"use strict";
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PromptVariant = exports.ToolChoice = exports.ChatMessage = exports.ChatMessageRole = exports.PromptTemplateType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
// ------------------------------------------------------
// COMMON
// ------------------------------------------------------
var PromptTemplateType;
(function (PromptTemplateType) {
    PromptTemplateType["TEXT"] = "TEXT";
    PromptTemplateType["CHAT"] = "CHAT";
})(PromptTemplateType || (exports.PromptTemplateType = PromptTemplateType = {}));
var ChatMessageRole;
(function (ChatMessageRole) {
    /**
     * This role represents the human user in the conversation. Inputs from the
     * user guide  the conversation and prompt responses from the assistant.
     */
    ChatMessageRole["USER"] = "user";
    /**
     * This is the role of the model itself, responding to user inputs based on
     * the context set by the system.
     */
    ChatMessageRole["ASSISTANT"] = "assistant";
})(ChatMessageRole || (exports.ChatMessageRole = ChatMessageRole = {}));
class ChatMessage {
    static user(text) {
        return new ChatMessage(ChatMessageRole.USER, text);
    }
    static assistant(text) {
        return new ChatMessage(ChatMessageRole.ASSISTANT, text);
    }
    constructor(role, text) {
        (this.role = role), (this.text = text);
    }
    /**
     * Renders as Cfn Property
     * @internal This is an internal core function and should not be called directly.
     */
    __render() {
        return {
            role: this.role,
            content: [
                {
                    text: this.text,
                },
            ],
        };
    }
}
exports.ChatMessage = ChatMessage;
_a = JSII_RTTI_SYMBOL_1;
ChatMessage[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ChatMessage", version: "0.1.309" };
class ToolChoice {
    /** The Model must request the specified tool. Only supported by some models like Anthropic Claude 3 models. */
    static specificTool(toolName) {
        return new ToolChoice(undefined, undefined, toolName);
    }
    constructor(any, auto, tool) {
        (this.any = any), (this.auto = auto), (this.tool = tool);
    }
    /**
     *
     * @internal
     */
    __render() {
        return {
            any: this.any,
            auto: this.auto,
            tool: this.tool ? { name: this.tool } : undefined,
        };
    }
}
exports.ToolChoice = ToolChoice;
_b = JSII_RTTI_SYMBOL_1;
ToolChoice[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ToolChoice", version: "0.1.309" };
/** The model must request at least one tool (no text is generated) */
ToolChoice.ANY = new ToolChoice({}, undefined, undefined);
/** (Default). The Model automatically decides if a tool should be called or whether to generate text instead.*/
ToolChoice.AUTO = new ToolChoice(undefined, {}, undefined);
// ------------------------------------------------------
// VARIANTS
// ------------------------------------------------------
/**
 * Variants are specific sets of inputs that guide FMs on Amazon Bedrock to
 * generate an appropriate response or output for a given task or instruction.
 * You can optimize the prompt for specific use cases and models.
 */
class PromptVariant {
    // ------------------------------------------------------
    // Static Methods
    // ------------------------------------------------------
    /**
     * Static method to create a text template
     */
    static text(props) {
        return {
            name: props.variantName,
            templateType: PromptTemplateType.TEXT,
            modelId: props.model.invokableArn,
            inferenceConfiguration: {
                text: { ...props.inferenceConfiguration },
            },
            templateConfiguration: {
                text: {
                    inputVariables: props.promptVariables?.flatMap((variable) => {
                        return { name: variable };
                    }),
                    text: props.promptText,
                },
            },
        };
    }
    /**
     * Static method to create a chat template. Use this template type when
     * the model supports the Converse API or the AnthropicClaude Messages API.
     * This allows you to include a System prompt and previous User messages
     * and Assistant messages for context.
     */
    static chat(props) {
        return {
            name: props.variantName,
            templateType: PromptTemplateType.CHAT,
            modelId: props.model.invokableArn,
            inferenceConfiguration: {
                text: { ...props.inferenceConfiguration },
            },
            templateConfiguration: {
                chat: {
                    inputVariables: props.promptVariables?.flatMap((variable) => {
                        return { name: variable };
                    }),
                    messages: props.messages?.flatMap(m => m.__render()),
                    system: props.system ? [{ text: props.system }] : undefined,
                    toolConfiguration: props.toolConfiguration
                        ? {
                            toolChoice: props.toolConfiguration.toolChoice.__render(),
                            tools: props.toolConfiguration.tools,
                        }
                        : undefined,
                },
            },
        };
    }
    /**
     * Static method to create an agent prompt template.
     */
    static agent(props) {
        return {
            name: props.variantName,
            templateType: PromptTemplateType.TEXT,
            genAiResource: {
                agent: {
                    agentIdentifier: props.agentAlias.aliasArn,
                },
            },
            templateConfiguration: {
                text: {
                    inputVariables: props.promptVariables?.flatMap((variable) => {
                        return { name: variable };
                    }),
                    text: props.promptText,
                },
            },
        };
    }
    // ------------------------------------------------------
    // Constructor
    // ------------------------------------------------------
    constructor() { }
}
exports.PromptVariant = PromptVariant;
_c = JSII_RTTI_SYMBOL_1;
PromptVariant[_c] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.PromptVariant", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvbXB0LXZhcmlhbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL3Byb21wdHMvcHJvbXB0LXZhcmlhbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFrQkEseURBQXlEO0FBQ3pELFNBQVM7QUFDVCx5REFBeUQ7QUFDekQsSUFBWSxrQkFHWDtBQUhELFdBQVksa0JBQWtCO0lBQzVCLG1DQUFhLENBQUE7SUFDYixtQ0FBYSxDQUFBO0FBQ2YsQ0FBQyxFQUhXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBRzdCO0FBeURELElBQVksZUFXWDtBQVhELFdBQVksZUFBZTtJQUN6Qjs7O09BR0c7SUFDSCxnQ0FBYSxDQUFBO0lBQ2I7OztPQUdHO0lBQ0gsMENBQXVCLENBQUE7QUFDekIsQ0FBQyxFQVhXLGVBQWUsK0JBQWYsZUFBZSxRQVcxQjtBQUVELE1BQWEsV0FBVztJQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBWTtRQUM3QixPQUFPLElBQUksV0FBVyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUNNLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBWTtRQUNsQyxPQUFPLElBQUksV0FBVyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUlELFlBQVksSUFBcUIsRUFBRSxJQUFZO1FBQzdDLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUNEOzs7T0FHRztJQUNJLFFBQVE7UUFDYixPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsT0FBTyxFQUFFO2dCQUNQO29CQUNFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtpQkFDaEI7YUFDRjtTQUNG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QUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO29CQUMzRCxpQkFBaUIsRUFBRSxLQUFLLENBQUMsaUJBQWlCO3dCQUN4QyxDQUFDLENBQUM7NEJBQ0EsVUFBVSxFQUFFLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFOzRCQUN6RCxLQUFLLEVBQUUsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEtBQUs7eUJBQ3JDO3dCQUNELENBQUMsQ0FBQyxTQUFTO2lCQUNkO2FBQ0Y7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUE4QjtRQUNoRCxPQUFPO1lBQ0wsSUFBSSxFQUFFLEtBQUssQ0FBQyxXQUFXO1lBQ3ZCLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJO1lBQ3JDLGFBQWEsRUFBRTtnQkFDYixLQUFLLEVBQUU7b0JBQ0wsZUFBZSxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUTtpQkFDM0M7YUFDRjtZQUNELHFCQUFxQixFQUFFO2dCQUNyQixJQUFJLEVBQUU7b0JBQ0osY0FBYyxFQUFFLEtBQUssQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO3dCQUNsRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO29CQUM1QixDQUFDLENBQUM7b0JBQ0YsSUFBSSxFQUFFLEtBQUssQ0FBQyxVQUFVO2lCQUN2QjthQUNGO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUE4QkQseURBQXlEO0lBQ3pELGNBQWM7SUFDZCx5REFBeUQ7SUFDekQsZ0JBQXlCLENBQUM7O0FBaEg1QixzQ0FpSEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBhd3NfYmVkcm9jayBhcyBiZWRyb2NrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgQ2ZuUHJvbXB0IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWJlZHJvY2snO1xuaW1wb3J0IHsgSUFnZW50QWxpYXMgfSBmcm9tICcuLi9hZ2VudHMvYWdlbnQtYWxpYXMnO1xuaW1wb3J0IHsgSUludm9rYWJsZSB9IGZyb20gJy4uL21vZGVscyc7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gQ09NTU9OXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBlbnVtIFByb21wdFRlbXBsYXRlVHlwZSB7XG4gIFRFWFQgPSAnVEVYVCcsXG4gIENIQVQgPSAnQ0hBVCcsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbW9uUHJvbXB0VmFyaWFudFByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9tcHQgdmFyaWFudC5cbiAgICovXG4gIHJlYWRvbmx5IHZhcmlhbnROYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgbW9kZWwgd2hpY2ggaXMgdXNlZCB0byBydW4gdGhlIHByb21wdC4gVGhlIG1vZGVsIGNvdWxkIGJlIGEgZm91bmRhdGlvblxuICAgKiBtb2RlbCwgYSBjdXN0b20gbW9kZWwsIG9yIGEgcHJvdmlzaW9uZWQgbW9kZWwuXG4gICAqL1xuICByZWFkb25seSBtb2RlbDogSUludm9rYWJsZTtcbiAgLyoqXG4gICAqIFRoZSB2YXJpYWJsZXMgaW4gdGhlIHByb21wdCB0ZW1wbGF0ZSB0aGF0IGNhbiBiZSBmaWxsZWQgaW4gYXQgcnVudGltZS5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdFZhcmlhYmxlcz86IHN0cmluZ1tdO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFRFWFRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGludGVyZmFjZSBUZXh0UHJvbXB0VmFyaWFudFByb3BzIGV4dGVuZHMgQ29tbW9uUHJvbXB0VmFyaWFudFByb3BzIHtcbiAgLyoqXG4gICAqIEluZmVyZW5jZSBjb25maWd1cmF0aW9uIGZvciB0aGUgVGV4dCBQcm9tcHRcbiAgICovXG4gIHJlYWRvbmx5IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24/OiBiZWRyb2NrLkNmblByb21wdC5Qcm9tcHRNb2RlbEluZmVyZW5jZUNvbmZpZ3VyYXRpb25Qcm9wZXJ0eTtcbiAgLyoqXG4gICAqIFRoZSB0ZXh0IHByb21wdC4gVmFyaWFibGVzIGFyZSB1c2VkIGJ5IGVuY2xvc2luZyBpdHMgbmFtZSB3aXRoIGRvdWJsZSBjdXJseSBicmFjZXNcbiAgICogYXMgaW4gYHt7dmFyaWFibGVfbmFtZX19YC5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdFRleHQ6IHN0cmluZztcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBDSEFUXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFByb21wdFZhcmlhbnRQcm9wcyBleHRlbmRzIENvbW1vblByb21wdFZhcmlhbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBJbmZlcmVuY2UgY29uZmlndXJhdGlvbiBmb3IgdGhlIENoYXQgUHJvbXB0LlxuICAgKiBNdXN0IGluY2x1ZGUgYXQgbGVhc3Qgb25lIFVzZXIgTWVzc2FnZS5cbiAgICogVGhlIG1lc3NhZ2VzIHNob3VsZCBhbHRlcm5hdGUgYmV0d2VlbiBVc2VyIGFuZCBBc3Npc3RhbnQuXG4gICAqL1xuICByZWFkb25seSBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXTtcbiAgLyoqXG4gICAqIENvbnRleHQgb3IgaW5zdHJ1Y3Rpb25zIGZvciB0aGUgbW9kZWwgdG8gY29uc2lkZXIgYmVmb3JlIGdlbmVyYXRpbmcgYSByZXNwb25zZS5cbiAgICovXG4gIHJlYWRvbmx5IHN5c3RlbT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBjb25maWd1cmF0aW9uIHdpdGggYXZhaWxhYmxlIHRvb2xzIHRvIHRoZSBtb2RlbCBhbmQgaG93IGl0IG11c3QgdXNlIHRoZW0uXG4gICAqL1xuICByZWFkb25seSB0b29sQ29uZmlndXJhdGlvbj86IFRvb2xDb25maWd1cmF0aW9uO1xuICAvKipcbiAgICogSW5mZXJlbmNlIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBUZXh0IFByb21wdFxuICAgKi9cbiAgcmVhZG9ubHkgaW5mZXJlbmNlQ29uZmlndXJhdGlvbj86IGJlZHJvY2suQ2ZuUHJvbXB0LlByb21wdE1vZGVsSW5mZXJlbmNlQ29uZmlndXJhdGlvblByb3BlcnR5O1xufVxuXG5leHBvcnQgZW51bSBDaGF0TWVzc2FnZVJvbGUge1xuICAvKipcbiAgICogVGhpcyByb2xlIHJlcHJlc2VudHMgdGhlIGh1bWFuIHVzZXIgaW4gdGhlIGNvbnZlcnNhdGlvbi4gSW5wdXRzIGZyb20gdGhlXG4gICAqIHVzZXIgZ3VpZGUgIHRoZSBjb252ZXJzYXRpb24gYW5kIHByb21wdCByZXNwb25zZXMgZnJvbSB0aGUgYXNzaXN0YW50LlxuICAgKi9cbiAgVVNFUiA9ICd1c2VyJyxcbiAgLyoqXG4gICAqIFRoaXMgaXMgdGhlIHJvbGUgb2YgdGhlIG1vZGVsIGl0c2VsZiwgcmVzcG9uZGluZyB0byB1c2VyIGlucHV0cyBiYXNlZCBvblxuICAgKiB0aGUgY29udGV4dCBzZXQgYnkgdGhlIHN5c3RlbS5cbiAgICovXG4gIEFTU0lTVEFOVCA9ICdhc3Npc3RhbnQnLFxufVxuXG5leHBvcnQgY2xhc3MgQ2hhdE1lc3NhZ2Uge1xuICBwdWJsaWMgc3RhdGljIHVzZXIodGV4dDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBDaGF0TWVzc2FnZShDaGF0TWVzc2FnZVJvbGUuVVNFUiwgdGV4dCk7XG4gIH1cbiAgcHVibGljIHN0YXRpYyBhc3Npc3RhbnQodGV4dDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBDaGF0TWVzc2FnZShDaGF0TWVzc2FnZVJvbGUuQVNTSVNUQU5ULCB0ZXh0KTtcbiAgfVxuICBwdWJsaWMgcmVhZG9ubHkgcm9sZTogQ2hhdE1lc3NhZ2VSb2xlO1xuICBwdWJsaWMgcmVhZG9ubHkgdGV4dDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHJvbGU6IENoYXRNZXNzYWdlUm9sZSwgdGV4dDogc3RyaW5nKSB7XG4gICAgKHRoaXMucm9sZSA9IHJvbGUpLCAodGhpcy50ZXh0ID0gdGV4dCk7XG4gIH1cbiAgLyoqXG4gICAqIFJlbmRlcnMgYXMgQ2ZuIFByb3BlcnR5XG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHVibGljIF9fcmVuZGVyKCk6IENmblByb21wdC5NZXNzYWdlUHJvcGVydHkge1xuICAgIHJldHVybiB7XG4gICAgICByb2xlOiB0aGlzLnJvbGUsXG4gICAgICBjb250ZW50OiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0ZXh0OiB0aGlzLnRleHQsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb29sQ29uZmlndXJhdGlvbiB7XG4gIHJlYWRvbmx5IHRvb2xDaG9pY2U6IFRvb2xDaG9pY2U7XG4gIHJlYWRvbmx5IHRvb2xzOiBDZm5Qcm9tcHQuVG9vbFByb3BlcnR5W107XG59XG5cbmV4cG9ydCBjbGFzcyBUb29sQ2hvaWNlIHtcbiAgLyoqIFRoZSBtb2RlbCBtdXN0IHJlcXVlc3QgYXQgbGVhc3Qgb25lIHRvb2wgKG5vIHRleHQgaXMgZ2VuZXJhdGVkKSAqL1xuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEFOWSA9IG5ldyBUb29sQ2hvaWNlKHt9LCB1bmRlZmluZWQsIHVuZGVmaW5lZCk7XG4gIC8qKiAoRGVmYXVsdCkuIFRoZSBNb2RlbCBhdXRvbWF0aWNhbGx5IGRlY2lkZXMgaWYgYSB0b29sIHNob3VsZCBiZSBjYWxsZWQgb3Igd2hldGhlciB0byBnZW5lcmF0ZSB0ZXh0IGluc3RlYWQuKi9cbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBBVVRPID0gbmV3IFRvb2xDaG9pY2UodW5kZWZpbmVkLCB7fSwgdW5kZWZpbmVkKTtcbiAgLyoqIFRoZSBNb2RlbCBtdXN0IHJlcXVlc3QgdGhlIHNwZWNpZmllZCB0b29sLiBPbmx5IHN1cHBvcnRlZCBieSBzb21lIG1vZGVscyBsaWtlIEFudGhyb3BpYyBDbGF1ZGUgMyBtb2RlbHMuICovXG4gIHB1YmxpYyBzdGF0aWMgc3BlY2lmaWNUb29sKHRvb2xOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IFRvb2xDaG9pY2UodW5kZWZpbmVkLCB1bmRlZmluZWQsIHRvb2xOYW1lKTtcbiAgfVxuICBwdWJsaWMgcmVhZG9ubHkgYW55PzogYW55O1xuICBwdWJsaWMgcmVhZG9ubHkgYXV0bz86IGFueTtcbiAgcHVibGljIHJlYWRvbmx5IHRvb2w/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoYW55OiBhbnksIGF1dG86IGFueSwgdG9vbD86IHN0cmluZykge1xuICAgICh0aGlzLmFueSA9IGFueSksICh0aGlzLmF1dG8gPSBhdXRvKSwgKHRoaXMudG9vbCA9IHRvb2wpO1xuICB9XG4gIC8qKlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHB1YmxpYyBfX3JlbmRlcigpOiBDZm5Qcm9tcHQuVG9vbENob2ljZVByb3BlcnR5IHtcbiAgICByZXR1cm4ge1xuICAgICAgYW55OiB0aGlzLmFueSxcbiAgICAgIGF1dG86IHRoaXMuYXV0byxcbiAgICAgIHRvb2w6IHRoaXMudG9vbCA/IHsgbmFtZTogdGhpcy50b29sIH0gOiB1bmRlZmluZWQsXG4gICAgfTtcbiAgfVxufVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBBR0VOVFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRQcm9tcHRWYXJpYW50UHJvcHMgZXh0ZW5kcyBDb21tb25Qcm9tcHRWYXJpYW50UHJvcHMge1xuICAvKipcbiAgICogQW4gYWxpYXMgcG9pbnRpbmcgdG8gdGhlIGFnZW50IHZlcnNpb24gdG8gYmUgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50QWxpYXM6IElBZ2VudEFsaWFzO1xuICAvKipcbiAgICogVGhlIHRleHQgcHJvbXB0LiBWYXJpYWJsZXMgYXJlIHVzZWQgYnkgZW5jbG9zaW5nIGl0cyBuYW1lIHdpdGggZG91YmxlIGN1cmx5IGJyYWNlc1xuICAgKiBhcyBpbiBge3t2YXJpYWJsZV9uYW1lfX1gLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0VGV4dDogc3RyaW5nO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFZBUklBTlRTXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8qKlxuICogVmFyaWFudHMgYXJlIHNwZWNpZmljIHNldHMgb2YgaW5wdXRzIHRoYXQgZ3VpZGUgRk1zIG9uIEFtYXpvbiBCZWRyb2NrIHRvXG4gKiBnZW5lcmF0ZSBhbiBhcHByb3ByaWF0ZSByZXNwb25zZSBvciBvdXRwdXQgZm9yIGEgZ2l2ZW4gdGFzayBvciBpbnN0cnVjdGlvbi5cbiAqIFlvdSBjYW4gb3B0aW1pemUgdGhlIHByb21wdCBmb3Igc3BlY2lmaWMgdXNlIGNhc2VzIGFuZCBtb2RlbHMuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBQcm9tcHRWYXJpYW50IHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFN0YXRpYyBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogU3RhdGljIG1ldGhvZCB0byBjcmVhdGUgYSB0ZXh0IHRlbXBsYXRlXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHRleHQocHJvcHM6IFRleHRQcm9tcHRWYXJpYW50UHJvcHMpOiBQcm9tcHRWYXJpYW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogcHJvcHMudmFyaWFudE5hbWUsXG4gICAgICB0ZW1wbGF0ZVR5cGU6IFByb21wdFRlbXBsYXRlVHlwZS5URVhULFxuICAgICAgbW9kZWxJZDogcHJvcHMubW9kZWwuaW52b2thYmxlQXJuLFxuICAgICAgaW5mZXJlbmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICB0ZXh0OiB7IC4uLnByb3BzLmluZmVyZW5jZUNvbmZpZ3VyYXRpb24gfSxcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgdGV4dDoge1xuICAgICAgICAgIGlucHV0VmFyaWFibGVzOiBwcm9wcy5wcm9tcHRWYXJpYWJsZXM/LmZsYXRNYXAoKHZhcmlhYmxlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7IG5hbWU6IHZhcmlhYmxlIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgdGV4dDogcHJvcHMucHJvbXB0VGV4dCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGF0aWMgbWV0aG9kIHRvIGNyZWF0ZSBhIGNoYXQgdGVtcGxhdGUuIFVzZSB0aGlzIHRlbXBsYXRlIHR5cGUgd2hlblxuICAgKiB0aGUgbW9kZWwgc3VwcG9ydHMgdGhlIENvbnZlcnNlIEFQSSBvciB0aGUgQW50aHJvcGljQ2xhdWRlIE1lc3NhZ2VzIEFQSS5cbiAgICogVGhpcyBhbGxvd3MgeW91IHRvIGluY2x1ZGUgYSBTeXN0ZW0gcHJvbXB0IGFuZCBwcmV2aW91cyBVc2VyIG1lc3NhZ2VzXG4gICAqIGFuZCBBc3Npc3RhbnQgbWVzc2FnZXMgZm9yIGNvbnRleHQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNoYXQocHJvcHM6IENoYXRQcm9tcHRWYXJpYW50UHJvcHMpOiBQcm9tcHRWYXJpYW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogcHJvcHMudmFyaWFudE5hbWUsXG4gICAgICB0ZW1wbGF0ZVR5cGU6IFByb21wdFRlbXBsYXRlVHlwZS5DSEFULFxuICAgICAgbW9kZWxJZDogcHJvcHMubW9kZWwuaW52b2thYmxlQXJuLFxuICAgICAgaW5mZXJlbmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICB0ZXh0OiB7IC4uLnByb3BzLmluZmVyZW5jZUNvbmZpZ3VyYXRpb24gfSxcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgY2hhdDoge1xuICAgICAgICAgIGlucHV0VmFyaWFibGVzOiBwcm9wcy5wcm9tcHRWYXJpYWJsZXM/LmZsYXRNYXAoKHZhcmlhYmxlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7IG5hbWU6IHZhcmlhYmxlIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgbWVzc2FnZXM6IHByb3BzLm1lc3NhZ2VzPy5mbGF0TWFwKG0gPT4gbS5fX3JlbmRlcigpKSxcbiAgICAgICAgICBzeXN0ZW06IHByb3BzLnN5c3RlbSA/IFt7IHRleHQ6IHByb3BzLnN5c3RlbSB9XSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICB0b29sQ29uZmlndXJhdGlvbjogcHJvcHMudG9vbENvbmZpZ3VyYXRpb25cbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICB0b29sQ2hvaWNlOiBwcm9wcy50b29sQ29uZmlndXJhdGlvbi50b29sQ2hvaWNlLl9fcmVuZGVyKCksXG4gICAgICAgICAgICAgIHRvb2xzOiBwcm9wcy50b29sQ29uZmlndXJhdGlvbi50b29scyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXRpYyBtZXRob2QgdG8gY3JlYXRlIGFuIGFnZW50IHByb21wdCB0ZW1wbGF0ZS5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYWdlbnQocHJvcHM6IEFnZW50UHJvbXB0VmFyaWFudFByb3BzKTogUHJvbXB0VmFyaWFudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHByb3BzLnZhcmlhbnROYW1lLFxuICAgICAgdGVtcGxhdGVUeXBlOiBQcm9tcHRUZW1wbGF0ZVR5cGUuVEVYVCxcbiAgICAgIGdlbkFpUmVzb3VyY2U6IHtcbiAgICAgICAgYWdlbnQ6IHtcbiAgICAgICAgICBhZ2VudElkZW50aWZpZXI6IHByb3BzLmFnZW50QWxpYXMuYWxpYXNBcm4sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIHRleHQ6IHtcbiAgICAgICAgICBpbnB1dFZhcmlhYmxlczogcHJvcHMucHJvbXB0VmFyaWFibGVzPy5mbGF0TWFwKCh2YXJpYWJsZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4geyBuYW1lOiB2YXJpYWJsZSB9O1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHRleHQ6IHByb3BzLnByb21wdFRleHQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHJvcGVydGllc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9tcHQgdmFyaWFudC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBwcm9tcHQgdGVtcGxhdGUuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgdGVtcGxhdGVUeXBlOiBQcm9tcHRUZW1wbGF0ZVR5cGU7XG4gIC8qKlxuICAgKiBUaGUgaW5mZXJlbmNlIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgaW5mZXJlbmNlQ29uZmlndXJhdGlvbj86IGJlZHJvY2suQ2ZuUHJvbXB0LlByb21wdEluZmVyZW5jZUNvbmZpZ3VyYXRpb25Qcm9wZXJ0eTtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgbW9kZWwgd2l0aCB3aGljaCB0byBydW4gaW5mZXJlbmNlIG9uIHRoZSBwcm9tcHQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgbW9kZWxJZD86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0ZW1wbGF0ZSBjb25maWd1cmF0aW9uLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHRlbXBsYXRlQ29uZmlndXJhdGlvbjogYmVkcm9jay5DZm5Qcm9tcHQuUHJvbXB0VGVtcGxhdGVDb25maWd1cmF0aW9uUHJvcGVydHk7XG4gIC8qKlxuICAgKiBUaGUgdGVtcGxhdGUgY29uZmlndXJhdGlvbi5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCBnZW5BaVJlc291cmNlPzogYmVkcm9jay5DZm5Qcm9tcHQuUHJvbXB0R2VuQWlSZXNvdXJjZVByb3BlcnR5O1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb25zdHJ1Y3RvclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCkge31cbn1cbiJdfQ==