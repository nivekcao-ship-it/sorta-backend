"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SalesforceDataSource = exports.SalesforceObjectType = exports.SalesforceDataSourceAuthType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * Represents the authentication types available for connecting to a Salesforce data source.
 */
var SalesforceDataSourceAuthType;
(function (SalesforceDataSourceAuthType) {
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     * - `consumerKey` (app client ID)
     * - `consumerSecret` (client secret)
     * - `authenticationUrl`
     */
    SalesforceDataSourceAuthType["OAUTH2_CLIENT_CREDENTIALS"] = "OAUTH2_CLIENT_CREDENTIALS";
})(SalesforceDataSourceAuthType || (exports.SalesforceDataSourceAuthType = SalesforceDataSourceAuthType = {}));
/**
 * Represents the Salesforce object types that can be accessed by the data source connector.
 */
var SalesforceObjectType;
(function (SalesforceObjectType) {
    SalesforceObjectType["ACCOUNT"] = "Account";
    SalesforceObjectType["ATTACHMENT"] = "Attachment";
    SalesforceObjectType["CAMPAIGN"] = "Campaign";
    SalesforceObjectType["CONTENT_VERSION"] = "ContentVersion";
    SalesforceObjectType["PARTNER"] = "Partner";
    SalesforceObjectType["PRICEBOOK_2"] = "Pricebook2";
    SalesforceObjectType["CASE"] = "Case";
    SalesforceObjectType["CONTACT"] = "Contact";
    SalesforceObjectType["CONTRACT"] = "Contract";
    SalesforceObjectType["DOCUMENT"] = "Document";
    SalesforceObjectType["IDEA"] = "Idea";
    SalesforceObjectType["LEAD"] = "Lead";
    SalesforceObjectType["OPPORTUNITY"] = "Opportunity";
    SalesforceObjectType["PRODUCT_2"] = "Product2";
    SalesforceObjectType["SOLUTION"] = "Solution";
    SalesforceObjectType["TASK"] = "Task";
    SalesforceObjectType["FEED_ITEM"] = "FeedItem";
    SalesforceObjectType["FEED_COMMENT"] = "FeedComment";
    SalesforceObjectType["KNOWLEDGE_KAV"] = "Knowledge__kav";
    SalesforceObjectType["USER"] = "User";
    SalesforceObjectType["COLLABORATION_GROUP"] = "CollaborationGroup";
})(SalesforceObjectType || (exports.SalesforceObjectType = SalesforceObjectType = {}));
/**
 * Sets up an data source to be added to a knowledge base.
 */
class SalesforceDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.SALESFORCE;
        this.dataSourceName =
            props.dataSourceName ?? (0, utils_1.generatePhysicalNameV2)(this, 'sfdc-ds', { maxLength: 40, lower: true, separator: '-' });
        this.endpoint = props.endpoint;
        this.authSecret = props.authSecret;
        this.kmsKey = props.kmsKey;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        this.authSecret.grantRead(this.knowledgeBase.role);
        // ------------------------------------------------------
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                salesforceConfiguration: {
                    sourceConfiguration: {
                        authType: SalesforceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS,
                        credentialsSecretArn: this.authSecret.secretArn,
                        hostUrl: this.endpoint,
                    },
                    crawlerConfiguration: props.filters
                        ? {
                            filterConfiguration: {
                                type: 'PATTERN',
                                patternObjectFilter: {
                                    filters: props.filters?.map(item => ({
                                        objectType: item.objectType,
                                        inclusionFilters: item.includePatterns,
                                        exclusionFilters: item.excludePatterns,
                                    })),
                                },
                            },
                        }
                        : undefined,
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.SalesforceDataSource = SalesforceDataSource;
_a = JSII_RTTI_SYMBOL_1;
SalesforceDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.SalesforceDataSource", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FsZXNmb3JjZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL3NhbGVzZm9yY2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILHlEQUF3RDtBQU14RCx5REFBK0Y7QUFDL0YseURBQXVFO0FBRXZFOztHQUVHO0FBQ0gsSUFBWSw0QkFRWDtBQVJELFdBQVksNEJBQTRCO0lBQ3RDOzs7OztPQUtHO0lBQ0gsdUZBQXVELENBQUE7QUFDekQsQ0FBQyxFQVJXLDRCQUE0Qiw0Q0FBNUIsNEJBQTRCLFFBUXZDO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLG9CQXNCWDtBQXRCRCxXQUFZLG9CQUFvQjtJQUM5QiwyQ0FBbUIsQ0FBQTtJQUNuQixpREFBeUIsQ0FBQTtJQUN6Qiw2Q0FBcUIsQ0FBQTtJQUNyQiwwREFBa0MsQ0FBQTtJQUNsQywyQ0FBbUIsQ0FBQTtJQUNuQixrREFBMEIsQ0FBQTtJQUMxQixxQ0FBYSxDQUFBO0lBQ2IsMkNBQW1CLENBQUE7SUFDbkIsNkNBQXFCLENBQUE7SUFDckIsNkNBQXFCLENBQUE7SUFDckIscUNBQWEsQ0FBQTtJQUNiLHFDQUFhLENBQUE7SUFDYixtREFBMkIsQ0FBQTtJQUMzQiw4Q0FBc0IsQ0FBQTtJQUN0Qiw2Q0FBcUIsQ0FBQTtJQUNyQixxQ0FBYSxDQUFBO0lBQ2IsOENBQXNCLENBQUE7SUFDdEIsb0RBQTRCLENBQUE7SUFDNUIsd0RBQWdDLENBQUE7SUFDaEMscUNBQWEsQ0FBQTtJQUNiLGtFQUEwQyxDQUFBO0FBQzVDLENBQUMsRUF0Qlcsb0JBQW9CLG9DQUFwQixvQkFBb0IsUUFzQi9CO0FBb0REOztHQUVHO0FBQ0gsTUFBYSxvQkFBcUIsU0FBUSxnQ0FBYTtJQTRDckQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFnQztRQUN4RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLG9CQUFvQjtRQUNwQixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUM7UUFDekMsSUFBSSxDQUFDLGNBQWMsR0FBRyxpQ0FBYyxDQUFDLFVBQVUsQ0FBQztRQUNoRCxJQUFJLENBQUMsY0FBYztZQUNqQixLQUFLLENBQUMsY0FBYyxJQUFJLElBQUEsOEJBQXNCLEVBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNsSCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFDL0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUUzQix5REFBeUQ7UUFDekQseUNBQXlDO1FBQ3pDLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVuRCx5REFBeUQ7UUFFekQseURBQXlEO1FBQ3pELG1CQUFtQjtRQUNuQix5REFBeUQ7UUFDekQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDJCQUFhLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUN0RCxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUU7Z0JBQzlCLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYztnQkFDekIsdUJBQXVCLEVBQUU7b0JBQ3ZCLG1CQUFtQixFQUFFO3dCQUNuQixRQUFRLEVBQUUsNEJBQTRCLENBQUMseUJBQXlCO3dCQUNoRSxvQkFBb0IsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVM7d0JBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUTtxQkFDdkI7b0JBQ0Qsb0JBQW9CLEVBQUUsS0FBSyxDQUFDLE9BQU87d0JBQ2pDLENBQUMsQ0FBQzs0QkFDQSxtQkFBbUIsRUFBRTtnQ0FDbkIsSUFBSSxFQUFFLFNBQVM7Z0NBQ2YsbUJBQW1CLEVBQUU7b0NBQ25CLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7d0NBQ25DLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTt3Q0FDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGVBQWU7d0NBQ3RDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxlQUFlO3FDQUN2QyxDQUFDLENBQUM7aUNBQ0o7NkJBQ0Y7eUJBQ0Y7d0JBQ0QsQ0FBQyxDQUFDLFNBQVM7aUJBQ2Q7YUFDRixDQUFDO1NBQ0gsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDO0lBQ3ZELENBQUM7O0FBOUZILG9EQStGQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENmbkRhdGFTb3VyY2UgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgeyBJS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBJU2VjcmV0IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXNlY3JldHNtYW5hZ2VyJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuXG5pbXBvcnQgeyBJS25vd2xlZGdlQmFzZSB9IGZyb20gJy4vLi4va25vd2xlZGdlLWJhc2VzL2tub3dsZWRnZS1iYXNlJztcbmltcG9ydCB7IERhdGFTb3VyY2VOZXcsIERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLCBEYXRhU291cmNlVHlwZSB9IGZyb20gJy4vYmFzZS1kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGF1dGhlbnRpY2F0aW9uIHR5cGVzIGF2YWlsYWJsZSBmb3IgY29ubmVjdGluZyB0byBhIFNhbGVzZm9yY2UgZGF0YSBzb3VyY2UuXG4gKi9cbmV4cG9ydCBlbnVtIFNhbGVzZm9yY2VEYXRhU291cmNlQXV0aFR5cGUge1xuICAvKipcbiAgICogWW91ciBzZWNyZXQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgaW4gQVdTIFNlY3JldHMgTWFuYWdlciBzaG91bGQgaW5jbHVkZTpcbiAgICogLSBgY29uc3VtZXJLZXlgIChhcHAgY2xpZW50IElEKVxuICAgKiAtIGBjb25zdW1lclNlY3JldGAgKGNsaWVudCBzZWNyZXQpXG4gICAqIC0gYGF1dGhlbnRpY2F0aW9uVXJsYFxuICAgKi9cbiAgT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUyA9ICdPQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTJyxcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBTYWxlc2ZvcmNlIG9iamVjdCB0eXBlcyB0aGF0IGNhbiBiZSBhY2Nlc3NlZCBieSB0aGUgZGF0YSBzb3VyY2UgY29ubmVjdG9yLlxuICovXG5leHBvcnQgZW51bSBTYWxlc2ZvcmNlT2JqZWN0VHlwZSB7XG4gIEFDQ09VTlQgPSAnQWNjb3VudCcsXG4gIEFUVEFDSE1FTlQgPSAnQXR0YWNobWVudCcsXG4gIENBTVBBSUdOID0gJ0NhbXBhaWduJyxcbiAgQ09OVEVOVF9WRVJTSU9OID0gJ0NvbnRlbnRWZXJzaW9uJyxcbiAgUEFSVE5FUiA9ICdQYXJ0bmVyJyxcbiAgUFJJQ0VCT09LXzIgPSAnUHJpY2Vib29rMicsXG4gIENBU0UgPSAnQ2FzZScsXG4gIENPTlRBQ1QgPSAnQ29udGFjdCcsXG4gIENPTlRSQUNUID0gJ0NvbnRyYWN0JyxcbiAgRE9DVU1FTlQgPSAnRG9jdW1lbnQnLFxuICBJREVBID0gJ0lkZWEnLFxuICBMRUFEID0gJ0xlYWQnLFxuICBPUFBPUlRVTklUWSA9ICdPcHBvcnR1bml0eScsXG4gIFBST0RVQ1RfMiA9ICdQcm9kdWN0MicsXG4gIFNPTFVUSU9OID0gJ1NvbHV0aW9uJyxcbiAgVEFTSyA9ICdUYXNrJyxcbiAgRkVFRF9JVEVNID0gJ0ZlZWRJdGVtJyxcbiAgRkVFRF9DT01NRU5UID0gJ0ZlZWRDb21tZW50JyxcbiAgS05PV0xFREdFX0tBViA9ICdLbm93bGVkZ2VfX2thdicsXG4gIFVTRVIgPSAnVXNlcicsXG4gIENPTExBQk9SQVRJT05fR1JPVVAgPSAnQ29sbGFib3JhdGlvbkdyb3VwJyxcbn1cblxuLyoqXG4gKiBEZWZpbmVzIHRoZSBjcmF3bGluZyBmaWx0ZXJzIGZvciBTYWxlc2ZvcmNlIGRhdGEgaW5nZXN0aW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNhbGVzZm9yY2VDcmF3bGluZ0ZpbHRlcnMge1xuICAvKipcbiAgICogVGhlIFNhbGVzZm9yY2Ugb2JqZWN0IHR5cGUgdG8gd2hpY2ggdGhpcyBmaWx0ZXIgYXBwbGllcy5cbiAgICovXG4gIHJlYWRvbmx5IG9iamVjdFR5cGU6IFNhbGVzZm9yY2VPYmplY3RUeXBlO1xuICAvKipcbiAgICogUmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zIHRvIGluY2x1ZGUgc3BlY2lmaWMgY29udGVudC5cbiAgICovXG4gIHJlYWRvbmx5IGluY2x1ZGVQYXR0ZXJucz86IHN0cmluZ1tdO1xuICAvKipcbiAgICogUmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zIHRvIGV4Y2x1ZGUgc3BlY2lmaWMgY29udGVudC5cbiAgICovXG4gIHJlYWRvbmx5IGV4Y2x1ZGVQYXR0ZXJucz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIEludGVyZmFjZSB0byBhZGQgYSBuZXcgZGF0YSBzb3VyY2UgdG8gYW4gZXhpc3RpbmcgS0IuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIGV4dGVuZHMgRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIFNhbGVzZm9yY2UgaG9zdCBVUkwgb3IgaW5zdGFuY2UgVVJMLlxuICAgKiBAZXhhbXBsZSBcImh0dHBzOi8vY29tcGFueS5zYWxlc2ZvcmNlLmNvbS9cIlxuICAgKi9cbiAgcmVhZG9ubHkgZW5kcG9pbnQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBBV1MgU2VjcmV0cyBNYW5hZ2VyIHNlY3JldCB0aGF0IHN0b3JlcyB5b3VyIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzXG4gICAqIGZvciB5b3VyIFNhbGVzZm9yY2UgaW5zdGFuY2UgVVJMLiBTZWNyZXQgbXVzdCBzdGFydCB3aXRoIFwiQW1hem9uQmVkcm9jay1cIi5cbiAgICovXG4gIHJlYWRvbmx5IGF1dGhTZWNyZXQ6IElTZWNyZXQ7XG4gIC8qKlxuICAgKiBUaGUgZmlsdGVycyAocmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zKSBmb3IgdGhlIGNyYXdsaW5nLlxuICAgKiBJZiB0aGVyZSdzIGEgY29uZmxpY3QsIHRoZSBleGNsdWRlIHBhdHRlcm4gdGFrZXMgcHJlY2VkZW5jZS5cbiAgICogQGRlZmF1bHQgTm9uZSAtIGFsbCB5b3VyIGNvbnRlbnQgaXMgY3Jhd2xlZC5cbiAgICovXG4gIHJlYWRvbmx5IGZpbHRlcnM/OiBTYWxlc2ZvcmNlQ3Jhd2xpbmdGaWx0ZXJzW107XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHRvIGNyZWF0ZSBhIG5ldyBzdGFuZGFsb25lIGRhdGEgc291cmNlIG9iamVjdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTYWxlc2ZvcmNlRGF0YVNvdXJjZVByb3BzIGV4dGVuZHMgU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSB0byBhc3NvY2lhdGUgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZTtcbn1cblxuLyoqXG4gKiBTZXRzIHVwIGFuIGRhdGEgc291cmNlIHRvIGJlIGFkZGVkIHRvIGEga25vd2xlZGdlIGJhc2UuXG4gKi9cbmV4cG9ydCBjbGFzcyBTYWxlc2ZvcmNlRGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2VOZXcge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tbW9uIGF0dHJpYnV0ZXMgZm9yIGFsbCBuZXcgZGF0YSBzb3VyY2VzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICogQGV4YW1wbGUgJ0pIVUVWWFVaTVUnXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlVHlwZTogRGF0YVNvdXJjZVR5cGU7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZU5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSBhc3NvY2lhdGVkIHdpdGggdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdG8gdXNlIHRvIGVuY3J5cHQgdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBVbmlxdWUgdG8gdGhpcyBjbGFzc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBTYWxlc2ZvcmNlIGhvc3QgVVJMIG9yIGluc3RhbmNlIFVSTC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBlbmRwb2ludDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2VjcmV0IHRoYXQgc3RvcmVzIHlvdXIgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYXV0aFNlY3JldDogSVNlY3JldDtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEludGVybmFsIE9ubHlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgRGF0YSBTb3VyY2UgY2ZuIHJlc291cmNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBDZm5EYXRhU291cmNlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICAvLyBBc3NpZ24gYXR0cmlidXRlc1xuICAgIHRoaXMua25vd2xlZGdlQmFzZSA9IHByb3BzLmtub3dsZWRnZUJhc2U7XG4gICAgdGhpcy5kYXRhU291cmNlVHlwZSA9IERhdGFTb3VyY2VUeXBlLlNBTEVTRk9SQ0U7XG4gICAgdGhpcy5kYXRhU291cmNlTmFtZSA9XG4gICAgICBwcm9wcy5kYXRhU291cmNlTmFtZSA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdzZmRjLWRzJywgeyBtYXhMZW5ndGg6IDQwLCBsb3dlcjogdHJ1ZSwgc2VwYXJhdG9yOiAnLScgfSk7XG4gICAgdGhpcy5lbmRwb2ludCA9IHByb3BzLmVuZHBvaW50O1xuICAgIHRoaXMuYXV0aFNlY3JldCA9IHByb3BzLmF1dGhTZWNyZXQ7XG4gICAgdGhpcy5rbXNLZXkgPSBwcm9wcy5rbXNLZXk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBNYW5hZ2UgcGVybWlzc2lvbnMgZm9yIHRoZSBkYXRhIHNvdXJjZVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuaGFuZGxlQ29tbW9uUGVybWlzc2lvbnMocHJvcHMpO1xuICAgIHRoaXMuYXV0aFNlY3JldC5ncmFudFJlYWQodGhpcy5rbm93bGVkZ2VCYXNlLnJvbGUpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IENmbkRhdGFTb3VyY2UodGhpcywgJ0RhdGFTb3VyY2UnLCB7XG4gICAgICAuLi50aGlzLmZvcm1hdEFzQ2ZuUHJvcHMocHJvcHMsIHtcbiAgICAgICAgdHlwZTogdGhpcy5kYXRhU291cmNlVHlwZSxcbiAgICAgICAgc2FsZXNmb3JjZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBzb3VyY2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICBhdXRoVHlwZTogU2FsZXNmb3JjZURhdGFTb3VyY2VBdXRoVHlwZS5PQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTLFxuICAgICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHRoaXMuYXV0aFNlY3JldC5zZWNyZXRBcm4sXG4gICAgICAgICAgICBob3N0VXJsOiB0aGlzLmVuZHBvaW50LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3Jhd2xlckNvbmZpZ3VyYXRpb246IHByb3BzLmZpbHRlcnNcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBmaWx0ZXJDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BBVFRFUk4nLFxuICAgICAgICAgICAgICAgIHBhdHRlcm5PYmplY3RGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHByb3BzLmZpbHRlcnM/Lm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IGl0ZW0ub2JqZWN0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVzaW9uRmlsdGVyczogaXRlbS5pbmNsdWRlUGF0dGVybnMsXG4gICAgICAgICAgICAgICAgICAgIGV4Y2x1c2lvbkZpbHRlcnM6IGl0ZW0uZXhjbHVkZVBhdHRlcm5zLFxuICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRhU291cmNlSWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckRhdGFTb3VyY2VJZDtcbiAgfVxufVxuIl19