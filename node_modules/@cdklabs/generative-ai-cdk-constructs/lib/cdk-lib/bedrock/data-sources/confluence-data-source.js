"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfluenceDataSource = exports.ConfluenceObjectType = exports.ConfluenceDataSourceAuthType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * The different authentication types available to connect to your Confluence instance.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/confluence-data-source-connector.html#configuration-confluence-connector
 */
var ConfluenceDataSourceAuthType;
(function (ConfluenceDataSourceAuthType) {
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     * - `confluenceAppKey`
     * - `confluenceAppSecret`
     * - `confluenceAccessToken`
     * - `confluenceRefreshToken`
     */
    ConfluenceDataSourceAuthType["OAUTH2_CLIENT_CREDENTIALS"] = "OAUTH2_CLIENT_CREDENTIALS";
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     *  - `username` (email of admin account)
     *  - `password` (API token)
     */
    ConfluenceDataSourceAuthType["BASIC"] = "BASIC";
})(ConfluenceDataSourceAuthType || (exports.ConfluenceDataSourceAuthType = ConfluenceDataSourceAuthType = {}));
/**
 * Represents the different types of content objects in Confluence that can be
 * crawled by the data source.
 */
var ConfluenceObjectType;
(function (ConfluenceObjectType) {
    ConfluenceObjectType["SPACE"] = "Space";
    ConfluenceObjectType["PAGE"] = "Page";
    ConfluenceObjectType["BLOG"] = "Blog";
    ConfluenceObjectType["COMMENT"] = "Comment";
    ConfluenceObjectType["ATTACHMENT"] = "Attachment";
})(ConfluenceObjectType || (exports.ConfluenceObjectType = ConfluenceObjectType = {}));
/**
 * Sets up a Confluence Data Source to be added to a knowledge base.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/confluence-data-source-connector.html
 */
class ConfluenceDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign common attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.CONFLUENCE;
        this.dataSourceName =
            props.dataSourceName ??
                (0, utils_1.generatePhysicalNameV2)(this, 'confluence-ds', { maxLength: 40, lower: true, separator: '-' });
        this.kmsKey = props.kmsKey;
        // Assign unique attributes
        this.confluenceUrl = props.confluenceUrl;
        this.authSecret = props.authSecret;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        this.authSecret.grantRead(this.knowledgeBase.role);
        // Grant write permissions to the knowledge base role for updating the secret.
        // This is necessary when using OAuth 2.0 authentication with a refresh token.
        if (props.authType === ConfluenceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS) {
            this.authSecret.grantWrite(this.knowledgeBase.role);
        }
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                confluenceConfiguration: {
                    sourceConfiguration: {
                        authType: props.authType ?? ConfluenceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS,
                        credentialsSecretArn: this.authSecret.secretArn,
                        hostUrl: this.confluenceUrl,
                        hostType: 'SAAS',
                    },
                    crawlerConfiguration: props.filters
                        ? {
                            filterConfiguration: {
                                type: 'PATTERN',
                                patternObjectFilter: {
                                    filters: props.filters?.map(item => ({
                                        objectType: item.objectType,
                                        inclusionFilters: item.includePatterns,
                                        exclusionFilters: item.excludePatterns,
                                    })),
                                },
                            },
                        }
                        : undefined,
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.ConfluenceDataSource = ConfluenceDataSource;
_a = JSII_RTTI_SYMBOL_1;
ConfluenceDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ConfluenceDataSource", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmx1ZW5jZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL2NvbmZsdWVuY2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILHlEQUF3RDtBQU14RCx5REFBK0Y7QUFDL0YseURBQXVFO0FBRXZFOzs7R0FHRztBQUNILElBQVksNEJBZVg7QUFmRCxXQUFZLDRCQUE0QjtJQUN0Qzs7Ozs7O09BTUc7SUFDSCx1RkFBdUQsQ0FBQTtJQUN2RDs7OztPQUlHO0lBQ0gsK0NBQWUsQ0FBQTtBQUNqQixDQUFDLEVBZlcsNEJBQTRCLDRDQUE1Qiw0QkFBNEIsUUFldkM7QUFFRDs7O0dBR0c7QUFDSCxJQUFZLG9CQU1YO0FBTkQsV0FBWSxvQkFBb0I7SUFDOUIsdUNBQWUsQ0FBQTtJQUNmLHFDQUFhLENBQUE7SUFDYixxQ0FBYSxDQUFBO0lBQ2IsMkNBQW1CLENBQUE7SUFDbkIsaURBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQU5XLG9CQUFvQixvQ0FBcEIsb0JBQW9CLFFBTS9CO0FBNkVEOzs7R0FHRztBQUNILE1BQWEsb0JBQXFCLFNBQVEsZ0NBQWE7SUE0Q3JELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBZ0M7UUFDeEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxjQUFjLEdBQUcsaUNBQWMsQ0FBQyxVQUFVLENBQUM7UUFDaEQsSUFBSSxDQUFDLGNBQWM7WUFDakIsS0FBSyxDQUFDLGNBQWM7Z0JBQ3BCLElBQUEsOEJBQXNCLEVBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNoRyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDM0IsMkJBQTJCO1FBQzNCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztRQUN6QyxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUM7UUFFbkMseURBQXlEO1FBQ3pELHlDQUF5QztRQUN6Qyx5REFBeUQ7UUFDekQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkQsOEVBQThFO1FBQzlFLDhFQUE4RTtRQUM5RSxJQUFJLEtBQUssQ0FBQyxRQUFRLEtBQUssNEJBQTRCLENBQUMseUJBQXlCLEVBQUUsQ0FBQztZQUM5RSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCx5REFBeUQ7UUFDekQsbUJBQW1CO1FBQ25CLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksMkJBQWEsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ3RELEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRTtnQkFDOUIsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjO2dCQUN6Qix1QkFBdUIsRUFBRTtvQkFDdkIsbUJBQW1CLEVBQUU7d0JBQ25CLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxJQUFJLDRCQUE0QixDQUFDLHlCQUF5Qjt3QkFDbEYsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTO3dCQUMvQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWE7d0JBQzNCLFFBQVEsRUFBRSxNQUFNO3FCQUNqQjtvQkFDRCxvQkFBb0IsRUFBRSxLQUFLLENBQUMsT0FBTzt3QkFDakMsQ0FBQyxDQUFDOzRCQUNBLG1CQUFtQixFQUFFO2dDQUNuQixJQUFJLEVBQUUsU0FBUztnQ0FDZixtQkFBbUIsRUFBRTtvQ0FDbkIsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzt3Q0FDbkMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO3dDQUMzQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsZUFBZTt3Q0FDdEMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGVBQWU7cUNBQ3ZDLENBQUMsQ0FBQztpQ0FDSjs2QkFDRjt5QkFDRjt3QkFDRCxDQUFDLENBQUMsU0FBUztpQkFDZDthQUNGLENBQUM7U0FDSCxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUM7SUFDdkQsQ0FBQzs7QUFwR0gsb0RBcUdDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ2ZuRGF0YVNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IElLZXkgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IElTZWNyZXQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc2VjcmV0c21hbmFnZXInO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5cbmltcG9ydCB7IElLbm93bGVkZ2VCYXNlIH0gZnJvbSAnLi8uLi9rbm93bGVkZ2UtYmFzZXMva25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMsIERhdGFTb3VyY2VOZXcsIERhdGFTb3VyY2VUeXBlIH0gZnJvbSAnLi9iYXNlLWRhdGEtc291cmNlJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5cbi8qKlxuICogVGhlIGRpZmZlcmVudCBhdXRoZW50aWNhdGlvbiB0eXBlcyBhdmFpbGFibGUgdG8gY29ubmVjdCB0byB5b3VyIENvbmZsdWVuY2UgaW5zdGFuY2UuXG4gKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvY29uZmx1ZW5jZS1kYXRhLXNvdXJjZS1jb25uZWN0b3IuaHRtbCNjb25maWd1cmF0aW9uLWNvbmZsdWVuY2UtY29ubmVjdG9yXG4gKi9cbmV4cG9ydCBlbnVtIENvbmZsdWVuY2VEYXRhU291cmNlQXV0aFR5cGUge1xuICAvKipcbiAgICogWW91ciBzZWNyZXQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgaW4gQVdTIFNlY3JldHMgTWFuYWdlciBzaG91bGQgaW5jbHVkZTpcbiAgICogLSBgY29uZmx1ZW5jZUFwcEtleWBcbiAgICogLSBgY29uZmx1ZW5jZUFwcFNlY3JldGBcbiAgICogLSBgY29uZmx1ZW5jZUFjY2Vzc1Rva2VuYFxuICAgKiAtIGBjb25mbHVlbmNlUmVmcmVzaFRva2VuYFxuICAgKi9cbiAgT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUyA9ICdPQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTJyxcbiAgLyoqXG4gICAqIFlvdXIgc2VjcmV0IGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGluIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2hvdWxkIGluY2x1ZGU6XG4gICAqICAtIGB1c2VybmFtZWAgKGVtYWlsIG9mIGFkbWluIGFjY291bnQpXG4gICAqICAtIGBwYXNzd29yZGAgKEFQSSB0b2tlbilcbiAgICovXG4gIEJBU0lDID0gJ0JBU0lDJyxcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgY29udGVudCBvYmplY3RzIGluIENvbmZsdWVuY2UgdGhhdCBjYW4gYmVcbiAqIGNyYXdsZWQgYnkgdGhlIGRhdGEgc291cmNlLlxuICovXG5leHBvcnQgZW51bSBDb25mbHVlbmNlT2JqZWN0VHlwZSB7XG4gIFNQQUNFID0gJ1NwYWNlJyxcbiAgUEFHRSA9ICdQYWdlJyxcbiAgQkxPRyA9ICdCbG9nJyxcbiAgQ09NTUVOVCA9ICdDb21tZW50JyxcbiAgQVRUQUNITUVOVCA9ICdBdHRhY2htZW50Jyxcbn1cblxuLyoqXG4gKiBEZWZpbmVzIGZpbHRlcnMgZm9yIGNyYXdsaW5nIENvbmZsdWVuY2UgY29udGVudC5cbiAqIFRoZXNlIGZpbHRlcnMgYWxsb3cgeW91IHRvIGluY2x1ZGUgb3IgZXhjbHVkZSBzcGVjaWZpYyBjb250ZW50IGJhc2VkIG9uIG9iamVjdCB0eXBlcyBhbmQgcGF0dGVybnMuXG4gKlxuICogLSBGb3IgU3BhY2VzOiBVc2UgdGhlIHVuaXF1ZSBzcGFjZSBrZXlcbiAqIC0gRm9yIFBhZ2VzOiBVc2UgdGhlIG1haW4gcGFnZSB0aXRsZVxuICogLSBGb3IgQmxvZ3M6IFVzZSB0aGUgbWFpbiBibG9nIHRpdGxlXG4gKiAtIEZvciBDb21tZW50czogVXNlIFwiUmU6IFBhZ2UvQmxvZyBUaXRsZVwiXG4gKiAtIEZvciBBdHRhY2htZW50czogVXNlIHRoZSBmaWxlbmFtZSB3aXRoIGV4dGVuc2lvblxuICogQHJlbWFya3NcbiAqIC0gWW91IGNhbiBzcGVjaWZ5IGluY2x1c2lvbiBhbmQgZXhjbHVzaW9uIHBhdHRlcm5zIHVzaW5nIHJlZ3VsYXIgZXhwcmVzc2lvbnMuXG4gKiAtIElmIGJvdGggaW5jbHVzaW9uIGFuZCBleGNsdXNpb24gcGF0dGVybnMgbWF0Y2ggYSBkb2N1bWVudCwgdGhlIGV4Y2x1c2lvbiB0YWtlcyBwcmVjZWRlbmNlLlxuICpcbiAqIEBleGFtcGxlXG4gKiB7XG4gKiAgIG9iamVjdFR5cGU6IENvbmZsdWVuY2VPYmplY3RUeXBlLkFUVEFDSE1FTlQsXG4gKiAgIGV4Y2x1ZGVQYXR0ZXJuczogW1wiLipwcml2YXRlLipcXFxcLnBkZlwiXVxuICogfVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbmZsdWVuY2VDcmF3bGluZ0ZpbHRlcnMge1xuICAvKipcbiAgICogVGhlIHR5cGUgb2YgQ29uZmx1ZW5jZSBvYmplY3QgdG8gYXBwbHkgdGhlIGZpbHRlcnMgdG8uXG4gICAqL1xuICByZWFkb25seSBvYmplY3RUeXBlOiBDb25mbHVlbmNlT2JqZWN0VHlwZTtcblxuICAvKipcbiAgICogUmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zIHRvIGluY2x1ZGUgY29udGVudC5cbiAgICogSWYgc3BlY2lmaWVkLCBvbmx5IGNvbnRlbnQgbWF0Y2hpbmcgdGhlc2UgcGF0dGVybnMgd2lsbCBiZSBjcmF3bGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5jbHVkZVBhdHRlcm5zPzogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucyB0byBleGNsdWRlIGNvbnRlbnQuXG4gICAqIENvbnRlbnQgbWF0Y2hpbmcgdGhlc2UgcGF0dGVybnMgd2lsbCBub3QgYmUgY3Jhd2xlZCwgZXZlbiBpZiBpdCBtYXRjaGVzIGFuIGluY2x1ZGUgcGF0dGVybi5cbiAgICovXG4gIHJlYWRvbmx5IGV4Y2x1ZGVQYXR0ZXJucz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIEludGVyZmFjZSB0byBhZGQgYSBuZXcgZGF0YSBzb3VyY2UgdG8gYW4gZXhpc3RpbmcgS0IuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmx1ZW5jZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIGV4dGVuZHMgRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIENvbmZsdWVuY2UgaG9zdCBVUkwgb3IgaW5zdGFuY2UgVVJMLlxuICAgKiBAZXhhbXBsZSBodHRwczovL2V4YW1wbGUuYXRsYXNzaWFuLm5ldFxuICAgKi9cbiAgcmVhZG9ubHkgY29uZmx1ZW5jZVVybDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2VjcmV0IHRoYXQgc3RvcmVzIHlvdXIgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHNcbiAgICogZm9yIHlvdXIgQ29uZmx1ZW5jZSBpbnN0YW5jZSBVUkwuIFNlY3JldCBtdXN0IHN0YXJ0IHdpdGggXCJBbWF6b25CZWRyb2NrLVwiLlxuICAgKi9cbiAgcmVhZG9ubHkgYXV0aFNlY3JldDogSVNlY3JldDtcbiAgLyoqXG4gICAqIFRoZSBzdXBwb3J0ZWQgYXV0aGVudGljYXRpb24gbWV0aG9kIHRvIGNvbm5lY3QgdG8gdGhlIGRhdGEgc291cmNlLlxuICAgKiBAZGVmYXVsdCBDb25mbHVlbmNlRGF0YVNvdXJjZUF1dGhUeXBlLk9BVVRIMl9DTElFTlRfQ1JFREVOVElBTFNcbiAgICovXG4gIHJlYWRvbmx5IGF1dGhUeXBlPzogQ29uZmx1ZW5jZURhdGFTb3VyY2VBdXRoVHlwZTtcbiAgLyoqXG4gICAqIFRoZSBmaWx0ZXJzIChyZWd1bGFyIGV4cHJlc3Npb24gcGF0dGVybnMpIGZvciB0aGUgY3Jhd2xpbmcuXG4gICAqIElmIHRoZXJlJ3MgYSBjb25mbGljdCwgdGhlIGV4Y2x1ZGUgcGF0dGVybiB0YWtlcyBwcmVjZWRlbmNlLlxuICAgKiBAZGVmYXVsdCBOb25lIC0gYWxsIHlvdXIgY29udGVudCBpcyBjcmF3bGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZmlsdGVycz86IENvbmZsdWVuY2VDcmF3bGluZ0ZpbHRlcnNbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gY3JlYXRlIGEgbmV3IHN0YW5kYWxvbmUgZGF0YSBzb3VyY2Ugb2JqZWN0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbmZsdWVuY2VEYXRhU291cmNlUHJvcHMgZXh0ZW5kcyBDb25mbHVlbmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xufVxuXG4vKipcbiAqIFNldHMgdXAgYSBDb25mbHVlbmNlIERhdGEgU291cmNlIHRvIGJlIGFkZGVkIHRvIGEga25vd2xlZGdlIGJhc2UuXG4gKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvY29uZmx1ZW5jZS1kYXRhLXNvdXJjZS1jb25uZWN0b3IuaHRtbFxuICovXG5leHBvcnQgY2xhc3MgQ29uZmx1ZW5jZURhdGFTb3VyY2UgZXh0ZW5kcyBEYXRhU291cmNlTmV3IHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbW1vbiBhdHRyaWJ1dGVzIGZvciBhbGwgbmV3IGRhdGEgc291cmNlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqIEBleGFtcGxlICdKSFVFVlhVWk1VJ1xuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFTb3VyY2VJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHR5cGUgb2YgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZVR5cGU6IERhdGFTb3VyY2VUeXBlO1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFTb3VyY2VOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUga25vd2xlZGdlIGJhc2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZTtcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IHRvIHVzZSB0byBlbmNyeXB0IHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbXNLZXk/OiBJS2V5O1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gVW5pcXVlIHRvIHRoaXMgY2xhc3NcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgQ29uZmx1ZW5jZSBob3N0IFVSTCBvciBpbnN0YW5jZSBVUkwuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29uZmx1ZW5jZVVybDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2VjcmV0IHRoYXQgc3RvcmVzIHlvdXIgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYXV0aFNlY3JldDogSVNlY3JldDtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEludGVybmFsIE9ubHlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgRGF0YSBTb3VyY2UgY2ZuIHJlc291cmNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBDZm5EYXRhU291cmNlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBDb25mbHVlbmNlRGF0YVNvdXJjZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICAvLyBBc3NpZ24gY29tbW9uIGF0dHJpYnV0ZXNcbiAgICB0aGlzLmtub3dsZWRnZUJhc2UgPSBwcm9wcy5rbm93bGVkZ2VCYXNlO1xuICAgIHRoaXMuZGF0YVNvdXJjZVR5cGUgPSBEYXRhU291cmNlVHlwZS5DT05GTFVFTkNFO1xuICAgIHRoaXMuZGF0YVNvdXJjZU5hbWUgPVxuICAgICAgcHJvcHMuZGF0YVNvdXJjZU5hbWUgPz9cbiAgICAgIGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2NvbmZsdWVuY2UtZHMnLCB7IG1heExlbmd0aDogNDAsIGxvd2VyOiB0cnVlLCBzZXBhcmF0b3I6ICctJyB9KTtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcbiAgICAvLyBBc3NpZ24gdW5pcXVlIGF0dHJpYnV0ZXNcbiAgICB0aGlzLmNvbmZsdWVuY2VVcmwgPSBwcm9wcy5jb25mbHVlbmNlVXJsO1xuICAgIHRoaXMuYXV0aFNlY3JldCA9IHByb3BzLmF1dGhTZWNyZXQ7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBNYW5hZ2UgcGVybWlzc2lvbnMgZm9yIHRoZSBkYXRhIHNvdXJjZVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuaGFuZGxlQ29tbW9uUGVybWlzc2lvbnMocHJvcHMpO1xuICAgIHRoaXMuYXV0aFNlY3JldC5ncmFudFJlYWQodGhpcy5rbm93bGVkZ2VCYXNlLnJvbGUpO1xuXG4gICAgLy8gR3JhbnQgd3JpdGUgcGVybWlzc2lvbnMgdG8gdGhlIGtub3dsZWRnZSBiYXNlIHJvbGUgZm9yIHVwZGF0aW5nIHRoZSBzZWNyZXQuXG4gICAgLy8gVGhpcyBpcyBuZWNlc3Nhcnkgd2hlbiB1c2luZyBPQXV0aCAyLjAgYXV0aGVudGljYXRpb24gd2l0aCBhIHJlZnJlc2ggdG9rZW4uXG4gICAgaWYgKHByb3BzLmF1dGhUeXBlID09PSBDb25mbHVlbmNlRGF0YVNvdXJjZUF1dGhUeXBlLk9BVVRIMl9DTElFTlRfQ1JFREVOVElBTFMpIHtcbiAgICAgIHRoaXMuYXV0aFNlY3JldC5ncmFudFdyaXRlKHRoaXMua25vd2xlZGdlQmFzZS5yb2xlKTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTDEgSW5zdGFudGlhdGlvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuX19yZXNvdXJjZSA9IG5ldyBDZm5EYXRhU291cmNlKHRoaXMsICdEYXRhU291cmNlJywge1xuICAgICAgLi4udGhpcy5mb3JtYXRBc0NmblByb3BzKHByb3BzLCB7XG4gICAgICAgIHR5cGU6IHRoaXMuZGF0YVNvdXJjZVR5cGUsXG4gICAgICAgIGNvbmZsdWVuY2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgc291cmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgYXV0aFR5cGU6IHByb3BzLmF1dGhUeXBlID8/IENvbmZsdWVuY2VEYXRhU291cmNlQXV0aFR5cGUuT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUyxcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiB0aGlzLmF1dGhTZWNyZXQuc2VjcmV0QXJuLFxuICAgICAgICAgICAgaG9zdFVybDogdGhpcy5jb25mbHVlbmNlVXJsLFxuICAgICAgICAgICAgaG9zdFR5cGU6ICdTQUFTJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyYXdsZXJDb25maWd1cmF0aW9uOiBwcm9wcy5maWx0ZXJzXG4gICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgZmlsdGVyQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQQVRURVJOJyxcbiAgICAgICAgICAgICAgICBwYXR0ZXJuT2JqZWN0RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBwcm9wcy5maWx0ZXJzPy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBpdGVtLm9iamVjdFR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1c2lvbkZpbHRlcnM6IGl0ZW0uaW5jbHVkZVBhdHRlcm5zLFxuICAgICAgICAgICAgICAgICAgICBleGNsdXNpb25GaWx0ZXJzOiBpdGVtLmV4Y2x1ZGVQYXR0ZXJucyxcbiAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGF0YVNvdXJjZUlkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJEYXRhU291cmNlSWQ7XG4gIH1cbn1cbiJdfQ==