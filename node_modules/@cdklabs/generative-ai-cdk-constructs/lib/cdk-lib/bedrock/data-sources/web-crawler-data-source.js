"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebCrawlerDataSource = exports.CrawlingScope = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * The scope of the crawling.
 */
var CrawlingScope;
(function (CrawlingScope) {
    /**
     * Crawls only web pages that belong to the same host or primary domain.
     */
    CrawlingScope["HOST_ONLY"] = "HOST_ONLY";
    /**
     * Includes subdomains in addition to the host or primary domain, i.e.
     * web pages that contain "aws.amazon.com" can also include
     * sub domain "docs.aws.amazon.com"
     */
    CrawlingScope["SUBDOMAINS"] = "SUBDOMAINS";
    /**
     * Limit crawling to web pages that belong to the same host and with the
     * same initial URL path.
     */
    CrawlingScope["DEFAULT"] = "DEFAULT";
})(CrawlingScope || (exports.CrawlingScope = CrawlingScope = {}));
/**
 * Sets up a web crawler data source to be added to a knowledge base.
 */
class WebCrawlerDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.WEB_CRAWLER;
        this.dataSourceName =
            props.dataSourceName ??
                (0, utils_1.generatePhysicalNameV2)(this, 'crawler-ds', { maxLength: 40, lower: true, separator: '-' });
        this.kmsKey = props.kmsKey;
        this.crawlingRate = props.crawlingRate ?? 300;
        this.siteUrls = props.sourceUrls;
        this.maxPages = props.maxPages ?? 25000;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                webConfiguration: {
                    crawlerConfiguration: {
                        crawlerLimits: {
                            rateLimit: this.crawlingRate,
                            maxPages: this.maxPages,
                        },
                        scope: props.crawlingScope !== CrawlingScope.DEFAULT ? props.crawlingScope : undefined,
                        inclusionFilters: props.filters?.includePatterns,
                        exclusionFilters: props.filters?.excludePatterns,
                        userAgent: props.userAgent,
                        userAgentHeader: props.userAgentHeader,
                    },
                    sourceConfiguration: {
                        urlConfiguration: {
                            seedUrls: props.sourceUrls.map(item => ({ url: item })),
                        },
                    },
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.WebCrawlerDataSource = WebCrawlerDataSource;
_a = JSII_RTTI_SYMBOL_1;
WebCrawlerDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.WebCrawlerDataSource", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLWNyYXdsZXItZGF0YS1zb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2RhdGEtc291cmNlcy93ZWItY3Jhd2xlci1kYXRhLXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgseURBQXdEO0FBS3hELHlEQUErRjtBQUMvRix5REFBdUU7QUFFdkU7O0dBRUc7QUFDSCxJQUFZLGFBZ0JYO0FBaEJELFdBQVksYUFBYTtJQUN2Qjs7T0FFRztJQUNILHdDQUF1QixDQUFBO0lBQ3ZCOzs7O09BSUc7SUFDSCwwQ0FBeUIsQ0FBQTtJQUN6Qjs7O09BR0c7SUFDSCxvQ0FBbUIsQ0FBQTtBQUNyQixDQUFDLEVBaEJXLGFBQWEsNkJBQWIsYUFBYSxRQWdCeEI7QUE0RUQ7O0dBRUc7QUFDSCxNQUFhLG9CQUFxQixTQUFRLGdDQUFhO0lBZ0RyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQWdDO1FBQ3hFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsb0JBQW9CO1FBQ3BCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztRQUN6QyxJQUFJLENBQUMsY0FBYyxHQUFHLGlDQUFjLENBQUMsV0FBVyxDQUFDO1FBQ2pELElBQUksQ0FBQyxjQUFjO1lBQ2pCLEtBQUssQ0FBQyxjQUFjO2dCQUNwQixJQUFBLDhCQUFzQixFQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDN0YsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzNCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLFlBQVksSUFBSSxHQUFHLENBQUM7UUFDOUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUM7UUFDeEMseURBQXlEO1FBQ3pELHlDQUF5QztRQUN6Qyx5REFBeUQ7UUFDekQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXBDLHlEQUF5RDtRQUN6RCxtQkFBbUI7UUFDbkIseURBQXlEO1FBRXpELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSwyQkFBYSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDdEQsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFO2dCQUM5QixJQUFJLEVBQUUsSUFBSSxDQUFDLGNBQWM7Z0JBQ3pCLGdCQUFnQixFQUFFO29CQUNoQixvQkFBb0IsRUFBRTt3QkFDcEIsYUFBYSxFQUFFOzRCQUNiLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWTs0QkFDNUIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO3lCQUN4Qjt3QkFDRCxLQUFLLEVBQUUsS0FBSyxDQUFDLGFBQWEsS0FBSyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxTQUFTO3dCQUN0RixnQkFBZ0IsRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLGVBQWU7d0JBQ2hELGdCQUFnQixFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsZUFBZTt3QkFDaEQsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO3dCQUMxQixlQUFlLEVBQUUsS0FBSyxDQUFDLGVBQWU7cUJBQ3ZDO29CQUNELG1CQUFtQixFQUFFO3dCQUNuQixnQkFBZ0IsRUFBRTs0QkFDaEIsUUFBUSxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO3lCQUN4RDtxQkFDRjtpQkFDRjthQUNGLENBQUM7U0FDSCxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUM7SUFDdkQsQ0FBQzs7QUE5Rkgsb0RBK0ZDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ2ZuRGF0YVNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IElLZXkgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuXG5pbXBvcnQgeyBJS25vd2xlZGdlQmFzZSB9IGZyb20gJy4vLi4va25vd2xlZGdlLWJhc2VzL2tub3dsZWRnZS1iYXNlJztcbmltcG9ydCB7IERhdGFTb3VyY2VOZXcsIERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLCBEYXRhU291cmNlVHlwZSB9IGZyb20gJy4vYmFzZS1kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuXG4vKipcbiAqIFRoZSBzY29wZSBvZiB0aGUgY3Jhd2xpbmcuXG4gKi9cbmV4cG9ydCBlbnVtIENyYXdsaW5nU2NvcGUge1xuICAvKipcbiAgICogQ3Jhd2xzIG9ubHkgd2ViIHBhZ2VzIHRoYXQgYmVsb25nIHRvIHRoZSBzYW1lIGhvc3Qgb3IgcHJpbWFyeSBkb21haW4uXG4gICAqL1xuICBIT1NUX09OTFkgPSAnSE9TVF9PTkxZJyxcbiAgLyoqXG4gICAqIEluY2x1ZGVzIHN1YmRvbWFpbnMgaW4gYWRkaXRpb24gdG8gdGhlIGhvc3Qgb3IgcHJpbWFyeSBkb21haW4sIGkuZS5cbiAgICogd2ViIHBhZ2VzIHRoYXQgY29udGFpbiBcImF3cy5hbWF6b24uY29tXCIgY2FuIGFsc28gaW5jbHVkZVxuICAgKiBzdWIgZG9tYWluIFwiZG9jcy5hd3MuYW1hem9uLmNvbVwiXG4gICAqL1xuICBTVUJET01BSU5TID0gJ1NVQkRPTUFJTlMnLFxuICAvKipcbiAgICogTGltaXQgY3Jhd2xpbmcgdG8gd2ViIHBhZ2VzIHRoYXQgYmVsb25nIHRvIHRoZSBzYW1lIGhvc3QgYW5kIHdpdGggdGhlXG4gICAqIHNhbWUgaW5pdGlhbCBVUkwgcGF0aC5cbiAgICovXG4gIERFRkFVTFQgPSAnREVGQVVMVCcsXG59XG5cbi8qKlxuICogVGhlIGZpbHRlcnMgKHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucykgdG8gaW5jbHVkZSBvciBleGNsdWRlIGluIHRoZSBjcmF3bGluZ1xuICogaW4gYWNjb3JkYW5jZSB3aXRoIHlvdXIgc2NvcGUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ3Jhd2xpbmdGaWx0ZXJzIHtcbiAgLyoqXG4gICAqIEluY2x1ZGUgcGF0dGVybnMuXG4gICAqL1xuICByZWFkb25seSBpbmNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIEV4Y2x1ZGUgcGF0aHMuXG4gICAqL1xuICByZWFkb25seSBleGNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gYWRkIGEgbmV3IGRhdGEgc291cmNlIHRvIGFuIGV4aXN0aW5nIEtCLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFdlYkNyYXdsZXJEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyBleHRlbmRzIERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBzb3VyY2UgdXJscyBpbiB0aGUgZm9ybWF0IGBodHRwczovL3d3dy5zaXRlbmFtZS5jb21gLlxuICAgKiBNYXhpbXVtIG9mIDEwMCBVUkxzLlxuICAgKi9cbiAgcmVhZG9ubHkgc291cmNlVXJsczogc3RyaW5nW107XG4gIC8qKlxuICAgKiBUaGUgc2NvcGUgb2YgdGhlIGNyYXdsaW5nLlxuICAgKiBAZGVmYXVsdCAtIENyYXdsaW5nU2NvcGUuREVGQVVMVFxuICAgKi9cbiAgcmVhZG9ubHkgY3Jhd2xpbmdTY29wZT86IENyYXdsaW5nU2NvcGU7XG4gIC8qKlxuICAgKiBUaGUgbWF4IHJhdGUgYXQgd2hpY2ggcGFnZXMgYXJlIGNyYXdsZWQsIHVwIHRvIDMwMCBwZXIgbWludXRlIHBlciBob3N0LlxuICAgKiBIaWdoZXIgdmFsdWVzIHdpbGwgZGVjcmVhc2Ugc3luYyB0aW1lIGJ1dCBpbmNyZWFzZSB0aGUgbG9hZCBvbiB0aGUgaG9zdC5cbiAgICogQGRlZmF1bHQgMzAwXG4gICAqL1xuICByZWFkb25seSBjcmF3bGluZ1JhdGU/OiBudW1iZXI7XG4gIC8qKlxuICAgKiBUaGUgZmlsdGVycyAocmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zKSBmb3IgdGhlIGNyYXdsaW5nLlxuICAgKiBJZiB0aGVyZSdzIGEgY29uZmxpY3QsIHRoZSBleGNsdWRlIHBhdHRlcm4gdGFrZXMgcHJlY2VkZW5jZS5cbiAgICogQGRlZmF1bHQgTm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZmlsdGVycz86IENyYXdsaW5nRmlsdGVycztcbiAgLyoqXG4gICAqIFRoZSB1c2VyIGFnZW50IHN0cmluZyB0byB1c2Ugd2hlbiBjcmF3bGluZy5cbiAgICogQGRlZmF1bHQgLSBEZWZhdWx0IHVzZXIgYWdlbnQgc3RyaW5nXG4gICAqL1xuICByZWFkb25seSB1c2VyQWdlbnQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdXNlciBhZ2VudCBoZWFkZXIgdG8gdXNlIHdoZW4gY3Jhd2xpbmcuIEEgc3RyaW5nIHVzZWQgZm9yIGlkZW50aWZ5aW5nXG4gICAqIHRoZSBjcmF3bGVyIG9yIGJvdCB3aGVuIGl0IGFjY2Vzc2VzIGEgd2ViIHNlcnZlci4gVGhlIHVzZXIgYWdlbnQgaGVhZGVyIHZhbHVlXG4gICAqIGNvbnNpc3RzIG9mIHRoZSBiZWRyb2NrYm90LCBVVUlELCBhbmQgYSB1c2VyIGFnZW50IHN1ZmZpeCBmb3IgeW91ciBjcmF3bGVyIChpZiBvbmUgaXMgcHJvdmlkZWQpLlxuICAgKiBCeSBkZWZhdWx0LCBpdCBpcyBzZXQgdG8gYmVkcm9ja2JvdF9VVUlELiBZb3UgY2FuIG9wdGlvbmFsbHkgYXBwZW5kIGEgY3VzdG9tIHN1ZmZpeCB0byBiZWRyb2NrYm90X1VVSURcbiAgICogdG8gYWxsb3dsaXN0IGEgc3BlY2lmaWMgdXNlciBhZ2VudCBwZXJtaXR0ZWQgdG8gYWNjZXNzIHlvdXIgc291cmNlIFVSTHMuXG4gICAqIEBkZWZhdWx0IC0gRGVmYXVsdCB1c2VyIGFnZW50IGhlYWRlciAoYmVkcm9ja2JvdF9VVUlEKVxuICAgKi9cbiAgcmVhZG9ubHkgdXNlckFnZW50SGVhZGVyPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHBhZ2VzIHRvIGNyYXdsLiBUaGUgbWF4IG51bWJlciBvZiB3ZWIgcGFnZXMgY3Jhd2xlZCBmcm9tIHlvdXIgc291cmNlIFVSTHMsXG4gICAqIHVwIHRvIDI1LDAwMCBwYWdlcy4gSWYgdGhlIHdlYiBwYWdlcyBleGNlZWQgdGhpcyBsaW1pdCwgdGhlIGRhdGEgc291cmNlIHN5bmMgd2lsbCBmYWlsIGFuZFxuICAgKiBubyB3ZWIgcGFnZXMgd2lsbCBiZSBpbmdlc3RlZC5cbiAgICogQGRlZmF1bHQgLSBObyBsaW1pdFxuICAgKi9cbiAgcmVhZG9ubHkgbWF4UGFnZXM/OiBudW1iZXI7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHRvIGNyZWF0ZSBhIG5ldyBzdGFuZGFsb25lIGRhdGEgc291cmNlIG9iamVjdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXZWJDcmF3bGVyRGF0YVNvdXJjZVByb3BzIGV4dGVuZHMgV2ViQ3Jhd2xlckRhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSB0byBhc3NvY2lhdGUgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZTtcbn1cblxuLyoqXG4gKiBTZXRzIHVwIGEgd2ViIGNyYXdsZXIgZGF0YSBzb3VyY2UgdG8gYmUgYWRkZWQgdG8gYSBrbm93bGVkZ2UgYmFzZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFdlYkNyYXdsZXJEYXRhU291cmNlIGV4dGVuZHMgRGF0YVNvdXJjZU5ldyB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21tb24gYXR0cmlidXRlcyBmb3IgYWxsIG5ldyBkYXRhIHNvdXJjZXNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKiBAZXhhbXBsZSAnSkhVRVZYVVpNVSdcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFTb3VyY2VUeXBlOiBEYXRhU291cmNlVHlwZTtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2U7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0byB1c2UgdG8gZW5jcnlwdCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFVuaXF1ZSB0byB0aGlzIGNsYXNzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIG1heCByYXRlIGF0IHdoaWNoIHBhZ2VzIGFyZSBjcmF3bGVkLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHNpdGVVcmxzOiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIFRoZSBtYXggcmF0ZSBhdCB3aGljaCBwYWdlcyBhcmUgY3Jhd2xlZC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjcmF3bGluZ1JhdGU6IG51bWJlcjtcbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiBwYWdlcyB0byBjcmF3bC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBtYXhQYWdlczogbnVtYmVyO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW50ZXJuYWwgT25seVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBEYXRhIFNvdXJjZSBjZm4gcmVzb3VyY2UuXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9fcmVzb3VyY2U6IENmbkRhdGFTb3VyY2U7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFdlYkNyYXdsZXJEYXRhU291cmNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIC8vIEFzc2lnbiBhdHRyaWJ1dGVzXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlID0gcHJvcHMua25vd2xlZGdlQmFzZTtcbiAgICB0aGlzLmRhdGFTb3VyY2VUeXBlID0gRGF0YVNvdXJjZVR5cGUuV0VCX0NSQVdMRVI7XG4gICAgdGhpcy5kYXRhU291cmNlTmFtZSA9XG4gICAgICBwcm9wcy5kYXRhU291cmNlTmFtZSA/P1xuICAgICAgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnY3Jhd2xlci1kcycsIHsgbWF4TGVuZ3RoOiA0MCwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pO1xuICAgIHRoaXMua21zS2V5ID0gcHJvcHMua21zS2V5O1xuICAgIHRoaXMuY3Jhd2xpbmdSYXRlID0gcHJvcHMuY3Jhd2xpbmdSYXRlID8/IDMwMDtcbiAgICB0aGlzLnNpdGVVcmxzID0gcHJvcHMuc291cmNlVXJscztcbiAgICB0aGlzLm1heFBhZ2VzID0gcHJvcHMubWF4UGFnZXMgPz8gMjUwMDA7XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTWFuYWdlIHBlcm1pc3Npb25zIGZvciB0aGUgZGF0YSBzb3VyY2VcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLmhhbmRsZUNvbW1vblBlcm1pc3Npb25zKHByb3BzKTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEwxIEluc3RhbnRpYXRpb25cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHRoaXMuX19yZXNvdXJjZSA9IG5ldyBDZm5EYXRhU291cmNlKHRoaXMsICdEYXRhU291cmNlJywge1xuICAgICAgLi4udGhpcy5mb3JtYXRBc0NmblByb3BzKHByb3BzLCB7XG4gICAgICAgIHR5cGU6IHRoaXMuZGF0YVNvdXJjZVR5cGUsXG4gICAgICAgIHdlYkNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBjcmF3bGVyQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgY3Jhd2xlckxpbWl0czoge1xuICAgICAgICAgICAgICByYXRlTGltaXQ6IHRoaXMuY3Jhd2xpbmdSYXRlLFxuICAgICAgICAgICAgICBtYXhQYWdlczogdGhpcy5tYXhQYWdlcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzY29wZTogcHJvcHMuY3Jhd2xpbmdTY29wZSAhPT0gQ3Jhd2xpbmdTY29wZS5ERUZBVUxUID8gcHJvcHMuY3Jhd2xpbmdTY29wZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGluY2x1c2lvbkZpbHRlcnM6IHByb3BzLmZpbHRlcnM/LmluY2x1ZGVQYXR0ZXJucyxcbiAgICAgICAgICAgIGV4Y2x1c2lvbkZpbHRlcnM6IHByb3BzLmZpbHRlcnM/LmV4Y2x1ZGVQYXR0ZXJucyxcbiAgICAgICAgICAgIHVzZXJBZ2VudDogcHJvcHMudXNlckFnZW50LFxuICAgICAgICAgICAgdXNlckFnZW50SGVhZGVyOiBwcm9wcy51c2VyQWdlbnRIZWFkZXIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzb3VyY2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICB1cmxDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgIHNlZWRVcmxzOiBwcm9wcy5zb3VyY2VVcmxzLm1hcChpdGVtID0+ICh7IHVybDogaXRlbSB9KSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGF0YVNvdXJjZUlkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJEYXRhU291cmNlSWQ7XG4gIH1cbn1cbiJdfQ==