"use strict";
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataSource = exports.DataSourceNew = exports.DataSourceBase = exports.DataSourceType = exports.DataDeletionPolicy = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
/**
 * Specifies the policy for handling data when a data source resource is deleted.
 * This policy affects the vector embeddings created from the data source.
 */
var DataDeletionPolicy;
(function (DataDeletionPolicy) {
    /**
     * Deletes all vector embeddings derived from the data source upon deletion
     * of a data source resource.
     */
    DataDeletionPolicy["DELETE"] = "DELETE";
    /**
     * Retains all vector embeddings derived from the data source even after
     * deletion of a data source resource.
     */
    DataDeletionPolicy["RETAIN"] = "RETAIN";
})(DataDeletionPolicy || (exports.DataDeletionPolicy = DataDeletionPolicy = {}));
/**
 * Represents the types of data sources that can be associated to an Knowledge Base.
 */
var DataSourceType;
(function (DataSourceType) {
    /**
     * Amazon S3 Bucket data source.
     */
    DataSourceType["S3"] = "S3";
    /**
     * Confluence Cloud Instance data source.
     */
    DataSourceType["CONFLUENCE"] = "CONFLUENCE";
    /**
     * Salesforce instance data source.
     */
    DataSourceType["SALESFORCE"] = "SALESFORCE";
    /**
     * Microsoft SharePoint instance data source.
     */
    DataSourceType["SHAREPOINT"] = "SHAREPOINT";
    /**
     * Web Crawler data source.
     * Extracts content from authorized public web pages using a crawler.
     */
    DataSourceType["WEB_CRAWLER"] = "WEB";
    /**
     * Custom data source.
     * A custom data source allows the flexibility to automatically ingest documents
     * into your vector database directly.
     */
    DataSourceType["CUSTOM"] = "CUSTOM";
    /**
     * Redshift Metadata data source.
     */
    DataSourceType["REDSHIFT_METADATA"] = "REDSHIFT_METADATA";
})(DataSourceType || (exports.DataSourceType = DataSourceType = {}));
/**
 * Specifies the base class for all data source resources (imported and new).
 */
class DataSourceBase extends aws_cdk_lib_1.Resource {
}
exports.DataSourceBase = DataSourceBase;
_a = JSII_RTTI_SYMBOL_1;
DataSourceBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSourceBase", version: "0.1.309" };
/**
 * Specifies the base class for all NEW data source resources of ANY type.
 */
class DataSourceNew extends DataSourceBase {
    // ------------------------------------------------------
    // Common methods for ALL NEW data sources
    // ------------------------------------------------------
    /**
     * Adds appropriate permissions to the KB execution role needed by the data source.
     */
    handleCommonPermissions(props) {
        let statementsToAdd = [];
        // Parsing strategy requires access to the parsing FM, so be sure to add permissions
        if (props.parsingStrategy) {
            statementsToAdd.push(...props.parsingStrategy.generatePolicyStatements());
        }
        // Custom transformation requires invoke permissions for the Lambda
        if (props.customTransformation) {
            statementsToAdd.push(...props.customTransformation.generatePolicyStatements(this));
        }
        // Context Enrichment requires invoke permissions for the enriching FM
        if (props.contextEnrichment) {
            statementsToAdd.push(...props.contextEnrichment.generatePolicyStatements());
        }
        // Add the permission statements to the KB execution role
        statementsToAdd.forEach((statement) => {
            this.knowledgeBase.role.addToPrincipalPolicy(statement);
        });
    }
    /**
     * Formats the data source configuration properties for CloudFormation.
     */
    formatAsCfnProps(props, dataSourceConfiguration) {
        return {
            dataDeletionPolicy: props.dataDeletionPolicy,
            dataSourceConfiguration: dataSourceConfiguration,
            description: props.description,
            knowledgeBaseId: this.knowledgeBase.knowledgeBaseId,
            name: this.dataSourceName,
            serverSideEncryptionConfiguration: props.kmsKey
                ? {
                    kmsKeyArn: props.kmsKey.keyArn,
                }
                : undefined,
            vectorIngestionConfiguration: props.chunkingStrategy ||
                props.parsingStrategy ||
                props.customTransformation ||
                props.contextEnrichment
                ? {
                    chunkingConfiguration: props.chunkingStrategy?.configuration,
                    parsingConfiguration: props.parsingStrategy?.configuration,
                    customTransformationConfiguration: props.customTransformation?.configuration,
                    contextEnrichmentConfiguration: props.contextEnrichment?.configuration,
                }
                : undefined,
        };
    }
}
exports.DataSourceNew = DataSourceNew;
_b = JSII_RTTI_SYMBOL_1;
DataSourceNew[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSourceNew", version: "0.1.309" };
class DataSource extends DataSourceBase {
    static fromDataSourceId(scope, id, dataSourceId) {
        return new DataSource(scope, id, dataSourceId);
    }
    constructor(scope, id, dataSourceId) {
        super(scope, id);
        this.dataSourceId = dataSourceId;
    }
}
exports.DataSource = DataSource;
_c = JSII_RTTI_SYMBOL_1;
DataSource[_c] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSource", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL2Jhc2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILDZDQUFrRDtBQVdsRDs7O0dBR0c7QUFDSCxJQUFZLGtCQVlYO0FBWkQsV0FBWSxrQkFBa0I7SUFDNUI7OztPQUdHO0lBQ0gsdUNBQWlCLENBQUE7SUFFakI7OztPQUdHO0lBQ0gsdUNBQWlCLENBQUE7QUFDbkIsQ0FBQyxFQVpXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBWTdCO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLGNBc0NYO0FBdENELFdBQVksY0FBYztJQUN4Qjs7T0FFRztJQUNILDJCQUFTLENBQUE7SUFFVDs7T0FFRztJQUNILDJDQUF5QixDQUFBO0lBRXpCOztPQUVHO0lBQ0gsMkNBQXlCLENBQUE7SUFFekI7O09BRUc7SUFDSCwyQ0FBeUIsQ0FBQTtJQUV6Qjs7O09BR0c7SUFDSCxxQ0FBbUIsQ0FBQTtJQUVuQjs7OztPQUlHO0lBQ0gsbUNBQWlCLENBQUE7SUFFakI7O09BRUc7SUFDSCx5REFBdUMsQ0FBQTtBQUN6QyxDQUFDLEVBdENXLGNBQWMsOEJBQWQsY0FBYyxRQXNDekI7QUFhRDs7R0FFRztBQUNILE1BQXNCLGNBQWUsU0FBUSxzQkFBUTs7QUFBckQsd0NBUUM7OztBQWdFRDs7R0FFRztBQUNILE1BQXNCLGFBQWMsU0FBUSxjQUFjO0lBdUJ4RCx5REFBeUQ7SUFDekQsMENBQTBDO0lBQzFDLHlEQUF5RDtJQUV6RDs7T0FFRztJQUNJLHVCQUF1QixDQUFDLEtBQWlDO1FBQzlELElBQUksZUFBZSxHQUFzQixFQUFFLENBQUM7UUFDNUMsb0ZBQW9GO1FBQ3BGLElBQUksS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzFCLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQztRQUM1RSxDQUFDO1FBQ0QsbUVBQW1FO1FBQ25FLElBQUksS0FBSyxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDL0IsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3JGLENBQUM7UUFDRCxzRUFBc0U7UUFDdEUsSUFBSSxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM1QixlQUFlLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQztRQUM5RSxDQUFDO1FBQ0QseURBQXlEO1FBQ3pELGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNJLGdCQUFnQixDQUNyQixLQUFpQyxFQUNqQyx1QkFBc0U7UUFFdEUsT0FBTztZQUNMLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxrQkFBa0I7WUFDNUMsdUJBQXVCLEVBQUUsdUJBQXVCO1lBQ2hELFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztZQUM5QixlQUFlLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlO1lBQ25ELElBQUksRUFBRSxJQUFJLENBQUMsY0FBYztZQUN6QixpQ0FBaUMsRUFBRSxLQUFLLENBQUMsTUFBTTtnQkFDN0MsQ0FBQyxDQUFDO29CQUNBLFNBQVMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU07aUJBQy9CO2dCQUNELENBQUMsQ0FBQyxTQUFTO1lBQ2IsNEJBQTRCLEVBQzFCLEtBQUssQ0FBQyxnQkFBZ0I7Z0JBQ3RCLEtBQUssQ0FBQyxlQUFlO2dCQUNyQixLQUFLLENBQUMsb0JBQW9CO2dCQUMxQixLQUFLLENBQUMsaUJBQWlCO2dCQUNyQixDQUFDLENBQUM7b0JBQ0EscUJBQXFCLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixFQUFFLGFBQWE7b0JBQzVELG9CQUFvQixFQUFFLEtBQUssQ0FBQyxlQUFlLEVBQUUsYUFBYTtvQkFDMUQsaUNBQWlDLEVBQUUsS0FBSyxDQUFDLG9CQUFvQixFQUFFLGFBQWE7b0JBQzVFLDhCQUE4QixFQUFFLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxhQUFhO2lCQUN2RTtnQkFDRCxDQUFDLENBQUMsU0FBUztTQUNoQixDQUFDO0lBQ0osQ0FBQzs7QUFqRkgsc0NBa0ZDOzs7QUFFRCxNQUFhLFVBQVcsU0FBUSxjQUFjO0lBQ3JDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFnQixFQUFFLEVBQVUsRUFBRSxZQUFvQjtRQUMvRSxPQUFPLElBQUksVUFBVSxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUlELFlBQW9CLEtBQWdCLEVBQUUsRUFBVSxFQUFFLFlBQW9CO1FBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbkMsQ0FBQzs7QUFWSCxnQ0FXQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IElSZXNvdXJjZSwgUmVzb3VyY2UgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBDZm5EYXRhU291cmNlLCBDZm5EYXRhU291cmNlUHJvcHMgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgeyBQb2xpY3lTdGF0ZW1lbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuXG5pbXBvcnQgeyBJS25vd2xlZGdlQmFzZSB9IGZyb20gJy4vLi4va25vd2xlZGdlLWJhc2VzL2tub3dsZWRnZS1iYXNlJztcbmltcG9ydCB7IENodW5raW5nU3RyYXRlZ3kgfSBmcm9tICcuL2NodW5raW5nJztcbmltcG9ydCB7IENvbnRleHRFbnJpY2htZW50IH0gZnJvbSAnLi9jb250ZXh0LWVucmljaG1lbnQnO1xuaW1wb3J0IHsgQ3VzdG9tVHJhbnNmb3JtYXRpb24gfSBmcm9tICcuL2N1c3RvbS10cmFuc2Zvcm1hdGlvbic7XG5pbXBvcnQgeyBQYXJzaW5nU3RyYXRlZ3kgfSBmcm9tICcuL3BhcnNpbmcnO1xuLyoqXG4gKiBTcGVjaWZpZXMgdGhlIHBvbGljeSBmb3IgaGFuZGxpbmcgZGF0YSB3aGVuIGEgZGF0YSBzb3VyY2UgcmVzb3VyY2UgaXMgZGVsZXRlZC5cbiAqIFRoaXMgcG9saWN5IGFmZmVjdHMgdGhlIHZlY3RvciBlbWJlZGRpbmdzIGNyZWF0ZWQgZnJvbSB0aGUgZGF0YSBzb3VyY2UuXG4gKi9cbmV4cG9ydCBlbnVtIERhdGFEZWxldGlvblBvbGljeSB7XG4gIC8qKlxuICAgKiBEZWxldGVzIGFsbCB2ZWN0b3IgZW1iZWRkaW5ncyBkZXJpdmVkIGZyb20gdGhlIGRhdGEgc291cmNlIHVwb24gZGVsZXRpb25cbiAgICogb2YgYSBkYXRhIHNvdXJjZSByZXNvdXJjZS5cbiAgICovXG4gIERFTEVURSA9ICdERUxFVEUnLFxuXG4gIC8qKlxuICAgKiBSZXRhaW5zIGFsbCB2ZWN0b3IgZW1iZWRkaW5ncyBkZXJpdmVkIGZyb20gdGhlIGRhdGEgc291cmNlIGV2ZW4gYWZ0ZXJcbiAgICogZGVsZXRpb24gb2YgYSBkYXRhIHNvdXJjZSByZXNvdXJjZS5cbiAgICovXG4gIFJFVEFJTiA9ICdSRVRBSU4nLFxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIHR5cGVzIG9mIGRhdGEgc291cmNlcyB0aGF0IGNhbiBiZSBhc3NvY2lhdGVkIHRvIGFuIEtub3dsZWRnZSBCYXNlLlxuICovXG5leHBvcnQgZW51bSBEYXRhU291cmNlVHlwZSB7XG4gIC8qKlxuICAgKiBBbWF6b24gUzMgQnVja2V0IGRhdGEgc291cmNlLlxuICAgKi9cbiAgUzMgPSAnUzMnLFxuXG4gIC8qKlxuICAgKiBDb25mbHVlbmNlIENsb3VkIEluc3RhbmNlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgQ09ORkxVRU5DRSA9ICdDT05GTFVFTkNFJyxcblxuICAvKipcbiAgICogU2FsZXNmb3JjZSBpbnN0YW5jZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIFNBTEVTRk9SQ0UgPSAnU0FMRVNGT1JDRScsXG5cbiAgLyoqXG4gICAqIE1pY3Jvc29mdCBTaGFyZVBvaW50IGluc3RhbmNlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgU0hBUkVQT0lOVCA9ICdTSEFSRVBPSU5UJyxcblxuICAvKipcbiAgICogV2ViIENyYXdsZXIgZGF0YSBzb3VyY2UuXG4gICAqIEV4dHJhY3RzIGNvbnRlbnQgZnJvbSBhdXRob3JpemVkIHB1YmxpYyB3ZWIgcGFnZXMgdXNpbmcgYSBjcmF3bGVyLlxuICAgKi9cbiAgV0VCX0NSQVdMRVIgPSAnV0VCJyxcblxuICAvKipcbiAgICogQ3VzdG9tIGRhdGEgc291cmNlLlxuICAgKiBBIGN1c3RvbSBkYXRhIHNvdXJjZSBhbGxvd3MgdGhlIGZsZXhpYmlsaXR5IHRvIGF1dG9tYXRpY2FsbHkgaW5nZXN0IGRvY3VtZW50c1xuICAgKiBpbnRvIHlvdXIgdmVjdG9yIGRhdGFiYXNlIGRpcmVjdGx5LlxuICAgKi9cbiAgQ1VTVE9NID0gJ0NVU1RPTScsXG5cbiAgLyoqXG4gICAqIFJlZHNoaWZ0IE1ldGFkYXRhIGRhdGEgc291cmNlLlxuICAgKi9cbiAgUkVEU0hJRlRfTUVUQURBVEEgPSAnUkVEU0hJRlRfTUVUQURBVEEnLFxufVxuXG4vKipcbiAqIFNwZWNpZmllcyBpbnRlcmZhY2UgZm9yIHJlc291cmNlcyBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkIGludG8gQ0RLLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElEYXRhU291cmNlIGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqIEBleGFtcGxlICdKSFVFVlhVWk1VJ1xuICAgKi9cbiAgcmVhZG9ubHkgZGF0YVNvdXJjZUlkOiBzdHJpbmc7XG59XG5cbi8qKlxuICogU3BlY2lmaWVzIHRoZSBiYXNlIGNsYXNzIGZvciBhbGwgZGF0YSBzb3VyY2UgcmVzb3VyY2VzIChpbXBvcnRlZCBhbmQgbmV3KS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERhdGFTb3VyY2VCYXNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJRGF0YVNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKiBAZXhhbXBsZSAnSkhVRVZYVVpNVSdcbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcblxuICAvLyBDb21tb24gbWV0aG9kcyBmb3IgaW1wb3J0ZWQgYW5kIG5ldyBkYXRhIHNvdXJjZXMgZ28gaGVyZVxufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgY29tbW9uIGZvciBjcmVhdGluZyBhbnkgb2YgdGhlIGRpZmZlcmVudCBkYXRhIHNvdXJjZSB0eXBlcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgbmFtZSB3aWxsIGJlIGdlbmVyYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGFTb3VyY2VOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBIGRlc2NyaXB0aW9uIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBpcyBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0byB1c2UgdG8gZW5jcnlwdCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2VydmljZSBvd25lZCBhbmQgbWFuYWdlZCBrZXkuXG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBrbXMuSUtleTtcblxuICAvKipcbiAgICogVGhlIGRhdGEgZGVsZXRpb24gcG9saWN5IHRvIGFwcGx5IHRvIHRoZSBkYXRhIHNvdXJjZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBTZXRzIHRoZSBkYXRhIGRlbGV0aW9uIHBvbGljeSB0byB0aGUgZGVmYXVsdCBvZiB0aGUgZGF0YSBzb3VyY2UgdHlwZS5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGFEZWxldGlvblBvbGljeT86IERhdGFEZWxldGlvblBvbGljeTtcblxuICAvKipcbiAgICogVGhlIGNodW5raW5nIHN0YXRlZ3kgdG8gdXNlIGZvciBzcGxpdHRpbmcgeW91ciBkb2N1bWVudHMgb3IgY29udGVudC5cbiAgICogVGhlIGNodW5rcyBhcmUgdGhlbiBjb252ZXJ0ZWQgdG8gZW1iZWRkaW5ncyBhbmQgd3JpdHRlbiB0byB0aGUgdmVjdG9yXG4gICAqIGluZGV4IGFsbG93aW5nIGZvciBzaW1pbGFyaXR5IHNlYXJjaCBhbmQgcmV0cmlldmFsIG9mIHRoZSBjb250ZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCBDaHVua2luZ1N0cmF0ZWd5LkRFRkFVTFRcbiAgICovXG4gIHJlYWRvbmx5IGNodW5raW5nU3RyYXRlZ3k/OiBDaHVua2luZ1N0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBUaGUgcGFyc2luZyBzdHJhdGVneSB0byB1c2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gUGFyc2luZyBTdGF0ZWd5IGlzIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBwYXJzaW5nU3RyYXRlZ3k/OiBQYXJzaW5nU3RyYXRlZ3k7XG5cbiAgLyoqXG4gICAqIFRoZSBjdXN0b20gdHJhbnNmb3JtYXRpb24gc3RyYXRlZ3kgdG8gdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGN1c3RvbSB0cmFuc2Zvcm1hdGlvbiBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tVHJhbnNmb3JtYXRpb24/OiBDdXN0b21UcmFuc2Zvcm1hdGlvbjtcblxuICAvKipcbiAgICogVGhlIGNvbnRleHQgZW5yaWNobWVudCBjb25maWd1cmF0aW9uIHRvIHVzZS5cbiAgICogQGRlZmF1bHQgLSBObyBjb250ZXh0IGVucmljaG1lbnQgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGNvbnRleHRFbnJpY2htZW50PzogQ29udGV4dEVucmljaG1lbnQ7XG59XG5cbi8qKlxuICogU3BlY2lmaWVzIHRoZSBiYXNlIGNsYXNzIGZvciBhbGwgTkVXIGRhdGEgc291cmNlIHJlc291cmNlcyBvZiBBTlkgdHlwZS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERhdGFTb3VyY2VOZXcgZXh0ZW5kcyBEYXRhU291cmNlQmFzZSB7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKiBAZXhhbXBsZSAnSkhVRVZYVVpNVSdcbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGRhdGFTb3VyY2VUeXBlOiBEYXRhU291cmNlVHlwZTtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBkYXRhU291cmNlTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2U7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0byB1c2UgdG8gZW5jcnlwdCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbW1vbiBtZXRob2RzIGZvciBBTEwgTkVXIGRhdGEgc291cmNlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQWRkcyBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucyB0byB0aGUgS0IgZXhlY3V0aW9uIHJvbGUgbmVlZGVkIGJ5IHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyBoYW5kbGVDb21tb25QZXJtaXNzaW9ucyhwcm9wczogRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpIHtcbiAgICBsZXQgc3RhdGVtZW50c1RvQWRkOiBQb2xpY3lTdGF0ZW1lbnRbXSA9IFtdO1xuICAgIC8vIFBhcnNpbmcgc3RyYXRlZ3kgcmVxdWlyZXMgYWNjZXNzIHRvIHRoZSBwYXJzaW5nIEZNLCBzbyBiZSBzdXJlIHRvIGFkZCBwZXJtaXNzaW9uc1xuICAgIGlmIChwcm9wcy5wYXJzaW5nU3RyYXRlZ3kpIHtcbiAgICAgIHN0YXRlbWVudHNUb0FkZC5wdXNoKC4uLnByb3BzLnBhcnNpbmdTdHJhdGVneS5nZW5lcmF0ZVBvbGljeVN0YXRlbWVudHMoKSk7XG4gICAgfVxuICAgIC8vIEN1c3RvbSB0cmFuc2Zvcm1hdGlvbiByZXF1aXJlcyBpbnZva2UgcGVybWlzc2lvbnMgZm9yIHRoZSBMYW1iZGFcbiAgICBpZiAocHJvcHMuY3VzdG9tVHJhbnNmb3JtYXRpb24pIHtcbiAgICAgIHN0YXRlbWVudHNUb0FkZC5wdXNoKC4uLnByb3BzLmN1c3RvbVRyYW5zZm9ybWF0aW9uLmdlbmVyYXRlUG9saWN5U3RhdGVtZW50cyh0aGlzKSk7XG4gICAgfVxuICAgIC8vIENvbnRleHQgRW5yaWNobWVudCByZXF1aXJlcyBpbnZva2UgcGVybWlzc2lvbnMgZm9yIHRoZSBlbnJpY2hpbmcgRk1cbiAgICBpZiAocHJvcHMuY29udGV4dEVucmljaG1lbnQpIHtcbiAgICAgIHN0YXRlbWVudHNUb0FkZC5wdXNoKC4uLnByb3BzLmNvbnRleHRFbnJpY2htZW50LmdlbmVyYXRlUG9saWN5U3RhdGVtZW50cygpKTtcbiAgICB9XG4gICAgLy8gQWRkIHRoZSBwZXJtaXNzaW9uIHN0YXRlbWVudHMgdG8gdGhlIEtCIGV4ZWN1dGlvbiByb2xlXG4gICAgc3RhdGVtZW50c1RvQWRkLmZvckVhY2goKHN0YXRlbWVudCkgPT4ge1xuICAgICAgdGhpcy5rbm93bGVkZ2VCYXNlLnJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3koc3RhdGVtZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXRzIHRoZSBkYXRhIHNvdXJjZSBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgZm9yIENsb3VkRm9ybWF0aW9uLlxuICAgKi9cbiAgcHVibGljIGZvcm1hdEFzQ2ZuUHJvcHMoXG4gICAgcHJvcHM6IERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxuICAgIGRhdGFTb3VyY2VDb25maWd1cmF0aW9uOiBDZm5EYXRhU291cmNlLkRhdGFTb3VyY2VDb25maWd1cmF0aW9uUHJvcGVydHksXG4gICk6IENmbkRhdGFTb3VyY2VQcm9wcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGFEZWxldGlvblBvbGljeTogcHJvcHMuZGF0YURlbGV0aW9uUG9saWN5LFxuICAgICAgZGF0YVNvdXJjZUNvbmZpZ3VyYXRpb246IGRhdGFTb3VyY2VDb25maWd1cmF0aW9uLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAga25vd2xlZGdlQmFzZUlkOiB0aGlzLmtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZUlkLFxuICAgICAgbmFtZTogdGhpcy5kYXRhU291cmNlTmFtZSxcbiAgICAgIHNlcnZlclNpZGVFbmNyeXB0aW9uQ29uZmlndXJhdGlvbjogcHJvcHMua21zS2V5XG4gICAgICAgID8ge1xuICAgICAgICAgIGttc0tleUFybjogcHJvcHMua21zS2V5LmtleUFybixcbiAgICAgICAgfVxuICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIHZlY3RvckluZ2VzdGlvbkNvbmZpZ3VyYXRpb246XG4gICAgICAgIHByb3BzLmNodW5raW5nU3RyYXRlZ3kgfHxcbiAgICAgICAgcHJvcHMucGFyc2luZ1N0cmF0ZWd5IHx8XG4gICAgICAgIHByb3BzLmN1c3RvbVRyYW5zZm9ybWF0aW9uIHx8XG4gICAgICAgIHByb3BzLmNvbnRleHRFbnJpY2htZW50XG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICBjaHVua2luZ0NvbmZpZ3VyYXRpb246IHByb3BzLmNodW5raW5nU3RyYXRlZ3k/LmNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICBwYXJzaW5nQ29uZmlndXJhdGlvbjogcHJvcHMucGFyc2luZ1N0cmF0ZWd5Py5jb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgY3VzdG9tVHJhbnNmb3JtYXRpb25Db25maWd1cmF0aW9uOiBwcm9wcy5jdXN0b21UcmFuc2Zvcm1hdGlvbj8uY29uZmlndXJhdGlvbixcbiAgICAgICAgICAgIGNvbnRleHRFbnJpY2htZW50Q29uZmlndXJhdGlvbjogcHJvcHMuY29udGV4dEVucmljaG1lbnQ/LmNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgfVxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERhdGFTb3VyY2UgZXh0ZW5kcyBEYXRhU291cmNlQmFzZSB7XG4gIHB1YmxpYyBzdGF0aWMgZnJvbURhdGFTb3VyY2VJZChzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBkYXRhU291cmNlSWQ6IHN0cmluZyk6IElEYXRhU291cmNlIHtcbiAgICByZXR1cm4gbmV3IERhdGFTb3VyY2Uoc2NvcGUsIGlkLCBkYXRhU291cmNlSWQpO1xuICB9XG5cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFTb3VyY2VJZDogc3RyaW5nO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgZGF0YVNvdXJjZUlkOiBzdHJpbmcpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMuZGF0YVNvdXJjZUlkID0gZGF0YVNvdXJjZUlkO1xuICB9XG59XG4iXX0=