"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ParsingStrategy = exports.ParsingStrategyType = exports.ParsingModality = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const default_parsing_prompt_1 = require("./default-parsing-prompt");
var ParsingModality;
(function (ParsingModality) {
    /**
     * Specifies whether to enable parsing of multimodal data, including both text and/or images.
     */
    ParsingModality["MULTIMODAL"] = "MULTIMODAL";
})(ParsingModality || (exports.ParsingModality = ParsingModality = {}));
/**
 * Enum representing the types of parsing strategies available for Amazon Bedrock Knowledge Bases.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/kb-advanced-parsing.html
 */
var ParsingStrategyType;
(function (ParsingStrategyType) {
    /**
     * Uses a Bedrock Foundation Model for advanced parsing of non-textual information from documents.
     */
    ParsingStrategyType["FOUNDATION_MODEL"] = "BEDROCK_FOUNDATION_MODEL";
    /**
     * Processes multimodal data using Bedrock Data Automation (BDA). It leverages
     * generative AI to automate the transformation of multi-modal data into structured formats.
     * If you choose a foundation model or Amazon Bedrock Data Automation for parsing and it fails
     * to parse a file, the Amazon Bedrock default parser is used instead.
     */
    ParsingStrategyType["DATA_AUTOMATION"] = "BEDROCK_DATA_AUTOMATION";
})(ParsingStrategyType || (exports.ParsingStrategyType = ParsingStrategyType = {}));
/**
 * Represents an advanced parsing strategy configuration for Knowledge Base ingestion.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/kb-chunking-parsing.html#kb-advanced-parsing
 */
class ParsingStrategy {
    // ------------------------------------------------------
    // FM Parsing Strategy
    // ------------------------------------------------------
    /**
     * Creates a Foundation Model-based parsing strategy for extracting non-textual information
     * from documents such as tables and charts.
     * - Additional costs apply when using advanced parsing due to foundation model usage.
     * - There are limits on file types (PDF) and total data that can be parsed using advanced parsing.
     * @see https://docs.aws.amazon.com/bedrock/latest/userguide/knowledge-base-ds.html#kb-ds-supported-doc-formats-limits
     */
    static foundationModel(props) {
        class FoundationModelTransformation extends ParsingStrategy {
            constructor() {
                super(...arguments);
                /** The CloudFormation property representation of this configuration */
                this.configuration = {
                    bedrockFoundationModelConfiguration: {
                        modelArn: props.parsingModel.invokableArn,
                        parsingPrompt: {
                            parsingPromptText: props.parsingPrompt ?? default_parsing_prompt_1.DEFAULT_PARSING_PROMPT,
                        },
                    },
                    parsingStrategy: ParsingStrategyType.FOUNDATION_MODEL,
                };
            }
            generatePolicyStatements() {
                return [
                    new aws_iam_1.PolicyStatement({
                        actions: ['bedrock:InvokeModel'],
                        resources: [props.parsingModel.invokableArn],
                    }),
                ];
            }
        }
        return new FoundationModelTransformation();
    }
    /**
     * Creates a Bedrock Data Automation-based parsing strategy for processing multimodal data.
     * It leverages generative AI to automate the transformation of multi-modal data into structured formats.
     * If the parsing fails, the Amazon Bedrock default parser is used instead.
     */
    static bedrockDataAutomation() {
        class BedrockDataAutomationTransformation extends ParsingStrategy {
            constructor() {
                super(...arguments);
                /** The CloudFormation property representation of this configuration */
                this.configuration = {
                    bedrockDataAutomationConfiguration: {
                        parsingModality: ParsingModality.MULTIMODAL,
                    },
                    parsingStrategy: ParsingStrategyType.DATA_AUTOMATION,
                };
            }
            generatePolicyStatements() {
                return [
                    new aws_iam_1.PolicyStatement({
                        actions: ['bedrock:InvokeDataAutomationAsync'],
                        resources: [
                            `arn:${aws_cdk_lib_1.Aws.PARTITION}:bedrock:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.PARTITION}:data-automation-project/public-rag-default`,
                            `arn:${aws_cdk_lib_1.Aws.PARTITION}:bedrock:*:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:data-automation-profile/us.data-automation-v1`, // see https://docs.aws.amazon.com/bedrock/latest/userguide/bda-cris.html
                        ],
                    }),
                    new aws_iam_1.PolicyStatement({
                        actions: ['bedrock:GetDataAutomationStatus'],
                        resources: [
                            `arn:${aws_cdk_lib_1.Aws.PARTITION}:bedrock:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:data-automation-invocation/*`,
                        ],
                    }),
                ];
            }
        }
        return new BedrockDataAutomationTransformation();
    }
}
exports.ParsingStrategy = ParsingStrategy;
_a = JSII_RTTI_SYMBOL_1;
ParsingStrategy[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ParsingStrategy", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL3BhcnNpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILDZDQUFrQztBQUVsQyxpREFBc0Q7QUFDdEQscUVBQWtFO0FBR2xFLElBQVksZUFLWDtBQUxELFdBQVksZUFBZTtJQUN6Qjs7T0FFRztJQUNILDRDQUF5QixDQUFBO0FBQzNCLENBQUMsRUFMVyxlQUFlLCtCQUFmLGVBQWUsUUFLMUI7QUFDRDs7O0dBR0c7QUFDSCxJQUFZLG1CQVlYO0FBWkQsV0FBWSxtQkFBbUI7SUFDN0I7O09BRUc7SUFDSCxvRUFBNkMsQ0FBQTtJQUM3Qzs7Ozs7T0FLRztJQUNILGtFQUEyQyxDQUFBO0FBQzdDLENBQUMsRUFaVyxtQkFBbUIsbUNBQW5CLG1CQUFtQixRQVk5QjtBQTJCRDs7O0dBR0c7QUFDSCxNQUFzQixlQUFlO0lBQ25DLHlEQUF5RDtJQUN6RCxzQkFBc0I7SUFDdEIseURBQXlEO0lBQ3pEOzs7Ozs7T0FNRztJQUNJLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBMEM7UUFDdEUsTUFBTSw2QkFBOEIsU0FBUSxlQUFlO1lBQTNEOztnQkFDRSx1RUFBdUU7Z0JBQ3ZELGtCQUFhLEdBQUc7b0JBQzlCLG1DQUFtQyxFQUFFO3dCQUNuQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxZQUFZO3dCQUN6QyxhQUFhLEVBQUU7NEJBQ2IsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLGFBQWEsSUFBSSwrQ0FBc0I7eUJBQ2pFO3FCQUNGO29CQUNELGVBQWUsRUFBRSxtQkFBbUIsQ0FBQyxnQkFBZ0I7aUJBQ3RELENBQUM7WUFVSixDQUFDO1lBUlEsd0JBQXdCO2dCQUM3QixPQUFPO29CQUNMLElBQUkseUJBQWUsQ0FBQzt3QkFDbEIsT0FBTyxFQUFFLENBQUMscUJBQXFCLENBQUM7d0JBQ2hDLFNBQVMsRUFBRSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDO3FCQUM3QyxDQUFDO2lCQUNILENBQUM7WUFDSixDQUFDO1NBQ0Y7UUFFRCxPQUFPLElBQUksNkJBQTZCLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLE1BQU0sQ0FBQyxxQkFBcUI7UUFDakMsTUFBTSxtQ0FBb0MsU0FBUSxlQUFlO1lBQWpFOztnQkFDRSx1RUFBdUU7Z0JBQ3ZELGtCQUFhLEdBQUc7b0JBQzlCLGtDQUFrQyxFQUFFO3dCQUNsQyxlQUFlLEVBQUUsZUFBZSxDQUFDLFVBQVU7cUJBQzVDO29CQUNELGVBQWUsRUFBRSxtQkFBbUIsQ0FBQyxlQUFlO2lCQUNyRCxDQUFDO1lBbUJKLENBQUM7WUFqQlEsd0JBQXdCO2dCQUM3QixPQUFPO29CQUNMLElBQUkseUJBQWUsQ0FBQzt3QkFDbEIsT0FBTyxFQUFFLENBQUMsbUNBQW1DLENBQUM7d0JBQzlDLFNBQVMsRUFBRTs0QkFDVCxPQUFPLGlCQUFHLENBQUMsU0FBUyxZQUFZLGlCQUFHLENBQUMsTUFBTSxJQUFJLGlCQUFHLENBQUMsU0FBUyw2Q0FBNkM7NEJBQ3hHLE9BQU8saUJBQUcsQ0FBQyxTQUFTLGNBQWMsaUJBQUcsQ0FBQyxVQUFVLGdEQUFnRCxFQUFFLHlFQUF5RTt5QkFDNUs7cUJBQ0YsQ0FBQztvQkFDRixJQUFJLHlCQUFlLENBQUM7d0JBQ2xCLE9BQU8sRUFBRSxDQUFDLGlDQUFpQyxDQUFDO3dCQUM1QyxTQUFTLEVBQUU7NEJBQ1QsT0FBTyxpQkFBRyxDQUFDLFNBQVMsWUFBWSxpQkFBRyxDQUFDLE1BQU0sSUFBSSxpQkFBRyxDQUFDLFVBQVUsK0JBQStCO3lCQUM1RjtxQkFDRixDQUFDO2lCQUNILENBQUM7WUFDSixDQUFDO1NBQ0Y7UUFFRCxPQUFPLElBQUksbUNBQW1DLEVBQUUsQ0FBQztJQUNuRCxDQUFDOztBQXhFSCwwQ0FnRkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBd3MgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBDZm5EYXRhU291cmNlIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWJlZHJvY2snO1xuaW1wb3J0IHsgUG9saWN5U3RhdGVtZW50IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgeyBERUZBVUxUX1BBUlNJTkdfUFJPTVBUIH0gZnJvbSAnLi9kZWZhdWx0LXBhcnNpbmctcHJvbXB0JztcbmltcG9ydCB7IElJbnZva2FibGUgfSBmcm9tICcuLi9tb2RlbHMnO1xuXG5leHBvcnQgZW51bSBQYXJzaW5nTW9kYWxpdHkge1xuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gZW5hYmxlIHBhcnNpbmcgb2YgbXVsdGltb2RhbCBkYXRhLCBpbmNsdWRpbmcgYm90aCB0ZXh0IGFuZC9vciBpbWFnZXMuXG4gICAqL1xuICBNVUxUSU1PREFMID0gJ01VTFRJTU9EQUwnLFxufVxuLyoqXG4gKiBFbnVtIHJlcHJlc2VudGluZyB0aGUgdHlwZXMgb2YgcGFyc2luZyBzdHJhdGVnaWVzIGF2YWlsYWJsZSBmb3IgQW1hem9uIEJlZHJvY2sgS25vd2xlZGdlIEJhc2VzLlxuICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vYmVkcm9jay9sYXRlc3QvdXNlcmd1aWRlL2tiLWFkdmFuY2VkLXBhcnNpbmcuaHRtbFxuICovXG5leHBvcnQgZW51bSBQYXJzaW5nU3RyYXRlZ3lUeXBlIHtcbiAgLyoqXG4gICAqIFVzZXMgYSBCZWRyb2NrIEZvdW5kYXRpb24gTW9kZWwgZm9yIGFkdmFuY2VkIHBhcnNpbmcgb2Ygbm9uLXRleHR1YWwgaW5mb3JtYXRpb24gZnJvbSBkb2N1bWVudHMuXG4gICAqL1xuICBGT1VOREFUSU9OX01PREVMID0gJ0JFRFJPQ0tfRk9VTkRBVElPTl9NT0RFTCcsXG4gIC8qKlxuICAgKiBQcm9jZXNzZXMgbXVsdGltb2RhbCBkYXRhIHVzaW5nIEJlZHJvY2sgRGF0YSBBdXRvbWF0aW9uIChCREEpLiBJdCBsZXZlcmFnZXNcbiAgICogZ2VuZXJhdGl2ZSBBSSB0byBhdXRvbWF0ZSB0aGUgdHJhbnNmb3JtYXRpb24gb2YgbXVsdGktbW9kYWwgZGF0YSBpbnRvIHN0cnVjdHVyZWQgZm9ybWF0cy5cbiAgICogSWYgeW91IGNob29zZSBhIGZvdW5kYXRpb24gbW9kZWwgb3IgQW1hem9uIEJlZHJvY2sgRGF0YSBBdXRvbWF0aW9uIGZvciBwYXJzaW5nIGFuZCBpdCBmYWlsc1xuICAgKiB0byBwYXJzZSBhIGZpbGUsIHRoZSBBbWF6b24gQmVkcm9jayBkZWZhdWx0IHBhcnNlciBpcyB1c2VkIGluc3RlYWQuXG4gICAqL1xuICBEQVRBX0FVVE9NQVRJT04gPSAnQkVEUk9DS19EQVRBX0FVVE9NQVRJT04nLFxufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNvbmZpZ3VyaW5nIGEgRm91bmRhdGlvbiBNb2RlbCBwYXJzaW5nIHN0cmF0ZWd5LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZvdW5kYXRpb25Nb2RlbFBhcnNpbmdTdHJhdGVneVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBGb3VuZGF0aW9uIE1vZGVsIHRvIHVzZSBmb3IgcGFyc2luZyBub24tdGV4dHVhbCBpbmZvcm1hdGlvbi5cbiAgICogQ3VycmVudGx5IHN1cHBvcnRlZCBtb2RlbHMgYXJlIENsYXVkZSAzIFNvbm5ldCBhbmQgQ2xhdWRlIDMgSGFpa3UuXG4gICAqL1xuICByZWFkb25seSBwYXJzaW5nTW9kZWw6IElJbnZva2FibGU7XG5cbiAgLyoqXG4gICAqIEN1c3RvbSBwcm9tcHQgdG8gaW5zdHJ1Y3QgdGhlIHBhcnNlciBvbiBob3cgdG8gaW50ZXJwcmV0IHRoZSBkb2N1bWVudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBVc2VzIHRoZSBkZWZhdWx0IGluc3RydWN0aW9uIHByb21wdCBhcyBwcm92aWRlZCBpbiB0aGUgQVdTIENvbnNvbGUuXG4gICAqL1xuICByZWFkb25seSBwYXJzaW5nUHJvbXB0Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBlbmFibGUgcGFyc2luZyBvZiBtdWx0aW1vZGFsIGRhdGEsIGluY2x1ZGluZyBib3RoIHRleHQgYW5kL29yIGltYWdlcy5cbiAgICpcbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIC0gVGV4dCBvbmx5XG4gICAqL1xuICByZWFkb25seSBwYXJzaW5nTW9kYWxpdHk/OiBQYXJzaW5nTW9kYWxpdHk7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhbiBhZHZhbmNlZCBwYXJzaW5nIHN0cmF0ZWd5IGNvbmZpZ3VyYXRpb24gZm9yIEtub3dsZWRnZSBCYXNlIGluZ2VzdGlvbi5cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9rYi1jaHVua2luZy1wYXJzaW5nLmh0bWwja2ItYWR2YW5jZWQtcGFyc2luZ1xuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUGFyc2luZ1N0cmF0ZWd5IHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEZNIFBhcnNpbmcgU3RyYXRlZ3lcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgRm91bmRhdGlvbiBNb2RlbC1iYXNlZCBwYXJzaW5nIHN0cmF0ZWd5IGZvciBleHRyYWN0aW5nIG5vbi10ZXh0dWFsIGluZm9ybWF0aW9uXG4gICAqIGZyb20gZG9jdW1lbnRzIHN1Y2ggYXMgdGFibGVzIGFuZCBjaGFydHMuXG4gICAqIC0gQWRkaXRpb25hbCBjb3N0cyBhcHBseSB3aGVuIHVzaW5nIGFkdmFuY2VkIHBhcnNpbmcgZHVlIHRvIGZvdW5kYXRpb24gbW9kZWwgdXNhZ2UuXG4gICAqIC0gVGhlcmUgYXJlIGxpbWl0cyBvbiBmaWxlIHR5cGVzIChQREYpIGFuZCB0b3RhbCBkYXRhIHRoYXQgY2FuIGJlIHBhcnNlZCB1c2luZyBhZHZhbmNlZCBwYXJzaW5nLlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUva25vd2xlZGdlLWJhc2UtZHMuaHRtbCNrYi1kcy1zdXBwb3J0ZWQtZG9jLWZvcm1hdHMtbGltaXRzXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZvdW5kYXRpb25Nb2RlbChwcm9wczogRm91bmRhdGlvbk1vZGVsUGFyc2luZ1N0cmF0ZWd5UHJvcHMpOiBQYXJzaW5nU3RyYXRlZ3kge1xuICAgIGNsYXNzIEZvdW5kYXRpb25Nb2RlbFRyYW5zZm9ybWF0aW9uIGV4dGVuZHMgUGFyc2luZ1N0cmF0ZWd5IHtcbiAgICAgIC8qKiBUaGUgQ2xvdWRGb3JtYXRpb24gcHJvcGVydHkgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBjb25maWd1cmF0aW9uICovXG4gICAgICBwdWJsaWMgcmVhZG9ubHkgY29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgYmVkcm9ja0ZvdW5kYXRpb25Nb2RlbENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBtb2RlbEFybjogcHJvcHMucGFyc2luZ01vZGVsLmludm9rYWJsZUFybixcbiAgICAgICAgICBwYXJzaW5nUHJvbXB0OiB7XG4gICAgICAgICAgICBwYXJzaW5nUHJvbXB0VGV4dDogcHJvcHMucGFyc2luZ1Byb21wdCA/PyBERUZBVUxUX1BBUlNJTkdfUFJPTVBULFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBhcnNpbmdTdHJhdGVneTogUGFyc2luZ1N0cmF0ZWd5VHlwZS5GT1VOREFUSU9OX01PREVMLFxuICAgICAgfTtcblxuICAgICAgcHVibGljIGdlbmVyYXRlUG9saWN5U3RhdGVtZW50cygpOiBQb2xpY3lTdGF0ZW1lbnRbXSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgbmV3IFBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6SW52b2tlTW9kZWwnXSxcbiAgICAgICAgICAgIHJlc291cmNlczogW3Byb3BzLnBhcnNpbmdNb2RlbC5pbnZva2FibGVBcm5dLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXcgRm91bmRhdGlvbk1vZGVsVHJhbnNmb3JtYXRpb24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgQmVkcm9jayBEYXRhIEF1dG9tYXRpb24tYmFzZWQgcGFyc2luZyBzdHJhdGVneSBmb3IgcHJvY2Vzc2luZyBtdWx0aW1vZGFsIGRhdGEuXG4gICAqIEl0IGxldmVyYWdlcyBnZW5lcmF0aXZlIEFJIHRvIGF1dG9tYXRlIHRoZSB0cmFuc2Zvcm1hdGlvbiBvZiBtdWx0aS1tb2RhbCBkYXRhIGludG8gc3RydWN0dXJlZCBmb3JtYXRzLlxuICAgKiBJZiB0aGUgcGFyc2luZyBmYWlscywgdGhlIEFtYXpvbiBCZWRyb2NrIGRlZmF1bHQgcGFyc2VyIGlzIHVzZWQgaW5zdGVhZC5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYmVkcm9ja0RhdGFBdXRvbWF0aW9uKCk6IFBhcnNpbmdTdHJhdGVneSB7XG4gICAgY2xhc3MgQmVkcm9ja0RhdGFBdXRvbWF0aW9uVHJhbnNmb3JtYXRpb24gZXh0ZW5kcyBQYXJzaW5nU3RyYXRlZ3kge1xuICAgICAgLyoqIFRoZSBDbG91ZEZvcm1hdGlvbiBwcm9wZXJ0eSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGNvbmZpZ3VyYXRpb24gKi9cbiAgICAgIHB1YmxpYyByZWFkb25seSBjb25maWd1cmF0aW9uID0ge1xuICAgICAgICBiZWRyb2NrRGF0YUF1dG9tYXRpb25Db25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgcGFyc2luZ01vZGFsaXR5OiBQYXJzaW5nTW9kYWxpdHkuTVVMVElNT0RBTCxcbiAgICAgICAgfSxcbiAgICAgICAgcGFyc2luZ1N0cmF0ZWd5OiBQYXJzaW5nU3RyYXRlZ3lUeXBlLkRBVEFfQVVUT01BVElPTixcbiAgICAgIH07XG5cbiAgICAgIHB1YmxpYyBnZW5lcmF0ZVBvbGljeVN0YXRlbWVudHMoKTogUG9saWN5U3RhdGVtZW50W10ge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIG5ldyBQb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOkludm9rZURhdGFBdXRvbWF0aW9uQXN5bmMnXSxcbiAgICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgICBgYXJuOiR7QXdzLlBBUlRJVElPTn06YmVkcm9jazoke0F3cy5SRUdJT059OiR7QXdzLlBBUlRJVElPTn06ZGF0YS1hdXRvbWF0aW9uLXByb2plY3QvcHVibGljLXJhZy1kZWZhdWx0YCxcbiAgICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmJlZHJvY2s6Kjoke0F3cy5BQ0NPVU5UX0lEfTpkYXRhLWF1dG9tYXRpb24tcHJvZmlsZS91cy5kYXRhLWF1dG9tYXRpb24tdjFgLCAvLyBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9iZGEtY3Jpcy5odG1sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG5ldyBQb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOkdldERhdGFBdXRvbWF0aW9uU3RhdHVzJ10sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmJlZHJvY2s6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpkYXRhLWF1dG9tYXRpb24taW52b2NhdGlvbi8qYCxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBCZWRyb2NrRGF0YUF1dG9tYXRpb25UcmFuc2Zvcm1hdGlvbigpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcm9wZXJ0aWVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKiogVGhlIENsb3VkRm9ybWF0aW9uIHByb3BlcnR5IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgY29uZmlndXJhdGlvbiAqL1xuICBwdWJsaWMgYWJzdHJhY3QgY29uZmlndXJhdGlvbjogQ2ZuRGF0YVNvdXJjZS5QYXJzaW5nQ29uZmlndXJhdGlvblByb3BlcnR5O1xuXG4gIHB1YmxpYyBhYnN0cmFjdCBnZW5lcmF0ZVBvbGljeVN0YXRlbWVudHMoKTogUG9saWN5U3RhdGVtZW50W107XG59XG4iXX0=