"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Agent = exports.AgentBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const iam = require("aws-cdk-lib/aws-iam");
const kms = require("aws-cdk-lib/aws-kms");
// Internal Libs
const action_group_1 = require("./action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../../common/helpers/utils");
const validation = require("../../../common/helpers/validation-helpers");
/******************************************************************************
 *                        ABSTRACT BASE CLASS
 *****************************************************************************/
/**
 * Abstract base class for an Agent.
 * Contains methods and attributes valid for Agents either created with CDK or imported.
 */
class AgentBase extends aws_cdk_lib_1.Resource {
}
exports.AgentBase = AgentBase;
_a = JSII_RTTI_SYMBOL_1;
AgentBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.AgentBase", version: "0.1.309" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create (or import) an Agent with CDK.
 * @cloudformationResource AWS::Bedrock::Agent
 */
class Agent extends AgentBase {
    /**
     * Static Method for importing an existing Bedrock Agent.
     */
    static fromAgentAttrs(scope, id, attrs) {
        class Import extends AgentBase {
            constructor() {
                super(...arguments);
                this.agentArn = attrs.agentArn;
                this.agentId = aws_cdk_lib_1.Arn.split(attrs.agentArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.role = iam.Role.fromRoleArn(scope, `${id}Role`, attrs.roleArn);
                this.kmsKey = attrs.kmsKeyArn ? kms.Key.fromKeyArn(scope, `${id}Key`, attrs.kmsKeyArn) : undefined;
                this.lastUpdated = attrs.lastUpdated;
                this.agentVersion = attrs.agentVersion ?? 'DRAFT';
            }
        }
        // Return new Agent
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // CONSTRUCTOR
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Validators
        // ------------------------------------------------------
        /**
         * Checks if the KB Association is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBase = (knowledgeBase) => {
            const MAX_LENGTH = 200;
            const description = knowledgeBase.instruction ?? knowledgeBase.description;
            const errors = [];
            // If at least one of the previous has been defined
            if (description) {
                errors.push(...validation.validateStringFieldLength({
                    value: description,
                    fieldName: 'description',
                    minLength: 0,
                    maxLength: MAX_LENGTH,
                }));
            }
            else {
                errors.push('If instructionForAgents is not provided, the description property of the KnowledgeBase ' +
                    `${knowledgeBase.knowledgeBaseId} must be provided.`);
            }
            return errors;
        };
        /**
         * Checks if the KB Associations are valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBaseAssocations = () => {
            const MAX_KB_ASSOCIATIONS = 10;
            const errors = [];
            if (this.knowledgeBases.length > MAX_KB_ASSOCIATIONS) {
                errors.push(`The maximum number of knowledge bases associations is ${MAX_KB_ASSOCIATIONS}.`);
            }
            for (const kb of this.knowledgeBases) {
                this.validateKnowledgeBase(kb);
            }
            return errors;
        };
        /**
         * Checks if the Guardrail is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateGuardrail = (guardrail) => {
            const errors = [];
            if (this.guardrail) {
                errors.push(`Cannot add Guardrail ${guardrail.guardrailId}. ` +
                    `Guardrail ${this.guardrail.guardrailId} has already been specified for this agent.`);
            }
            errors.push(...validation.validateFieldPattern(guardrail.guardrailVersion, 'version', /^(([0-9]{1,8})|(DRAFT))$/));
            return errors;
        };
        /**
         * Check if the action group is valid
         */
        this.validateActionGroup = (actionGroup) => {
            console.log('Validating action group: ', actionGroup.name);
            let errors = [];
            // Find if there is a conflicting action group name
            if (this.actionGroups?.find(ag => ag.name === actionGroup.name)) {
                errors.push(`An action group with name: ${actionGroup.name} has already been defined`);
            }
            return errors;
        };
        // ------------------------------------------------------
        // Set properties and defaults
        // ------------------------------------------------------
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 64, lower: true, separator: '-' });
        this.idleSessionTTL = props.idleSessionTTL ?? aws_cdk_lib_1.Duration.hours(1);
        this.shouldPrepareAgent = props.shouldPrepareAgent ?? false;
        this.userInputEnabled = props.userInputEnabled ?? false;
        this.codeInterpreterEnabled = props.codeInterpreterEnabled ?? false;
        this.foundationModel = props.foundationModel;
        this.forceDelete = props.forceDelete ?? false;
        // Optional
        this.description = props.description;
        this.instruction = props.instruction;
        this.promptOverrideConfiguration = props.promptOverrideConfiguration;
        this.kmsKey = props.kmsKey;
        this.memory = props.memory;
        this.agentCollaboration = props.agentCollaboration;
        this.customOrchestration = props.customOrchestration;
        this.orchestrationType = props.orchestrationType;
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // If existing role is provided, use it.
        if (props.existingRole) {
            this.role = props.existingRole;
            // Otherwise, create a new one
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                // generate a role name
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
                // ensure the role has a trust policy that allows the Bedrock service to assume the role
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com').withConditions({
                    StringEquals: {
                        'aws:SourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                }),
            });
        }
        // ------------------------------------------------------
        // Set Lazy Props initial values
        // ------------------------------------------------------
        this.knowledgeBases = [];
        this.actionGroups = [];
        this.agentCollaborators = [];
        // Add Default Action Groups
        this.addActionGroup(action_group_1.AgentActionGroup.userInput(this.userInputEnabled));
        this.addActionGroup(action_group_1.AgentActionGroup.codeInterpreter(this.codeInterpreterEnabled));
        // Add specified elems through methods to handle permissions
        // this needs to happen after role creation / assignment
        props.knowledgeBases?.forEach(kb => {
            this.addKnowledgeBase(kb);
        });
        props.actionGroups?.forEach(ag => {
            this.addActionGroup(ag);
        });
        props.agentCollaborators?.forEach(ac => {
            this.addAgentCollaborator(ac);
        });
        if (props.guardrail) {
            this.addGuardrail(props.guardrail);
        }
        // Grant permissions for custom orchestration if provided
        if (this.customOrchestration?.executor?.lambdaFunction) {
            this.customOrchestration.executor.lambdaFunction.grantInvoke(this.role);
            this.customOrchestration.executor.lambdaFunction.addPermission(`OrchestrationLambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
                principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
                sourceArn: aws_cdk_lib_1.Lazy.string({ produce: () => this.agentArn }),
                sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
            });
        }
        // ------------------------------------------------------
        // Set Lazy Validations
        // ------------------------------------------------------
        this.node.addValidation({
            validate: () => this.validateKnowledgeBaseAssocations(),
        });
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        const cfnProps = {
            actionGroups: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderActionGroups() }, { omitEmptyArray: true }),
            agentName: this.name,
            agentResourceRoleArn: this.role.roleArn,
            autoPrepare: this.shouldPrepareAgent,
            customerEncryptionKeyArn: props.kmsKey?.keyArn,
            description: props.description,
            foundationModel: this.foundationModel.invokableArn,
            guardrailConfiguration: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderGuardrail() }),
            idleSessionTtlInSeconds: this.idleSessionTTL.toSeconds(),
            instruction: props.instruction,
            knowledgeBases: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderKnowledgeBases() }, { omitEmptyArray: true }),
            memoryConfiguration: props.memory,
            promptOverrideConfiguration: this.promptOverrideConfiguration?._render(),
            skipResourceInUseCheckOnDelete: this.forceDelete,
            agentCollaboration: this.agentCollaboration,
            agentCollaborators: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderAgentCollaborators() }, { omitEmptyArray: true }),
            customOrchestration: this.renderCustomOrchestration(),
            orchestrationType: this.orchestrationType,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnAgent(this, 'AgentResource', cfnProps);
        this.agentId = this.__resource.attrAgentId;
        this.agentArn = this.__resource.attrAgentArn;
        this.agentVersion = this.__resource.attrAgentVersion;
        this.lastUpdated = this.__resource.attrUpdatedAt;
        // Add explicit dependency between the agent resource and the agent's role default policy
        // See https://github.com/awslabs/generative-ai-cdk-constructs/issues/899
        if (!props.existingRole) {
            // add the appropriate permissions to use the FM
            const grant = this.foundationModel.grantInvoke(this.role);
            grant.applyBefore(this.__resource);
        }
        this.testAlias = agent_alias_1.AgentAlias.fromAttributes(this, 'DefaultAlias', {
            aliasId: 'TSTALIASID',
            aliasName: 'AgentTestAlias',
            agentVersion: 'DRAFT',
            agent: this,
        });
    }
    // ------------------------------------------------------
    // HELPER METHODS - addX()
    // ------------------------------------------------------
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        // Do some checks
        validation.throwIfInvalid(this.validateKnowledgeBase, knowledgeBase);
        // Add it to the array
        this.knowledgeBases.push(knowledgeBase);
        // Add the appropriate Permissions to query the Knowledge Base
        knowledgeBase.grantQuery(this.role);
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        // Do some checks
        validation.throwIfInvalid(this.validateGuardrail, guardrail);
        // Add it to the construct
        this.guardrail = guardrail;
        // Handle permissions
        guardrail.grantApply(this.role);
    }
    /**
     * Add an action group to the agent.
     */
    addActionGroup(actionGroup) {
        // Do some checks
        validation.throwIfInvalid(this.validateActionGroup, actionGroup);
        // Add it to the array
        this.actionGroups.push(actionGroup);
        // Handle permissions to invoke the lambda function
        actionGroup.executor?.lambdaFunction?.grantInvoke(this.role);
        actionGroup.executor?.lambdaFunction?.addPermission(`LambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
        });
        // Handle permissions to access the schema file from S3
        if (actionGroup.apiSchema?.s3File) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['s3:GetObject'],
                resources: [`arn:aws:s3:::${actionGroup.apiSchema.s3File.bucketName}/${actionGroup.apiSchema.s3File.objectKey}`],
                conditions: {
                    StringEquals: {
                        'aws:ResourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                },
            }));
        }
    }
    /**
     * Add an agent collaborator to the agent.
     */
    addAgentCollaborator(agentCollaborator) {
        this.agentCollaborators?.push(agentCollaborator);
        agentCollaborator.grant(this.role);
    }
    /**
     * Add multiple action groups to the agent.
     */
    addActionGroups(...actionGroups) {
        actionGroups.forEach(ag => this.addActionGroup(ag));
    }
    // ------------------------------------------------------
    // Lazy Renderers
    // ------------------------------------------------------
    /**
     * Render the guardrail configuration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderGuardrail() {
        return this.guardrail
            ? {
                guardrailIdentifier: this.guardrail.guardrailId,
                guardrailVersion: this.guardrail.guardrailVersion,
            }
            : undefined;
    }
    /**
     * Render the knowledge base associations.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderKnowledgeBases() {
        const knowledgeBaseAssociationsCfn = [];
        // Build the associations in the CFN format
        this.knowledgeBases.forEach(kb => {
            knowledgeBaseAssociationsCfn.push({
                knowledgeBaseId: kb.knowledgeBaseId,
                knowledgeBaseState: 'ENABLED',
                // at least one is defined as it has been validated when adding the kb
                description: kb.instruction ?? kb.description,
            });
        });
        return knowledgeBaseAssociationsCfn;
    }
    /**
     * Render the action groups
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderActionGroups() {
        const actionGroupsCfn = [];
        // Build the associations in the CFN format
        this.actionGroups.forEach(ag => {
            actionGroupsCfn.push(ag._render());
        });
        return actionGroupsCfn;
    }
    /**
     * Render the agent collaborators.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderAgentCollaborators() {
        if (!this.agentCollaborators || this.agentCollaborators.length === 0) {
            return undefined;
        }
        const agentCollaboratorsCfn = [];
        this.agentCollaborators.forEach(ac => {
            agentCollaboratorsCfn.push(ac._render());
        });
        return agentCollaboratorsCfn;
    }
    /**
     * Render the custom orchestration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderCustomOrchestration() {
        if (!this.customOrchestration) {
            return undefined;
        }
        return {
            executor: {
                lambda: this.customOrchestration.executor.lambdaFunction.functionArn,
            },
        };
    }
}
exports.Agent = Agent;
_b = JSII_RTTI_SYMBOL_1;
Agent[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50cy9hZ2VudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQXlGO0FBQ3pGLG1EQUFtRDtBQUNuRCwyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLGdCQUFnQjtBQUNoQixpREFBa0Q7QUFDbEQsK0NBQXdEO0FBR3hELHlEQUF1RTtBQUN2RSx5RUFBeUU7QUF1Q3pFOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsU0FBVSxTQUFRLHNCQUFROztBQUFoRCw4QkFPQzs7O0FBb0tEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBYSxLQUFNLFNBQVEsU0FBUztJQUNsQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDL0UsTUFBTSxNQUFPLFNBQVEsU0FBUztZQUE5Qjs7Z0JBQ2tCLGFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUMxQixZQUFPLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSx1QkFBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsWUFBYSxDQUFDO2dCQUNqRixTQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvRCxXQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQzlGLGdCQUFXLEdBQUcsS0FB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SSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDOUIsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztRQUVELE9BQU87WUFDTCxRQUFRLEVBQUU7Z0JBQ1IsTUFBTSxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVc7YUFDckU7U0FDRixDQUFDO0lBQ0osQ0FBQzs7QUEzYkgsc0JBdWdCQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFybiwgQXJuRm9ybWF0LCBEdXJhdGlvbiwgSVJlc291cmNlLCBMYXp5LCBSZXNvdXJjZSwgU3RhY2sgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBiZWRyb2NrIGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuLy8gSW50ZXJuYWwgTGlic1xuaW1wb3J0IHsgQWdlbnRBY3Rpb25Hcm91cCB9IGZyb20gJy4vYWN0aW9uLWdyb3VwJztcbmltcG9ydCB7IEFnZW50QWxpYXMsIElBZ2VudEFsaWFzIH0gZnJvbSAnLi9hZ2VudC1hbGlhcyc7XG5pbXBvcnQgeyBBZ2VudENvbGxhYm9yYXRvciwgQWdlbnRDb2xsYWJvcmF0b3JUeXBlIH0gZnJvbSAnLi9hZ2VudC1jb2xsYWJvcmF0b3InO1xuaW1wb3J0IHsgUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9wcm9tcHQtb3ZlcnJpZGUnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCAqIGFzIHZhbGlkYXRpb24gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdmFsaWRhdGlvbi1oZWxwZXJzJztcbmltcG9ydCB7IElHdWFyZHJhaWwgfSBmcm9tICcuLi9ndWFyZHJhaWxzL2d1YXJkcmFpbHMnO1xuaW1wb3J0IHsgSUtub3dsZWRnZUJhc2UgfSBmcm9tICcuLi9rbm93bGVkZ2UtYmFzZXMva25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgSUludm9rYWJsZSB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBNZW1vcnkgfSBmcm9tICcuL21lbW9yeSc7XG5pbXBvcnQgeyBPcmNoZXN0cmF0aW9uVHlwZSwgQ3VzdG9tT3JjaGVzdHJhdGlvbiB9IGZyb20gJy4vb3JjaGVzdHJhdGlvbic7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gQWdlbnQsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElBZ2VudCBleHRlbmRzIElSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICogQGV4YW1wbGUgXCJhcm46YXdzOmJlZHJvY2s6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjphZ2VudC9PS0RTSk9HS01PXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgQWdlbnQuXG4gICAqIEBleGFtcGxlIFwiT0tEU0pPR0tNT1wiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIEtNUyBlbmNyeXB0aW9uIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBhZ2VudFxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBXaGVuIHRoaXMgYWdlbnQgd2FzIGxhc3QgdXBkYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xufVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBBQlNUUkFDVCBCQVNFIENMQVNTXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGFuIEFnZW50LlxuICogQ29udGFpbnMgbWV0aG9kcyBhbmQgYXR0cmlidXRlcyB2YWxpZCBmb3IgQWdlbnRzIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWdlbnRCYXNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJQWdlbnQge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCBhZ2VudFZlcnNpb246IHN0cmluZztcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBQUk9QUyBGT1IgTkVXIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBjcmVhdGluZyBhIENESyBtYW5hZ2VkIEJlZHJvY2sgQWdlbnQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuYW1lIGlzIGdlbmVyYXRlZCBieSBDREsuXG4gICAqL1xuICByZWFkb25seSBuYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGluc3RydWN0aW9uIHVzZWQgYnkgdGhlIGFnZW50LiBUaGlzIGRldGVybWluZXMgaG93IHRoZSBhZ2VudCB3aWxsIHBlcmZvcm0gaGlzIHRhc2suXG4gICAqIFRoaXMgaW5zdHJ1Y3Rpb24gbXVzdCBoYXZlIGEgbWluaW11bSBvZiA0MCBjaGFyYWN0ZXJzLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zdHJ1Y3Rpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBmb3VuZGF0aW9uIG1vZGVsIHVzZWQgZm9yIG9yY2hlc3RyYXRpb24gYnkgdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgZm91bmRhdGlvbk1vZGVsOiBJSW52b2thYmxlO1xuICAvKipcbiAgICogVGhlIGV4aXN0aW5nIElBTSBSb2xlIGZvciB0aGUgYWdlbnQgdG8gdXNlLlxuICAgKiBFbnN1cmUgdGhlIHJvbGUgaGFzIGEgdHJ1c3QgcG9saWN5IHRoYXQgYWxsb3dzIHRoZSBCZWRyb2NrIHNlcnZpY2UgdG8gYXNzdW1lIHRoZSByb2xlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IHJvbGUgaXMgY3JlYXRlZCBmb3IgeW91LlxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdSb2xlPzogaWFtLklSb2xlO1xuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gYXV0b21hdGljYWxseSB1cGRhdGUgdGhlIGBEUkFGVGAgdmVyc2lvbiBvZiB0aGUgYWdlbnQgYWZ0ZXJcbiAgICogbWFraW5nIGNoYW5nZXMgdG8gdGhlIGFnZW50LiBUaGUgYERSQUZUYCB2ZXJzaW9uIGNhbiBiZSBjb250aW51YWxseSBpdGVyYXRlZFxuICAgKiB1cG9uIGR1cmluZyBpbnRlcm5hbCBkZXZlbG9wbWVudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50PzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEhvdyBsb25nIHNlc3Npb25zIHNob3VsZCBiZSBrZXB0IG9wZW4gZm9yIHRoZSBhZ2VudC4gSWYgbm8gY29udmVyc2F0aW9uIG9jY3Vyc1xuICAgKiBkdXJpbmcgdGhpcyB0aW1lLCB0aGUgc2Vzc2lvbiBleHBpcmVzIGFuZCBBbWF6b24gQmVkcm9jayBkZWxldGVzIGFueSBkYXRhXG4gICAqIHByb3ZpZGVkIGJlZm9yZSB0aGUgdGltZW91dC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAxIGhvdXJcbiAgICovXG4gIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMPzogRHVyYXRpb247XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSBvZiB0aGUgYWdlbnQgaWYgY3VzdG9tIGVuY3J5cHRpb24gaXMgY29uZmlndXJlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBbiBBV1MgbWFuYWdlZCBrZXkgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogQSBkZXNjcmlwdGlvbiBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gaXMgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLbm93bGVkZ2VCYXNlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkga25vd2xlZGdlQmFzZXM/OiBJS25vd2xlZGdlQmFzZVtdO1xuICAvKipcbiAgICogVGhlIEFjdGlvbiBHcm91cHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbkdyb3Vwcz86IEFnZW50QWN0aW9uR3JvdXBbXTtcbiAgLyoqXG4gICAqIFRoZSBndWFyZHJhaWwgdGhhdCB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWw/OiBJR3VhcmRyYWlsO1xuICAvKipcbiAgICogT3ZlcnJpZGVzIHNvbWUgcHJvbXB0IHRlbXBsYXRlcyBpbiBkaWZmZXJlbnQgcGFydHMgb2YgYW4gYWdlbnQgc2VxdWVuY2UgY29uZmlndXJhdGlvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBvdmVycmlkZXMgYXJlIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uPzogUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uO1xuICAvKipcbiAgICogU2VsZWN0IHdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgdXNlcklucHV0RW5hYmxlZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBTZWxlY3Qgd2hldGhlciB0aGUgYWdlbnQgY2FuIGdlbmVyYXRlLCBydW4sIGFuZCB0cm91Ymxlc2hvb3QgY29kZSB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2tcbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgY29kZUludGVycHJldGVyRW5hYmxlZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGRlbGV0ZSB0aGUgcmVzb3VyY2UgZXZlbiBpZiBpdCdzIGluIHVzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0cnVlXG4gICAqL1xuICByZWFkb25seSBmb3JjZURlbGV0ZT86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgbWVtb3J5IHRvIG1haW50YWluIGNvbnRleHQgYWNyb3NzIG11bHRpcGxlIHNlc3Npb25zIGFuZCByZWNhbGwgcGFzdCBpbnRlcmFjdGlvbnMuXG4gICAqIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgbWFpbnRhaW5pbmcgY29udGludWl0eSBpbiBtdWx0aS10dXJuIGNvbnZlcnNhdGlvbnMgYW5kIHJlY2FsbGluZyB1c2VyIHByZWZlcmVuY2VzXG4gICAqIG9yIHBhc3QgaW50ZXJhY3Rpb25zLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvYWdlbnRzLW1lbW9yeS5odG1sXG4gICAqIEBkZWZhdWx0IC0gTm8gbWVtb3J5IHdpbGwgYmUgdXNlZC4gQWdlbnRzIHdpbGwgcmV0YWluIGNvbnRleHQgZnJvbSB0aGUgY3VycmVudCBzZXNzaW9uIG9ubHkuXG4gICAqL1xuICByZWFkb25seSBtZW1vcnk/OiBNZW1vcnk7XG4gIC8qKlxuICAgKiBUaGUgY29sbGFib3JhdGlvbiB0eXBlIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gY29sbGFib3JhdGlvbiAoQWdlbnRDb2xsYWJvcmF0b3JUeXBlLkRJU0FCTEVEKS5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50Q29sbGFib3JhdGlvbj86IEFnZW50Q29sbGFib3JhdG9yVHlwZTtcbiAgLyoqXG4gICAqIENvbGxhYm9yYXRvcnMgdGhhdCB0aGlzIGFnZW50IHdpbGwgd29yayB3aXRoLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGNvbGxhYm9yYXRvcnMuXG4gICAqL1xuICByZWFkb25seSBhZ2VudENvbGxhYm9yYXRvcnM/OiBBZ2VudENvbGxhYm9yYXRvcltdO1xuICAvKipcbiAgICogRGV0YWlscyBvZiBjdXN0b20gb3JjaGVzdHJhdGlvbiBmb3IgdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFN0YW5kYXJkIG9yY2hlc3RyYXRpb24uXG4gICAqL1xuICByZWFkb25seSBjdXN0b21PcmNoZXN0cmF0aW9uPzogQ3VzdG9tT3JjaGVzdHJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIG9yY2hlc3RyYXRpb24gdG8gdXNlIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU1RBTkRBUkRcbiAgICovXG4gIHJlYWRvbmx5IG9yY2hlc3RyYXRpb25UeXBlPzogT3JjaGVzdHJhdGlvblR5cGU7XG59XG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICBBVFRSUyBGT1IgSU1QT1JURUQgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEF0dHJpYnV0ZXMgZm9yIHNwZWNpZnlpbmcgYW4gaW1wb3J0ZWQgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudEF0dHJpYnV0ZXMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYWdlbnQuXG4gICAqIEBleGFtcGxlIFwiYXJuOmF3czpiZWRyb2NrOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6YWdlbnQvT0tEU0pPR0tNT1wiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGFnZW50QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICogQGV4YW1wbGUgXCJYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgcm9sZUFybjogc3RyaW5nO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGFnZW50XG4gICAqL1xuICByZWFkb25seSBrbXNLZXlBcm4/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBXaGVuIHRoaXMgYWdlbnQgd2FzIGxhc3QgdXBkYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGFnZW50IHZlcnNpb24uIElmIG5vIGV4cGxpY2l0IHZlcnNpb25zIGhhdmUgYmVlbiBjcmVhdGVkLFxuICAgKiBsZWF2ZSB0aGlzICBlbXB0eSB0byB1c2UgdGhlIERSQUZUIHZlcnNpb24uIE90aGVyd2lzZSwgdXNlIHRoZVxuICAgKiB2ZXJzaW9uIG51bWJlciAoZS5nLiAxKS5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50VmVyc2lvbj86IHN0cmluZztcbn1cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgTkVXIENPTlNUUlVDVCBERUZJTklUSU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIENsYXNzIHRvIGNyZWF0ZSAob3IgaW1wb3J0KSBhbiBBZ2VudCB3aXRoIENESy5cbiAqIEBjbG91ZGZvcm1hdGlvblJlc291cmNlIEFXUzo6QmVkcm9jazo6QWdlbnRcbiAqL1xuZXhwb3J0IGNsYXNzIEFnZW50IGV4dGVuZHMgQWdlbnRCYXNlIHtcbiAgLyoqXG4gICAqIFN0YXRpYyBNZXRob2QgZm9yIGltcG9ydGluZyBhbiBleGlzdGluZyBCZWRyb2NrIEFnZW50LlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tQWdlbnRBdHRycyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogQWdlbnRBdHRyaWJ1dGVzKTogSUFnZW50IHtcbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBBZ2VudEJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGFnZW50QXJuID0gYXR0cnMuYWdlbnRBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJZCA9IEFybi5zcGxpdChhdHRycy5hZ2VudEFybiwgQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUpLnJlc291cmNlTmFtZSE7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgcm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHNjb3BlLCBgJHtpZH1Sb2xlYCwgYXR0cnMucm9sZUFybik7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkga21zS2V5ID0gYXR0cnMua21zS2V5QXJuID8ga21zLktleS5mcm9tS2V5QXJuKHNjb3BlLCBgJHtpZH1LZXlgLCBhdHRycy5rbXNLZXlBcm4pIDogdW5kZWZpbmVkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGxhc3RVcGRhdGVkID0gYXR0cnMubGFzdFVwZGF0ZWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRWZXJzaW9uID0gYXR0cnMuYWdlbnRWZXJzaW9uID8/ICdEUkFGVCc7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIG5ldyBBZ2VudFxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEJhc2UgYXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGFnZW50XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZ2VudFZlcnNpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYWdlbnRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbXNLZXk/OiBrbXMuSUtleTtcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ0RLLW9ubHkgYXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBhZ2VudCB3aWxsIGF1dG9tYXRpY2FsbHkgdXBkYXRlIHRoZSBEUkFGVCB2ZXJzaW9uIG9mIHRoZSBhZ2VudCBhZnRlclxuICAgKiBtYWtpbmcgY2hhbmdlcyB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50OiBib29sZWFuO1xuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMOiBEdXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBmb3VuZGF0aW9uIG1vZGVsIHVzZWQgZm9yIG9yY2hlc3RyYXRpb24gYnkgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvdW5kYXRpb25Nb2RlbDogSUludm9rYWJsZTtcbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IHRlc3QgYWxpYXMgZm9yIHRoaXMgYWdlbnQuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHRlc3QgYWxpYXNcbiAgICogKGBUU1RBTElBU0lEYCkgdGhhdCBwb2ludHMgdG8gdGhlIHdvcmtpbmcgKGBEUkFGVGApIHZlcnNpb24uXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGVzdEFsaWFzOiBJQWdlbnRBbGlhcztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB1c2VySW5wdXRFbmFibGVkOiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgYWdlbnQgY2FuIGdlbmVyYXRlLCBydW4sIGFuZCB0cm91Ymxlc2hvb3QgY29kZSB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29kZUludGVycHJldGVyRW5hYmxlZDogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHJlc291cmNlIHdpbGwgYmUgZGVsZXRlZCBldmVuIGlmIGl0J3MgaW4gdXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvcmNlRGVsZXRlOiBib29sZWFuO1xuICAvKipcbiAgICogQWdlbnQgY29sbGFib3JhdGlvbiB0eXBlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50Q29sbGFib3JhdGlvbj86IEFnZW50Q29sbGFib3JhdG9yVHlwZTtcbiAgLyoqXG4gICAqIEFnZW50IGNvbGxhYm9yYXRvcnMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRDb2xsYWJvcmF0b3JzPzogQWdlbnRDb2xsYWJvcmF0b3JbXTtcbiAgLyoqXG4gICAqIEN1c3RvbSBvcmNoZXN0cmF0aW9uIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY3VzdG9tT3JjaGVzdHJhdGlvbj86IEN1c3RvbU9yY2hlc3RyYXRpb247XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBvcmNoZXN0cmF0aW9uIGZvciB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgb3JjaGVzdHJhdGlvblR5cGU/OiBPcmNoZXN0cmF0aW9uVHlwZTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENESy1vbmx5IGF0dHJpYnV0ZXMgKG9wdGlvbmFsKVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGluc3RydWN0aW9uIHVzZWQgYnkgdGhlIGFnZW50LiBUaGlzIGRldGVybWluZXMgaG93IHRoZSBhZ2VudCB3aWxsIHBlcmZvcm0gaGlzIHRhc2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPdmVycmlkZXMgc29tZSBwcm9tcHQgdGVtcGxhdGVzIGluIGRpZmZlcmVudCBwYXJ0cyBvZiBhbiBhZ2VudCBzZXF1ZW5jZSBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIG92ZXJyaWRlcyBhcmUgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24/OiBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBUaGUgbWVtb3J5IGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBtZW1vcnk/OiBNZW1vcnk7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBMYXp5IEF0dHJpYnV0ZXNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgYWN0aW9uIGdyb3VwcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFjdGlvbkdyb3VwczogQWdlbnRBY3Rpb25Hcm91cFtdO1xuICAvKipcbiAgICogVGhlIEtub3dsZWRnZUJhc2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMga25vd2xlZGdlQmFzZXM6IElLbm93bGVkZ2VCYXNlW107XG4gIC8qKlxuICAgKiBUaGUgZ3VhcmRyYWlsIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgZ3VhcmRyYWlsPzogSUd1YXJkcmFpbDtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEludGVybmFsIE9ubHlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgTDEgcmVwcmVzZW50YXRpb24gb2YgdGhlIGFnZW50XG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9fcmVzb3VyY2U6IGJlZHJvY2suQ2ZuQWdlbnQ7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENPTlNUUlVDVE9SXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQWdlbnRQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgcHJvcGVydGllcyBhbmQgZGVmYXVsdHNcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLm5hbWUgPVxuICAgICAgcHJvcHMubmFtZSA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdiZWRyb2NrLWFnZW50JywgeyBtYXhMZW5ndGg6IDY0LCBsb3dlcjogdHJ1ZSwgc2VwYXJhdG9yOiAnLScgfSk7XG4gICAgdGhpcy5pZGxlU2Vzc2lvblRUTCA9IHByb3BzLmlkbGVTZXNzaW9uVFRMID8/IER1cmF0aW9uLmhvdXJzKDEpO1xuICAgIHRoaXMuc2hvdWxkUHJlcGFyZUFnZW50ID0gcHJvcHMuc2hvdWxkUHJlcGFyZUFnZW50ID8/IGZhbHNlO1xuICAgIHRoaXMudXNlcklucHV0RW5hYmxlZCA9IHByb3BzLnVzZXJJbnB1dEVuYWJsZWQgPz8gZmFsc2U7XG4gICAgdGhpcy5jb2RlSW50ZXJwcmV0ZXJFbmFibGVkID0gcHJvcHMuY29kZUludGVycHJldGVyRW5hYmxlZCA/PyBmYWxzZTtcbiAgICB0aGlzLmZvdW5kYXRpb25Nb2RlbCA9IHByb3BzLmZvdW5kYXRpb25Nb2RlbDtcbiAgICB0aGlzLmZvcmNlRGVsZXRlID0gcHJvcHMuZm9yY2VEZWxldGUgPz8gZmFsc2U7XG5cbiAgICAvLyBPcHRpb25hbFxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwcm9wcy5kZXNjcmlwdGlvbjtcbiAgICB0aGlzLmluc3RydWN0aW9uID0gcHJvcHMuaW5zdHJ1Y3Rpb247XG4gICAgdGhpcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24gPSBwcm9wcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gICAgdGhpcy5rbXNLZXkgPSBwcm9wcy5rbXNLZXk7XG4gICAgdGhpcy5tZW1vcnkgPSBwcm9wcy5tZW1vcnk7XG4gICAgdGhpcy5hZ2VudENvbGxhYm9yYXRpb24gPSBwcm9wcy5hZ2VudENvbGxhYm9yYXRpb247XG4gICAgdGhpcy5jdXN0b21PcmNoZXN0cmF0aW9uID0gcHJvcHMuY3VzdG9tT3JjaGVzdHJhdGlvbjtcbiAgICB0aGlzLm9yY2hlc3RyYXRpb25UeXBlID0gcHJvcHMub3JjaGVzdHJhdGlvblR5cGU7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBSb2xlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gSWYgZXhpc3Rpbmcgcm9sZSBpcyBwcm92aWRlZCwgdXNlIGl0LlxuICAgIGlmIChwcm9wcy5leGlzdGluZ1JvbGUpIHtcbiAgICAgIHRoaXMucm9sZSA9IHByb3BzLmV4aXN0aW5nUm9sZTtcbiAgICAgIC8vIE90aGVyd2lzZSwgY3JlYXRlIGEgbmV3IG9uZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1JvbGUnLCB7XG4gICAgICAgIC8vIGdlbmVyYXRlIGEgcm9sZSBuYW1lXG4gICAgICAgIHJvbGVOYW1lOiBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdBbWF6b25CZWRyb2NrRXhlY3V0aW9uUm9sZUZvckFnZW50c18nLCB7IG1heExlbmd0aDogNjQsIGxvd2VyOiBmYWxzZSB9KSxcbiAgICAgICAgLy8gZW5zdXJlIHRoZSByb2xlIGhhcyBhIHRydXN0IHBvbGljeSB0aGF0IGFsbG93cyB0aGUgQmVkcm9jayBzZXJ2aWNlIHRvIGFzc3VtZSB0aGUgcm9sZVxuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJykud2l0aENvbmRpdGlvbnMoe1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2F3czpTb3VyY2VBY2NvdW50JzogU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICdhd3M6U291cmNlQXJuJzogU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgc2VydmljZTogJ2JlZHJvY2snLFxuICAgICAgICAgICAgICByZXNvdXJjZTogJ2FnZW50JyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgTGF6eSBQcm9wcyBpbml0aWFsIHZhbHVlc1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMua25vd2xlZGdlQmFzZXMgPSBbXTtcbiAgICB0aGlzLmFjdGlvbkdyb3VwcyA9IFtdO1xuICAgIHRoaXMuYWdlbnRDb2xsYWJvcmF0b3JzID0gW107XG4gICAgLy8gQWRkIERlZmF1bHQgQWN0aW9uIEdyb3Vwc1xuICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoQWdlbnRBY3Rpb25Hcm91cC51c2VySW5wdXQodGhpcy51c2VySW5wdXRFbmFibGVkKSk7XG4gICAgdGhpcy5hZGRBY3Rpb25Hcm91cChBZ2VudEFjdGlvbkdyb3VwLmNvZGVJbnRlcnByZXRlcih0aGlzLmNvZGVJbnRlcnByZXRlckVuYWJsZWQpKTtcblxuICAgIC8vIEFkZCBzcGVjaWZpZWQgZWxlbXMgdGhyb3VnaCBtZXRob2RzIHRvIGhhbmRsZSBwZXJtaXNzaW9uc1xuICAgIC8vIHRoaXMgbmVlZHMgdG8gaGFwcGVuIGFmdGVyIHJvbGUgY3JlYXRpb24gLyBhc3NpZ25tZW50XG4gICAgcHJvcHMua25vd2xlZGdlQmFzZXM/LmZvckVhY2goa2IgPT4ge1xuICAgICAgdGhpcy5hZGRLbm93bGVkZ2VCYXNlKGtiKTtcbiAgICB9KTtcbiAgICBwcm9wcy5hY3Rpb25Hcm91cHM/LmZvckVhY2goYWcgPT4ge1xuICAgICAgdGhpcy5hZGRBY3Rpb25Hcm91cChhZyk7XG4gICAgfSk7XG4gICAgcHJvcHMuYWdlbnRDb2xsYWJvcmF0b3JzPy5mb3JFYWNoKGFjID0+IHtcbiAgICAgIHRoaXMuYWRkQWdlbnRDb2xsYWJvcmF0b3IoYWMpO1xuICAgIH0pO1xuICAgIGlmIChwcm9wcy5ndWFyZHJhaWwpIHtcbiAgICAgIHRoaXMuYWRkR3VhcmRyYWlsKHByb3BzLmd1YXJkcmFpbCk7XG4gICAgfVxuXG4gICAgLy8gR3JhbnQgcGVybWlzc2lvbnMgZm9yIGN1c3RvbSBvcmNoZXN0cmF0aW9uIGlmIHByb3ZpZGVkXG4gICAgaWYgKHRoaXMuY3VzdG9tT3JjaGVzdHJhdGlvbj8uZXhlY3V0b3I/LmxhbWJkYUZ1bmN0aW9uKSB7XG4gICAgICB0aGlzLmN1c3RvbU9yY2hlc3RyYXRpb24uZXhlY3V0b3IubGFtYmRhRnVuY3Rpb24uZ3JhbnRJbnZva2UodGhpcy5yb2xlKTtcbiAgICAgIHRoaXMuY3VzdG9tT3JjaGVzdHJhdGlvbi5leGVjdXRvci5sYW1iZGFGdW5jdGlvbi5hZGRQZXJtaXNzaW9uKGBPcmNoZXN0cmF0aW9uTGFtYmRhSW52b2NhdGlvblBvbGljeS0ke3RoaXMubm9kZS5hZGRyLnNsaWNlKDAsIDE2KX1gLCB7XG4gICAgICAgIHByaW5jaXBhbDogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgICAgc291cmNlQXJuOiBMYXp5LnN0cmluZyh7IHByb2R1Y2U6ICgpID0+IHRoaXMuYWdlbnRBcm4gfSksXG4gICAgICAgIHNvdXJjZUFjY291bnQ6IFN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgTGF6eSBWYWxpZGF0aW9uc1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMubm9kZS5hZGRWYWxpZGF0aW9uKHtcbiAgICAgIHZhbGlkYXRlOiAoKSA9PiB0aGlzLnZhbGlkYXRlS25vd2xlZGdlQmFzZUFzc29jYXRpb25zKCksXG4gICAgfSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDRk4gUHJvcHMgLSBXaXRoIExhenkgc3VwcG9ydFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0IGNmblByb3BzOiBiZWRyb2NrLkNmbkFnZW50UHJvcHMgPSB7XG4gICAgICBhY3Rpb25Hcm91cHM6IExhenkuYW55KHsgcHJvZHVjZTogKCkgPT4gdGhpcy5yZW5kZXJBY3Rpb25Hcm91cHMoKSB9LCB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0pLFxuICAgICAgYWdlbnROYW1lOiB0aGlzLm5hbWUsXG4gICAgICBhZ2VudFJlc291cmNlUm9sZUFybjogdGhpcy5yb2xlLnJvbGVBcm4sXG4gICAgICBhdXRvUHJlcGFyZTogdGhpcy5zaG91bGRQcmVwYXJlQWdlbnQsXG4gICAgICBjdXN0b21lckVuY3J5cHRpb25LZXlBcm46IHByb3BzLmttc0tleT8ua2V5QXJuLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgZm91bmRhdGlvbk1vZGVsOiB0aGlzLmZvdW5kYXRpb25Nb2RlbC5pbnZva2FibGVBcm4sXG4gICAgICBndWFyZHJhaWxDb25maWd1cmF0aW9uOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyR3VhcmRyYWlsKCkgfSksXG4gICAgICBpZGxlU2Vzc2lvblR0bEluU2Vjb25kczogdGhpcy5pZGxlU2Vzc2lvblRUTC50b1NlY29uZHMoKSxcbiAgICAgIGluc3RydWN0aW9uOiBwcm9wcy5pbnN0cnVjdGlvbixcbiAgICAgIGtub3dsZWRnZUJhc2VzOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyS25vd2xlZGdlQmFzZXMoKSB9LCB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0pLFxuICAgICAgbWVtb3J5Q29uZmlndXJhdGlvbjogcHJvcHMubWVtb3J5LFxuICAgICAgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uOiB0aGlzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbj8uX3JlbmRlcigpLFxuICAgICAgc2tpcFJlc291cmNlSW5Vc2VDaGVja09uRGVsZXRlOiB0aGlzLmZvcmNlRGVsZXRlLFxuICAgICAgYWdlbnRDb2xsYWJvcmF0aW9uOiB0aGlzLmFnZW50Q29sbGFib3JhdGlvbixcbiAgICAgIGFnZW50Q29sbGFib3JhdG9yczogTGF6eS5hbnkoeyBwcm9kdWNlOiAoKSA9PiB0aGlzLnJlbmRlckFnZW50Q29sbGFib3JhdG9ycygpIH0sIHsgb21pdEVtcHR5QXJyYXk6IHRydWUgfSksXG4gICAgICBjdXN0b21PcmNoZXN0cmF0aW9uOiB0aGlzLnJlbmRlckN1c3RvbU9yY2hlc3RyYXRpb24oKSxcbiAgICAgIG9yY2hlc3RyYXRpb25UeXBlOiB0aGlzLm9yY2hlc3RyYXRpb25UeXBlLFxuICAgIH07XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IGJlZHJvY2suQ2ZuQWdlbnQodGhpcywgJ0FnZW50UmVzb3VyY2UnLCBjZm5Qcm9wcyk7XG5cbiAgICB0aGlzLmFnZW50SWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckFnZW50SWQ7XG4gICAgdGhpcy5hZ2VudEFybiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyQWdlbnRBcm47XG4gICAgdGhpcy5hZ2VudFZlcnNpb24gPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckFnZW50VmVyc2lvbjtcbiAgICB0aGlzLmxhc3RVcGRhdGVkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJVcGRhdGVkQXQ7XG5cbiAgICAvLyBBZGQgZXhwbGljaXQgZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBhZ2VudCByZXNvdXJjZSBhbmQgdGhlIGFnZW50J3Mgcm9sZSBkZWZhdWx0IHBvbGljeVxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYXdzbGFicy9nZW5lcmF0aXZlLWFpLWNkay1jb25zdHJ1Y3RzL2lzc3Vlcy84OTlcbiAgICBpZiAoIXByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgLy8gYWRkIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucyB0byB1c2UgdGhlIEZNXG4gICAgICBjb25zdCBncmFudCA9IHRoaXMuZm91bmRhdGlvbk1vZGVsLmdyYW50SW52b2tlKHRoaXMucm9sZSk7XG4gICAgICBncmFudC5hcHBseUJlZm9yZSh0aGlzLl9fcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIHRoaXMudGVzdEFsaWFzID0gQWdlbnRBbGlhcy5mcm9tQXR0cmlidXRlcyh0aGlzLCAnRGVmYXVsdEFsaWFzJywge1xuICAgICAgYWxpYXNJZDogJ1RTVEFMSUFTSUQnLFxuICAgICAgYWxpYXNOYW1lOiAnQWdlbnRUZXN0QWxpYXMnLFxuICAgICAgYWdlbnRWZXJzaW9uOiAnRFJBRlQnLFxuICAgICAgYWdlbnQ6IHRoaXMsXG4gICAgfSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSEVMUEVSIE1FVEhPRFMgLSBhZGRYKClcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBBZGQga25vd2xlZGdlIGJhc2UgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEtub3dsZWRnZUJhc2Uoa25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2UpIHtcbiAgICAvLyBEbyBzb21lIGNoZWNrc1xuICAgIHZhbGlkYXRpb24udGhyb3dJZkludmFsaWQodGhpcy52YWxpZGF0ZUtub3dsZWRnZUJhc2UsIGtub3dsZWRnZUJhc2UpO1xuICAgIC8vIEFkZCBpdCB0byB0aGUgYXJyYXlcbiAgICB0aGlzLmtub3dsZWRnZUJhc2VzLnB1c2goa25vd2xlZGdlQmFzZSk7XG4gICAgLy8gQWRkIHRoZSBhcHByb3ByaWF0ZSBQZXJtaXNzaW9ucyB0byBxdWVyeSB0aGUgS25vd2xlZGdlIEJhc2VcbiAgICBrbm93bGVkZ2VCYXNlLmdyYW50UXVlcnkodGhpcy5yb2xlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgZ3VhcmRyYWlsIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRHdWFyZHJhaWwoZ3VhcmRyYWlsOiBJR3VhcmRyYWlsKSB7XG4gICAgLy8gRG8gc29tZSBjaGVja3NcbiAgICB2YWxpZGF0aW9uLnRocm93SWZJbnZhbGlkKHRoaXMudmFsaWRhdGVHdWFyZHJhaWwsIGd1YXJkcmFpbCk7XG4gICAgLy8gQWRkIGl0IHRvIHRoZSBjb25zdHJ1Y3RcbiAgICB0aGlzLmd1YXJkcmFpbCA9IGd1YXJkcmFpbDtcbiAgICAvLyBIYW5kbGUgcGVybWlzc2lvbnNcbiAgICBndWFyZHJhaWwuZ3JhbnRBcHBseSh0aGlzLnJvbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhY3Rpb24gZ3JvdXAgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFjdGlvbkdyb3VwKGFjdGlvbkdyb3VwOiBBZ2VudEFjdGlvbkdyb3VwKSB7XG4gICAgLy8gRG8gc29tZSBjaGVja3NcbiAgICB2YWxpZGF0aW9uLnRocm93SWZJbnZhbGlkKHRoaXMudmFsaWRhdGVBY3Rpb25Hcm91cCwgYWN0aW9uR3JvdXApO1xuICAgIC8vIEFkZCBpdCB0byB0aGUgYXJyYXlcbiAgICB0aGlzLmFjdGlvbkdyb3Vwcy5wdXNoKGFjdGlvbkdyb3VwKTtcbiAgICAvLyBIYW5kbGUgcGVybWlzc2lvbnMgdG8gaW52b2tlIHRoZSBsYW1iZGEgZnVuY3Rpb25cbiAgICBhY3Rpb25Hcm91cC5leGVjdXRvcj8ubGFtYmRhRnVuY3Rpb24/LmdyYW50SW52b2tlKHRoaXMucm9sZSk7XG4gICAgYWN0aW9uR3JvdXAuZXhlY3V0b3I/LmxhbWJkYUZ1bmN0aW9uPy5hZGRQZXJtaXNzaW9uKGBMYW1iZGFJbnZvY2F0aW9uUG9saWN5LSR7dGhpcy5ub2RlLmFkZHIuc2xpY2UoMCwgMTYpfWAsIHtcbiAgICAgIHByaW5jaXBhbDogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIHNvdXJjZUFybjogdGhpcy5hZ2VudEFybixcbiAgICAgIHNvdXJjZUFjY291bnQ6IFN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgfSk7XG4gICAgLy8gSGFuZGxlIHBlcm1pc3Npb25zIHRvIGFjY2VzcyB0aGUgc2NoZW1hIGZpbGUgZnJvbSBTM1xuICAgIGlmIChhY3Rpb25Hcm91cC5hcGlTY2hlbWE/LnMzRmlsZSkge1xuICAgICAgdGhpcy5yb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydzMzpHZXRPYmplY3QnXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbYGFybjphd3M6czM6Ojoke2FjdGlvbkdyb3VwLmFwaVNjaGVtYS5zM0ZpbGUuYnVja2V0TmFtZX0vJHthY3Rpb25Hcm91cC5hcGlTY2hlbWEuczNGaWxlLm9iamVjdEtleX1gXSxcbiAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2F3czpSZXNvdXJjZUFjY291bnQnOiBTdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhZ2VudCBjb2xsYWJvcmF0b3IgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFnZW50Q29sbGFib3JhdG9yKGFnZW50Q29sbGFib3JhdG9yOiBBZ2VudENvbGxhYm9yYXRvcikge1xuICAgIHRoaXMuYWdlbnRDb2xsYWJvcmF0b3JzPy5wdXNoKGFnZW50Q29sbGFib3JhdG9yKTtcbiAgICBhZ2VudENvbGxhYm9yYXRvci5ncmFudCh0aGlzLnJvbGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBtdWx0aXBsZSBhY3Rpb24gZ3JvdXBzIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBY3Rpb25Hcm91cHMoLi4uYWN0aW9uR3JvdXBzOiBBZ2VudEFjdGlvbkdyb3VwW10pIHtcbiAgICBhY3Rpb25Hcm91cHMuZm9yRWFjaChhZyA9PiB0aGlzLmFkZEFjdGlvbkdyb3VwKGFnKSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGF6eSBSZW5kZXJlcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIGd1YXJkcmFpbCBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyR3VhcmRyYWlsKCk6IGJlZHJvY2suQ2ZuQWdlbnQuR3VhcmRyYWlsQ29uZmlndXJhdGlvblByb3BlcnR5IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5ndWFyZHJhaWxcbiAgICAgID8ge1xuICAgICAgICBndWFyZHJhaWxJZGVudGlmaWVyOiB0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxJZCxcbiAgICAgICAgZ3VhcmRyYWlsVmVyc2lvbjogdGhpcy5ndWFyZHJhaWwuZ3VhcmRyYWlsVmVyc2lvbixcbiAgICAgIH1cbiAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUga25vd2xlZGdlIGJhc2UgYXNzb2NpYXRpb25zLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyS25vd2xlZGdlQmFzZXMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eVtdIHtcbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlQXNzb2NpYXRpb25zQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10gPSBbXTtcbiAgICAvLyBCdWlsZCB0aGUgYXNzb2NpYXRpb25zIGluIHRoZSBDRk4gZm9ybWF0XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcy5mb3JFYWNoKGtiID0+IHtcbiAgICAgIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm4ucHVzaCh7XG4gICAgICAgIGtub3dsZWRnZUJhc2VJZDoga2Iua25vd2xlZGdlQmFzZUlkLFxuICAgICAgICBrbm93bGVkZ2VCYXNlU3RhdGU6ICdFTkFCTEVEJyxcbiAgICAgICAgLy8gYXQgbGVhc3Qgb25lIGlzIGRlZmluZWQgYXMgaXQgaGFzIGJlZW4gdmFsaWRhdGVkIHdoZW4gYWRkaW5nIHRoZSBrYlxuICAgICAgICBkZXNjcmlwdGlvbjoga2IuaW5zdHJ1Y3Rpb24gPz8ga2IuZGVzY3JpcHRpb24hLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm47XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBhY3Rpb24gZ3JvdXBzXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJBY3Rpb25Hcm91cHMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEFjdGlvbkdyb3VwUHJvcGVydHlbXSB7XG4gICAgY29uc3QgYWN0aW9uR3JvdXBzQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdID0gW107XG4gICAgLy8gQnVpbGQgdGhlIGFzc29jaWF0aW9ucyBpbiB0aGUgQ0ZOIGZvcm1hdFxuICAgIHRoaXMuYWN0aW9uR3JvdXBzLmZvckVhY2goYWcgPT4ge1xuICAgICAgYWN0aW9uR3JvdXBzQ2ZuLnB1c2goYWcuX3JlbmRlcigpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gYWN0aW9uR3JvdXBzQ2ZuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUgYWdlbnQgY29sbGFib3JhdG9ycy5cbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckFnZW50Q29sbGFib3JhdG9ycygpOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50Q29sbGFib3JhdG9yUHJvcGVydHlbXSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLmFnZW50Q29sbGFib3JhdG9ycyB8fCB0aGlzLmFnZW50Q29sbGFib3JhdG9ycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgYWdlbnRDb2xsYWJvcmF0b3JzQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50Q29sbGFib3JhdG9yUHJvcGVydHlbXSA9IFtdO1xuXG4gICAgdGhpcy5hZ2VudENvbGxhYm9yYXRvcnMuZm9yRWFjaChhYyA9PiB7XG4gICAgICBhZ2VudENvbGxhYm9yYXRvcnNDZm4ucHVzaChhYy5fcmVuZGVyKCkpO1xuICAgIH0pO1xuICAgIHJldHVybiBhZ2VudENvbGxhYm9yYXRvcnNDZm47XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBjdXN0b20gb3JjaGVzdHJhdGlvbi5cbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHJlbmRlckN1c3RvbU9yY2hlc3RyYXRpb24oKTogYmVkcm9jay5DZm5BZ2VudC5DdXN0b21PcmNoZXN0cmF0aW9uUHJvcGVydHkgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5jdXN0b21PcmNoZXN0cmF0aW9uKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBleGVjdXRvcjoge1xuICAgICAgICBsYW1iZGE6IHRoaXMuY3VzdG9tT3JjaGVzdHJhdGlvbi5leGVjdXRvci5sYW1iZGFGdW5jdGlvbi5mdW5jdGlvbkFybixcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBWYWxpZGF0b3JzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBLQiBBc3NvY2lhdGlvbiBpcyB2YWxpZFxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVLbm93bGVkZ2VCYXNlID0gKGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlKTogc3RyaW5nW10gPT4ge1xuICAgIGNvbnN0IE1BWF9MRU5HVEggPSAyMDA7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSBrbm93bGVkZ2VCYXNlLmluc3RydWN0aW9uID8/IGtub3dsZWRnZUJhc2UuZGVzY3JpcHRpb247XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIC8vIElmIGF0IGxlYXN0IG9uZSBvZiB0aGUgcHJldmlvdXMgaGFzIGJlZW4gZGVmaW5lZFxuICAgIGlmIChkZXNjcmlwdGlvbikge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIC4uLnZhbGlkYXRpb24udmFsaWRhdGVTdHJpbmdGaWVsZExlbmd0aCh7XG4gICAgICAgICAgdmFsdWU6IGRlc2NyaXB0aW9uLFxuICAgICAgICAgIGZpZWxkTmFtZTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICBtaW5MZW5ndGg6IDAsXG4gICAgICAgICAgbWF4TGVuZ3RoOiBNQVhfTEVOR1RILFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAnSWYgaW5zdHJ1Y3Rpb25Gb3JBZ2VudHMgaXMgbm90IHByb3ZpZGVkLCB0aGUgZGVzY3JpcHRpb24gcHJvcGVydHkgb2YgdGhlIEtub3dsZWRnZUJhc2UgJyArXG4gICAgICAgICAgYCR7a25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlSWR9IG11c3QgYmUgcHJvdmlkZWQuYCxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIEtCIEFzc29jaWF0aW9ucyBhcmUgdmFsaWRcbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlS25vd2xlZGdlQmFzZUFzc29jYXRpb25zID0gKCk6IHN0cmluZ1tdID0+IHtcbiAgICBjb25zdCBNQVhfS0JfQVNTT0NJQVRJT05TID0gMTA7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGlmICh0aGlzLmtub3dsZWRnZUJhc2VzLmxlbmd0aCA+IE1BWF9LQl9BU1NPQ0lBVElPTlMpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBUaGUgbWF4aW11bSBudW1iZXIgb2Yga25vd2xlZGdlIGJhc2VzIGFzc29jaWF0aW9ucyBpcyAke01BWF9LQl9BU1NPQ0lBVElPTlN9LmApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtiIG9mIHRoaXMua25vd2xlZGdlQmFzZXMpIHtcbiAgICAgIHRoaXMudmFsaWRhdGVLbm93bGVkZ2VCYXNlKGtiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfTtcbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgR3VhcmRyYWlsIGlzIHZhbGlkXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUd1YXJkcmFpbCA9IChndWFyZHJhaWw6IElHdWFyZHJhaWwpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGlmICh0aGlzLmd1YXJkcmFpbCkge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIGBDYW5ub3QgYWRkIEd1YXJkcmFpbCAke2d1YXJkcmFpbC5ndWFyZHJhaWxJZH0uIGAgK1xuICAgICAgICAgIGBHdWFyZHJhaWwgJHt0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxJZH0gaGFzIGFscmVhZHkgYmVlbiBzcGVjaWZpZWQgZm9yIHRoaXMgYWdlbnQuYCxcbiAgICAgICk7XG4gICAgfVxuICAgIGVycm9ycy5wdXNoKC4uLnZhbGlkYXRpb24udmFsaWRhdGVGaWVsZFBhdHRlcm4oZ3VhcmRyYWlsLmd1YXJkcmFpbFZlcnNpb24sICd2ZXJzaW9uJywgL14oKFswLTldezEsOH0pfChEUkFGVCkpJC8pKTtcbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlIGFjdGlvbiBncm91cCBpcyB2YWxpZFxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUFjdGlvbkdyb3VwID0gKGFjdGlvbkdyb3VwOiBBZ2VudEFjdGlvbkdyb3VwKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ1ZhbGlkYXRpbmcgYWN0aW9uIGdyb3VwOiAnLCBhY3Rpb25Hcm91cC5uYW1lKTtcbiAgICBsZXQgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIC8vIEZpbmQgaWYgdGhlcmUgaXMgYSBjb25mbGljdGluZyBhY3Rpb24gZ3JvdXAgbmFtZVxuICAgIGlmICh0aGlzLmFjdGlvbkdyb3Vwcz8uZmluZChhZyA9PiBhZy5uYW1lID09PSBhY3Rpb25Hcm91cC5uYW1lKSkge1xuICAgICAgZXJyb3JzLnB1c2goYEFuIGFjdGlvbiBncm91cCB3aXRoIG5hbWU6ICR7YWN0aW9uR3JvdXAubmFtZX0gaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkYCk7XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG59XG4iXX0=