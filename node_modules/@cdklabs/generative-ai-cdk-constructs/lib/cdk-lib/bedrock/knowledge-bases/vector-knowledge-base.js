"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorKnowledgeBase = exports.VectorKnowledgeBaseBase = exports.VectorStoreType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const nag_suppressions_1 = require("cdk-nag/lib/nag-suppressions");
const knowledge_base_1 = require("./knowledge-base");
const utils_1 = require("../../../common/helpers/utils");
const amazonaurora_1 = require("../../amazonaurora");
const mongodb_atlas_1 = require("../../mongodb-atlas");
const opensearch_vectorindex_1 = require("../../opensearch-vectorindex");
const opensearchmanagedcluster_1 = require("../../opensearchmanagedcluster");
const opensearchserverless_1 = require("../../opensearchserverless");
const pinecone_1 = require("../../pinecone");
const confluence_data_source_1 = require("../data-sources/confluence-data-source");
const context_enrichment_1 = require("../data-sources/context-enrichment");
const custom_data_source_1 = require("../data-sources/custom-data-source");
const s3_data_source_1 = require("../data-sources/s3-data-source");
const salesforce_data_source_1 = require("../data-sources/salesforce-data-source");
const sharepoint_data_source_1 = require("../data-sources/sharepoint-data-source");
const web_crawler_data_source_1 = require("../data-sources/web-crawler-data-source");
const models_1 = require("../models");
/******************************************************************************
 *                                  ENUMS
 *****************************************************************************/
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `OPENSEARCH_MANAGED_CLUSTER` is the vector store for OpenSearch Managed Cluster.
     */
    VectorStoreType["OPENSEARCH_MANAGED_CLUSTER"] = "OPENSEARCH_MANAGED_CLUSTER";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
    /**
     * `MONGO_DB_ATLAS` is the vector store for MongoDB Atlas.
     */
    VectorStoreType["MONGO_DB_ATLAS"] = "MONGO_DB_ATLAS";
    /**
     * `NEPTUNE_ANALYTICS` is the vector store for Amazon Neptune Analytics.
     */
    VectorStoreType["NEPTUNE_ANALYTICS"] = "NEPTUNE_ANALYTICS";
})(VectorStoreType || (exports.VectorStoreType = VectorStoreType = {}));
/******************************************************************************
 *                              ABSTRACT CLASS
 *****************************************************************************/
/**
 * Abstract base class for Vector Knowledge Base.
 * Contains methods valid for KBs either created with CDK or imported.
 */
class VectorKnowledgeBaseBase extends knowledge_base_1.KnowledgeBaseBase {
    constructor(scope, id) {
        super(scope, id);
        this.type = knowledge_base_1.KnowledgeBaseType.VECTOR;
    }
    // ------------------------------------------------------
    // Helper methods to add Data Sources
    // ------------------------------------------------------
    /**
     * Adds an S3 data source to the knowledge base.
     */
    addS3DataSource(props) {
        // Validate context enrichment is only used with Neptune Analytics
        const isNeptuneKB = this.vectorStoreType === VectorStoreType.NEPTUNE_ANALYTICS;
        if (props.contextEnrichment && !isNeptuneKB) {
            throw new Error('Context enrichment is only supported for Neptune/GraphRAG KnowledgeBases');
        }
        // Set context enrichment - use provided value or default for Neptune
        let contextEnrichment = props.contextEnrichment;
        if (isNeptuneKB) {
            contextEnrichment =
                props.contextEnrichment ??
                    context_enrichment_1.ContextEnrichment.foundationModel({
                        enrichmentModel: models_1.BedrockFoundationModel.ANTHROPIC_CLAUDE_HAIKU_V1_0,
                    });
        }
        // Create and return the S3 data source
        return new s3_data_source_1.S3DataSource(this, `s3-${props.bucket.node.addr}`, {
            knowledgeBase: this,
            ...props,
            contextEnrichment: contextEnrichment,
        });
    }
    addWebCrawlerDataSource(props) {
        const url = new URL(props.sourceUrls[0]);
        return new web_crawler_data_source_1.WebCrawlerDataSource(this, `web-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addSharePointDataSource(props) {
        const url = new URL(props.siteUrls[0]);
        return new sharepoint_data_source_1.SharePointDataSource(this, `sp-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addConfluenceDataSource(props) {
        const url = new URL(props.confluenceUrl);
        return new confluence_data_source_1.ConfluenceDataSource(this, `cf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addSalesforceDataSource(props) {
        const url = new URL(props.endpoint);
        return new salesforce_data_source_1.SalesforceDataSource(this, `sf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this,
            ...props,
        });
    }
    addCustomDataSource(props) {
        return new custom_data_source_1.CustomDataSource(this, `custom-${props.dataSourceName}`, {
            knowledgeBase: this,
            ...props,
        });
    }
}
exports.VectorKnowledgeBaseBase = VectorKnowledgeBaseBase;
_a = JSII_RTTI_SYMBOL_1;
VectorKnowledgeBaseBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.VectorKnowledgeBaseBase", version: "0.1.309" };
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class VectorKnowledgeBase extends VectorKnowledgeBaseBase {
    // ------------------------------------------------------
    // Import Methods
    // ------------------------------------------------------
    static fromKnowledgeBaseAttributes(scope, id, attrs) {
        const stack = aws_cdk_lib_1.Stack.of(scope);
        class Import extends VectorKnowledgeBaseBase {
            constructor() {
                super(...arguments);
                this.role = iam.Role.fromRoleArn(this, `kb-${attrs.knowledgeBaseId}-role`, attrs.executionRoleArn);
                this.description = attrs.description;
                this.instruction = attrs.instruction;
                this.knowledgeBaseId = attrs.knowledgeBaseId;
                this.vectorStoreType = attrs.vectorStoreType;
                this.knowledgeBaseArn = stack.formatArn({
                    service: 'bedrock',
                    resource: 'knowledge-base',
                    resourceName: attrs.knowledgeBaseId,
                    arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                });
            }
        }
        return new Import(scope, id);
    }
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        const embeddingsModel = props.embeddingsModel;
        const vectorType = props.vectorType ?? models_1.VectorType.FLOATING_POINT;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        this.description = props.description ?? 'CDK deployed Knowledge base'; // even though this prop is optional, if no value is provided it will fail to deploy
        //this.knowledgeBaseState = props.knowledgeBaseState ?? 'ENABLED';
        this.instruction = props.instruction;
        this.name = props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        // ------------------------------------------------------
        // Validations
        // ------------------------------------------------------
        validateModel(embeddingsModel, vectorType);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // Use existing role if provided, otherwise create a new one
        this.role = props.existingRole ?? (0, knowledge_base_1.createKnowledgeBaseServiceRole)(this);
        if (!props.existingRole) {
            embeddingsModel.grantInvoke(this.role);
            // Add CDK Nag suppression for bedrock:InvokeModel* wildcard permission
            nag_suppressions_1.NagSuppressions.addResourceSuppressions(this.role, [
                {
                    id: 'AwsSolutions-IAM5',
                    reason: 'Bedrock Knowledge Base requires wildcard permissions to invoke embedding models',
                },
            ], true);
        }
        // ------------------------------------------------------
        // Vector Store
        // ------------------------------------------------------
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_SERVERLESS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            this.vectorStoreType = VectorStoreType.PINECONE;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            this.vectorStoreType = VectorStoreType.AMAZON_AURORA;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleAmazonAuroraVectorStore(props));
        }
        else if (props.vectorStore instanceof mongodb_atlas_1.MongoDBAtlasVectorStore) {
            this.vectorStoreType = VectorStoreType.MONGO_DB_ATLAS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleMongoDBAtlasVectorStore(props));
        }
        else if (props.vectorStore instanceof opensearchmanagedcluster_1.OpenSearchManagedClusterVectorStore) {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_MANAGED_CLUSTER;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchManagedClusterVectorStore(props));
        }
        else {
            this.vectorStoreType = VectorStoreType.OPENSEARCH_SERVERLESS;
            ({ vectorStore: this.vectorStore, vectorStoreType: this.vectorStoreType } =
                this.handleOpenSearchDefaultVectorCollection());
        }
        // perform this validation after the vector store is handled since if the user
        // doesn't provide one, the method above will create it
        validateVectorType(this.vectorStore, vectorType);
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use vector stores
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection) && !(this.vectorStore instanceof opensearchmanagedcluster_1.OpenSearchManagedClusterVectorStore)) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [this.vectorStore.credentialsSecretArn],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [this.vectorStore.resourceArn],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    precision: props.vectorType === models_1.VectorType.BINARY ? 'Binary' : 'float',
                    distanceType: props.vectorType === models_1.VectorType.BINARY ? 'hamming' : 'l2',
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` or `ExistingAmazonAuroraVectorStore`,
         * then get textField, metadataField and vectorField from
         * the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
                ? this.vectorStore.vectorField
                : vectorField,
            textField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.textField
                : textField,
            metadataField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.metadataField
                : metadataField,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        const knowledgeBase = new aws_cdk_lib_1.aws_bedrock.CfnKnowledgeBase(this, 'MyCfnKnowledgeBase', {
            knowledgeBaseConfiguration: {
                type: knowledge_base_1.KnowledgeBaseType.VECTOR,
                vectorKnowledgeBaseConfiguration: {
                    embeddingModelArn: embeddingsModel.asArn(this),
                    // Used this approach as if property is specified on models that do not
                    // support configurable dimensions CloudFormation throws an error at runtime
                    embeddingModelConfiguration: {
                        bedrockEmbeddingModelConfiguration: embeddingsModel.modelId === 'amazon.titan-embed-text-v2:0'
                            ? {
                                dimensions: embeddingsModel.vectorDimensions,
                                embeddingDataType: vectorType,
                            }
                            : { embeddingDataType: vectorType },
                    },
                    ...(props.supplementalDataStorageLocations && props.supplementalDataStorageLocations.length > 0
                        ? {
                            supplementalDataStorageConfiguration: {
                                supplementalDataStorageLocations: props.supplementalDataStorageLocations.map(location => location.__render()),
                            },
                        }
                        : {}),
                },
            },
            name: this.name,
            roleArn: this.role.roleArn,
            storageConfiguration: getStorageConfiguration(storageConfiguration),
            description: props.description,
        });
        this.knowledgeBaseInstance = knowledgeBase;
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            // roles: [crProvider.role],
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        //...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                        ...(this.vectorStoreType === VectorStoreType.PINECONE
                            ? ['bedrock:AssociateThirdPartyKnowledgeBase']
                            : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS && this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        nag_suppressions_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.attrKnowledgeBaseArn;
        this.knowledgeBaseId = knowledgeBase.attrKnowledgeBaseId;
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle PineconeVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of PineconeVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
            ? props.vectorStore
            : props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle OpenSearchManagedClusterVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of OpenSearchManagedClusterVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchManagedClusterVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_MANAGED_CLUSTER,
        };
    }
    /**
     * Handle MongoDBAtlasVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of MongoDBAtlasVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleMongoDBAtlasVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.MONGO_DB_ATLAS,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Associate knowledge base with an agent
     */
    associateToAgent(agent) {
        agent.addKnowledgeBase(this);
    }
}
exports.VectorKnowledgeBase = VectorKnowledgeBase;
_b = JSII_RTTI_SYMBOL_1;
VectorKnowledgeBase[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.VectorKnowledgeBase", version: "0.1.309" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel, vectorType) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
    if (foundationModel.supportedVectorType &&
        !foundationModel.supportedVectorType.includes(vectorType)) {
        throw new Error(`The vector type ${vectorType} is not supported by the model ${foundationModel}.`);
    }
}
/**
 * Validate that the storage configuration can use the selected vector type.
 * It prevents the use of vector types with vector stores that do not support them,
 * thereby avoiding potential runtime errors.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorType(vectorStore, vectorType) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorType == models_1.VectorType.BINARY) {
        console.log(vectorStore);
        throw new Error('Amazon OpenSearch Serverless is currently the only vector store that supports storing binary vectors.');
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore =
                params.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
                    ? params.vectorStore
                    : params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: `${params.vectorStore.schemaName}.${params.vectorStore.tableName}`,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        case VectorStoreType.MONGO_DB_ATLAS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.MONGO_DB_ATLAS,
                mongoDbAtlasConfiguration: {
                    collectionName: params.vectorStore.collectionName,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    endpoint: params.vectorStore.endpoint,
                    endpointServiceName: params.vectorStore.endpointServiceName,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                    textIndexName: params.vectorStore.textIndexName,
                },
            };
        case VectorStoreType.OPENSEARCH_MANAGED_CLUSTER:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_MANAGED_CLUSTER,
                opensearchManagedClusterConfiguration: {
                    domainArn: params.vectorStore.domainArn,
                    domainEndpoint: params.vectorStore.domainEndpoint,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVjdG9yLWtub3dsZWRnZS1iYXNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2Nkay1saWIvYmVkcm9jay9rbm93bGVkZ2UtYmFzZXMvdmVjdG9yLWtub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2Q0FBdUU7QUFDdkUsMkNBQTJDO0FBQzNDLG1FQUErRDtBQUUvRCxxREFPMEI7QUFFMUIseURBQXVFO0FBQ3ZFLHFEQUE4RjtBQUM5Rix1REFBOEQ7QUFDOUQseUVBQTJEO0FBQzNELDZFQUFxRjtBQUNyRixxRUFBOEQ7QUFDOUQsNkNBQXFEO0FBRXJELG1GQUdnRDtBQUNoRCwyRUFBdUU7QUFDdkUsMkVBRzRDO0FBQzVDLG1FQUE0RjtBQUM1RixtRkFHZ0Q7QUFDaEQsbUZBR2dEO0FBQ2hELHFGQUdpRDtBQUNqRCxzQ0FBK0Q7QUFFL0Q7OytFQUUrRTtBQUMvRTs7Ozs7OztHQU9HO0FBQ0gsSUFBWSxlQXlCWDtBQXpCRCxXQUFZLGVBQWU7SUFDekI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILDRFQUF5RCxDQUFBO0lBQ3pEOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7SUFDckI7O09BRUc7SUFDSCx3Q0FBcUIsQ0FBQTtJQUNyQjs7T0FFRztJQUNILG9EQUFpQyxDQUFBO0lBQ2pDOztPQUVHO0lBQ0gsMERBQXVDLENBQUE7QUFDekMsQ0FBQyxFQXpCVyxlQUFlLCtCQUFmLGVBQWUsUUF5QjFCO0FBaUdEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsdUJBQ3BCLFNBQVEsa0NBQWlCO0lBV3pCLFlBQVksS0FBZ0IsRUFBRSxFQUFVO1FBQ3RDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFISCxTQUFJLEdBQXNCLGtDQUFpQixDQUFDLE1BQU0sQ0FBQztJQUluRSxDQUFDO0lBRUQseURBQXlEO0lBQ3pELHFDQUFxQztJQUNyQyx5REFBeUQ7SUFDekQ7O09BRUc7SUFDSSxlQUFlLENBQUMsS0FBbUM7UUFDeEQsa0VBQWtFO1FBQ2xFLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLEtBQUssZUFBZSxDQUFDLGlCQUFpQixDQUFDO1FBQy9FLElBQUksS0FBSyxDQUFDLGlCQUFpQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDNUMsTUFBTSxJQUFJLEtBQUssQ0FBQywwRUFBMEUsQ0FBQyxDQUFDO1FBQzlGLENBQUM7UUFFRCxxRUFBcUU7UUFDckUsSUFBSSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsaUJBQWlCLENBQUM7UUFDaEQsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNoQixpQkFBaUI7Z0JBQ2YsS0FBSyxDQUFDLGlCQUFpQjtvQkFDdkIsc0NBQWlCLENBQUMsZUFBZSxDQUFDO3dCQUNoQyxlQUFlLEVBQUUsK0JBQXNCLENBQUMsMkJBQTJCO3FCQUNwRSxDQUFDLENBQUM7UUFDUCxDQUFDO1FBRUQsdUNBQXVDO1FBQ3ZDLE9BQU8sSUFBSSw2QkFBWSxDQUFDLElBQUksRUFBRSxNQUFNLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzVELGFBQWEsRUFBRSxJQUFJO1lBQ25CLEdBQUcsS0FBSztZQUNSLGlCQUFpQixFQUFFLGlCQUFpQjtTQUNyQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sdUJBQXVCLENBQzVCLEtBQTJDO1FBRTNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxPQUFPLElBQUksOENBQW9CLENBQUMsSUFBSSxFQUFFLE9BQU8sR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUU7WUFDN0UsYUFBYSxFQUFFLElBQUk7WUFDbkIsR0FBRyxLQUFLO1NBQ1QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNNLHVCQUF1QixDQUM1QixLQUEyQztRQUUzQyxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkMsT0FBTyxJQUFJLDZDQUFvQixDQUFDLElBQUksRUFBRSxNQUFNLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFO1lBQzVFLGFBQWEsRUFBRSxJQUFJO1lBQ25CLEdBQUcsS0FBSztTQUNULENBQUMsQ0FBQztJQUNMLENBQUM7SUFDTSx1QkFBdUIsQ0FDNUIsS0FBMkM7UUFFM0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSw2Q0FBb0IsQ0FBQyxJQUFJLEVBQUUsTUFBTSxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRTtZQUM1RSxhQUFhLEVBQUUsSUFBSTtZQUNuQixHQUFHLEtBQUs7U0FDVCxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ00sdUJBQXVCLENBQzVCLEtBQTJDO1FBRTNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwQyxPQUFPLElBQUksNkNBQW9CLENBQUMsSUFBSSxFQUFFLE1BQU0sR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUU7WUFDNUUsYUFBYSxFQUFFLElBQUk7WUFDbkIsR0FBRyxLQUFLO1NBQ1QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNNLG1CQUFtQixDQUFDLEtBQXVDO1FBQ2hFLE9BQU8sSUFBSSxxQ0FBZ0IsQ0FBQyxJQUFJLEVBQUUsVUFBVSxLQUFLLENBQUMsY0FBYyxFQUFFLEVBQUU7WUFDbEUsYUFBYSxFQUFFLElBQUk7WUFDbkIsR0FBRyxLQUFLO1NBQ1QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7QUF4RkgsMERBeUZDOzs7QUFrRkQ7Ozs7R0FJRztBQUNILE1BQWEsbUJBQW9CLFNBQVEsdUJBQXVCO0lBQzlELHlEQUF5RDtJQUN6RCxpQkFBaUI7SUFDakIseURBQXlEO0lBQ2xELE1BQU0sQ0FBQywyQkFBMkIsQ0FDdkMsS0FBZ0IsRUFDaEIsRUFBVSxFQUNWLEtBQW9DO1FBRXBDLE1BQU0sS0FBSyxHQUFHLG1CQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTlCLE1BQU0sTUFBTyxTQUFRLHVCQUF1QjtZQUE1Qzs7Z0JBQ2tCLFNBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FDekMsSUFBSSxFQUNKLE1BQU0sS0FBSyxDQUFDLGVBQWUsT0FBTyxFQUNsQyxLQUFLLENBQUMsZ0JBQWdCLENBQ3ZCLENBQUM7Z0JBQ2MsZ0JBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO2dCQUNoQyxnQkFBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUM7Z0JBQ2hDLG9CQUFlLEdBQUcsS0FBSyxDQUFDLGVBQWUsQ0FBQztnQkFDeEMsb0JBQWUsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDO2dCQUN4QyxxQkFBZ0IsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDO29CQUNqRCxPQUFPLEVBQUUsU0FBUztvQkFDbEIsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsWUFBWSxFQUFFLEtBQUssQ0FBQyxlQUFlO29CQUNuQyxTQUFTLEVBQUUsdUJBQVMsQ0FBQyxtQkFBbUI7aUJBQ3pDLENBQUMsQ0FBQztZQUNMLENBQUM7U0FBQTtRQUNELE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUE4REQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUErQjtRQUN2RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLHlEQUF5RDtRQUN6RCw2QkFBNkI7UUFDN0IseURBQXlEO1FBQ3pELE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUM7UUFDOUMsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsSUFBSSxtQkFBVSxDQUFDLGNBQWMsQ0FBQztRQUNqRSxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxJQUFJLHNDQUFzQyxDQUFDO1FBQzVFLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLElBQUksdUNBQXVDLENBQUM7UUFDakYsTUFBTSxTQUFTLEdBQUcsMkJBQTJCLENBQUM7UUFDOUMsTUFBTSxhQUFhLEdBQUcseUJBQXlCLENBQUM7UUFFaEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxJQUFJLDZCQUE2QixDQUFDLENBQUMsb0ZBQW9GO1FBQzNKLGtFQUFrRTtRQUNsRSxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUM7UUFDckMsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUEsOEJBQXNCLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWhGLHlEQUF5RDtRQUN6RCxjQUFjO1FBQ2QseURBQXlEO1FBRXpELGFBQWEsQ0FBQyxlQUFlLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDM0MsbUJBQW1CLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlGLElBQUksS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3RCLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JFLENBQUM7UUFFRCx5REFBeUQ7UUFDekQsT0FBTztRQUNQLHlEQUF5RDtRQUN6RCw0REFBNEQ7UUFDNUQsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsWUFBWSxJQUFJLElBQUEsK0NBQThCLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFFdkUsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN4QixlQUFlLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV2Qyx1RUFBdUU7WUFDdkUsa0NBQWUsQ0FBQyx1QkFBdUIsQ0FDckMsSUFBSSxDQUFDLElBQUksRUFDVDtnQkFDRTtvQkFDRSxFQUFFLEVBQUUsbUJBQW1CO29CQUN2QixNQUFNLEVBQUUsaUZBQWlGO2lCQUMxRjthQUNGLEVBQ0QsSUFBSSxDQUNMLENBQUM7UUFDSixDQUFDO1FBRUQseURBQXlEO1FBQ3pELGVBQWU7UUFDZix5REFBeUQ7UUFDekQ7Ozs7V0FJRztRQUNILElBQUksS0FBSyxDQUFDLFdBQVcsWUFBWSx1Q0FBZ0IsRUFBRSxDQUFDO1lBQ2xELElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDLHFCQUFxQixDQUFDO1lBQzdELENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDdkUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDNUMsQ0FBQzthQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsWUFBWSw4QkFBbUIsRUFBRSxDQUFDO1lBQzVELElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQztZQUNoRCxDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3ZFLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUM7YUFBTSxJQUNMLEtBQUssQ0FBQyxXQUFXLFlBQVksc0NBQXVCO1lBQ3BELEtBQUssQ0FBQyxXQUFXLFlBQVksOENBQStCLEVBQzVELENBQUM7WUFDRCxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQyxhQUFhLENBQUM7WUFDckQsQ0FBQyxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLGVBQWUsRUFBRSxJQUFJLENBQUMsZUFBZSxFQUFFO2dCQUN2RSxJQUFJLENBQUMsNkJBQTZCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMvQyxDQUFDO2FBQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxZQUFZLHVDQUF1QixFQUFFLENBQUM7WUFDaEUsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUMsY0FBYyxDQUFDO1lBQ3RELENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDdkUsSUFBSSxDQUFDLDZCQUE2QixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDL0MsQ0FBQzthQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsWUFBWSw4REFBbUMsRUFBRSxDQUFDO1lBQzVFLElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDLDBCQUEwQixDQUFDO1lBQ2xFLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDdkUsSUFBSSxDQUFDLHlDQUF5QyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDM0QsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQyxxQkFBcUIsQ0FBQztZQUM3RCxDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUU7Z0JBQ3ZFLElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUVELDhFQUE4RTtRQUM5RSx1REFBdUQ7UUFDdkQsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVqRDs7OztXQUlHO1FBQ0gsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsWUFBWSx1Q0FBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxZQUFZLDhEQUFtQyxDQUFDLEVBQUUsQ0FBQztZQUMxSCxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUM1QixJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7Z0JBQ3RCLE9BQU8sRUFBRSxDQUFDLCtCQUErQixDQUFDO2dCQUMxQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLG9CQUFvQixDQUFDO2FBQ25ELENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQztRQUVEOzs7Ozs7V0FNRztRQUNILElBQ0UsSUFBSSxDQUFDLFdBQVcsWUFBWSxzQ0FBdUI7WUFDbkQsSUFBSSxDQUFDLFdBQVcsWUFBWSw4Q0FBK0IsRUFDM0QsQ0FBQztZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQzVCLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQztnQkFDdEIsT0FBTyxFQUFFO29CQUNQLDJCQUEyQjtvQkFDM0IsZ0NBQWdDO29CQUNoQyx3QkFBd0I7aUJBQ3pCO2dCQUNELFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDO2FBQzFDLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQztRQUVEOzs7V0FHRztRQUNILElBQUksSUFBSSxDQUFDLGVBQWUsS0FBSyxlQUFlLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUNuRSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksb0NBQVcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFO29CQUNsRCxVQUFVLEVBQUUsSUFBSSxDQUFDLFdBQStCO29CQUNoRCxTQUFTO29CQUNULFdBQVc7b0JBQ1gsZ0JBQWdCLEVBQUUsZUFBZSxDQUFDLGdCQUFpQjtvQkFDbkQsU0FBUyxFQUFFLEtBQUssQ0FBQyxVQUFVLEtBQUssbUJBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTztvQkFDdEUsWUFBWSxFQUFFLEtBQUssQ0FBQyxVQUFVLEtBQUssbUJBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSTtvQkFDdkUsUUFBUSxFQUFFO3dCQUNSOzRCQUNFLFlBQVksRUFBRSwyQkFBMkI7NEJBQ3pDLFFBQVEsRUFBRSxNQUFNOzRCQUNoQixVQUFVLEVBQUUsSUFBSTt5QkFDakI7d0JBQ0Q7NEJBQ0UsWUFBWSxFQUFFLHlCQUF5Qjs0QkFDdkMsUUFBUSxFQUFFLE1BQU07NEJBQ2hCLFVBQVUsRUFBRSxLQUFLO3lCQUNsQjtxQkFDRjtpQkFDRixDQUFDLENBQUM7Z0JBRUgsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN4RCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO1lBQ3ZDLENBQUM7UUFDSCxDQUFDO1FBRUQ7Ozs7O1dBS0c7UUFDSCxNQUFNLG9CQUFvQixHQUF5QjtZQUNqRCxTQUFTLEVBQUUsU0FBUztZQUNwQixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDN0IsZUFBZSxFQUFFLElBQUksQ0FBQyxlQUFlO1lBQ3JDLFdBQVcsRUFDVCxJQUFJLENBQUMsV0FBVyxZQUFZLHNDQUF1QjtnQkFDbkQsSUFBSSxDQUFDLFdBQVcsWUFBWSw4Q0FBK0I7Z0JBQ3pELENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVc7Z0JBQzlCLENBQUMsQ0FBQyxXQUFXO1lBQ2pCLFNBQVMsRUFDUCxJQUFJLENBQUMsV0FBVyxZQUFZLHNDQUF1QjtnQkFDbkQsSUFBSSxDQUFDLFdBQVcsWUFBWSw4Q0FBK0I7Z0JBQzNELElBQUksQ0FBQyxXQUFXLFlBQVksOEJBQW1CO2dCQUM3QyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTO2dCQUM1QixDQUFDLENBQUMsU0FBUztZQUNmLGFBQWEsRUFDWCxJQUFJLENBQUMsV0FBVyxZQUFZLHNDQUF1QjtnQkFDbkQsSUFBSSxDQUFDLFdBQVcsWUFBWSw4Q0FBK0I7Z0JBQzNELElBQUksQ0FBQyxXQUFXLFlBQVksOEJBQW1CO2dCQUM3QyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhO2dCQUNoQyxDQUFDLENBQUMsYUFBYTtTQUNwQixDQUFDO1FBRUYseURBQXlEO1FBQ3pELG1CQUFtQjtRQUNuQix5REFBeUQ7UUFDekQsTUFBTSxhQUFhLEdBQUcsSUFBSSx5QkFBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxvQkFBb0IsRUFBRTtZQUM3RSwwQkFBMEIsRUFBRTtnQkFDMUIsSUFBSSxFQUFFLGtDQUFpQixDQUFDLE1BQU07Z0JBQzlCLGdDQUFnQyxFQUFFO29CQUNoQyxpQkFBaUIsRUFBRSxlQUFlLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztvQkFDOUMsdUVBQXVFO29CQUN2RSw0RUFBNEU7b0JBQzVFLDJCQUEyQixFQUFFO3dCQUMzQixrQ0FBa0MsRUFDaEMsZUFBZSxDQUFDLE9BQU8sS0FBSyw4QkFBOEI7NEJBQ3hELENBQUMsQ0FBQztnQ0FDQSxVQUFVLEVBQUUsZUFBZSxDQUFDLGdCQUFnQjtnQ0FDNUMsaUJBQWlCLEVBQUUsVUFBVTs2QkFDOUI7NEJBQ0QsQ0FBQyxDQUFDLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFO3FCQUN4QztvQkFDRCxHQUFHLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxNQUFNLEdBQUcsQ0FBQzt3QkFDN0YsQ0FBQyxDQUFDOzRCQUNBLG9DQUFvQyxFQUFFO2dDQUNwQyxnQ0FBZ0MsRUFBRSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDOzZCQUM5Rzt5QkFDRjt3QkFDRCxDQUFDLENBQUMsRUFBRSxDQUFDO2lCQUNSO2FBQ0Y7WUFDRCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQzFCLG9CQUFvQixFQUFFLHVCQUF1QixDQUFDLG9CQUFvQixDQUFDO1lBQ25FLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztTQUMvQixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMscUJBQXFCLEdBQUcsYUFBYSxDQUFDO1FBRTNDLE1BQU0sVUFBVSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ3BELDRCQUE0QjtZQUM1QixLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2xCLFVBQVUsRUFBRTtnQkFDVixJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7b0JBQ3RCLE9BQU8sRUFBRTt3QkFDUCw2QkFBNkI7d0JBQzdCOzs7MkJBR0c7d0JBQ0gsd0VBQXdFO3dCQUN4RSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsS0FBSyxlQUFlLENBQUMsUUFBUTs0QkFDbkQsQ0FBQyxDQUFDLENBQUMsMENBQTBDLENBQUM7NEJBQzlDLENBQUMsQ0FBQyxFQUFFLENBQUM7cUJBQ1I7b0JBQ0QsU0FBUyxFQUFFLENBQUMsR0FBRyxDQUFDO2lCQUNqQixDQUFDO2dCQUNGLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQztvQkFDdEIsT0FBTyxFQUFFO3dCQUNQLDZCQUE2Qjt3QkFDN0IsNkJBQTZCO3dCQUM3QixxQkFBcUI7cUJBQ3RCO29CQUNELFNBQVMsRUFBRTt3QkFDVCxtQkFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUM7NEJBQ3ZCLE9BQU8sRUFBRSxTQUFTOzRCQUNsQixRQUFRLEVBQUUsZ0JBQWdCOzRCQUMxQixZQUFZLEVBQUUsR0FBRzs0QkFDakIsU0FBUyxFQUFFLHVCQUFTLENBQUMsbUJBQW1CO3lCQUN6QyxDQUFDO3FCQUNIO2lCQUNGLENBQUM7Z0JBQ0YsSUFBSSxHQUFHLENBQUMsZUFBZSxDQUFDO29CQUN0QixPQUFPLEVBQUUsQ0FBQyxjQUFjLENBQUM7b0JBQ3pCLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2lCQUMvQixDQUFDO2FBQ0g7U0FDRixDQUFDLENBQUM7UUFFSCxhQUFhLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0MsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLGVBQWUsQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkYsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFDRCxJQUFJLElBQUksQ0FBQyxlQUFlLEtBQUssZUFBZSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzNELGFBQWEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBRUQsa0NBQWUsQ0FBQyx1QkFBdUIsQ0FDckMsVUFBVSxFQUNWO1lBQ0U7Z0JBQ0UsRUFBRSxFQUFFLG1CQUFtQjtnQkFDdkIsTUFBTSxFQUFFLDhEQUE4RDthQUN2RTtTQUNGLEVBQ0QsSUFBSSxDQUNMLENBQUM7UUFFRixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLG9CQUFvQixDQUFDO1FBQzNELElBQUksQ0FBQyxlQUFlLEdBQUcsYUFBYSxDQUFDLG1CQUFtQixDQUFDO0lBQzNELENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSywwQkFBMEIsQ0FBQyxLQUErQjtRQUloRSxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBK0IsQ0FBQztRQUMxRCxXQUFXLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxPQUFPO1lBQ0wsV0FBVyxFQUFFLFdBQVc7WUFDeEIsZUFBZSxFQUFFLGVBQWUsQ0FBQyxxQkFBcUI7U0FDdkQsQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSyx5QkFBeUIsQ0FBQyxLQUErQjtRQUkvRCxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBa0MsQ0FBQztRQUM3RCxPQUFPO1lBQ0wsV0FBVyxFQUFFLFdBQVc7WUFDeEIsZUFBZSxFQUFFLGVBQWUsQ0FBQyxRQUFRO1NBQzFDLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssNkJBQTZCLENBQUMsS0FBK0I7UUFJbkUsTUFBTSxXQUFXLEdBQ2YsS0FBSyxDQUFDLFdBQVcsWUFBWSw4Q0FBK0I7WUFDMUQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXO1lBQ25CLENBQUMsQ0FBRSxLQUFLLENBQUMsV0FBdUMsQ0FBQztRQUNyRCxPQUFPO1lBQ0wsV0FBVyxFQUFFLFdBQVc7WUFDeEIsZUFBZSxFQUFFLGVBQWUsQ0FBQyxhQUFhO1NBQy9DLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0sseUNBQXlDLENBQUMsS0FBK0I7UUFJL0UsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQWtELENBQUM7UUFDN0UsT0FBTztZQUNMLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLGVBQWUsRUFBRSxlQUFlLENBQUMsMEJBQTBCO1NBQzVELENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssNkJBQTZCLENBQUMsS0FBK0I7UUFJbkUsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQXNDLENBQUM7UUFDakUsT0FBTztZQUNMLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLGVBQWUsRUFBRSxlQUFlLENBQUMsY0FBYztTQUNoRCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0ssdUNBQXVDO1FBSTdDLE1BQU0sV0FBVyxHQUFHLElBQUksdUNBQWdCLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzVELFdBQVcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLE9BQU87WUFDTCxXQUFXLEVBQUUsV0FBVztZQUN4QixlQUFlLEVBQUUsZUFBZSxDQUFDLHFCQUFxQjtTQUN2RCxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0JBQWdCLENBQUMsS0FBWTtRQUNsQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7QUFsZkgsa0RBbWZDOzs7QUFFRDs7OztHQUlHO0FBQ0gsU0FBUyxhQUFhLENBQUMsZUFBdUMsRUFBRSxVQUFzQjtJQUNwRixJQUFJLENBQUMsZUFBZSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDM0MsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLGVBQWUsOENBQThDLENBQUMsQ0FBQztJQUM5RixDQUFDO0lBQ0QsSUFDRSxlQUFlLENBQUMsbUJBQW1CO1FBQ25DLENBQUMsZUFBZSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFDekQsQ0FBQztRQUNELE1BQU0sSUFBSSxLQUFLLENBQ2IsbUJBQW1CLFVBQVUsa0NBQWtDLGVBQWUsR0FBRyxDQUNsRixDQUFDO0lBQ0osQ0FBQztBQUNILENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxTQUFTLGtCQUFrQixDQUFDLFdBQWdCLEVBQUUsVUFBc0I7SUFDbEUsSUFBSSxDQUFDLENBQUMsV0FBVyxZQUFZLHVDQUFnQixDQUFDLElBQUksVUFBVSxJQUFJLG1CQUFVLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDbEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN6QixNQUFNLElBQUksS0FBSyxDQUNiLHVHQUF1RyxDQUN4RyxDQUFDO0lBQ0osQ0FBQztBQUNILENBQUM7QUFFRDs7Ozs7R0FLRztBQUNILFNBQVMsbUJBQW1CLENBQUMsV0FBZ0IsRUFBRSxXQUFnQixFQUFFLFdBQWdCLEVBQUUsU0FBYztJQUMvRixJQUFJLENBQUMsQ0FBQyxXQUFXLFlBQVksdUNBQWdCLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUM5RCxNQUFNLElBQUksS0FBSyxDQUNiLHFGQUFxRjtZQUNuRiw2QkFBNkIsQ0FDaEMsQ0FBQztJQUNKLENBQUM7SUFDRCxJQUFJLENBQUMsQ0FBQyxXQUFXLFlBQVksdUNBQWdCLENBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUM1RCxNQUFNLElBQUksS0FBSyxDQUNiLG1GQUFtRjtZQUNqRiw2QkFBNkIsQ0FDaEMsQ0FBQztJQUNKLENBQUM7SUFDRCxJQUFJLENBQUMsQ0FBQyxXQUFXLFlBQVksdUNBQWdCLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUM5RCxNQUFNLElBQUksS0FBSyxDQUNiLHFGQUFxRjtZQUNuRiw2QkFBNkIsQ0FDaEMsQ0FBQztJQUNKLENBQUM7QUFDSCxDQUFDO0FBRUQ7Ozs7Ozs7Ozs7R0FVRztBQUNILFNBQVMsdUJBQXVCLENBQUMsV0FBd0IsRUFBRSxTQUFpQixFQUFFLFdBQW1CO0lBQy9GLElBQUksV0FBVyxDQUFDLFNBQVMsS0FBSyxzQ0FBc0MsRUFBRSxDQUFDO1FBQ3JFLElBQUksV0FBVyxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUN4QyxNQUFNLElBQUksS0FBSyxDQUNiLHVFQUF1RTtnQkFDckUsZ0ZBQWdGO2dCQUNoRiwwR0FBMEc7Z0JBQzFHLDJGQUEyRjtnQkFDM0YsMkRBQTJELENBQzlELENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUNELElBQUksV0FBVyxDQUFDLFdBQVcsS0FBSyx1Q0FBdUMsRUFBRSxDQUFDO1FBQ3hFLElBQUksV0FBVyxDQUFDLFdBQVcsS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUM1QyxNQUFNLElBQUksS0FBSyxDQUNiLDBFQUEwRTtnQkFDeEUsZ0ZBQWdGO2dCQUNoRiwwR0FBMEc7Z0JBQzFHLDRGQUE0RjtnQkFDNUYsNkRBQTZELENBQ2hFLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBUyx1QkFBdUIsQ0FBQyxNQUE0QjtJQUMzRCxRQUFRLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUMvQixLQUFLLGVBQWUsQ0FBQyxxQkFBcUI7WUFDeEMsTUFBTSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBK0IsQ0FBQztZQUM1RCxPQUFPO2dCQUNMLElBQUksRUFBRSxlQUFlLENBQUMscUJBQXFCO2dCQUMzQyxpQ0FBaUMsRUFBRTtvQkFDakMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYTtvQkFDL0MsWUFBWSxFQUFFO3dCQUNaLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVzt3QkFDL0IsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTO3dCQUMzQixhQUFhLEVBQUUsTUFBTSxDQUFDLGFBQWE7cUJBQ3BDO29CQUNELGVBQWUsRUFBRSxNQUFNLENBQUMsU0FBUztpQkFDbEM7YUFDRixDQUFDO1FBQ0osS0FBSyxlQUFlLENBQUMsUUFBUTtZQUMzQixNQUFNLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFrQyxDQUFDO1lBQy9ELE9BQU87Z0JBQ0wsSUFBSSxFQUFFLGVBQWUsQ0FBQyxRQUFRO2dCQUM5QixxQkFBcUIsRUFBRTtvQkFDckIsU0FBUyxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxJQUFJLFNBQVM7b0JBQ3BELGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCO29CQUNyRCxvQkFBb0IsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLG9CQUFvQjtvQkFDN0QsWUFBWSxFQUFFO3dCQUNaLFNBQVMsRUFBRSxNQUFNLENBQUMsU0FBUzt3QkFDM0IsYUFBYSxFQUFFLE1BQU0sQ0FBQyxhQUFhO3FCQUNwQztpQkFDRjthQUNGLENBQUM7UUFDSixLQUFLLGVBQWUsQ0FBQyxhQUFhO1lBQ2hDLE1BQU0sQ0FBQyxXQUFXO2dCQUNoQixNQUFNLENBQUMsV0FBVyxZQUFZLDhDQUErQjtvQkFDM0QsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXO29CQUNwQixDQUFDLENBQUUsTUFBTSxDQUFDLFdBQXVDLENBQUM7WUFDdEQsT0FBTztnQkFDTCxJQUFJLEVBQUUsZUFBZSxDQUFDLGFBQWE7Z0JBQ25DLGdCQUFnQixFQUFFO29CQUNoQixvQkFBb0IsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLG9CQUFvQjtvQkFDN0QsWUFBWSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsWUFBWTtvQkFDN0MsV0FBVyxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsV0FBVztvQkFDM0MsU0FBUyxFQUFFLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLElBQUksTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUU7b0JBQzdFLFlBQVksRUFBRTt3QkFDWixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQzt3QkFDbEQsZUFBZSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsZUFBZTt3QkFDbkQsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFO3dCQUN6QyxhQUFhLEVBQUUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUU7cUJBQ2xEO2lCQUNGO2FBQ0YsQ0FBQztRQUNKLEtBQUssZUFBZSxDQUFDLGNBQWM7WUFDakMsTUFBTSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBc0MsQ0FBQztZQUNuRSxPQUFPO2dCQUNMLElBQUksRUFBRSxlQUFlLENBQUMsY0FBYztnQkFDcEMseUJBQXlCLEVBQUU7b0JBQ3pCLGNBQWMsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLGNBQWM7b0JBQ2pELG9CQUFvQixFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsb0JBQW9CO29CQUM3RCxZQUFZLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZO29CQUM3QyxRQUFRLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRO29CQUNyQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLG1CQUFtQjtvQkFDM0QsWUFBWSxFQUFFO3dCQUNaLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVzt3QkFDL0IsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTO3dCQUMzQixhQUFhLEVBQUUsTUFBTSxDQUFDLGFBQWE7cUJBQ3BDO29CQUNELGVBQWUsRUFBRSxNQUFNLENBQUMsU0FBUztvQkFDakMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYTtpQkFDaEQ7YUFDRixDQUFDO1FBQ0osS0FBSyxlQUFlLENBQUMsMEJBQTBCO1lBQzdDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQWtELENBQUM7WUFDL0UsT0FBTztnQkFDTCxJQUFJLEVBQUUsZUFBZSxDQUFDLDBCQUEwQjtnQkFDaEQscUNBQXFDLEVBQUU7b0JBQ3JDLFNBQVMsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVM7b0JBQ3ZDLGNBQWMsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLGNBQWM7b0JBQ2pELFlBQVksRUFBRTt3QkFDWixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7d0JBQy9CLFNBQVMsRUFBRSxNQUFNLENBQUMsU0FBUzt3QkFDM0IsYUFBYSxFQUFFLE1BQU0sQ0FBQyxhQUFhO3FCQUNwQztvQkFDRCxlQUFlLEVBQUUsTUFBTSxDQUFDLFNBQVM7aUJBQ2xDO2FBQ0YsQ0FBQztRQUNKO1lBQ0UsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7SUFDaEYsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBcm5Gb3JtYXQsIGF3c19iZWRyb2NrIGFzIGJlZHJvY2ssIFN0YWNrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZy9saWIvbmFnLXN1cHByZXNzaW9ucyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7XG4gIENvbW1vbktub3dsZWRnZUJhc2VBdHRyaWJ1dGVzLFxuICBDb21tb25Lbm93bGVkZ2VCYXNlUHJvcHMsXG4gIGNyZWF0ZUtub3dsZWRnZUJhc2VTZXJ2aWNlUm9sZSxcbiAgSUtub3dsZWRnZUJhc2UsXG4gIEtub3dsZWRnZUJhc2VCYXNlLFxuICBLbm93bGVkZ2VCYXNlVHlwZSxcbn0gZnJvbSAnLi9rbm93bGVkZ2UtYmFzZSc7XG5pbXBvcnQgeyBTdXBwbGVtZW50YWxEYXRhU3RvcmFnZUxvY2F0aW9uIH0gZnJvbSAnLi9zdXBwbGVtZW50YWwtZGF0YS1zdG9yYWdlJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5pbXBvcnQgeyBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlLCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB9IGZyb20gJy4uLy4uL2FtYXpvbmF1cm9yYSc7XG5pbXBvcnQgeyBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZSB9IGZyb20gJy4uLy4uL21vbmdvZGItYXRsYXMnO1xuaW1wb3J0IHsgVmVjdG9ySW5kZXggfSBmcm9tICcuLi8uLi9vcGVuc2VhcmNoLXZlY3RvcmluZGV4JztcbmltcG9ydCB7IE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlIH0gZnJvbSAnLi4vLi4vb3BlbnNlYXJjaG1hbmFnZWRjbHVzdGVyJztcbmltcG9ydCB7IFZlY3RvckNvbGxlY3Rpb24gfSBmcm9tICcuLi8uLi9vcGVuc2VhcmNoc2VydmVybGVzcyc7XG5pbXBvcnQgeyBQaW5lY29uZVZlY3RvclN0b3JlIH0gZnJvbSAnLi4vLi4vcGluZWNvbmUnO1xuaW1wb3J0IHsgQWdlbnQgfSBmcm9tICcuLi9hZ2VudHMvYWdlbnQnO1xuaW1wb3J0IHtcbiAgQ29uZmx1ZW5jZURhdGFTb3VyY2UsXG4gIENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbn0gZnJvbSAnLi4vZGF0YS1zb3VyY2VzL2NvbmZsdWVuY2UtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHsgQ29udGV4dEVucmljaG1lbnQgfSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvY29udGV4dC1lbnJpY2htZW50JztcbmltcG9ydCB7XG4gIEN1c3RvbURhdGFTb3VyY2UsXG4gIEN1c3RvbURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxufSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvY3VzdG9tLWRhdGEtc291cmNlJztcbmltcG9ydCB7IFMzRGF0YVNvdXJjZSwgUzNEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyB9IGZyb20gJy4uL2RhdGEtc291cmNlcy9zMy1kYXRhLXNvdXJjZSc7XG5pbXBvcnQge1xuICBTYWxlc2ZvcmNlRGF0YVNvdXJjZSxcbiAgU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxufSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvc2FsZXNmb3JjZS1kYXRhLXNvdXJjZSc7XG5pbXBvcnQge1xuICBTaGFyZVBvaW50RGF0YVNvdXJjZSxcbiAgU2hhcmVQb2ludERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxufSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvc2hhcmVwb2ludC1kYXRhLXNvdXJjZSc7XG5pbXBvcnQge1xuICBXZWJDcmF3bGVyRGF0YVNvdXJjZSxcbiAgV2ViQ3Jhd2xlckRhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxufSBmcm9tICcuLi9kYXRhLXNvdXJjZXMvd2ViLWNyYXdsZXItZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHsgQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCwgVmVjdG9yVHlwZSB9IGZyb20gJy4uL21vZGVscyc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVOVU1TXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEtub3dsZWRnZSBiYXNlIGNhbiBiZSBiYWNrZWQgYnkgZGlmZmVyZW50IHZlY3RvciBkYXRhYmFzZXMuXG4gKiBUaGlzIGVudW0gcmVwcmVzZW50cyB0aGUgZGlmZmVyZW50IHZlY3RvciBkYXRhYmFzZXMgdGhhdCBjYW4gYmUgdXNlZC5cbiAqXG4gKiBgT1BFTlNFQVJDSF9TRVJWRVJMRVNTYCBpcyB0aGUgZGVmYXVsdCB2ZWN0b3IgZGF0YWJhc2UuXG4gKiBgUElORUNPTkVgIGlzIHRoZSB2ZWN0b3IgZGF0YWJhc2UgZm9yIFBpbmVjb25lLlxuICogYEFNQVpPTl9BVVJPUkFgIGlzIHRoZSB2ZWN0b3IgZGF0YWJhc2UgZm9yIEFtYXpvbiBBdXJvcmEgUG9zdGdyZVNRTC5cbiAqL1xuZXhwb3J0IGVudW0gVmVjdG9yU3RvcmVUeXBlIHtcbiAgLyoqXG4gICAqIGBPUEVOU0VBUkNIX1NFUlZFUkxFU1NgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICovXG4gIE9QRU5TRUFSQ0hfU0VSVkVSTEVTUyA9ICdPUEVOU0VBUkNIX1NFUlZFUkxFU1MnLFxuICAvKipcbiAgICogYE9QRU5TRUFSQ0hfTUFOQUdFRF9DTFVTVEVSYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBPcGVuU2VhcmNoIE1hbmFnZWQgQ2x1c3Rlci5cbiAgICovXG4gIE9QRU5TRUFSQ0hfTUFOQUdFRF9DTFVTVEVSID0gJ09QRU5TRUFSQ0hfTUFOQUdFRF9DTFVTVEVSJyxcbiAgLyoqXG4gICAqIGBQSU5FQ09ORWAgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgUGluZWNvbmUuXG4gICAqL1xuICBQSU5FQ09ORSA9ICdQSU5FQ09ORScsXG4gIC8qKlxuICAgKiBgUkRTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBBbWF6b24gQXVyb3JhLlxuICAgKi9cbiAgQU1BWk9OX0FVUk9SQSA9ICdSRFMnLFxuICAvKipcbiAgICogYE1PTkdPX0RCX0FUTEFTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBNb25nb0RCIEF0bGFzLlxuICAgKi9cbiAgTU9OR09fREJfQVRMQVMgPSAnTU9OR09fREJfQVRMQVMnLFxuICAvKipcbiAgICogYE5FUFRVTkVfQU5BTFlUSUNTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBBbWF6b24gTmVwdHVuZSBBbmFseXRpY3MuXG4gICAqL1xuICBORVBUVU5FX0FOQUxZVElDUyA9ICdORVBUVU5FX0FOQUxZVElDUycsXG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT01NT04gSU5URVJGQUNFU1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBzdG9yYWdlIGZvciBrbm93bGVkZ2UgYmFzZS5cbiAqL1xuaW50ZXJmYWNlIFN0b3JhZ2VDb25maWd1cmF0aW9uIHtcbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3Igc3RvcmUsIHdoaWNoIGNhbiBiZSBvZiBgVmVjdG9yQ29sbGVjdGlvbmAsIGBQaW5lY29uZVZlY3RvclN0b3JlYCxcbiAgICogYEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlYCwgb3IgYE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlYCB0eXBlcy5cbiAgICovXG4gIHZlY3RvclN0b3JlOlxuICAgIHwgVmVjdG9yQ29sbGVjdGlvblxuICAgIHwgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgIHwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICB8IE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlXG4gICAgfCBPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZTtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIHZlY3RvciBzdG9yZS5cbiAgICovXG4gIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgaW5kZXguXG4gICAqL1xuICBpbmRleE5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSB2ZWN0b3IgZmllbGQgZm9yIHZlY3RvciBtYXBwaW5nLlxuICAgKi9cbiAgdmVjdG9yRmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSB0ZXh0IGZpZWxkIGZvciB2ZWN0b3IgbWFwcGluZy5cbiAgICovXG4gIHRleHRGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIG1ldGFkYXRhLlxuICAgKi9cbiAgbWV0YWRhdGFGaWVsZDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBLbm93bGVkZ2UgQmFzZSwgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVZlY3Rvcktub3dsZWRnZUJhc2UgZXh0ZW5kcyBJS25vd2xlZGdlQmFzZSB7XG4gIC8qKlxuICAgKiBUaGUgc3RvcmFnZSB0eXBlIGZvciB0aGUgVmVjdG9yIEVtYmVkZGluZ3MuXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcblxuICAvKipcbiAgICogQWRkIGFuIFMzIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFMzRGF0YVNvdXJjZShwcm9wczogUzNEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFMzRGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogQWRkIGEgd2ViIGNyYXdsZXIgZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgYWRkV2ViQ3Jhd2xlckRhdGFTb3VyY2UocHJvcHM6IFdlYkNyYXdsZXJEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFdlYkNyYXdsZXJEYXRhU291cmNlO1xuXG4gIC8qKlxuICAgKiBBZGQgYSBTaGFyZVBvaW50IGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFNoYXJlUG9pbnREYXRhU291cmNlKHByb3BzOiBTaGFyZVBvaW50RGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTaGFyZVBvaW50RGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogQWRkIGEgQ29uZmx1ZW5jZSBkYXRhIHNvdXJjZSB0byB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBhZGRDb25mbHVlbmNlRGF0YVNvdXJjZShwcm9wczogQ29uZmx1ZW5jZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzKTogQ29uZmx1ZW5jZURhdGFTb3VyY2U7XG5cbiAgLyoqXG4gICAqIEFkZCBhIFNhbGVzZm9yY2UgZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgYWRkU2FsZXNmb3JjZURhdGFTb3VyY2UocHJvcHM6IFNhbGVzZm9yY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFNhbGVzZm9yY2VEYXRhU291cmNlO1xuXG4gIC8qKlxuICAgKiBBZGQgYSBDdXN0b20gZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgYWRkQ3VzdG9tRGF0YVNvdXJjZShwcm9wczogQ3VzdG9tRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBDdXN0b21EYXRhU291cmNlO1xuXG4gIC8qKlxuICAgKiBHcmFudCB0aGUgZ2l2ZW4gaWRlbnRpdHkgcGVybWlzc2lvbnMgdG8gcmV0cmlldmUgY29udGVudCBmcm9tIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGdyYW50UmV0cmlldmUoZ3JhbnRlZTogaWFtLklHcmFudGFibGUpOiBpYW0uR3JhbnQ7XG5cbiAgLyoqXG4gICAqIEdyYW50IHRoZSBnaXZlbiBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byByZXRyaWV2ZSBjb250ZW50IGZyb20gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgZ3JhbnRSZXRyaWV2ZUFuZEdlbmVyYXRlKGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlKTogaWFtLkdyYW50O1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFCU1RSQUNUIENMQVNTXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIFZlY3RvciBLbm93bGVkZ2UgQmFzZS5cbiAqIENvbnRhaW5zIG1ldGhvZHMgdmFsaWQgZm9yIEtCcyBlaXRoZXIgY3JlYXRlZCB3aXRoIENESyBvciBpbXBvcnRlZC5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFZlY3Rvcktub3dsZWRnZUJhc2VCYXNlXG4gIGV4dGVuZHMgS25vd2xlZGdlQmFzZUJhc2VcbiAgaW1wbGVtZW50cyBJVmVjdG9yS25vd2xlZGdlQmFzZSB7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBrbm93bGVkZ2VCYXNlQXJuOiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBrbm93bGVkZ2VCYXNlSWQ6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcblxuICBwdWJsaWMgcmVhZG9ubHkgdHlwZTogS25vd2xlZGdlQmFzZVR5cGUgPSBLbm93bGVkZ2VCYXNlVHlwZS5WRUNUT1I7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSGVscGVyIG1ldGhvZHMgdG8gYWRkIERhdGEgU291cmNlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIEFkZHMgYW4gUzMgZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIGFkZFMzRGF0YVNvdXJjZShwcm9wczogUzNEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFMzRGF0YVNvdXJjZSB7XG4gICAgLy8gVmFsaWRhdGUgY29udGV4dCBlbnJpY2htZW50IGlzIG9ubHkgdXNlZCB3aXRoIE5lcHR1bmUgQW5hbHl0aWNzXG4gICAgY29uc3QgaXNOZXB0dW5lS0IgPSB0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLk5FUFRVTkVfQU5BTFlUSUNTO1xuICAgIGlmIChwcm9wcy5jb250ZXh0RW5yaWNobWVudCAmJiAhaXNOZXB0dW5lS0IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ29udGV4dCBlbnJpY2htZW50IGlzIG9ubHkgc3VwcG9ydGVkIGZvciBOZXB0dW5lL0dyYXBoUkFHIEtub3dsZWRnZUJhc2VzJyk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGNvbnRleHQgZW5yaWNobWVudCAtIHVzZSBwcm92aWRlZCB2YWx1ZSBvciBkZWZhdWx0IGZvciBOZXB0dW5lXG4gICAgbGV0IGNvbnRleHRFbnJpY2htZW50ID0gcHJvcHMuY29udGV4dEVucmljaG1lbnQ7XG4gICAgaWYgKGlzTmVwdHVuZUtCKSB7XG4gICAgICBjb250ZXh0RW5yaWNobWVudCA9XG4gICAgICAgIHByb3BzLmNvbnRleHRFbnJpY2htZW50ID8/XG4gICAgICAgIENvbnRleHRFbnJpY2htZW50LmZvdW5kYXRpb25Nb2RlbCh7XG4gICAgICAgICAgZW5yaWNobWVudE1vZGVsOiBCZWRyb2NrRm91bmRhdGlvbk1vZGVsLkFOVEhST1BJQ19DTEFVREVfSEFJS1VfVjFfMCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFuZCByZXR1cm4gdGhlIFMzIGRhdGEgc291cmNlXG4gICAgcmV0dXJuIG5ldyBTM0RhdGFTb3VyY2UodGhpcywgYHMzLSR7cHJvcHMuYnVja2V0Lm5vZGUuYWRkcn1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLFxuICAgICAgLi4ucHJvcHMsXG4gICAgICBjb250ZXh0RW5yaWNobWVudDogY29udGV4dEVucmljaG1lbnQsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYWRkV2ViQ3Jhd2xlckRhdGFTb3VyY2UoXG4gICAgcHJvcHM6IFdlYkNyYXdsZXJEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbiAgKTogV2ViQ3Jhd2xlckRhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvcHMuc291cmNlVXJsc1swXSk7XG4gICAgcmV0dXJuIG5ldyBXZWJDcmF3bGVyRGF0YVNvdXJjZSh0aGlzLCBgd2ViLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkU2hhcmVQb2ludERhdGFTb3VyY2UoXG4gICAgcHJvcHM6IFNoYXJlUG9pbnREYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbiAgKTogU2hhcmVQb2ludERhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvcHMuc2l0ZVVybHNbMF0pO1xuICAgIHJldHVybiBuZXcgU2hhcmVQb2ludERhdGFTb3VyY2UodGhpcywgYHNwLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkQ29uZmx1ZW5jZURhdGFTb3VyY2UoXG4gICAgcHJvcHM6IENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbiAgKTogQ29uZmx1ZW5jZURhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvcHMuY29uZmx1ZW5jZVVybCk7XG4gICAgcmV0dXJuIG5ldyBDb25mbHVlbmNlRGF0YVNvdXJjZSh0aGlzLCBgY2YtJHt1cmwuaG9zdG5hbWUucmVwbGFjZSgnLicsICctJyl9YCwge1xuICAgICAga25vd2xlZGdlQmFzZTogdGhpcyxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBhZGRTYWxlc2ZvcmNlRGF0YVNvdXJjZShcbiAgICBwcm9wczogU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLFxuICApOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChwcm9wcy5lbmRwb2ludCk7XG4gICAgcmV0dXJuIG5ldyBTYWxlc2ZvcmNlRGF0YVNvdXJjZSh0aGlzLCBgc2YtJHt1cmwuaG9zdG5hbWUucmVwbGFjZSgnLicsICctJyl9YCwge1xuICAgICAga25vd2xlZGdlQmFzZTogdGhpcyxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBhZGRDdXN0b21EYXRhU291cmNlKHByb3BzOiBDdXN0b21EYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IEN1c3RvbURhdGFTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgQ3VzdG9tRGF0YVNvdXJjZSh0aGlzLCBgY3VzdG9tLSR7cHJvcHMuZGF0YVNvdXJjZU5hbWV9YCwge1xuICAgICAga25vd2xlZGdlQmFzZTogdGhpcyxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgUFJPUFMgRk9SIE5FVyBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBrbm93bGVkZ2UgYmFzZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZlY3Rvcktub3dsZWRnZUJhc2VQcm9wcyBleHRlbmRzIENvbW1vbktub3dsZWRnZUJhc2VQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBmb3IgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAqL1xuICByZWFkb25seSBlbWJlZGRpbmdzTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWw7XG5cbiAgLyoqXG4gICAqIFRoZSBzdXBwbGVtZW50YWwgZGF0YSBzdG9yYWdlIGxvY2F0aW9ucyBmb3IgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAqL1xuICByZWFkb25seSBzdXBwbGVtZW50YWxEYXRhU3RvcmFnZUxvY2F0aW9ucz86IFN1cHBsZW1lbnRhbERhdGFTdG9yYWdlTG9jYXRpb25bXTtcblxuICAvKipcbiAgICogVGhlIHZlY3RvciB0eXBlIHRvIHN0b3JlIHZlY3RvciBlbWJlZGRpbmdzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFZlY3RvclR5cGUuRkxPQVRJTkdfUE9JTlRcbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvclR5cGU/OiBWZWN0b3JUeXBlO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdmVjdG9yIGluZGV4LlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsXG4gICAqIGRvIG5vdCBpbmNsdWRlIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4J1xuICAgKi9cbiAgcmVhZG9ubHkgaW5kZXhOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gdGhlIHZlY3RvciBpbmRleC5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBkbyBub3QgaW5jbHVkZSB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLiBNdXN0IGJlIGVpdGhlciBvZlxuICAgKiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCwgYFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlYCxcbiAgICogYFBpbmVjb25lVmVjdG9yU3RvcmVgLCBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgLCBvciBgTW9uZ29EQkF0bGFzVmVjdG9yU3RvcmVgLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IE9wZW5TZWFyY2ggU2VydmVybGVzcyB2ZWN0b3IgY29sbGVjdGlvbiBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yU3RvcmU/OlxuICAgIHwgVmVjdG9yQ29sbGVjdGlvblxuICAgIHwgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgIHwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICB8IE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlXG4gICAgfCBPcGVuU2VhcmNoTWFuYWdlZENsdXN0ZXJWZWN0b3JTdG9yZTtcbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3IgaW5kZXggZm9yIHRoZSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgYmFja2VkIGtub3dsZWRnZSBiYXNlLlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsIGRvIG5vdCBpbmNsdWRlXG4gICAqIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5ldyB2ZWN0b3IgaW5kZXggaXMgY3JlYXRlZCBvbiB0aGUgVmVjdG9yIENvbGxlY3Rpb25cbiAgICogaWYgdmVjdG9yIHN0b3JlIGlzIG9mIGBWZWN0b3JDb2xsZWN0aW9uYCB0eXBlLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgQVRUUlMgRk9SIElNUE9SVEVEIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBpbXBvcnRpbmcgYSBrbm93bGVkZ2UgYmFzZSBvdXRzaWRlIG9mIHRoaXMgc3RhY2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWZWN0b3JLbm93bGVkZ2VCYXNlQXR0cmlidXRlcyBleHRlbmRzIENvbW1vbktub3dsZWRnZUJhc2VBdHRyaWJ1dGVzIHtcbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3Igc3RvcmUgdHlwZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG59XG5cbi8qKlxuICogRGVwbG95cyBhIEJlZHJvY2sgS25vd2xlZGdlIEJhc2UgYW5kIGNvbmZpZ3VyZXMgYSBiYWNrZW5kIGJ5IE9wZW5TZWFyY2ggU2VydmVybGVzcyxcbiAqIFBpbmVjb25lLCBSZWRpcyBFbnRlcnByaXNlIENsb3VkIG9yIEFtYXpvbiBBdXJvcmEgUG9zdGdyZVNRTC5cbiAqXG4gKi9cbmV4cG9ydCBjbGFzcyBWZWN0b3JLbm93bGVkZ2VCYXNlIGV4dGVuZHMgVmVjdG9yS25vd2xlZGdlQmFzZUJhc2Uge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW1wb3J0IE1ldGhvZHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUtub3dsZWRnZUJhc2VBdHRyaWJ1dGVzKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBhdHRyczogVmVjdG9yS25vd2xlZGdlQmFzZUF0dHJpYnV0ZXMsXG4gICk6IElWZWN0b3JLbm93bGVkZ2VCYXNlIHtcbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHNjb3BlKTtcblxuICAgIGNsYXNzIEltcG9ydCBleHRlbmRzIFZlY3Rvcktub3dsZWRnZUJhc2VCYXNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSByb2xlID0gaWFtLlJvbGUuZnJvbVJvbGVBcm4oXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGBrYi0ke2F0dHJzLmtub3dsZWRnZUJhc2VJZH0tcm9sZWAsXG4gICAgICAgIGF0dHJzLmV4ZWN1dGlvblJvbGVBcm4sXG4gICAgICApO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uID0gYXR0cnMuZGVzY3JpcHRpb247XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgaW5zdHJ1Y3Rpb24gPSBhdHRycy5pbnN0cnVjdGlvbjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlSWQgPSBhdHRycy5rbm93bGVkZ2VCYXNlSWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmVUeXBlID0gYXR0cnMudmVjdG9yU3RvcmVUeXBlO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VBcm4gPSBzdGFjay5mb3JtYXRBcm4oe1xuICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICByZXNvdXJjZU5hbWU6IGF0dHJzLmtub3dsZWRnZUJhc2VJZCxcbiAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEltcG9ydChzY29wZSwgaWQpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBBdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2Yga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUluc3RhbmNlOiBiZWRyb2NrLkNmbktub3dsZWRnZUJhc2U7XG5cbiAgLyoqXG4gICAqIFRoZSByb2xlIHRoZSBLbm93bGVkZ2UgQmFzZSB1c2VzIHRvIGFjY2VzcyB0aGUgdmVjdG9yIHN0b3JlIGFuZCBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3Igc3RvcmUgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB2ZWN0b3JTdG9yZTpcbiAgICB8IFZlY3RvckNvbGxlY3Rpb25cbiAgICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICB8IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgfCBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZVxuICAgIHwgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIEEgZGVzY3JpcHRpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluc3RydWN0aW9ucyBmb3IgYWdlbnRzIGJhc2VkIG9uIHRoZSBkZXNpZ24gYW5kIHR5cGUgb2YgaW5mb3JtYXRpb24gb2YgdGhlXG4gICAqIEtub3dsZWRnZSBCYXNlLiBUaGlzIHdpbGwgaW1wYWN0IGhvdyBBZ2VudHMgaW50ZXJhY3Qgd2l0aCB0aGUgS25vd2xlZGdlIEJhc2UuXG4gICAqL1xuICByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG5cbiAgLyoqXG4gICAqIFRoZSBPcGVuU2VhcmNoIHZlY3RvciBpbmRleCBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSB2ZWN0b3JJbmRleD86IFZlY3RvckluZGV4O1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gU2V0IHByb3BlcnRpZXMgb3IgZGVmYXVsdHNcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb25zdCBlbWJlZGRpbmdzTW9kZWwgPSBwcm9wcy5lbWJlZGRpbmdzTW9kZWw7XG4gICAgY29uc3QgdmVjdG9yVHlwZSA9IHByb3BzLnZlY3RvclR5cGUgPz8gVmVjdG9yVHlwZS5GTE9BVElOR19QT0lOVDtcbiAgICBjb25zdCBpbmRleE5hbWUgPSBwcm9wcy5pbmRleE5hbWUgPz8gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleCc7XG4gICAgY29uc3QgdmVjdG9yRmllbGQgPSBwcm9wcy52ZWN0b3JGaWVsZCA/PyAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3Rvcic7XG4gICAgY29uc3QgdGV4dEZpZWxkID0gJ0FNQVpPTl9CRURST0NLX1RFWFRfQ0hVTksnO1xuICAgIGNvbnN0IG1ldGFkYXRhRmllbGQgPSAnQU1BWk9OX0JFRFJPQ0tfTUVUQURBVEEnO1xuXG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHByb3BzLmRlc2NyaXB0aW9uID8/ICdDREsgZGVwbG95ZWQgS25vd2xlZGdlIGJhc2UnOyAvLyBldmVuIHRob3VnaCB0aGlzIHByb3AgaXMgb3B0aW9uYWwsIGlmIG5vIHZhbHVlIGlzIHByb3ZpZGVkIGl0IHdpbGwgZmFpbCB0byBkZXBsb3lcbiAgICAvL3RoaXMua25vd2xlZGdlQmFzZVN0YXRlID0gcHJvcHMua25vd2xlZGdlQmFzZVN0YXRlID8/ICdFTkFCTEVEJztcbiAgICB0aGlzLmluc3RydWN0aW9uID0gcHJvcHMuaW5zdHJ1Y3Rpb247XG4gICAgdGhpcy5uYW1lID0gcHJvcHMubmFtZSA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdLQicsIHsgbWF4TGVuZ3RoOiAzMiB9KTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFZhbGlkYXRpb25zXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YWxpZGF0ZU1vZGVsKGVtYmVkZGluZ3NNb2RlbCwgdmVjdG9yVHlwZSk7XG4gICAgdmFsaWRhdGVWZWN0b3JJbmRleChwcm9wcy52ZWN0b3JTdG9yZSwgcHJvcHMudmVjdG9ySW5kZXgsIHByb3BzLnZlY3RvckZpZWxkLCBwcm9wcy5pbmRleE5hbWUpO1xuICAgIGlmIChwcm9wcy52ZWN0b3JJbmRleCkge1xuICAgICAgdmFsaWRhdGVJbmRleFBhcmFtZXRlcnMocHJvcHMudmVjdG9ySW5kZXgsIGluZGV4TmFtZSwgdmVjdG9yRmllbGQpO1xuICAgIH1cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFJvbGVcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBVc2UgZXhpc3Rpbmcgcm9sZSBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIGNyZWF0ZSBhIG5ldyBvbmVcbiAgICB0aGlzLnJvbGUgPSBwcm9wcy5leGlzdGluZ1JvbGUgPz8gY3JlYXRlS25vd2xlZGdlQmFzZVNlcnZpY2VSb2xlKHRoaXMpO1xuXG4gICAgaWYgKCFwcm9wcy5leGlzdGluZ1JvbGUpIHtcbiAgICAgIGVtYmVkZGluZ3NNb2RlbC5ncmFudEludm9rZSh0aGlzLnJvbGUpO1xuXG4gICAgICAvLyBBZGQgQ0RLIE5hZyBzdXBwcmVzc2lvbiBmb3IgYmVkcm9jazpJbnZva2VNb2RlbCogd2lsZGNhcmQgcGVybWlzc2lvblxuICAgICAgTmFnU3VwcHJlc3Npb25zLmFkZFJlc291cmNlU3VwcHJlc3Npb25zKFxuICAgICAgICB0aGlzLnJvbGUsXG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ0F3c1NvbHV0aW9ucy1JQU01JyxcbiAgICAgICAgICAgIHJlYXNvbjogJ0JlZHJvY2sgS25vd2xlZGdlIEJhc2UgcmVxdWlyZXMgd2lsZGNhcmQgcGVybWlzc2lvbnMgdG8gaW52b2tlIGVtYmVkZGluZyBtb2RlbHMnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHRydWUsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFZlY3RvciBTdG9yZVxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgdmVjdG9yIHN0b3JlIGlmIHRoZSB2ZWN0b3Igc3RvcmUgd2FzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLlxuICAgICAqIE90aGVyd2lzZSBjaGVjayBhZ2FpbnRzIGFsbCBwb3NzaWJsZSB2ZWN0b3IgZGF0YXN0b3Jlcy5cbiAgICAgKiBJZiBub25lIHdhcyBwcm92aWRlZCBjcmVhdGUgZGVmYXVsdCBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgQ29sbGVjdGlvbi5cbiAgICAgKi9cbiAgICBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLnZlY3RvclN0b3JlVHlwZSA9IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1M7XG4gICAgICAoeyB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSB9ID1cbiAgICAgICAgdGhpcy5oYW5kbGVPcGVuU2VhcmNoQ29sbGVjdGlvbihwcm9wcykpO1xuICAgIH0gZWxzZSBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBQaW5lY29uZVZlY3RvclN0b3JlKSB7XG4gICAgICB0aGlzLnZlY3RvclN0b3JlVHlwZSA9IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORTtcbiAgICAgICh7IHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLCB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlIH0gPVxuICAgICAgICB0aGlzLmhhbmRsZVBpbmVjb25lVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgKSB7XG4gICAgICB0aGlzLnZlY3RvclN0b3JlVHlwZSA9IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBO1xuICAgICAgKHsgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUgfSA9XG4gICAgICAgIHRoaXMuaGFuZGxlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgTW9uZ29EQkF0bGFzVmVjdG9yU3RvcmUpIHtcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID0gVmVjdG9yU3RvcmVUeXBlLk1PTkdPX0RCX0FUTEFTO1xuICAgICAgKHsgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUgfSA9XG4gICAgICAgIHRoaXMuaGFuZGxlTW9uZ29EQkF0bGFzVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmUpIHtcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID0gVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfTUFOQUdFRF9DTFVTVEVSO1xuICAgICAgKHsgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUgfSA9XG4gICAgICAgIHRoaXMuaGFuZGxlT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTO1xuICAgICAgKHsgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUgfSA9XG4gICAgICAgIHRoaXMuaGFuZGxlT3BlblNlYXJjaERlZmF1bHRWZWN0b3JDb2xsZWN0aW9uKCkpO1xuICAgIH1cblxuICAgIC8vIHBlcmZvcm0gdGhpcyB2YWxpZGF0aW9uIGFmdGVyIHRoZSB2ZWN0b3Igc3RvcmUgaXMgaGFuZGxlZCBzaW5jZSBpZiB0aGUgdXNlclxuICAgIC8vIGRvZXNuJ3QgcHJvdmlkZSBvbmUsIHRoZSBtZXRob2QgYWJvdmUgd2lsbCBjcmVhdGUgaXRcbiAgICB2YWxpZGF0ZVZlY3RvclR5cGUodGhpcy52ZWN0b3JTdG9yZSwgdmVjdG9yVHlwZSk7XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGFkZCBgc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWVgIHRvIHRoZSByb2xlXG4gICAgICogb2YgdGhlIGtub3dsZWRnZSBiYXNlIGlmIHdlIHVzZSB2ZWN0b3Igc3RvcmVzXG4gICAgICogb3RoZXIgdGhhbiBPcGVuU2VhcmNoIFNlcnZlcmxlc3MuXG4gICAgICovXG4gICAgaWYgKCEodGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pICYmICEodGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlKSkge1xuICAgICAgdGhpcy5yb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZSddLFxuICAgICAgICAgIHJlc291cmNlczogW3RoaXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm5dLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2UgbmVlZCB0byBhZGQgYHJkcy1kYXRhOkV4ZWN1dGVTdGF0ZW1lbnRgLFxuICAgICAqIGByZHMtZGF0YTpCYXRjaEV4ZWN1dGVTdGF0ZW1lbnRgIGFuZFxuICAgICAqIGByZHM6RGVzY3JpYmVEQkNsdXN0ZXJzYCB0byB0aGUgcm9sZVxuICAgICAqIG9mIHRoZSBrbm93bGVkZ2UgYmFzZSBpZiB3ZSB1c2UgQW1hem9uIEF1cm9yYSBhc1xuICAgICAqIGEgZGF0YSBzb3VyY2UuXG4gICAgICovXG4gICAgaWYgKFxuICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHx8XG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICkge1xuICAgICAgdGhpcy5yb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ3Jkcy1kYXRhOkV4ZWN1dGVTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgJ3Jkcy1kYXRhOkJhdGNoRXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgICAncmRzOkRlc2NyaWJlREJDbHVzdGVycycsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnZlY3RvclN0b3JlLnJlc291cmNlQXJuXSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgdmVjdG9yIGluZGV4IGlmIHRoZSB2ZWN0b3Igc3RvcmUgaXMgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzXG4gICAgICogYW5kIGl0IHdhcyBub3QgcHJvdmlkZWQuIE90aGVyd2lzZSB1c2UgdGhlIHByb3ZpZGVkIHZlY3RvciBpbmRleC5cbiAgICAgKi9cbiAgICBpZiAodGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MpIHtcbiAgICAgIGlmICghcHJvcHMudmVjdG9ySW5kZXgpIHtcbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleCA9IG5ldyBWZWN0b3JJbmRleCh0aGlzLCAnS0JJbmRleCcsIHtcbiAgICAgICAgICBjb2xsZWN0aW9uOiB0aGlzLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb24sXG4gICAgICAgICAgaW5kZXhOYW1lLFxuICAgICAgICAgIHZlY3RvckZpZWxkLFxuICAgICAgICAgIHZlY3RvckRpbWVuc2lvbnM6IGVtYmVkZGluZ3NNb2RlbC52ZWN0b3JEaW1lbnNpb25zISxcbiAgICAgICAgICBwcmVjaXNpb246IHByb3BzLnZlY3RvclR5cGUgPT09IFZlY3RvclR5cGUuQklOQVJZID8gJ0JpbmFyeScgOiAnZmxvYXQnLFxuICAgICAgICAgIGRpc3RhbmNlVHlwZTogcHJvcHMudmVjdG9yVHlwZSA9PT0gVmVjdG9yVHlwZS5CSU5BUlkgPyAnaGFtbWluZycgOiAnbDInLFxuICAgICAgICAgIG1hcHBpbmdzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1hcHBpbmdGaWVsZDogJ0FNQVpPTl9CRURST0NLX1RFWFRfQ0hVTksnLFxuICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICBmaWx0ZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWFwcGluZ0ZpZWxkOiAnQU1BWk9OX0JFRFJPQ0tfTUVUQURBVEEnLFxuICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICBmaWx0ZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleC5ub2RlLmFkZERlcGVuZGVuY3kodGhpcy52ZWN0b3JTdG9yZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnZlY3RvckluZGV4ID0gcHJvcHMudmVjdG9ySW5kZXg7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHN0b3JhZ2UgY29uZmlndXJhaW9uLiBJZiBpdCBpcyBvZiB0eXBlIG9mXG4gICAgICogYEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlYCBvciBgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAsXG4gICAgICogdGhlbiBnZXQgdGV4dEZpZWxkLCBtZXRhZGF0YUZpZWxkIGFuZCB2ZWN0b3JGaWVsZCBmcm9tXG4gICAgICogdGhlIGFyZ3VtZW50cy4gT3RoZXJ3aXNlIHVzZSBkZWZhdWx0IHZhbHVlcy5cbiAgICAgKi9cbiAgICBjb25zdCBzdG9yYWdlQ29uZmlndXJhdGlvbjogU3RvcmFnZUNvbmZpZ3VyYXRpb24gPSB7XG4gICAgICBpbmRleE5hbWU6IGluZGV4TmFtZSxcbiAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIHZlY3RvckZpZWxkOlxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IHRoaXMudmVjdG9yU3RvcmUudmVjdG9yRmllbGRcbiAgICAgICAgICA6IHZlY3RvckZpZWxkLFxuICAgICAgdGV4dEZpZWxkOlxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IHRoaXMudmVjdG9yU3RvcmUudGV4dEZpZWxkXG4gICAgICAgICAgOiB0ZXh0RmllbGQsXG4gICAgICBtZXRhZGF0YUZpZWxkOlxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IHRoaXMudmVjdG9yU3RvcmUubWV0YWRhdGFGaWVsZFxuICAgICAgICAgIDogbWV0YWRhdGFGaWVsZCxcbiAgICB9O1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTDEgSW5zdGFudGlhdGlvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgYmVkcm9jay5DZm5Lbm93bGVkZ2VCYXNlKHRoaXMsICdNeUNmbktub3dsZWRnZUJhc2UnLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICB0eXBlOiBLbm93bGVkZ2VCYXNlVHlwZS5WRUNUT1IsXG4gICAgICAgIHZlY3Rvcktub3dsZWRnZUJhc2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgZW1iZWRkaW5nTW9kZWxBcm46IGVtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKSxcbiAgICAgICAgICAvLyBVc2VkIHRoaXMgYXBwcm9hY2ggYXMgaWYgcHJvcGVydHkgaXMgc3BlY2lmaWVkIG9uIG1vZGVscyB0aGF0IGRvIG5vdFxuICAgICAgICAgIC8vIHN1cHBvcnQgY29uZmlndXJhYmxlIGRpbWVuc2lvbnMgQ2xvdWRGb3JtYXRpb24gdGhyb3dzIGFuIGVycm9yIGF0IHJ1bnRpbWVcbiAgICAgICAgICBlbWJlZGRpbmdNb2RlbENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgIGJlZHJvY2tFbWJlZGRpbmdNb2RlbENvbmZpZ3VyYXRpb246XG4gICAgICAgICAgICAgIGVtYmVkZGluZ3NNb2RlbC5tb2RlbElkID09PSAnYW1hem9uLnRpdGFuLWVtYmVkLXRleHQtdjI6MCdcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbnM6IGVtYmVkZGluZ3NNb2RlbC52ZWN0b3JEaW1lbnNpb25zLFxuICAgICAgICAgICAgICAgICAgZW1iZWRkaW5nRGF0YVR5cGU6IHZlY3RvclR5cGUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDogeyBlbWJlZGRpbmdEYXRhVHlwZTogdmVjdG9yVHlwZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLi4uKHByb3BzLnN1cHBsZW1lbnRhbERhdGFTdG9yYWdlTG9jYXRpb25zICYmIHByb3BzLnN1cHBsZW1lbnRhbERhdGFTdG9yYWdlTG9jYXRpb25zLmxlbmd0aCA+IDBcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBzdXBwbGVtZW50YWxEYXRhU3RvcmFnZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgICAgICBzdXBwbGVtZW50YWxEYXRhU3RvcmFnZUxvY2F0aW9uczogcHJvcHMuc3VwcGxlbWVudGFsRGF0YVN0b3JhZ2VMb2NhdGlvbnMubWFwKGxvY2F0aW9uID0+IGxvY2F0aW9uLl9fcmVuZGVyKCkpLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgcm9sZUFybjogdGhpcy5yb2xlLnJvbGVBcm4sXG4gICAgICBzdG9yYWdlQ29uZmlndXJhdGlvbjogZ2V0U3RvcmFnZUNvbmZpZ3VyYXRpb24oc3RvcmFnZUNvbmZpZ3VyYXRpb24pLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgIH0pO1xuXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlSW5zdGFuY2UgPSBrbm93bGVkZ2VCYXNlO1xuXG4gICAgY29uc3Qga2JDUlBvbGljeSA9IG5ldyBpYW0uUG9saWN5KHRoaXMsICdLQkNSUG9saWN5Jywge1xuICAgICAgLy8gcm9sZXM6IFtjclByb3ZpZGVyLnJvbGVdLFxuICAgICAgcm9sZXM6IFt0aGlzLnJvbGVdLFxuICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2JlZHJvY2s6Q3JlYXRlS25vd2xlZGdlQmFzZScsXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFdlIG5lZWQgdG8gYWRkIGBiZWRyb2NrOkFzc29jaWF0ZVRoaXJkUGFydHlLbm93bGVkZ2VCYXNlYCBpZlxuICAgICAgICAgICAgICogd2UgYXJlIGRlcGxveWluZyBSZWRpcyBvciBQaW5lY29uZSBkYXRhIHNvdXJjZXNcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgLy8uLi4odGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5SRURJU19FTlRFUlBSSVNFX0NMT1VEIHx8XG4gICAgICAgICAgICAuLi4odGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORVxuICAgICAgICAgICAgICA/IFsnYmVkcm9jazpBc3NvY2lhdGVUaGlyZFBhcnR5S25vd2xlZGdlQmFzZSddXG4gICAgICAgICAgICAgIDogW10pLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpVcGRhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgICdiZWRyb2NrOkRlbGV0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6VGFnUmVzb3VyY2UnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydpYW06UGFzc1JvbGUnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnJvbGUucm9sZUFybl0sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMucm9sZSk7XG4gICAga25vd2xlZGdlQmFzZS5ub2RlLmFkZERlcGVuZGVuY3koa2JDUlBvbGljeSk7XG4gICAgaWYgKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTICYmIHRoaXMudmVjdG9ySW5kZXgpIHtcbiAgICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMudmVjdG9ySW5kZXgpO1xuICAgIH1cbiAgICBpZiAodGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICB9XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBrYkNSUG9saWN5LFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOiBcIkJlZHJvY2sgQ3JlYXRlS25vd2xlZGdlQmFzZSBjYW4ndCBiZSByZXN0cmljdGVkIGJ5IHJlc291cmNlLlwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHRydWUsXG4gICAgKTtcblxuICAgIHRoaXMua25vd2xlZGdlQmFzZUFybiA9IGtub3dsZWRnZUJhc2UuYXR0cktub3dsZWRnZUJhc2VBcm47XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlSWQgPSBrbm93bGVkZ2VCYXNlLmF0dHJLbm93bGVkZ2VCYXNlSWQ7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIFZlY3RvckNvbGxlY3Rpb24gdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBWZWN0b3JDb2xsZWN0aW9uLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVPcGVuU2VhcmNoQ29sbGVjdGlvbihwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmUuZ3JhbnREYXRhQWNjZXNzKHRoaXMucm9sZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBQaW5lY29uZVZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgUGluZWNvbmVWZWN0b3JTdG9yZSwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlUGluZWNvbmVWZWN0b3JTdG9yZShwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIFBpbmVjb25lVmVjdG9yU3RvcmU7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKHByb3BzOiBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMpOiB7XG4gICAgdmVjdG9yU3RvcmU6IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHwgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPVxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgICAgID8gcHJvcHMudmVjdG9yU3RvcmVcbiAgICAgICAgOiAocHJvcHMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlKHByb3BzOiBWZWN0b3JLbm93bGVkZ2VCYXNlUHJvcHMpOiB7XG4gICAgdmVjdG9yU3RvcmU6IE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IHByb3BzLnZlY3RvclN0b3JlIGFzIE9wZW5TZWFyY2hNYW5hZ2VkQ2x1c3RlclZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX01BTkFHRURfQ0xVU1RFUixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIE1vbmdvREJBdGxhc1ZlY3RvclN0b3JlLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVNb25nb0RCQXRsYXNWZWN0b3JTdG9yZShwcm9wczogVmVjdG9yS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuTU9OR09fREJfQVRMQVMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGRlZmF1bHQgVmVjdG9yU3RvcmUgdHlwZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFZlY3RvckNvbGxlY3Rpb24sIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpOiB7XG4gICAgdmVjdG9yU3RvcmU6IFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gbmV3IFZlY3RvckNvbGxlY3Rpb24odGhpcywgJ0tCVmVjdG9ycycpO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3NvY2lhdGUga25vd2xlZGdlIGJhc2Ugd2l0aCBhbiBhZ2VudFxuICAgKi9cbiAgcHVibGljIGFzc29jaWF0ZVRvQWdlbnQoYWdlbnQ6IEFnZW50KSB7XG4gICAgYWdlbnQuYWRkS25vd2xlZGdlQmFzZSh0aGlzKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBjYW4gdXNlIHRoZSBzZWxlY3RlZCBtb2RlbC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVNb2RlbChmb3VuZGF0aW9uTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwsIHZlY3RvclR5cGU6IFZlY3RvclR5cGUpIHtcbiAgaWYgKCFmb3VuZGF0aW9uTW9kZWwuc3VwcG9ydHNLbm93bGVkZ2VCYXNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbW9kZWwgJHtmb3VuZGF0aW9uTW9kZWx9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgQmVkcm9jayBLbm93bGVkZ2UgQmFzZS5gKTtcbiAgfVxuICBpZiAoXG4gICAgZm91bmRhdGlvbk1vZGVsLnN1cHBvcnRlZFZlY3RvclR5cGUgJiZcbiAgICAhZm91bmRhdGlvbk1vZGVsLnN1cHBvcnRlZFZlY3RvclR5cGUuaW5jbHVkZXModmVjdG9yVHlwZSlcbiAgKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFRoZSB2ZWN0b3IgdHlwZSAke3ZlY3RvclR5cGV9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIG1vZGVsICR7Zm91bmRhdGlvbk1vZGVsfS5gLFxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IHRoZSBzdG9yYWdlIGNvbmZpZ3VyYXRpb24gY2FuIHVzZSB0aGUgc2VsZWN0ZWQgdmVjdG9yIHR5cGUuXG4gKiBJdCBwcmV2ZW50cyB0aGUgdXNlIG9mIHZlY3RvciB0eXBlcyB3aXRoIHZlY3RvciBzdG9yZXMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGVtLFxuICogdGhlcmVieSBhdm9pZGluZyBwb3RlbnRpYWwgcnVudGltZSBlcnJvcnMuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlVmVjdG9yVHlwZSh2ZWN0b3JTdG9yZTogYW55LCB2ZWN0b3JUeXBlOiBWZWN0b3JUeXBlKSB7XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9yVHlwZSA9PSBWZWN0b3JUeXBlLkJJTkFSWSkge1xuICAgIGNvbnNvbGUubG9nKHZlY3RvclN0b3JlKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQW1hem9uIE9wZW5TZWFyY2ggU2VydmVybGVzcyBpcyBjdXJyZW50bHkgdGhlIG9ubHkgdmVjdG9yIHN0b3JlIHRoYXQgc3VwcG9ydHMgc3RvcmluZyBiaW5hcnkgdmVjdG9ycy4nLFxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBpZiBWZWN0b3JJbmRleCB3YXMgcHJvdmlkZWQgZm9yIGEgVmVjdG9yU3RvcmUgb2YgdHlwZVxuICogb3RoZXIgdGhhbiBgVmVjdG9yQ29sbGVjdGlvbmAuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlVmVjdG9ySW5kZXgodmVjdG9yU3RvcmU6IGFueSwgdmVjdG9ySW5kZXg6IGFueSwgdmVjdG9yRmllbGQ6IGFueSwgaW5kZXhOYW1lOiBhbnkpIHtcbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiB2ZWN0b3JJbmRleCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBWZWN0b3JDb2xsZWN0aW9uLCB2ZWN0b3JJbmRleCBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgaW5kZXhOYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIGluZGV4TmFtZSBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9yRmllbGQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgdmVjdG9yRmllbGQgc2hvdWxkIG5vdCBiZSBwcm92aWRlZCAnICtcbiAgICAgICAgJ2luIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgaW5kZXhOYW1lIGFuZCB2ZWN0b3JGaWVsZCBwYXJhbWV0ZXJzIGFyZSBpZGVudGljYWxcbiAqIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0IGlmIFZlY3RvckluZGV4IHdhcyBjcmVhdGVkIG1hbnVhbGx5LlxuICpcbiAqIEJ5IGRlZmF1bHQgd2UgYXNzaWduIGB2ZWN0b3JJbmRleGAgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGBcbiAqIHZhbHVlIGFuZCBpZiB1c2VyIHByb3ZpZGVzIGB2ZWN0b3JJbmRleGAgbWFudWFsbHksIHdlIG5lZWQgdG8gbWFrZSBzdXJlXG4gKiB0aGV5IGFsc28gcHJvdmlkZSBpdCBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdCBpZiB0aGUgdmFsdWUgaXMgbm90XG4gKiBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YC4gU2FtZSBmb3IgdmVjdG9yRmllbGQuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlSW5kZXhQYXJhbWV0ZXJzKHZlY3RvckluZGV4OiBWZWN0b3JJbmRleCwgaW5kZXhOYW1lOiBzdHJpbmcsIHZlY3RvckZpZWxkOiBzdHJpbmcpIHtcbiAgaWYgKHZlY3RvckluZGV4LmluZGV4TmFtZSAhPT0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleCcpIHtcbiAgICBpZiAodmVjdG9ySW5kZXguaW5kZXhOYW1lICE9PSBpbmRleE5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0RlZmF1bHQgdmFsdWUgb2YgaW5kZXhOYW1lIGlzIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgLicgK1xuICAgICAgICAgICcgSWYgeW91IGNyZWF0ZSBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgYXNzaWduIHZlY3RvckluZGV4IHRvIHZhbHVlIG90aGVyIHRoYW4nICtcbiAgICAgICAgICAnIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgIHRoZW4geW91IG11c3QgcHJvdmlkZSB0aGUgc2FtZSB2YWx1ZSBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nICtcbiAgICAgICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAnICtcbiAgICAgICAgICAnIHRoZW4gZG8gbm90IGFzc2lnbiBpbmRleE5hbWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGlmICh2ZWN0b3JJbmRleC52ZWN0b3JGaWVsZCAhPT0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InKSB7XG4gICAgaWYgKHZlY3RvckluZGV4LnZlY3RvckZpZWxkICE9PSB2ZWN0b3JGaWVsZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnRGVmYXVsdCB2YWx1ZSBvZiB2ZWN0b3JGaWVsZCBpcyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcmAuJyArXG4gICAgICAgICAgJyBJZiB5b3UgY3JlYXRlIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBhc3NpZ24gdmVjdG9yRmllbGQgdG8gdmFsdWUgb3RoZXIgdGhhbicgK1xuICAgICAgICAgICcgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1maWVsZGAgdGhlbiB5b3UgbXVzdCBwcm92aWRlIHRoZSBzYW1lIHZhbHVlIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicgK1xuICAgICAgICAgICcgSWYgeW91IGNyZWF0ZWQgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIHNldCBpdCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcmAnICtcbiAgICAgICAgICAnIHRoZW4gZG8gbm90IGFzc2lnbiB2ZWN0b3JGaWVsZCBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBEZXRlcm1pbmUgc3RvcmFnZSBjb25maWd1cmF0aW9uIGJhc2VkIG9uIHZlY3RvciBzdG9yZSB0eXBlLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiBnZXRTdG9yYWdlQ29uZmlndXJhdGlvbihwYXJhbXM6IFN0b3JhZ2VDb25maWd1cmF0aW9uKTogYW55IHtcbiAgc3dpdGNoIChwYXJhbXMudmVjdG9yU3RvcmVUeXBlKSB7XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb247XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTLFxuICAgICAgICBvcGVuc2VhcmNoU2VydmVybGVzc0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBjb2xsZWN0aW9uQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY29sbGVjdGlvbkFybixcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHZlY3RvckZpZWxkOiBwYXJhbXMudmVjdG9yRmllbGQsXG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQsXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZlY3RvckluZGV4TmFtZTogcGFyYW1zLmluZGV4TmFtZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkU6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPSBwYXJhbXMudmVjdG9yU3RvcmUgYXMgUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORSxcbiAgICAgICAgcGluZWNvbmVDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgbmFtZXNwYWNlOiBwYXJhbXMudmVjdG9yU3RvcmUubmFtZXNwYWNlIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICBjb25uZWN0aW9uU3RyaW5nOiBwYXJhbXMudmVjdG9yU3RvcmUuY29ubmVjdGlvblN0cmluZyxcbiAgICAgICAgICBjcmVkZW50aWFsc1NlY3JldEFybjogcGFyYW1zLnZlY3RvclN0b3JlLmNyZWRlbnRpYWxzU2VjcmV0QXJuLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdGV4dEZpZWxkOiBwYXJhbXMudGV4dEZpZWxkLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQTpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9XG4gICAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICAgICAgICA/IHBhcmFtcy52ZWN0b3JTdG9yZVxuICAgICAgICAgIDogKHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICAgICAgcmRzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZGF0YWJhc2VOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuZGF0YWJhc2VOYW1lLFxuICAgICAgICAgIHJlc291cmNlQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUucmVzb3VyY2VBcm4sXG4gICAgICAgICAgdGFibGVOYW1lOiBgJHtwYXJhbXMudmVjdG9yU3RvcmUuc2NoZW1hTmFtZX0uJHtwYXJhbXMudmVjdG9yU3RvcmUudGFibGVOYW1lfWAsXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLnJlcGxhY2UoLy0vZywgJ18nKSxcbiAgICAgICAgICAgIHByaW1hcnlLZXlGaWVsZDogcGFyYW1zLnZlY3RvclN0b3JlLnByaW1hcnlLZXlGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBjYXNlIFZlY3RvclN0b3JlVHlwZS5NT05HT19EQl9BVExBUzpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBNb25nb0RCQXRsYXNWZWN0b3JTdG9yZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5NT05HT19EQl9BVExBUyxcbiAgICAgICAgbW9uZ29EYkF0bGFzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNvbGxlY3Rpb25OYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuY29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBkYXRhYmFzZU5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS5kYXRhYmFzZU5hbWUsXG4gICAgICAgICAgZW5kcG9pbnQ6IHBhcmFtcy52ZWN0b3JTdG9yZS5lbmRwb2ludCxcbiAgICAgICAgICBlbmRwb2ludFNlcnZpY2VOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuZW5kcG9pbnRTZXJ2aWNlTmFtZSxcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHZlY3RvckZpZWxkOiBwYXJhbXMudmVjdG9yRmllbGQsXG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQsXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZlY3RvckluZGV4TmFtZTogcGFyYW1zLmluZGV4TmFtZSxcbiAgICAgICAgICB0ZXh0SW5kZXhOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUudGV4dEluZGV4TmFtZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9NQU5BR0VEX0NMVVNURVI6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPSBwYXJhbXMudmVjdG9yU3RvcmUgYXMgT3BlblNlYXJjaE1hbmFnZWRDbHVzdGVyVmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9NQU5BR0VEX0NMVVNURVIsXG4gICAgICAgIG9wZW5zZWFyY2hNYW5hZ2VkQ2x1c3RlckNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBkb21haW5Bcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5kb21haW5Bcm4sXG4gICAgICAgICAgZG9tYWluRW5kcG9pbnQ6IHBhcmFtcy52ZWN0b3JTdG9yZS5kb21haW5FbmRwb2ludCxcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHZlY3RvckZpZWxkOiBwYXJhbXMudmVjdG9yRmllbGQsXG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQsXG4gICAgICAgICAgICBtZXRhZGF0YUZpZWxkOiBwYXJhbXMubWV0YWRhdGFGaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZlY3RvckluZGV4TmFtZTogcGFyYW1zLmluZGV4TmFtZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdmVjdG9yIHN0b3JlIHR5cGU6ICR7cGFyYW1zLnZlY3RvclN0b3JlVHlwZX1gKTtcbiAgfVxufVxuIl19