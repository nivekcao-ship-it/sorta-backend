"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Guardrail = exports.GuardrailBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const fs = require("fs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const aws_cloudwatch_1 = require("aws-cdk-lib/aws-cloudwatch");
const iam = require("aws-cdk-lib/aws-iam");
const aws_kms_1 = require("aws-cdk-lib/aws-kms");
const helpers_internal_1 = require("aws-cdk-lib/core/lib/helpers-internal");
/**
 * Abstract base class for a Guardrail.
 * Contains methods and attributes valid for Guardrails either created with CDK or imported.
 */
class GuardrailBase extends aws_cdk_lib_1.Resource {
    /**
     * Return the given named metric for all guardrails.
     *
     * By default, the metric will be calculated as a sum over a period of 5 minutes.
     * You can customize this by using the `statistic` and `period` properties.
     */
    static metricAll(metricName, props) {
        return new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock/Guardrails',
            dimensionsMap: { Operation: 'ApplyGuardrail' },
            metricName,
            ...props,
        });
    }
    /**
     * Return the invocations metric for all guardrails.
     */
    static metricAllInvocations(props) {
        return this.metricAll('Invocations', props);
    }
    /**
     * Return the text unit count metric for all guardrails.
     */
    static metricAllTextUnitCount(props) {
        return this.metricAll('TextUnitCount', props);
    }
    /**
     * Return the invocations intervened metric for all guardrails.
     */
    static metricAllInvocationsIntervened(props) {
        return this.metricAll('InvocationsIntervened', props);
    }
    /**
     * Return the invocation latency metric for all guardrails.
     */
    static metricAllInvocationLatency(props) {
        return this.metricAll('InvocationLatency', props);
    }
    /**
     * Grant the given principal identity permissions to perform actions on this agent alias.
     */
    grant(grantee, ...actions) {
        return iam.Grant.addToPrincipal({
            grantee,
            actions,
            resourceArns: [this.guardrailArn],
            scope: this,
        });
    }
    /**
     * Grant the given identity permissions to apply the guardrail.
     */
    grantApply(grantee) {
        const baseGrant = this.grant(grantee, 'bedrock:ApplyGuardrail');
        if (this.kmsKey) {
            // If KMS key exists, create encryption grant and combine with base grant
            const kmsGrant = this.kmsKey.grantEncryptDecrypt(grantee);
            return kmsGrant.combine(baseGrant);
        }
        else {
            // If no KMS key exists, return only the base grant
            return baseGrant;
        }
    }
    /**
     * Return the given named metric for this guardrail.
     *
     * By default, the metric will be calculated as a sum over a period of 5 minutes.
     * You can customize this by using the `statistic` and `period` properties.
     */
    metric(metricName, props) {
        const metricProps = {
            namespace: 'AWS/Bedrock/Guardrails',
            metricName,
            dimensionsMap: { GuardrailArn: this.guardrailArn, GuardrailVersion: this.guardrailVersion },
            ...props,
        };
        return this.configureMetric(metricProps);
    }
    /**
     * Return the invocations metric for this guardrail.
     */
    metricInvocations(props) {
        return this.metric('Invocations', props);
    }
    /**
     * Return the invocation latency metric for this guardrail.
     */
    metricInvocationLatency(props) {
        return this.metric('InvocationLatency', props);
    }
    /**
     * Return the invocation client errors metric for this guardrail.
     */
    metricInvocationClientErrors(props) {
        return this.metric('InvocationClientErrors', props);
    }
    /**
     * Return the invocation server errors metric for this guardrail.
     */
    metricInvocationServerErrors(props) {
        return this.metric('InvocationServerErrors', props);
    }
    /**
     * Return the invocation throttles metric for this guardrail.
     */
    metricInvocationThrottles(props) {
        return this.metric('InvocationThrottles', props);
    }
    /**
     * Return the text unit count metric for this guardrail.
     */
    metricTextUnitCount(props) {
        return this.metric('TextUnitCount', props);
    }
    /**
     * Return the invocations intervened metric for this guardrail.
     */
    metricInvocationsIntervened(props) {
        return this.metric('InvocationsIntervened', props);
    }
    configureMetric(props) {
        return new aws_cloudwatch_1.Metric({
            ...props,
            region: props?.region ?? this.stack.region,
            account: props?.account ?? this.stack.account,
        });
    }
}
exports.GuardrailBase = GuardrailBase;
_a = JSII_RTTI_SYMBOL_1;
GuardrailBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.GuardrailBase", version: "0.1.309" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create a Guardrail with CDK.
 * @cloudformationResource AWS::Bedrock::Guardrail
 */
class Guardrail extends GuardrailBase {
    /**
     * Import a guardrail given its attributes
     */
    static fromGuardrailAttributes(scope, id, attrs) {
        class Import extends GuardrailBase {
            constructor() {
                super(...arguments);
                this.guardrailArn = attrs.guardrailArn;
                this.guardrailId = aws_cdk_lib_1.Arn.split(attrs.guardrailArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.guardrailVersion = attrs.guardrailVersion ?? 'DRAFT';
                this.kmsKey = attrs.kmsKey;
                this.lastUpdated = undefined;
            }
        }
        return new Import(scope, id);
    }
    /**
     * Import a low-level L1 Cfn Guardrail
     */
    static fromCfnGuardrail(cfnGuardrail) {
        return new (class extends GuardrailBase {
            constructor() {
                super(...arguments);
                this.guardrailArn = cfnGuardrail.attrGuardrailArn;
                this.guardrailId = cfnGuardrail.attrGuardrailId;
                this.guardrailVersion = cfnGuardrail.attrVersion;
                this.kmsKey = cfnGuardrail.kmsKeyArn
                    ? aws_kms_1.Key.fromKeyArn(this, '@FromCfnGuardrailKey', cfnGuardrail.kmsKeyArn)
                    : undefined;
                this.lastUpdated = cfnGuardrail.attrUpdatedAt;
            }
        })(cfnGuardrail, '@FromCfnGuardrail');
    }
    constructor(scope, id, props) {
        super(scope, id, {
            physicalName: props.name,
        });
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        this.name = this.physicalName;
        this.contentFilters = props.contentFilters ?? [];
        this.piiFilters = props.piiFilters ?? [];
        this.regexFilters = props.regexFilters ?? [];
        this.deniedTopics = props.deniedTopics ?? [];
        this.contextualGroundingFilters = props.contextualGroundingFilters ?? [];
        this.wordFilters = props.wordFilters ?? [];
        this.managedWordListFilters = props.managedWordListFilters ?? [];
        const defaultBlockedInputMessaging = 'Sorry, your query violates our usage policy.';
        const defaultBlockedOutputsMessaging = 'Sorry, I am unable to answer your question because of our usage policy.';
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        let cfnProps = {
            name: this.name,
            description: props.description,
            kmsKeyArn: props.kmsKey?.keyArn,
            blockedInputMessaging: props.blockedInputMessaging ?? defaultBlockedInputMessaging,
            blockedOutputsMessaging: props.blockedOutputsMessaging ?? defaultBlockedOutputsMessaging,
            // Lazy props
            contentPolicyConfig: this.generateCfnContentPolicyConfig(),
            contextualGroundingPolicyConfig: this.generateCfnContextualPolicyConfig(),
            topicPolicyConfig: this.generateCfnTopicPolicy(),
            wordPolicyConfig: this.generateCfnWordPolicyConfig(),
            sensitiveInformationPolicyConfig: this.generateCfnSensitiveInformationPolicyConfig(),
        };
        // Hash calculation useful for versioning of the guardrail
        this.hash = (0, helpers_internal_1.md5hash)(JSON.stringify(cfnProps));
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnGuardrail(this, 'MyGuardrail', cfnProps);
        this.guardrailId = this.__resource.attrGuardrailId;
        this.guardrailArn = this.__resource.attrGuardrailArn;
        this.guardrailVersion = this.__resource.attrVersion;
        this.lastUpdated = this.__resource.attrUpdatedAt;
    }
    // ------------------------------------------------------
    // METHODS
    // ------------------------------------------------------
    /**
     * Adds a content filter to the guardrail.
     * @param filter The content filter to add.
     */
    addContentFilter(filter) {
        this.contentFilters.push(filter);
    }
    /**
     * Adds a PII filter to the guardrail.
     * @param filter The PII filter to add.
     */
    addPIIFilter(filter) {
        this.piiFilters.push(filter);
    }
    /**
     * Adds a regex filter to the guardrail.
     * @param filter The regex filter to add.
     */
    addRegexFilter(filter) {
        this.regexFilters.push(filter);
    }
    /**
     * Adds a denied topic filter to the guardrail.
     * @param filter The denied topic filter to add.
     */
    addDeniedTopicFilter(filter) {
        this.deniedTopics.push(filter);
    }
    /**
     * Adds a contextual grounding filter to the guardrail.
     * @param filter The contextual grounding filter to add.
     */
    addContextualGroundingFilter(filter) {
        this.contextualGroundingFilters.push(filter);
    }
    /**
     * Adds a word filter to the guardrail.
     * @param filter The word filter to add.
     */
    addWordFilter(filter) {
        this.wordFilters.push(filter);
    }
    /**
     * Adds a word filter to the guardrail.
     * @param filePath The location of the word filter file.
     */
    addWordFilterFromFile(filePath, inputAction, outputAction, inputEnabled, outputEnabled) {
        const fileContents = fs.readFileSync(filePath, 'utf8');
        const words = fileContents.trim().split(',');
        for (const word of words)
            this.addWordFilter({ text: word, inputAction, outputAction, inputEnabled, outputEnabled });
    }
    /**
     * Adds a managed word list filter to the guardrail.
     * @param filter The managed word list filter to add.
     */
    addManagedWordListFilter(filter) {
        this.managedWordListFilters.push(filter);
    }
    /**
     * Create a version for the guardrail.
     * @param description The description of the version.
     * @returns The guardrail version.
     */
    createVersion(description) {
        const cfnVersion = new bedrock.CfnGuardrailVersion(this, `GuardrailVersion-${this.hash.slice(0, 16)}`, {
            description: description,
            guardrailIdentifier: this.guardrailId,
        });
        this.guardrailVersion = cfnVersion.attrVersion;
        return this.guardrailVersion;
    }
    // ------------------------------------------------------
    // CFN Generators
    // ------------------------------------------------------
    /**
     * Returns the content filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnContentPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.contentFilters.length > 0) {
                    return { filtersConfig: this.contentFilters };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the topic filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnTopicPolicy() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.deniedTopics.length > 0) {
                    return {
                        topicsConfig: this.deniedTopics.flatMap((topic) => {
                            return {
                                definition: topic.definition,
                                name: topic.name,
                                examples: topic.examples,
                                type: 'DENY',
                            };
                        }),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the contectual filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnContextualPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.contextualGroundingFilters.length > 0) {
                    return {
                        filtersConfig: this.contextualGroundingFilters.flatMap((filter) => {
                            return {
                                type: filter.type,
                                threshold: filter.threshold,
                            };
                        }),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the word config applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnWordPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.wordFilters.length > 0 || this.managedWordListFilters.length > 0) {
                    return {
                        wordsConfig: this.generateCfnWordConfig(),
                        managedWordListsConfig: this.generateCfnManagedWordListsConfig(),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the word filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnWordConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.wordFilters.flatMap((word) => {
                    return {
                        text: word.text,
                        inputAction: word.inputAction,
                        inputEnabled: word.inputEnabled,
                        outputAction: word.outputAction,
                        outputEnabled: word.outputEnabled,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the word filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnManagedWordListsConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.managedWordListFilters.flatMap((filter) => {
                    return {
                        type: filter.type,
                        inputAction: filter.inputAction,
                        inputEnabled: filter.inputEnabled,
                        outputAction: filter.outputAction,
                        outputEnabled: filter.outputEnabled,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the sensitive information config applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnSensitiveInformationPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.regexFilters.length > 0 || this.piiFilters.length > 0) {
                    return {
                        regexesConfig: this.generateCfnRegexesConfig(),
                        piiEntitiesConfig: this.generateCfnPiiEntitiesConfig(),
                    };
                }
                else {
                    return undefined;
                }
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the regex filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnRegexesConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.regexFilters.flatMap((regex) => {
                    return {
                        name: regex.name,
                        description: regex.description,
                        pattern: regex.pattern,
                        action: regex.action,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the Pii filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnPiiEntitiesConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.piiFilters.flatMap((filter) => {
                    return {
                        type: filter.type,
                        action: filter.action,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
}
exports.Guardrail = Guardrail;
_b = JSII_RTTI_SYMBOL_1;
Guardrail[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Guardrail", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmRyYWlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZ3VhcmRyYWlscy9ndWFyZHJhaWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCx5QkFBeUI7QUFDekIsNkNBQXFGO0FBQ3JGLG1EQUFtRDtBQUNuRCwrREFBZ0Y7QUFDaEYsMkNBQTJDO0FBQzNDLGlEQUFnRDtBQUNoRCw0RUFBZ0U7QUF1RmhFOzs7R0FHRztBQUNILE1BQXNCLGFBQWMsU0FBUSxzQkFBUTtJQUNsRDs7Ozs7T0FLRztJQUNJLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBa0IsRUFBRSxLQUFxQjtRQUMvRCxPQUFPLElBQUksdUJBQU0sQ0FBQztZQUNoQixTQUFTLEVBQUUsd0JBQXdCO1lBQ25DLGFBQWEsRUFBRSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtZQUM5QyxVQUFVO1lBQ1YsR0FBRyxLQUFLO1NBQ1QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLG9CQUFvQixDQUFDLEtBQXFCO1FBQ3RELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLHNCQUFzQixDQUFDLEtBQXFCO1FBQ3hELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLDhCQUE4QixDQUFDLEtBQXFCO1FBQ2hFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyx1QkFBdUIsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsMEJBQTBCLENBQUMsS0FBcUI7UUFDNUQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFzQkQ7O09BRUc7SUFDSSxLQUFLLENBQUMsT0FBdUIsRUFBRSxHQUFHLE9BQWlCO1FBQ3hELE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUM7WUFDOUIsT0FBTztZQUNQLE9BQU87WUFDUCxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ2pDLEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNEOztPQUVHO0lBQ0ksVUFBVSxDQUFDLE9BQXVCO1FBQ3ZDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHdCQUF3QixDQUFDLENBQUM7UUFFaEUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIseUVBQXlFO1lBQ3pFLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDMUQsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7YUFBTSxDQUFDO1lBQ04sbURBQW1EO1lBQ25ELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxNQUFNLENBQUMsVUFBa0IsRUFBRSxLQUFxQjtRQUNyRCxNQUFNLFdBQVcsR0FBZ0I7WUFDL0IsU0FBUyxFQUFFLHdCQUF3QjtZQUNuQyxVQUFVO1lBQ1YsYUFBYSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQzNGLEdBQUcsS0FBSztTQUNULENBQUM7UUFDRixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVEOztPQUVHO0lBQ0ksaUJBQWlCLENBQUMsS0FBcUI7UUFDNUMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSx1QkFBdUIsQ0FBQyxLQUFxQjtRQUNsRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksNEJBQTRCLENBQUMsS0FBcUI7UUFDdkQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLHdCQUF3QixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRDs7T0FFRztJQUNJLDRCQUE0QixDQUFDLEtBQXFCO1FBQ3ZELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSx5QkFBeUIsQ0FBQyxLQUFxQjtRQUNwRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVEOztPQUVHO0lBQ0ksbUJBQW1CLENBQUMsS0FBcUI7UUFDOUMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7O09BRUc7SUFDSSwyQkFBMkIsQ0FBQyxLQUFxQjtRQUN0RCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVPLGVBQWUsQ0FBQyxLQUFrQjtRQUN4QyxPQUFPLElBQUksdUJBQU0sQ0FBQztZQUNoQixHQUFHLEtBQUs7WUFDUixNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07WUFDMUMsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO1NBQzlDLENBQUMsQ0FBQztJQUNMLENBQUM7O0FBbEtILHNDQW1LQzs7O0FBeUZEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBYSxTQUFVLFNBQVEsYUFBYTtJQUMxQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUEwQjtRQUM1RixNQUFNLE1BQU8sU0FBUSxhQUFhO1lBQWxDOztnQkFDa0IsaUJBQVksR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDO2dCQUNsQyxnQkFBVyxHQUFHLGlCQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsdUJBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLFlBQWEsQ0FBQztnQkFDekYscUJBQWdCLEdBQUcsS0FBSyxDQUFDLGdCQUFnQixJQUFJLE9BQU8sQ0FBQztnQkFDckQsV0FBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7Z0JBQ3RCLGdCQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzFDLENBQUM7U0FBQTtRQUVELE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFrQztRQUMvRCxPQUFPLElBQUksQ0FBQyxLQUFNLFNBQVEsYUFBYTtZQUEzQjs7Z0JBQ00saUJBQVksR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUM7Z0JBQzdDLGdCQUFXLEdBQUcsWUFBWSxDQUFDLGVBQWUsQ0FBQztnQkFDM0MscUJBQWdCLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQztnQkFDNUMsV0FBTSxHQUFHLFlBQVksQ0FBQyxTQUFTO29CQUM3QyxDQUFDLENBQUMsYUFBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsc0JBQXNCLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQztvQkFDdEUsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFDRSxnQkFBVyxHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUM7WUFDM0QsQ0FBQztTQUFBLENBQUMsQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBc0VELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDZixZQUFZLEVBQUUsS0FBSyxDQUFDLElBQUk7U0FDekIsQ0FBQyxDQUFDO1FBRUgseURBQXlEO1FBQ3pELDZCQUE2QjtRQUM3Qix5REFBeUQ7UUFDekQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzlCLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsSUFBSSxFQUFFLENBQUM7UUFDakQsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQztRQUN6QyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxZQUFZLElBQUksRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLDBCQUEwQixHQUFHLEtBQUssQ0FBQywwQkFBMEIsSUFBSSxFQUFFLENBQUM7UUFDekUsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDLHNCQUFzQixJQUFJLEVBQUUsQ0FBQztRQUVqRSxNQUFNLDRCQUE0QixHQUFHLDhDQUE4QyxDQUFDO1FBQ3BGLE1BQU0sOEJBQThCLEdBQUcseUVBQXlFLENBQUM7UUFFakgseURBQXlEO1FBQ3pELGdDQUFnQztRQUNoQyx5REFBeUQ7UUFDekQsSUFBSSxRQUFRLEdBQThCO1lBQ3hDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztZQUM5QixTQUFTLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxNQUFNO1lBQy9CLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxxQkFBcUIsSUFBSSw0QkFBNEI7WUFDbEYsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLHVCQUF1QixJQUFJLDhCQUE4QjtZQUN4RixhQUFhO1lBQ2IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLDhCQUE4QixFQUFFO1lBQzFELCtCQUErQixFQUFFLElBQUksQ0FBQyxpQ0FBaUMsRUFBRTtZQUN6RSxpQkFBaUIsRUFBRSxJQUFJLENBQUMsc0JBQXNCLEVBQUU7WUFDaEQsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLDJCQUEyQixFQUFFO1lBQ3BELGdDQUFnQyxFQUFFLElBQUksQ0FBQywyQ0FBMkMsRUFBRTtTQUNyRixDQUFDO1FBRUYsMERBQTBEO1FBQzFELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBQSwwQkFBTyxFQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUU5Qyx5REFBeUQ7UUFDekQsbUJBQW1CO1FBQ25CLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTFFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUM7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDO1FBQ3JELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQztRQUNwRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO0lBQ25ELENBQUM7SUFFRCx5REFBeUQ7SUFDekQsVUFBVTtJQUNWLHlEQUF5RDtJQUN6RDs7O09BR0c7SUFDSSxnQkFBZ0IsQ0FBQyxNQUE2QjtRQUNuRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksWUFBWSxDQUFDLE1BQXlCO1FBQzNDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRDs7O09BR0c7SUFDSSxjQUFjLENBQUMsTUFBMkI7UUFDL0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG9CQUFvQixDQUFDLE1BQXFCO1FBQy9DLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7O09BR0c7SUFDSSw0QkFBNEIsQ0FBQyxNQUF5QztRQUMzRSxJQUFJLENBQUMsMEJBQTBCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7O09BR0c7SUFDSSxhQUFhLENBQUMsTUFBMEI7UUFDN0MsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVEOzs7T0FHRztJQUNJLHFCQUFxQixDQUFDLFFBQWdCLEVBQzNDLFdBQXFDLEVBQ3JDLFlBQXNDLEVBQ3RDLFlBQXNCLEVBQ3RCLGFBQXVCO1FBQ3ZCLE1BQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0MsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLO1lBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUN2SCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksd0JBQXdCLENBQUMsTUFBaUM7UUFDL0QsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLGFBQWEsQ0FBQyxXQUFvQjtRQUN2QyxNQUFNLFVBQVUsR0FBRyxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsb0JBQW9CLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3JHLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxXQUFXO1NBQ3RDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDO1FBQy9DLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDO0lBQy9CLENBQUM7SUFFRCx5REFBeUQ7SUFDekQsaUJBQWlCO0lBQ2pCLHlEQUF5RDtJQUN6RDs7O09BR0c7SUFDSyw4QkFBOEI7UUFDcEMsT0FBTyxrQkFBSSxDQUFDLEdBQUcsQ0FBQztZQUNkLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ1osSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDbkMsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFzRCxDQUFDO2dCQUNwRyxDQUFDO3FCQUFNLENBQUM7b0JBQ04sT0FBTyxTQUFTLENBQUM7Z0JBQ25CLENBQUM7WUFDSCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNLLHNCQUFzQjtRQUM1QixPQUFPLGtCQUFJLENBQUMsR0FBRyxDQUFDO1lBQ2QsT0FBTyxFQUFFLEdBQUcsRUFBRTtnQkFDWixJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNqQyxPQUFPO3dCQUNMLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQW9CLEVBQUUsRUFBRTs0QkFDL0QsT0FBTztnQ0FDTCxVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7Z0NBQzVCLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtnQ0FDaEIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dDQUN4QixJQUFJLEVBQUUsTUFBTTs2QkFDK0IsQ0FBQzt3QkFDaEQsQ0FBQyxDQUFDO3FCQUNILENBQUM7Z0JBQ0osQ0FBQztxQkFBTSxDQUFDO29CQUNOLE9BQU8sU0FBUyxDQUFDO2dCQUNuQixDQUFDO1lBQ0gsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSyxpQ0FBaUM7UUFDdkMsT0FBTyxrQkFBSSxDQUFDLEdBQUcsQ0FBQztZQUNkLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ1osSUFBSSxJQUFJLENBQUMsMEJBQTBCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUMvQyxPQUFPO3dCQUNMLGFBQWEsRUFBRSxJQUFJLENBQUMsMEJBQTBCLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBeUMsRUFBRSxFQUFFOzRCQUNuRyxPQUFPO2dDQUNMLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTtnQ0FDakIsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTOzZCQUNvQyxDQUFDO3dCQUNwRSxDQUFDLENBQUM7cUJBQ0gsQ0FBQztnQkFDSixDQUFDO3FCQUFNLENBQUM7b0JBQ04sT0FBTyxTQUFTLENBQUM7Z0JBQ25CLENBQUM7WUFDSCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNLLDJCQUEyQjtRQUNqQyxPQUFPLGtCQUFJLENBQUMsR0FBRyxDQUFDO1lBQ2QsT0FBTyxFQUFFLEdBQUcsRUFBRTtnQkFDWixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUMxRSxPQUFPO3dCQUNMLFdBQVcsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUU7d0JBQ3pDLHNCQUFzQixFQUFFLElBQUksQ0FBQyxpQ0FBaUMsRUFBRTtxQkFDaEIsQ0FBQztnQkFDckQsQ0FBQztxQkFBTSxDQUFDO29CQUNOLE9BQU8sU0FBUyxDQUFDO2dCQUNuQixDQUFDO1lBQ0gsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSyxxQkFBcUI7UUFDM0IsT0FBTyxrQkFBSSxDQUFDLEdBQUcsQ0FDYjtZQUNFLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQXdCLEVBQUUsRUFBRTtvQkFDM0QsT0FBTzt3QkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7d0JBQ2YsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO3dCQUM3QixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7d0JBQy9CLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWTt3QkFDL0IsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO3FCQUNTLENBQUM7Z0JBQy9DLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztTQUNGLEVBQ0QsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQ3pCLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssaUNBQWlDO1FBQ3ZDLE9BQU8sa0JBQUksQ0FBQyxHQUFHLENBQ2I7WUFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFO2dCQUNaLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQWlDLEVBQUUsRUFBRTtvQkFDL0UsT0FBTzt3QkFDTCxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7d0JBQ2pCLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVzt3QkFDL0IsWUFBWSxFQUFFLE1BQU0sQ0FBQyxZQUFZO3dCQUNqQyxZQUFZLEVBQUUsTUFBTSxDQUFDLFlBQVk7d0JBQ2pDLGFBQWEsRUFBRSxNQUFNLENBQUMsYUFBYTtxQkFDZSxDQUFDO2dCQUN2RCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixFQUNELEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUN6QixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNLLDJDQUEyQztRQUNqRCxPQUFPLGtCQUFJLENBQUMsR0FBRyxDQUNiO1lBQ0UsT0FBTyxFQUFFLEdBQUcsRUFBRTtnQkFDWixJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDL0QsT0FBTzt3QkFDTCxhQUFhLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUFFO3dCQUM5QyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsNEJBQTRCLEVBQUU7cUJBQ3ZELENBQUM7Z0JBQ0osQ0FBQztxQkFBTSxDQUFDO29CQUNOLE9BQU8sU0FBUyxDQUFDO2dCQUNuQixDQUFDO1lBQ0gsQ0FBQztTQUNGLEVBQ0QsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQ3pCLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssd0JBQXdCO1FBQzlCLE9BQU8sa0JBQUksQ0FBQyxHQUFHLENBQ2I7WUFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFO2dCQUNaLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUEwQixFQUFFLEVBQUU7b0JBQzlELE9BQU87d0JBQ0wsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO3dCQUNoQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7d0JBQzlCLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTzt3QkFDdEIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO3FCQUN1QixDQUFDO2dCQUNoRCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixFQUNELEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUN6QixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNLLDRCQUE0QjtRQUNsQyxPQUFPLGtCQUFJLENBQUMsR0FBRyxDQUNiO1lBQ0UsT0FBTyxFQUFFLEdBQUcsRUFBRTtnQkFDWixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBeUIsRUFBRSxFQUFFO29CQUMzRCxPQUFPO3dCQUNMLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTt3QkFDakIsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNO3FCQUMwQixDQUFDO2dCQUNwRCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixFQUNELEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUN6QixDQUFDO0lBQ0osQ0FBQzs7QUFoYkgsOEJBaWJDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHsgQXJuLCBBcm5Gb3JtYXQsIElSZXNvbHZhYmxlLCBJUmVzb3VyY2UsIExhenksIFJlc291cmNlIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgYmVkcm9jayBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgeyBNZXRyaWMsIE1ldHJpY09wdGlvbnMsIE1ldHJpY1Byb3BzIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWNsb3Vkd2F0Y2gnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgSUtleSwgS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBtZDVoYXNoIH0gZnJvbSAnYXdzLWNkay1saWIvY29yZS9saWIvaGVscGVycy1pbnRlcm5hbCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGZpbHRlcnMgZnJvbSAnLi9ndWFyZHJhaWwtZmlsdGVycyc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBHdWFyZHJhaWwsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElHdWFyZHJhaWwgZXh0ZW5kcyBJUmVzb3VyY2Uge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmd1YXJkcmFpbC95eW1wem8zOThpcHFcIlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAZXhhbXBsZSBcInl5bXB6bzM5OGlwcVwiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZ3VhcmRyYWlsXG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBJS2V5O1xuICAvKipcbiAgICogV2hlbiB0aGlzIGd1YXJkcmFpbCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgZ3VhcmRyYWlsLiBJZiBubyBleHBsaWNpdCB2ZXJzaW9uIGlzIGNyZWF0ZWQsXG4gICAqIHRoaXMgd2lsbCBkZWZhdWx0IHRvIFwiRFJBRlRcIlxuICAgKi9cbiAgZ3VhcmRyYWlsVmVyc2lvbjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBHcmFudCB0aGUgZ2l2ZW4gcHJpbmNpcGFsIGlkZW50aXR5IHBlcm1pc3Npb25zIHRvIHBlcmZvcm0gYWN0aW9ucyBvbiB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIGdyYW50KGdyYW50ZWU6IGlhbS5JR3JhbnRhYmxlLCAuLi5hY3Rpb25zOiBzdHJpbmdbXSk6IGlhbS5HcmFudDtcbiAgLyoqXG4gICAqIEdyYW50IHRoZSBnaXZlbiBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byBhcHBseSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgZ3JhbnRBcHBseShncmFudGVlOiBpYW0uSUdyYW50YWJsZSk6IGlhbS5HcmFudDtcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBnaXZlbiBuYW1lZCBtZXRyaWMgZm9yIHRoaXMgZ3VhcmRyYWlsLlxuICAgKi9cbiAgbWV0cmljKG1ldHJpY05hbWU6IHN0cmluZywgcHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb25zIG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqL1xuICBtZXRyaWNJbnZvY2F0aW9ucyhwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWM7XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgaW52b2NhdGlvbiBsYXRlbmN5IG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqL1xuICBtZXRyaWNJbnZvY2F0aW9uTGF0ZW5jeShwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWM7XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgaW52b2NhdGlvbiBjbGllbnQgZXJyb3JzIG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqL1xuICBtZXRyaWNJbnZvY2F0aW9uQ2xpZW50RXJyb3JzKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYztcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbnZvY2F0aW9uIHNlcnZlciBlcnJvcnMgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIG1ldHJpY0ludm9jYXRpb25TZXJ2ZXJFcnJvcnMocHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb24gdGhyb3R0bGVzIG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqL1xuICBtZXRyaWNJbnZvY2F0aW9uVGhyb3R0bGVzKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYztcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSB0ZXh0IHVuaXQgY291bnQgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIG1ldHJpY1RleHRVbml0Q291bnQocHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb25zIGludGVydmVuZWQgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIG1ldHJpY0ludm9jYXRpb25zSW50ZXJ2ZW5lZChwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWM7XG59XG5cbi8qKlxuICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgYSBHdWFyZHJhaWwuXG4gKiBDb250YWlucyBtZXRob2RzIGFuZCBhdHRyaWJ1dGVzIHZhbGlkIGZvciBHdWFyZHJhaWxzIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgR3VhcmRyYWlsQmFzZSBleHRlbmRzIFJlc291cmNlIGltcGxlbWVudHMgSUd1YXJkcmFpbCB7XG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGdpdmVuIG5hbWVkIG1ldHJpYyBmb3IgYWxsIGd1YXJkcmFpbHMuXG4gICAqXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBtZXRyaWMgd2lsbCBiZSBjYWxjdWxhdGVkIGFzIGEgc3VtIG92ZXIgYSBwZXJpb2Qgb2YgNSBtaW51dGVzLlxuICAgKiBZb3UgY2FuIGN1c3RvbWl6ZSB0aGlzIGJ5IHVzaW5nIHRoZSBgc3RhdGlzdGljYCBhbmQgYHBlcmlvZGAgcHJvcGVydGllcy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsKG1ldHJpY05hbWU6IHN0cmluZywgcHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljIHtcbiAgICByZXR1cm4gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jay9HdWFyZHJhaWxzJyxcbiAgICAgIGRpbWVuc2lvbnNNYXA6IHsgT3BlcmF0aW9uOiAnQXBwbHlHdWFyZHJhaWwnIH0sXG4gICAgICBtZXRyaWNOYW1lLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbnZvY2F0aW9ucyBtZXRyaWMgZm9yIGFsbCBndWFyZHJhaWxzLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBtZXRyaWNBbGxJbnZvY2F0aW9ucyhwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0FsbCgnSW52b2NhdGlvbnMnLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSB0ZXh0IHVuaXQgY291bnQgbWV0cmljIGZvciBhbGwgZ3VhcmRyYWlscy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsVGV4dFVuaXRDb3VudChwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0FsbCgnVGV4dFVuaXRDb3VudCcsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb25zIGludGVydmVuZWQgbWV0cmljIGZvciBhbGwgZ3VhcmRyYWlscy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsSW52b2NhdGlvbnNJbnRlcnZlbmVkKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljQWxsKCdJbnZvY2F0aW9uc0ludGVydmVuZWQnLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbnZvY2F0aW9uIGxhdGVuY3kgbWV0cmljIGZvciBhbGwgZ3VhcmRyYWlscy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgbWV0cmljQWxsSW52b2NhdGlvbkxhdGVuY3kocHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWNBbGwoJ0ludm9jYXRpb25MYXRlbmN5JywgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGd1YXJkcmFpbElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCBndWFyZHJhaWxWZXJzaW9uOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSBvZiB0aGUgZ3VhcmRyYWlsIGlmIGN1c3RvbSBlbmNyeXB0aW9uIGlzIGNvbmZpZ3VyZWQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBndWFyZHJhaWwgd2FzIGxhc3QgdXBkYXRlZFxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xuICAvKipcbiAgICogR3JhbnQgdGhlIGdpdmVuIHByaW5jaXBhbCBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byBwZXJmb3JtIGFjdGlvbnMgb24gdGhpcyBhZ2VudCBhbGlhcy5cbiAgICovXG4gIHB1YmxpYyBncmFudChncmFudGVlOiBpYW0uSUdyYW50YWJsZSwgLi4uYWN0aW9uczogc3RyaW5nW10pIHtcbiAgICByZXR1cm4gaWFtLkdyYW50LmFkZFRvUHJpbmNpcGFsKHtcbiAgICAgIGdyYW50ZWUsXG4gICAgICBhY3Rpb25zLFxuICAgICAgcmVzb3VyY2VBcm5zOiBbdGhpcy5ndWFyZHJhaWxBcm5dLFxuICAgICAgc2NvcGU6IHRoaXMsXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIEdyYW50IHRoZSBnaXZlbiBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byBhcHBseSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIGdyYW50QXBwbHkoZ3JhbnRlZTogaWFtLklHcmFudGFibGUpOiBpYW0uR3JhbnQge1xuICAgIGNvbnN0IGJhc2VHcmFudCA9IHRoaXMuZ3JhbnQoZ3JhbnRlZSwgJ2JlZHJvY2s6QXBwbHlHdWFyZHJhaWwnKTtcblxuICAgIGlmICh0aGlzLmttc0tleSkge1xuICAgICAgLy8gSWYgS01TIGtleSBleGlzdHMsIGNyZWF0ZSBlbmNyeXB0aW9uIGdyYW50IGFuZCBjb21iaW5lIHdpdGggYmFzZSBncmFudFxuICAgICAgY29uc3Qga21zR3JhbnQgPSB0aGlzLmttc0tleS5ncmFudEVuY3J5cHREZWNyeXB0KGdyYW50ZWUpO1xuICAgICAgcmV0dXJuIGttc0dyYW50LmNvbWJpbmUoYmFzZUdyYW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm8gS01TIGtleSBleGlzdHMsIHJldHVybiBvbmx5IHRoZSBiYXNlIGdyYW50XG4gICAgICByZXR1cm4gYmFzZUdyYW50O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGdpdmVuIG5hbWVkIG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBtZXRyaWMgd2lsbCBiZSBjYWxjdWxhdGVkIGFzIGEgc3VtIG92ZXIgYSBwZXJpb2Qgb2YgNSBtaW51dGVzLlxuICAgKiBZb3UgY2FuIGN1c3RvbWl6ZSB0aGlzIGJ5IHVzaW5nIHRoZSBgc3RhdGlzdGljYCBhbmQgYHBlcmlvZGAgcHJvcGVydGllcy5cbiAgICovXG4gIHB1YmxpYyBtZXRyaWMobWV0cmljTmFtZTogc3RyaW5nLCBwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWMge1xuICAgIGNvbnN0IG1ldHJpY1Byb3BzOiBNZXRyaWNQcm9wcyA9IHtcbiAgICAgIG5hbWVzcGFjZTogJ0FXUy9CZWRyb2NrL0d1YXJkcmFpbHMnLFxuICAgICAgbWV0cmljTmFtZSxcbiAgICAgIGRpbWVuc2lvbnNNYXA6IHsgR3VhcmRyYWlsQXJuOiB0aGlzLmd1YXJkcmFpbEFybiwgR3VhcmRyYWlsVmVyc2lvbjogdGhpcy5ndWFyZHJhaWxWZXJzaW9uIH0sXG4gICAgICAuLi5wcm9wcyxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyZU1ldHJpYyhtZXRyaWNQcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbnZvY2F0aW9ucyBtZXRyaWMgZm9yIHRoaXMgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIG1ldHJpY0ludm9jYXRpb25zKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKCdJbnZvY2F0aW9ucycsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb24gbGF0ZW5jeSBtZXRyaWMgZm9yIHRoaXMgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIG1ldHJpY0ludm9jYXRpb25MYXRlbmN5KHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKCdJbnZvY2F0aW9uTGF0ZW5jeScsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb24gY2xpZW50IGVycm9ycyBtZXRyaWMgZm9yIHRoaXMgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIG1ldHJpY0ludm9jYXRpb25DbGllbnRFcnJvcnMocHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ0ludm9jYXRpb25DbGllbnRFcnJvcnMnLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbnZvY2F0aW9uIHNlcnZlciBlcnJvcnMgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBtZXRyaWNJbnZvY2F0aW9uU2VydmVyRXJyb3JzKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKCdJbnZvY2F0aW9uU2VydmVyRXJyb3JzJywgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgaW52b2NhdGlvbiB0aHJvdHRsZXMgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBtZXRyaWNJbnZvY2F0aW9uVGhyb3R0bGVzKHByb3BzPzogTWV0cmljT3B0aW9ucyk6IE1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKCdJbnZvY2F0aW9uVGhyb3R0bGVzJywgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgdGV4dCB1bml0IGNvdW50IG1ldHJpYyBmb3IgdGhpcyBndWFyZHJhaWwuXG4gICAqL1xuICBwdWJsaWMgbWV0cmljVGV4dFVuaXRDb3VudChwcm9wcz86IE1ldHJpY09wdGlvbnMpOiBNZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYygnVGV4dFVuaXRDb3VudCcsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGludm9jYXRpb25zIGludGVydmVuZWQgbWV0cmljIGZvciB0aGlzIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBtZXRyaWNJbnZvY2F0aW9uc0ludGVydmVuZWQocHJvcHM/OiBNZXRyaWNPcHRpb25zKTogTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ0ludm9jYXRpb25zSW50ZXJ2ZW5lZCcsIHByb3BzKTtcbiAgfVxuXG4gIHByaXZhdGUgY29uZmlndXJlTWV0cmljKHByb3BzOiBNZXRyaWNQcm9wcykge1xuICAgIHJldHVybiBuZXcgTWV0cmljKHtcbiAgICAgIC4uLnByb3BzLFxuICAgICAgcmVnaW9uOiBwcm9wcz8ucmVnaW9uID8/IHRoaXMuc3RhY2sucmVnaW9uLFxuICAgICAgYWNjb3VudDogcHJvcHM/LmFjY291bnQgPz8gdGhpcy5zdGFjay5hY2NvdW50LFxuICAgIH0pO1xuICB9XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgUFJPUFMgRk9SIE5FVyBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUHJvcGVydGllcyBmb3IgY3JlYXRpbmcgYSBHdWFyZHJhaWwuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR3VhcmRyYWlsUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgbWVzc2FnZSB0byByZXR1cm4gd2hlbiB0aGUgZ3VhcmRyYWlsIGJsb2NrcyBhIHByb21wdC5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJTb3JyeSwgeW91ciBxdWVyeSB2aW9sYXRlcyBvdXIgdXNhZ2UgcG9saWN5LlwiXG4gICAqL1xuICByZWFkb25seSBibG9ja2VkSW5wdXRNZXNzYWdpbmc/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgbWVzc2FnZSB0byByZXR1cm4gd2hlbiB0aGUgZ3VhcmRyYWlsIGJsb2NrcyBhIG1vZGVsIHJlc3BvbnNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCBcIlNvcnJ5LCBJIGFtIHVuYWJsZSB0byBhbnN3ZXIgeW91ciBxdWVzdGlvbiBiZWNhdXNlIG9mIG91ciB1c2FnZSBwb2xpY3kuXCJcbiAgICovXG4gIHJlYWRvbmx5IGJsb2NrZWRPdXRwdXRzTWVzc2FnaW5nPzogc3RyaW5nO1xuICAvKipcbiAgICogQSBjdXN0b20gS01TIGtleSB0byB1c2UgZm9yIGVuY3J5cHRpbmcgZGF0YS5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJZb3VyIGRhdGEgaXMgZW5jcnlwdGVkIGJ5IGRlZmF1bHQgd2l0aCBhIGtleSB0aGF0IEFXUyBvd25zIGFuZCBtYW5hZ2VzIGZvciB5b3UuXCJcbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBUaGUgY29udGVudCBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIE5vdGUsIGlmIG9uZSBvZlxuICAgKi9cbiAgcmVhZG9ubHkgY29udGVudEZpbHRlcnM/OiBmaWx0ZXJzLkNvbnRlbnRGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFVwIHRvIDMwIGRlbmllZCB0b3BpY3MgdG8gYmxvY2sgdXNlciBpbnB1dHMgb3IgbW9kZWwgcmVzcG9uc2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgdG9waWMuXG4gICAqL1xuICByZWFkb25seSBkZW5pZWRUb3BpY3M/OiBmaWx0ZXJzLlRvcGljW107XG4gIC8qKlxuICAgKiBUaGUgd29yZCBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSB3b3JkRmlsdGVycz86IGZpbHRlcnMuV29yZEZpbHRlcltdO1xuICAvKipcbiAgICogVGhlIG1hbmFnZWQgd29yZCBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSBtYW5hZ2VkV29yZExpc3RGaWx0ZXJzPzogZmlsdGVycy5NYW5hZ2VkV29yZEZpbHRlcltdO1xuICAvKipcbiAgICogVGhlIFBJSSBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSBwaWlGaWx0ZXJzPzogZmlsdGVycy5QSUlGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gKHJlZ2V4KSBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSByZWdleEZpbHRlcnM/OiBmaWx0ZXJzLlJlZ2V4RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgY29udGV4dHVhbCBncm91bmRpbmcgZmlsdGVycyB0byBhcHBseSB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcmVhZG9ubHkgY29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcnM/OiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJbXTtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgQVRUUlMgRk9SIElNUE9SVEVEIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuZXhwb3J0IGludGVyZmFjZSBHdWFyZHJhaWxBdHRyaWJ1dGVzIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGd1YXJkcmFpbC4gQXQgbGVhc3Qgb25lIG9mIGd1YXJkcmFpbEFybiBvciBndWFyZHJhaWxJZCBtdXN0IGJlXG4gICAqIGRlZmluZWQgaW4gb3JkZXIgdG8gaW5pdGlhbGl6ZSBhIGd1YXJkcmFpbCByZWYuXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IG9mIHRoZSBndWFyZHJhaWwgaWYgY3VzdG9tIGVuY3J5cHRpb24gaXMgY29uZmlndXJlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIC0gTWVhbnMgZGF0YSBpcyBlbmNyeXB0ZWQgYnkgZGVmYXVsdCB3aXRoIGEgQVdTLW1hbmFnZWQga2V5XG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBJS2V5O1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIGd1YXJkcmFpbC5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJEUkFGVFwiXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxWZXJzaW9uPzogc3RyaW5nO1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIE5FVyBDT05TVFJVQ1QgREVGSU5JVElPTlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBDbGFzcyB0byBjcmVhdGUgYSBHdWFyZHJhaWwgd2l0aCBDREsuXG4gKiBAY2xvdWRmb3JtYXRpb25SZXNvdXJjZSBBV1M6OkJlZHJvY2s6Okd1YXJkcmFpbFxuICovXG5leHBvcnQgY2xhc3MgR3VhcmRyYWlsIGV4dGVuZHMgR3VhcmRyYWlsQmFzZSB7XG4gIC8qKlxuICAgKiBJbXBvcnQgYSBndWFyZHJhaWwgZ2l2ZW4gaXRzIGF0dHJpYnV0ZXNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUd1YXJkcmFpbEF0dHJpYnV0ZXMoc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgYXR0cnM6IEd1YXJkcmFpbEF0dHJpYnV0ZXMpOiBJR3VhcmRyYWlsIHtcbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBHdWFyZHJhaWxCYXNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxBcm4gPSBhdHRycy5ndWFyZHJhaWxBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsSWQgPSBBcm4uc3BsaXQoYXR0cnMuZ3VhcmRyYWlsQXJuLCBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSkucmVzb3VyY2VOYW1lITtcbiAgICAgIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxWZXJzaW9uID0gYXR0cnMuZ3VhcmRyYWlsVmVyc2lvbiA/PyAnRFJBRlQnO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGttc0tleSA9IGF0dHJzLmttc0tleTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBsYXN0VXBkYXRlZCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEltcG9ydChzY29wZSwgaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEltcG9ydCBhIGxvdy1sZXZlbCBMMSBDZm4gR3VhcmRyYWlsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21DZm5HdWFyZHJhaWwoY2ZuR3VhcmRyYWlsOiBiZWRyb2NrLkNmbkd1YXJkcmFpbCk6IElHdWFyZHJhaWwge1xuICAgIHJldHVybiBuZXcgKGNsYXNzIGV4dGVuZHMgR3VhcmRyYWlsQmFzZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsQXJuID0gY2ZuR3VhcmRyYWlsLmF0dHJHdWFyZHJhaWxBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsSWQgPSBjZm5HdWFyZHJhaWwuYXR0ckd1YXJkcmFpbElkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGd1YXJkcmFpbFZlcnNpb24gPSBjZm5HdWFyZHJhaWwuYXR0clZlcnNpb247XG4gICAgICBwdWJsaWMgcmVhZG9ubHkga21zS2V5ID0gY2ZuR3VhcmRyYWlsLmttc0tleUFyblxuICAgICAgICA/IEtleS5mcm9tS2V5QXJuKHRoaXMsICdARnJvbUNmbkd1YXJkcmFpbEtleScsIGNmbkd1YXJkcmFpbC5rbXNLZXlBcm4pXG4gICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGxhc3RVcGRhdGVkID0gY2ZuR3VhcmRyYWlsLmF0dHJVcGRhdGVkQXQ7XG4gICAgfSkoY2ZuR3VhcmRyYWlsLCAnQEZyb21DZm5HdWFyZHJhaWwnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBCeSBkZWZhdWx0LCB0aGlzIHZhbHVlIHdpbGwgYWx3YXlzIGJlIGBEUkFGVGAgdW5sZXNzIGFuIGV4cGxpY2l0IHZlcnNpb24gaXMgY3JlYXRlZC5cbiAgICogRm9yIGFuIGV4cGxpY2l0IHZlcnNpb24gY3JlYXRlZCwgdGhpcyB3aWxsIHVzdWFsbHkgYmUgYSBudW1iZXIgKGUuZy4gZm9yIFZlcnNpb24gMSBqdXN0IGVudGVyIFwiMVwiKVxuICAgKlxuICAgKiBAZXhhbXBsZSBcIjFcIlxuICAgKiBAZGVmYXVsdCAtIFwiRFJBRlRcIlxuICAgKi9cbiAgcHVibGljIGd1YXJkcmFpbFZlcnNpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IHVzZWQgdG8gZW5jcnlwdCBkYXRhLlxuICAgKlxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWQgLSBcIkRhdGEgaXMgZW5jcnlwdGVkIGJ5IGRlZmF1bHQgd2l0aCBhIGtleSB0aGF0IEFXUyBvd25zIGFuZCBtYW5hZ2VzIGZvciB5b3VcIlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBUaGUgY29udGVudCBmaWx0ZXJzIGFwcGxpZWQgYnkgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb250ZW50RmlsdGVyczogZmlsdGVycy5Db250ZW50RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgUElJIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHBpaUZpbHRlcnM6IGZpbHRlcnMuUElJRmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgcmVnZXggZmlsdGVycyBhcHBsaWVkIGJ5IHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcmVnZXhGaWx0ZXJzOiBmaWx0ZXJzLlJlZ2V4RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgZGVuaWVkIHRvcGljIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlbmllZFRvcGljczogZmlsdGVycy5Ub3BpY1tdO1xuICAvKipcbiAgICogVGhlIGNvbnRleHR1YWwgZ3JvdW5kaW5nIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzOiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSB3b3JkIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHdvcmRGaWx0ZXJzOiBmaWx0ZXJzLldvcmRGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSBtYW5hZ2VkIHdvcmQgbGlzdCBmaWx0ZXJzIGFwcGxpZWQgYnkgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBtYW5hZ2VkV29yZExpc3RGaWx0ZXJzOiBmaWx0ZXJzLk1hbmFnZWRXb3JkRmlsdGVyW107XG4gIC8qKlxuICAgKiBXaGVuIHRoaXMgZ3VhcmRyYWlsIHdhcyBsYXN0IHVwZGF0ZWRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBsYXN0VXBkYXRlZD86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBjb21wdXRlZCBoYXNoIG9mIHRoZSBndWFyZHJhaWwgcHJvcGVydGllcy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBoYXNoOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgTDEgcmVwcmVzZW50YXRpb24gb2YgdGhlIGd1YXJkcmFpbFxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBiZWRyb2NrLkNmbkd1YXJkcmFpbDtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogR3VhcmRyYWlsUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHtcbiAgICAgIHBoeXNpY2FsTmFtZTogcHJvcHMubmFtZSxcbiAgICB9KTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIG9yIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5uYW1lID0gdGhpcy5waHlzaWNhbE5hbWU7XG4gICAgdGhpcy5jb250ZW50RmlsdGVycyA9IHByb3BzLmNvbnRlbnRGaWx0ZXJzID8/IFtdO1xuICAgIHRoaXMucGlpRmlsdGVycyA9IHByb3BzLnBpaUZpbHRlcnMgPz8gW107XG4gICAgdGhpcy5yZWdleEZpbHRlcnMgPSBwcm9wcy5yZWdleEZpbHRlcnMgPz8gW107XG4gICAgdGhpcy5kZW5pZWRUb3BpY3MgPSBwcm9wcy5kZW5pZWRUb3BpY3MgPz8gW107XG4gICAgdGhpcy5jb250ZXh0dWFsR3JvdW5kaW5nRmlsdGVycyA9IHByb3BzLmNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzID8/IFtdO1xuICAgIHRoaXMud29yZEZpbHRlcnMgPSBwcm9wcy53b3JkRmlsdGVycyA/PyBbXTtcbiAgICB0aGlzLm1hbmFnZWRXb3JkTGlzdEZpbHRlcnMgPSBwcm9wcy5tYW5hZ2VkV29yZExpc3RGaWx0ZXJzID8/IFtdO1xuXG4gICAgY29uc3QgZGVmYXVsdEJsb2NrZWRJbnB1dE1lc3NhZ2luZyA9ICdTb3JyeSwgeW91ciBxdWVyeSB2aW9sYXRlcyBvdXIgdXNhZ2UgcG9saWN5Lic7XG4gICAgY29uc3QgZGVmYXVsdEJsb2NrZWRPdXRwdXRzTWVzc2FnaW5nID0gJ1NvcnJ5LCBJIGFtIHVuYWJsZSB0byBhbnN3ZXIgeW91ciBxdWVzdGlvbiBiZWNhdXNlIG9mIG91ciB1c2FnZSBwb2xpY3kuJztcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIENGTiBQcm9wcyAtIFdpdGggTGF6eSBzdXBwb3J0XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgbGV0IGNmblByb3BzOiBiZWRyb2NrLkNmbkd1YXJkcmFpbFByb3BzID0ge1xuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAga21zS2V5QXJuOiBwcm9wcy5rbXNLZXk/LmtleUFybixcbiAgICAgIGJsb2NrZWRJbnB1dE1lc3NhZ2luZzogcHJvcHMuYmxvY2tlZElucHV0TWVzc2FnaW5nID8/IGRlZmF1bHRCbG9ja2VkSW5wdXRNZXNzYWdpbmcsXG4gICAgICBibG9ja2VkT3V0cHV0c01lc3NhZ2luZzogcHJvcHMuYmxvY2tlZE91dHB1dHNNZXNzYWdpbmcgPz8gZGVmYXVsdEJsb2NrZWRPdXRwdXRzTWVzc2FnaW5nLFxuICAgICAgLy8gTGF6eSBwcm9wc1xuICAgICAgY29udGVudFBvbGljeUNvbmZpZzogdGhpcy5nZW5lcmF0ZUNmbkNvbnRlbnRQb2xpY3lDb25maWcoKSxcbiAgICAgIGNvbnRleHR1YWxHcm91bmRpbmdQb2xpY3lDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5Db250ZXh0dWFsUG9saWN5Q29uZmlnKCksXG4gICAgICB0b3BpY1BvbGljeUNvbmZpZzogdGhpcy5nZW5lcmF0ZUNmblRvcGljUG9saWN5KCksXG4gICAgICB3b3JkUG9saWN5Q29uZmlnOiB0aGlzLmdlbmVyYXRlQ2ZuV29yZFBvbGljeUNvbmZpZygpLFxuICAgICAgc2Vuc2l0aXZlSW5mb3JtYXRpb25Qb2xpY3lDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5TZW5zaXRpdmVJbmZvcm1hdGlvblBvbGljeUNvbmZpZygpLFxuICAgIH07XG5cbiAgICAvLyBIYXNoIGNhbGN1bGF0aW9uIHVzZWZ1bCBmb3IgdmVyc2lvbmluZyBvZiB0aGUgZ3VhcmRyYWlsXG4gICAgdGhpcy5oYXNoID0gbWQ1aGFzaChKU09OLnN0cmluZ2lmeShjZm5Qcm9wcykpO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTDEgSW5zdGFudGlhdGlvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuX19yZXNvdXJjZSA9IG5ldyBiZWRyb2NrLkNmbkd1YXJkcmFpbCh0aGlzLCAnTXlHdWFyZHJhaWwnLCBjZm5Qcm9wcyk7XG5cbiAgICB0aGlzLmd1YXJkcmFpbElkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJHdWFyZHJhaWxJZDtcbiAgICB0aGlzLmd1YXJkcmFpbEFybiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyR3VhcmRyYWlsQXJuO1xuICAgIHRoaXMuZ3VhcmRyYWlsVmVyc2lvbiA9IHRoaXMuX19yZXNvdXJjZS5hdHRyVmVyc2lvbjtcbiAgICB0aGlzLmxhc3RVcGRhdGVkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJVcGRhdGVkQXQ7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTUVUSE9EU1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIEFkZHMgYSBjb250ZW50IGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBjb250ZW50IGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkQ29udGVudEZpbHRlcihmaWx0ZXI6IGZpbHRlcnMuQ29udGVudEZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMuY29udGVudEZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBQSUkgZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIFBJSSBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZFBJSUZpbHRlcihmaWx0ZXI6IGZpbHRlcnMuUElJRmlsdGVyKTogdm9pZCB7XG4gICAgdGhpcy5waWlGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgcmVnZXggZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIHJlZ2V4IGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkUmVnZXhGaWx0ZXIoZmlsdGVyOiBmaWx0ZXJzLlJlZ2V4RmlsdGVyKTogdm9pZCB7XG4gICAgdGhpcy5yZWdleEZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBkZW5pZWQgdG9waWMgZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIGRlbmllZCB0b3BpYyBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZERlbmllZFRvcGljRmlsdGVyKGZpbHRlcjogZmlsdGVycy5Ub3BpYyk6IHZvaWQge1xuICAgIHRoaXMuZGVuaWVkVG9waWNzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgY29udGV4dHVhbCBncm91bmRpbmcgZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIGNvbnRleHR1YWwgZ3JvdW5kaW5nIGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkQ29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcihmaWx0ZXI6IGZpbHRlcnMuQ29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMuY29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSB3b3JkIGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSB3b3JkIGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkV29yZEZpbHRlcihmaWx0ZXI6IGZpbHRlcnMuV29yZEZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMud29yZEZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSB3b3JkIGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsZVBhdGggVGhlIGxvY2F0aW9uIG9mIHRoZSB3b3JkIGZpbHRlciBmaWxlLlxuICAgKi9cbiAgcHVibGljIGFkZFdvcmRGaWx0ZXJGcm9tRmlsZShmaWxlUGF0aDogc3RyaW5nLFxuICAgIGlucHV0QWN0aW9uPzogZmlsdGVycy5HdWFyZHJhaWxBY3Rpb24sXG4gICAgb3V0cHV0QWN0aW9uPzogZmlsdGVycy5HdWFyZHJhaWxBY3Rpb24sXG4gICAgaW5wdXRFbmFibGVkPzogYm9vbGVhbixcbiAgICBvdXRwdXRFbmFibGVkPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGNvbnN0IGZpbGVDb250ZW50cyA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCB3b3JkcyA9IGZpbGVDb250ZW50cy50cmltKCkuc3BsaXQoJywnKTtcbiAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygd29yZHMpIHRoaXMuYWRkV29yZEZpbHRlcih7IHRleHQ6IHdvcmQsIGlucHV0QWN0aW9uLCBvdXRwdXRBY3Rpb24sIGlucHV0RW5hYmxlZCwgb3V0cHV0RW5hYmxlZCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgbWFuYWdlZCB3b3JkIGxpc3QgZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIG1hbmFnZWQgd29yZCBsaXN0IGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkTWFuYWdlZFdvcmRMaXN0RmlsdGVyKGZpbHRlcjogZmlsdGVycy5NYW5hZ2VkV29yZEZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMubWFuYWdlZFdvcmRMaXN0RmlsdGVycy5wdXNoKGZpbHRlcik7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgdmVyc2lvbiBmb3IgdGhlIGd1YXJkcmFpbC5cbiAgICogQHBhcmFtIGRlc2NyaXB0aW9uIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgdmVyc2lvbi5cbiAgICogQHJldHVybnMgVGhlIGd1YXJkcmFpbCB2ZXJzaW9uLlxuICAgKi9cbiAgcHVibGljIGNyZWF0ZVZlcnNpb24oZGVzY3JpcHRpb24/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNmblZlcnNpb24gPSBuZXcgYmVkcm9jay5DZm5HdWFyZHJhaWxWZXJzaW9uKHRoaXMsIGBHdWFyZHJhaWxWZXJzaW9uLSR7dGhpcy5oYXNoLnNsaWNlKDAsIDE2KX1gLCB7XG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXG4gICAgICBndWFyZHJhaWxJZGVudGlmaWVyOiB0aGlzLmd1YXJkcmFpbElkLFxuICAgIH0pO1xuXG4gICAgdGhpcy5ndWFyZHJhaWxWZXJzaW9uID0gY2ZuVmVyc2lvbi5hdHRyVmVyc2lvbjtcbiAgICByZXR1cm4gdGhpcy5ndWFyZHJhaWxWZXJzaW9uO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENGTiBHZW5lcmF0b3JzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29udGVudCBmaWx0ZXJzIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmbkNvbnRlbnRQb2xpY3lDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueSh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRGaWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4geyBmaWx0ZXJzQ29uZmlnOiB0aGlzLmNvbnRlbnRGaWx0ZXJzIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuQ29udGVudFBvbGljeUNvbmZpZ1Byb3BlcnR5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG9waWMgZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5Ub3BpY1BvbGljeSgpOiBJUmVzb2x2YWJsZSB7XG4gICAgcmV0dXJuIExhenkuYW55KHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuZGVuaWVkVG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG9waWNzQ29uZmlnOiB0aGlzLmRlbmllZFRvcGljcy5mbGF0TWFwKCh0b3BpYzogZmlsdGVycy5Ub3BpYykgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRlZmluaXRpb246IHRvcGljLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgbmFtZTogdG9waWMubmFtZSxcbiAgICAgICAgICAgICAgICBleGFtcGxlczogdG9waWMuZXhhbXBsZXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTlknLFxuICAgICAgICAgICAgICB9IGFzIGJlZHJvY2suQ2ZuR3VhcmRyYWlsLlRvcGljQ29uZmlnUHJvcGVydHk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY29udGVjdHVhbCBmaWx0ZXJzIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmbkNvbnRleHR1YWxQb2xpY3lDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueSh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZmlsdGVyc0NvbmZpZzogdGhpcy5jb250ZXh0dWFsR3JvdW5kaW5nRmlsdGVycy5mbGF0TWFwKChmaWx0ZXI6IGZpbHRlcnMuQ29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6IGZpbHRlci50eXBlLFxuICAgICAgICAgICAgICAgIHRocmVzaG9sZDogZmlsdGVyLnRocmVzaG9sZCxcbiAgICAgICAgICAgICAgfSBhcyBiZWRyb2NrLkNmbkd1YXJkcmFpbC5Db250ZXh0dWFsR3JvdW5kaW5nRmlsdGVyQ29uZmlnUHJvcGVydHk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgd29yZCBjb25maWcgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuV29yZFBvbGljeUNvbmZpZygpOiBJUmVzb2x2YWJsZSB7XG4gICAgcmV0dXJuIExhenkuYW55KHtcbiAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMud29yZEZpbHRlcnMubGVuZ3RoID4gMCB8fCB0aGlzLm1hbmFnZWRXb3JkTGlzdEZpbHRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3b3Jkc0NvbmZpZzogdGhpcy5nZW5lcmF0ZUNmbldvcmRDb25maWcoKSxcbiAgICAgICAgICAgIG1hbmFnZWRXb3JkTGlzdHNDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5NYW5hZ2VkV29yZExpc3RzQ29uZmlnKCksXG4gICAgICAgICAgfSBhcyBiZWRyb2NrLkNmbkd1YXJkcmFpbC5Xb3JkUG9saWN5Q29uZmlnUHJvcGVydHk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSB3b3JkIGZpbHRlcnMgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuV29yZENvbmZpZygpOiBJUmVzb2x2YWJsZSB7XG4gICAgcmV0dXJuIExhenkuYW55KFxuICAgICAge1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMud29yZEZpbHRlcnMuZmxhdE1hcCgod29yZDogZmlsdGVycy5Xb3JkRmlsdGVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0ZXh0OiB3b3JkLnRleHQsXG4gICAgICAgICAgICAgIGlucHV0QWN0aW9uOiB3b3JkLmlucHV0QWN0aW9uLFxuICAgICAgICAgICAgICBpbnB1dEVuYWJsZWQ6IHdvcmQuaW5wdXRFbmFibGVkLFxuICAgICAgICAgICAgICBvdXRwdXRBY3Rpb246IHdvcmQub3V0cHV0QWN0aW9uLFxuICAgICAgICAgICAgICBvdXRwdXRFbmFibGVkOiB3b3JkLm91dHB1dEVuYWJsZWQsXG4gICAgICAgICAgICB9IGFzIGJlZHJvY2suQ2ZuR3VhcmRyYWlsLldvcmRDb25maWdQcm9wZXJ0eTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSB3b3JkIGZpbHRlcnMgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuTWFuYWdlZFdvcmRMaXN0c0NvbmZpZygpOiBJUmVzb2x2YWJsZSB7XG4gICAgcmV0dXJuIExhenkuYW55KFxuICAgICAge1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMubWFuYWdlZFdvcmRMaXN0RmlsdGVycy5mbGF0TWFwKChmaWx0ZXI6IGZpbHRlcnMuTWFuYWdlZFdvcmRGaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHR5cGU6IGZpbHRlci50eXBlLFxuICAgICAgICAgICAgICBpbnB1dEFjdGlvbjogZmlsdGVyLmlucHV0QWN0aW9uLFxuICAgICAgICAgICAgICBpbnB1dEVuYWJsZWQ6IGZpbHRlci5pbnB1dEVuYWJsZWQsXG4gICAgICAgICAgICAgIG91dHB1dEFjdGlvbjogZmlsdGVyLm91dHB1dEFjdGlvbixcbiAgICAgICAgICAgICAgb3V0cHV0RW5hYmxlZDogZmlsdGVyLm91dHB1dEVuYWJsZWQsXG4gICAgICAgICAgICB9IGFzIGJlZHJvY2suQ2ZuR3VhcmRyYWlsLk1hbmFnZWRXb3Jkc0NvbmZpZ1Byb3BlcnR5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHsgb21pdEVtcHR5QXJyYXk6IHRydWUgfSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHNlbnNpdGl2ZSBpbmZvcm1hdGlvbiBjb25maWcgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuU2Vuc2l0aXZlSW5mb3JtYXRpb25Qb2xpY3lDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueShcbiAgICAgIHtcbiAgICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnJlZ2V4RmlsdGVycy5sZW5ndGggPiAwIHx8IHRoaXMucGlpRmlsdGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICByZWdleGVzQ29uZmlnOiB0aGlzLmdlbmVyYXRlQ2ZuUmVnZXhlc0NvbmZpZygpLFxuICAgICAgICAgICAgICBwaWlFbnRpdGllc0NvbmZpZzogdGhpcy5nZW5lcmF0ZUNmblBpaUVudGl0aWVzQ29uZmlnKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSByZWdleCBmaWx0ZXJzIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmblJlZ2V4ZXNDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueShcbiAgICAgIHtcbiAgICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlZ2V4RmlsdGVycy5mbGF0TWFwKChyZWdleDogZmlsdGVycy5SZWdleEZpbHRlcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbmFtZTogcmVnZXgubmFtZSxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlZ2V4LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICBwYXR0ZXJuOiByZWdleC5wYXR0ZXJuLFxuICAgICAgICAgICAgICBhY3Rpb246IHJlZ2V4LmFjdGlvbixcbiAgICAgICAgICAgIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuUmVnZXhDb25maWdQcm9wZXJ0eTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBQaWkgZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5QaWlFbnRpdGllc0NvbmZpZygpOiBJUmVzb2x2YWJsZSB7XG4gICAgcmV0dXJuIExhenkuYW55KFxuICAgICAge1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucGlpRmlsdGVycy5mbGF0TWFwKChmaWx0ZXI6IGZpbHRlcnMuUElJRmlsdGVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0eXBlOiBmaWx0ZXIudHlwZSxcbiAgICAgICAgICAgICAgYWN0aW9uOiBmaWx0ZXIuYWN0aW9uLFxuICAgICAgICAgICAgfSBhcyBiZWRyb2NrLkNmbkd1YXJkcmFpbC5QaWlFbnRpdHlDb25maWdQcm9wZXJ0eTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0sXG4gICAgKTtcbiAgfVxufVxuIl19