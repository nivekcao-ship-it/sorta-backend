"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KendraGenAiIndex = exports.KendraGenAiIndexBase = exports.Kendra = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const kendra = require("aws-cdk-lib/aws-kendra");
const utils_1 = require("../../common/helpers/utils");
var Kendra;
(function (Kendra) {
    /**
     * Represents an Amazon Kendra Index Edition.
     */
    let Edition;
    (function (Edition) {
        Edition["DEVELOPER_EDITION"] = "DEVELOPER_EDITION";
        Edition["ENTERPRISE_EDITION"] = "ENTERPRISE_EDITION";
        Edition["GEN_AI_ENTERPRISE_EDITION"] = "GEN_AI_ENTERPRISE_EDITION";
    })(Edition = Kendra.Edition || (Kendra.Edition = {}));
    /**
     * Represents an Amazon Kendra Index Field Type.
     */
    let IndexFieldTypes;
    (function (IndexFieldTypes) {
        IndexFieldTypes["STRING"] = "STRING_VALUE";
        IndexFieldTypes["STRING_LIST"] = "STRING_LIST_VALUE";
        IndexFieldTypes["LONG"] = "LONG_VALUE";
        IndexFieldTypes["DATE"] = "DATE_VALUE";
    })(IndexFieldTypes = Kendra.IndexFieldTypes || (Kendra.IndexFieldTypes = {}));
    /**
     * The different policies available to filter search results based on user context.
     */
    let UserContextPolicy;
    (function (UserContextPolicy) {
        /** All indexed content is searchable and displayable for all users.
         * If you want to filter search results on user context, you can use
         * the attribute filters of _user_id and _group_ids or you can provide
         * user and group information in UserContext . */
        UserContextPolicy["ATTRIBUTE_FILTER"] = "ATTRIBUTE_FILTER";
        /**
         * Enables token-based user access control to filter search results on
         * user context. All documents with no access control and all documents
         * accessible to the user will be searchable and displayable.
         */
        UserContextPolicy["USER_TOKEN"] = "USER_TOKEN";
    })(UserContextPolicy = Kendra.UserContextPolicy || (Kendra.UserContextPolicy = {}));
})(Kendra || (exports.Kendra = Kendra = {}));
/******************************************************************************
 *                              COMMON
 *****************************************************************************/
/**
 * Abstract base class for a Kendra GenAI index.
 * Contains methods and attributes valid for Kendra GenAI Indexes either created with CDK or imported.
 */
class KendraGenAiIndexBase extends aws_cdk_lib_1.Resource {
}
exports.KendraGenAiIndexBase = KendraGenAiIndexBase;
_a = JSII_RTTI_SYMBOL_1;
KendraGenAiIndexBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.kendra.KendraGenAiIndexBase", version: "0.1.309" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create a Kendra GenAI Index with CDK.
 * @cloudformationResource AWS::Kendra::Index
 */
class KendraGenAiIndex extends KendraGenAiIndexBase {
    /**
     * Import a guardrail given its attributes
     */
    static fromAttrs(scope, id, attrs) {
        class Import extends KendraGenAiIndexBase {
            constructor() {
                super(...arguments);
                this.role = attrs.role;
                this.indexId = attrs.indexId;
                this.indexArn = aws_cdk_lib_1.Stack.of(this).formatArn({
                    service: 'kendra',
                    resource: 'index',
                    resourceName: attrs.indexId,
                    arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                });
            }
        }
        return new Import(scope, id);
    }
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * The edition of the Gen AI index
         */
        this.edition = Kendra.Edition.GEN_AI_ENTERPRISE_EDITION;
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'genai-index', { maxLength: 40, lower: true, separator: '-' });
        this.documentCapacityUnits = props.documentCapacityUnits ?? 0;
        this.queryCapacityUnits = props.queryCapacityUnits ?? 0;
        this.kmsKey = props.kmsKey;
        // ------------------------------------------------------
        // Role Creation
        // ------------------------------------------------------
        const roleName = (0, utils_1.generatePhysicalNameV2)(this, `AmazonKendraRoleForIndex-${this.name}`, { maxLength: 64 });
        this.role = new iam.Role(this, 'Role', {
            roleName: roleName,
            assumedBy: new iam.ServicePrincipal('kendra.amazonaws.com'),
        });
        this.role.addToPrincipalPolicy(new iam.PolicyStatement({
            actions: ['logs:DescribeLogGroups'],
            resources: ['*'],
        }));
        this.role.addToPrincipalPolicy(new iam.PolicyStatement({
            actions: ['cloudwatch:PutMetricData'],
            resources: ['*'],
            conditions: {
                StringEquals: {
                    'cloudwatch:namespace': 'AWS/Kendra',
                },
            },
        }));
        this.role.addToPrincipalPolicy(new iam.PolicyStatement({
            actions: ['logs:CreateLogGroup'],
            resources: [
                aws_cdk_lib_1.Stack.of(this).formatArn({
                    service: 'logs',
                    resource: 'log-group',
                    resourceName: '/aws/kendra/*',
                    arnFormat: aws_cdk_lib_1.ArnFormat.COLON_RESOURCE_NAME,
                }),
            ],
        }));
        this.role.addToPrincipalPolicy(new iam.PolicyStatement({
            actions: ['logs:DescribeLogStreams', 'logs:CreateLogStream', 'logs:PutLogEvents'],
            resources: [
                aws_cdk_lib_1.Stack.of(this).formatArn({
                    service: 'logs',
                    resource: 'log-group',
                    resourceName: '/aws/kendra/*:log-stream:*',
                    arnFormat: aws_cdk_lib_1.ArnFormat.COLON_RESOURCE_NAME,
                }),
            ],
        }));
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this._resource = new kendra.CfnIndex(this, 'GenAiIndex', {
            name: this.name,
            edition: Kendra.Edition.GEN_AI_ENTERPRISE_EDITION,
            roleArn: this.role.roleArn,
            serverSideEncryptionConfiguration: props.kmsKey
                ? {
                    kmsKeyId: props.kmsKey.keyId,
                }
                : undefined,
            capacityUnits: {
                storageCapacityUnits: this.documentCapacityUnits,
                queryCapacityUnits: this.queryCapacityUnits,
            },
            userContextPolicy: Kendra.UserContextPolicy.ATTRIBUTE_FILTER,
        });
        this.indexArn = this._resource.attrArn;
        this.indexId = this._resource.attrId;
    }
}
exports.KendraGenAiIndex = KendraGenAiIndex;
_b = JSII_RTTI_SYMBOL_1;
KendraGenAiIndex[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.kendra.KendraGenAiIndex", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuLWFpLWluZGV4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2Nkay1saWIva2VuZHJhL2dlbi1haS1pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQW9FO0FBQ3BFLDJDQUEyQztBQUMzQyxpREFBaUQ7QUFHakQsc0RBQW9FO0FBOEJwRSxJQUFpQixNQUFNLENBb0N0QjtBQXBDRCxXQUFpQixNQUFNO0lBQ3JCOztPQUVHO0lBQ0gsSUFBWSxPQUlYO0lBSkQsV0FBWSxPQUFPO1FBQ2pCLGtEQUF1QyxDQUFBO1FBQ3ZDLG9EQUF5QyxDQUFBO1FBQ3pDLGtFQUF1RCxDQUFBO0lBQ3pELENBQUMsRUFKVyxPQUFPLEdBQVAsY0FBTyxLQUFQLGNBQU8sUUFJbEI7SUFFRDs7T0FFRztJQUNILElBQVksZUFLWDtJQUxELFdBQVksZUFBZTtRQUN6QiwwQ0FBdUIsQ0FBQTtRQUN2QixvREFBaUMsQ0FBQTtRQUNqQyxzQ0FBbUIsQ0FBQTtRQUNuQixzQ0FBbUIsQ0FBQTtJQUNyQixDQUFDLEVBTFcsZUFBZSxHQUFmLHNCQUFlLEtBQWYsc0JBQWUsUUFLMUI7SUFFRDs7T0FFRztJQUNILElBQVksaUJBWVg7SUFaRCxXQUFZLGlCQUFpQjtRQUMzQjs7O3lEQUdpRDtRQUNqRCwwREFBcUMsQ0FBQTtRQUNyQzs7OztXQUlHO1FBQ0gsOENBQXlCLENBQUE7SUFDM0IsQ0FBQyxFQVpXLGlCQUFpQixHQUFqQix3QkFBaUIsS0FBakIsd0JBQWlCLFFBWTVCO0FBQ0gsQ0FBQyxFQXBDZ0IsTUFBTSxzQkFBTixNQUFNLFFBb0N0QjtBQXFERDs7K0VBRStFO0FBQy9FOzs7R0FHRztBQUNILE1BQXNCLG9CQUFxQixTQUFRLHNCQUFROztBQUEzRCxvREFJQzs7O0FBRUQ7OytFQUUrRTtBQUMvRTs7O0dBR0c7QUFDSCxNQUFhLGdCQUFpQixTQUFRLG9CQUFvQjtJQUN4RDs7T0FFRztJ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QkFBaUIsQ0FBQyxnQkFBZ0I7U0FDN0QsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztRQUN2QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO0lBQ3ZDLENBQUM7O0FBeklILDRDQTBJQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFybkZvcm1hdCwgSVJlc291cmNlLCBSZXNvdXJjZSwgU3RhY2sgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBrZW5kcmEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWtlbmRyYSc7XG5pbXBvcnQgeyBJS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBLZW5kcmEgSW5kZXgsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElLZW5kcmFHZW5BaUluZGV4IGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBBbWF6b24gUmVzb3VyY2UgTmFtZSAoQVJOKSBvZiB0aGUgaW5kZXguXG4gICAqIEBleGFtcGxlICdhcm46YXdzOmtlbmRyYTp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmluZGV4L2FmMDRjN2VhLTIyYmMtNDZiNy1hNjVlLTZjMjFlNjA0ZmMxMSdcbiAgICovXG4gIHJlYWRvbmx5IGluZGV4QXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBpbmRleC5cbiAgICogQGV4YW1wbGUgJ2FmMDRjN2VhLTIyYmMtNDZiNy1hNjVlLTZjMjFlNjA0ZmMxMScuXG4gICAqL1xuICByZWFkb25seSBpbmRleElkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFuIElBTSByb2xlIHRoYXQgZ2l2ZXMgQW1hem9uIEtlbmRyYSBwZXJtaXNzaW9ucyB0byBhY2Nlc3NcbiAgICogeW91ciBBbWF6b24gQ2xvdWRXYXRjaCBsb2dzIGFuZCBtZXRyaWNzLiBUaGlzIGlzIGFsc28gdGhlXG4gICAqIHJvbGUgdXNlZCB3aGVuIHlvdSB1c2UgdGhlIEJhdGNoUHV0RG9jdW1lbnQgb3BlcmF0aW9uIHRvIGluZGV4XG4gICAqIGRvY3VtZW50cyBmcm9tIGFuIEFtYXpvbiBTMyBidWNrZXQuXG4gICAqL1xuICByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgS2VuZHJhIHtcbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgYW4gQW1hem9uIEtlbmRyYSBJbmRleCBFZGl0aW9uLlxuICAgKi9cbiAgZXhwb3J0IGVudW0gRWRpdGlvbiB7XG4gICAgREVWRUxPUEVSX0VESVRJT04gPSAnREVWRUxPUEVSX0VESVRJT04nLFxuICAgIEVOVEVSUFJJU0VfRURJVElPTiA9ICdFTlRFUlBSSVNFX0VESVRJT04nLFxuICAgIEdFTl9BSV9FTlRFUlBSSVNFX0VESVRJT04gPSAnR0VOX0FJX0VOVEVSUFJJU0VfRURJVElPTicsXG4gIH1cblxuICAvKipcbiAgICogUmVwcmVzZW50cyBhbiBBbWF6b24gS2VuZHJhIEluZGV4IEZpZWxkIFR5cGUuXG4gICAqL1xuICBleHBvcnQgZW51bSBJbmRleEZpZWxkVHlwZXMge1xuICAgIFNUUklORyA9ICdTVFJJTkdfVkFMVUUnLFxuICAgIFNUUklOR19MSVNUID0gJ1NUUklOR19MSVNUX1ZBTFVFJyxcbiAgICBMT05HID0gJ0xPTkdfVkFMVUUnLFxuICAgIERBVEUgPSAnREFURV9WQUxVRScsXG4gIH1cblxuICAvKipcbiAgICogVGhlIGRpZmZlcmVudCBwb2xpY2llcyBhdmFpbGFibGUgdG8gZmlsdGVyIHNlYXJjaCByZXN1bHRzIGJhc2VkIG9uIHVzZXIgY29udGV4dC5cbiAgICovXG4gIGV4cG9ydCBlbnVtIFVzZXJDb250ZXh0UG9saWN5IHtcbiAgICAvKiogQWxsIGluZGV4ZWQgY29udGVudCBpcyBzZWFyY2hhYmxlIGFuZCBkaXNwbGF5YWJsZSBmb3IgYWxsIHVzZXJzLlxuICAgICAqIElmIHlvdSB3YW50IHRvIGZpbHRlciBzZWFyY2ggcmVzdWx0cyBvbiB1c2VyIGNvbnRleHQsIHlvdSBjYW4gdXNlXG4gICAgICogdGhlIGF0dHJpYnV0ZSBmaWx0ZXJzIG9mIF91c2VyX2lkIGFuZCBfZ3JvdXBfaWRzIG9yIHlvdSBjYW4gcHJvdmlkZVxuICAgICAqIHVzZXIgYW5kIGdyb3VwIGluZm9ybWF0aW9uIGluIFVzZXJDb250ZXh0IC4gKi9cbiAgICBBVFRSSUJVVEVfRklMVEVSID0gJ0FUVFJJQlVURV9GSUxURVInLFxuICAgIC8qKlxuICAgICAqIEVuYWJsZXMgdG9rZW4tYmFzZWQgdXNlciBhY2Nlc3MgY29udHJvbCB0byBmaWx0ZXIgc2VhcmNoIHJlc3VsdHMgb25cbiAgICAgKiB1c2VyIGNvbnRleHQuIEFsbCBkb2N1bWVudHMgd2l0aCBubyBhY2Nlc3MgY29udHJvbCBhbmQgYWxsIGRvY3VtZW50c1xuICAgICAqIGFjY2Vzc2libGUgdG8gdGhlIHVzZXIgd2lsbCBiZSBzZWFyY2hhYmxlIGFuZCBkaXNwbGF5YWJsZS5cbiAgICAgKi9cbiAgICBVU0VSX1RPS0VOID0gJ1VTRVJfVE9LRU4nLFxuICB9XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgUFJPUFMgRk9SIE5FVyBDT05TVFJVQ1RcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogUHJvcGVydGllcyBmb3IgY3JlYXRpbmcgYSBHZW5BSSBJbmRleC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBLZW5kcmFHZW5BaUluZGV4UHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGluZGV4LlxuICAgKiBAZGVmYXVsdCAtIEEgbmFtZSBpcyBnZW5lcmF0ZWQgYnkgQ0RLLlxuICAgKi9cbiAgcmVhZG9ubHkgbmFtZT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBBV1MgS01TIGN1c3RvbWVyIG1hbmFnZWQga2V5IChDTUspIHRvIHVzZVxuICAgKiB0byBlbmNyeXB0IGRhdGEgaW5kZXhlZCBieSBBbWF6b24gS2VuZHJhLiBBbWF6b24gS2VuZHJhIGRvZXNuJ3Qgc3VwcG9ydFxuICAgKiBhc3ltbWV0cmljIENNS3MuXG4gICAqIEBkZWZhdWx0IC0gQVdTIG1hbmFnZWQgZW5jcnlwdGlvbiBrZXkgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBUaGUgZG9jdW1lbnQgY2FwYWNpdHkgdW5pdHMuIEV2ZXJ5IHVuaXQgaW5jcmVhc2VzIHRoZSBiYXNlbGluZSBjYXBhY2l0eSBieSAyMCwwMDAgZG9jdW1lbnRzLlxuICAgKiBFLmcuIGBkb2N1bWVudENhcGFjaXR5VW5pdHM6IDFgIG1lYW5zIEJhc2VsaW5lICsgMjAsMDAwIGRvY3VtZW50cyA9IDQwLDAwMCBkb2N1bWVudHNcbiAgICogQGRlZmF1bHQgMCAtIGJhc2VsaW5lIGNhcGFjaXR5IG9mIDIwLDAwMCBkb2N1bWVudHNcbiAgICovXG4gIHJlYWRvbmx5IGRvY3VtZW50Q2FwYWNpdHlVbml0cz86IG51bWJlcjtcbiAgLyoqXG4gICAqIFRoZSBxdWVyeSBjYXBhY2l0eSB1bml0cy4gRXZlcnkgdW5pdCBpbmNyZWFzZXMgdGhlIGJhc2VsaW5lIGNhcGFjaXR5IGJ5IDAuMSBRUFMuXG4gICAqIEUuZy4gYHF1ZXJ5Q2FwYWNpdHlVbml0czogN2AgbWVhbnMgQmFzZWxpbmUgKyAwLjEgUVBTICogNyA9IDAuOCBRUFNcbiAgICogQGRlZmF1bHQgMCAtIGJhc2VsaW5lIGNhcGFjaXR5IG9mIDAuMSBRUFNcbiAgICovXG4gIHJlYWRvbmx5IHF1ZXJ5Q2FwYWNpdHlVbml0cz86IG51bWJlcjtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgQVRUUlMgRk9SIElNUE9SVEVEIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBQcm9wZXJ0aWVzIG5lZWRlZCBmb3IgaW1wb3J0aW5nIGFuIGV4aXN0aW5nIEtlbmRyYSBJbmRleC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBLZW5kcmFHZW5BaUluZGV4QXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgSWQgb2YgdGhlIGluZGV4LlxuICAgKiBAZXhhbXBsZSAnYWYwNGM3ZWEtMjJiYy00NmI3LWE2NWUtNmMyMWU2MDRmYzExJ1xuICAgKi9cbiAgcmVhZG9ubHkgaW5kZXhJZDogc3RyaW5nO1xuICAvKipcbiAgICogQW4gSUFNIHJvbGUgdGhhdCBnaXZlcyB5b3VyIEFtYXpvbiBLZW5kcmEgaW5kZXggcGVybWlzc2lvbnMuXG4gICAqL1xuICByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGEgS2VuZHJhIEdlbkFJIGluZGV4LlxuICogQ29udGFpbnMgbWV0aG9kcyBhbmQgYXR0cmlidXRlcyB2YWxpZCBmb3IgS2VuZHJhIEdlbkFJIEluZGV4ZXMgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBLZW5kcmFHZW5BaUluZGV4QmFzZSBleHRlbmRzIFJlc291cmNlIGltcGxlbWVudHMgSUtlbmRyYUdlbkFpSW5kZXgge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgaW5kZXhBcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGluZGV4SWQ6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBORVcgQ09OU1RSVUNUIERFRklOSVRJT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQ2xhc3MgdG8gY3JlYXRlIGEgS2VuZHJhIEdlbkFJIEluZGV4IHdpdGggQ0RLLlxuICogQGNsb3VkZm9ybWF0aW9uUmVzb3VyY2UgQVdTOjpLZW5kcmE6OkluZGV4XG4gKi9cbmV4cG9ydCBjbGFzcyBLZW5kcmFHZW5BaUluZGV4IGV4dGVuZHMgS2VuZHJhR2VuQWlJbmRleEJhc2Uge1xuICAvKipcbiAgICogSW1wb3J0IGEgZ3VhcmRyYWlsIGdpdmVuIGl0cyBhdHRyaWJ1dGVzXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21BdHRycyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogS2VuZHJhR2VuQWlJbmRleEF0dHJpYnV0ZXMpOiBJS2VuZHJhR2VuQWlJbmRleCB7XG4gICAgY2xhc3MgSW1wb3J0IGV4dGVuZHMgS2VuZHJhR2VuQWlJbmRleEJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IHJvbGUgPSBhdHRycy5yb2xlO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluZGV4SWQgPSBhdHRycy5pbmRleElkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluZGV4QXJuID0gU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgc2VydmljZTogJ2tlbmRyYScsXG4gICAgICAgIHJlc291cmNlOiAnaW5kZXgnLFxuICAgICAgICByZXNvdXJjZU5hbWU6IGF0dHJzLmluZGV4SWQsXG4gICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbXBvcnQoc2NvcGUsIGlkKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcm9wZXJ0aWVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBpbmhlcml0ZWRcbiAgcHVibGljIHJlYWRvbmx5IGluZGV4QXJuOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBpbmRleElkOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG5cbiAgLyoqXG4gICAqIFRoZSBlZGl0aW9uIG9mIHRoZSBHZW4gQUkgaW5kZXhcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBlZGl0aW9uOiBLZW5kcmEuRWRpdGlvbiA9IEtlbmRyYS5FZGl0aW9uLkdFTl9BSV9FTlRFUlBSSVNFX0VESVRJT047XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgR2VuIEFJIGluZGV4XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFXUyBLTVMga2V5IChDTUspIHVzZWQgdG8gZW5jcnlwdCBkYXRhXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIFRoZSBkb2N1bWVudCBjYXBhY2l0eSB1bml0cyB1c2VkIGZvciB0aGUgR2VuIEFJIGluZGV4XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZG9jdW1lbnRDYXBhY2l0eVVuaXRzOiBudW1iZXI7XG4gIC8qKlxuICAgKiBUaGUgcXVlcnkgY2FwYWNpdHkgdW5pdHMgdXNlZCBmb3IgdGhlIEdlbiBBSSBpbmRleFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHF1ZXJ5Q2FwYWNpdHlVbml0czogbnVtYmVyO1xuICAvKipcbiAgICogVGhlIEwxIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBLZW5kcmEgSW5kZXhcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX3Jlc291cmNlOiBrZW5kcmEuQ2ZuSW5kZXg7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEtlbmRyYUdlbkFpSW5kZXhQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgcHJvcGVydGllcyBvciBkZWZhdWx0c1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMubmFtZSA9XG4gICAgICBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2dlbmFpLWluZGV4JywgeyBtYXhMZW5ndGg6IDQwLCBsb3dlcjogdHJ1ZSwgc2VwYXJhdG9yOiAnLScgfSk7XG5cbiAgICB0aGlzLmRvY3VtZW50Q2FwYWNpdHlVbml0cyA9IHByb3BzLmRvY3VtZW50Q2FwYWNpdHlVbml0cyA/PyAwO1xuICAgIHRoaXMucXVlcnlDYXBhY2l0eVVuaXRzID0gcHJvcHMucXVlcnlDYXBhY2l0eVVuaXRzID8/IDA7XG4gICAgdGhpcy5rbXNLZXkgPSBwcm9wcy5rbXNLZXk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBSb2xlIENyZWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgY29uc3Qgcm9sZU5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsIGBBbWF6b25LZW5kcmFSb2xlRm9ySW5kZXgtJHt0aGlzLm5hbWV9YCwgeyBtYXhMZW5ndGg6IDY0IH0pO1xuICAgIHRoaXMucm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnUm9sZScsIHtcbiAgICAgIHJvbGVOYW1lOiByb2xlTmFtZSxcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdrZW5kcmEuYW1hem9uYXdzLmNvbScpLFxuICAgIH0pO1xuICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydsb2dzOkRlc2NyaWJlTG9nR3JvdXBzJ10sXG4gICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICB9KSxcbiAgICApO1xuICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydjbG91ZHdhdGNoOlB1dE1ldHJpY0RhdGEnXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2Nsb3Vkd2F0Y2g6bmFtZXNwYWNlJzogJ0FXUy9LZW5kcmEnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICApO1xuICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydsb2dzOkNyZWF0ZUxvZ0dyb3VwJ10sXG4gICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgIFN0YWNrLm9mKHRoaXMpLmZvcm1hdEFybih7XG4gICAgICAgICAgICBzZXJ2aWNlOiAnbG9ncycsXG4gICAgICAgICAgICByZXNvdXJjZTogJ2xvZy1ncm91cCcsXG4gICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcvYXdzL2tlbmRyYS8qJyxcbiAgICAgICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgfSksXG4gICAgICAgIF0sXG4gICAgICB9KSxcbiAgICApO1xuICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydsb2dzOkRlc2NyaWJlTG9nU3RyZWFtcycsICdsb2dzOkNyZWF0ZUxvZ1N0cmVhbScsICdsb2dzOlB1dExvZ0V2ZW50cyddLFxuICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICBTdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgc2VydmljZTogJ2xvZ3MnLFxuICAgICAgICAgICAgcmVzb3VyY2U6ICdsb2ctZ3JvdXAnLFxuICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnL2F3cy9rZW5kcmEvKjpsb2ctc3RyZWFtOionLFxuICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuQ09MT05fUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fcmVzb3VyY2UgPSBuZXcga2VuZHJhLkNmbkluZGV4KHRoaXMsICdHZW5BaUluZGV4Jywge1xuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgZWRpdGlvbjogS2VuZHJhLkVkaXRpb24uR0VOX0FJX0VOVEVSUFJJU0VfRURJVElPTixcbiAgICAgIHJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgc2VydmVyU2lkZUVuY3J5cHRpb25Db25maWd1cmF0aW9uOiBwcm9wcy5rbXNLZXlcbiAgICAgICAgPyB7XG4gICAgICAgICAga21zS2V5SWQ6IHByb3BzLmttc0tleS5rZXlJZCxcbiAgICAgICAgfVxuICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIGNhcGFjaXR5VW5pdHM6IHtcbiAgICAgICAgc3RvcmFnZUNhcGFjaXR5VW5pdHM6IHRoaXMuZG9jdW1lbnRDYXBhY2l0eVVuaXRzLFxuICAgICAgICBxdWVyeUNhcGFjaXR5VW5pdHM6IHRoaXMucXVlcnlDYXBhY2l0eVVuaXRzLFxuICAgICAgfSxcbiAgICAgIHVzZXJDb250ZXh0UG9saWN5OiBLZW5kcmEuVXNlckNvbnRleHRQb2xpY3kuQVRUUklCVVRFX0ZJTFRFUixcbiAgICB9KTtcblxuICAgIHRoaXMuaW5kZXhBcm4gPSB0aGlzLl9yZXNvdXJjZS5hdHRyQXJuO1xuICAgIHRoaXMuaW5kZXhJZCA9IHRoaXMuX3Jlc291cmNlLmF0dHJJZDtcbiAgfVxufVxuIl19