"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorCollection = exports.VectorCollectionType = exports.VectorCollectionStandbyReplicas = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const cloudwatch = require("aws-cdk-lib/aws-cloudwatch");
const iam = require("aws-cdk-lib/aws-iam");
const oss = require("aws-cdk-lib/aws-opensearchserverless");
const utils_1 = require("../../common/helpers/utils");
/**
 * Configuration for standby replicas in a vector collection.
 */
var VectorCollectionStandbyReplicas;
(function (VectorCollectionStandbyReplicas) {
    /**
     * Enable standby replicas for high availability
     */
    VectorCollectionStandbyReplicas["ENABLED"] = "ENABLED";
    /**
     * Disable standby replicas to reduce costs
     */
    VectorCollectionStandbyReplicas["DISABLED"] = "DISABLED";
})(VectorCollectionStandbyReplicas || (exports.VectorCollectionStandbyReplicas = VectorCollectionStandbyReplicas = {}));
/**
 * The type of collection.
 */
var VectorCollectionType;
(function (VectorCollectionType) {
    /**
     * Search – Full-text search that powers applications in your internal networks (content management systems, legal documents) and internet-facing applications,
     * such as ecommerce website search and content search.
     */
    VectorCollectionType["SEARCH"] = "SEARCH";
    /**
     * Time series – The log analytics segment that focuses on analyzing large volumes of semi-structured,
     * machine-generated data in real-time for operational, security, user behavior, and business insights.
     */
    VectorCollectionType["TIMESERIES"] = "TIMESERIES";
    /**
     * Vector search – Semantic search on vector embeddings that simplifies vector data management and powers machine learning (ML) augmented search experiences and generative AI applications,
     * such as chatbots, personal assistants, and fraud detection.
     */
    VectorCollectionType["VECTORSEARCH"] = "VECTORSEARCH";
})(VectorCollectionType || (exports.VectorCollectionType = VectorCollectionType = {}));
/**
 * A new or imported vector collection.
 */
class VectorCollectionBase extends cdk.Resource {
    metric(metricName, props) {
        return new cloudwatch.Metric({
            namespace: 'AWS/AOSS',
            metricName,
            dimensionsMap: {
                CollectionId: this.collectionId,
            },
            ...props,
        });
    }
    metricSearchRequestCount(props) {
        return this.metric('SearchRequestCount', props);
    }
    metricIndexRequestCount(props) {
        return this.metric('IndexRequestCount', props);
    }
    metricSearchLatency(props) {
        return this.metric('SearchLatency', { statistic: 'Average', ...props });
    }
    metricSearchLatencyP90(props) {
        return this.metric('SearchLatency', { statistic: 'p90', ...props });
    }
}
/**
 * Provides a vector search collection in Amazon OpenSearch Serverless.
 */
class VectorCollection extends VectorCollectionBase {
    /**
     * Return metrics for all vector collections.
     */
    static metricAll(metricName, props) {
        return new cloudwatch.Metric({
            namespace: 'AWS/AOSS',
            metricName,
            statistic: 'Sum',
            ...props,
        });
    }
    /**
     * Metric for the total number of search requests across all collections.
     */
    static metricAllSearchRequestCount(props) {
        return this.metricAll('SearchRequestCount', props);
    }
    /**
     * Metric for the total number of index requests across all collections.
     */
    static metricAllIndexRequestCount(props) {
        return this.metricAll('IndexRequestCount', props);
    }
    /**
     * Metric for average search latency across all collections.
     */
    static metricAllSearchLatency(props) {
        return this.metricAll('SearchLatency', {
            statistic: 'Average',
            ...props,
        });
    }
    /**
     * Import an existing collection using its attributes.
     * @param constructScope The parent creating construct.
     * @param constructId The construct's name.
     * @param attrs The collection attributes to use.
     */
    static fromCollectionAttributes(constructScope, constructId, attrs) {
        class Import extends VectorCollectionBase {
            constructor(scope, id) {
                super(scope, id);
                this.collectionArn = attrs.collectionArn;
                this.collectionId = attrs.collectionId;
                this.collectionName = attrs.collectionName;
                this.standbyReplicas = attrs.standbyReplicas;
                this.collectionType = attrs.collectionType;
                this.aossPolicy = new iam.ManagedPolicy(this, 'ImportedAOSSPolicy', {
                    statements: [
                        new iam.PolicyStatement({
                            effect: iam.Effect.ALLOW,
                            actions: ['aoss:APIAccessAll'],
                            resources: [this.collectionArn],
                        }),
                    ],
                });
                this.dataAccessPolicy = new oss.CfnAccessPolicy(this, 'ImportedDataAccessPolicy', {
                    name: (0, utils_1.generatePhysicalNameV2)(this, 'DataAccessPolicy', { maxLength: 32, lower: true }),
                    type: 'data',
                    policy: '[]',
                });
            }
        }
        return new Import(constructScope, constructId);
    }
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * An OpenSearch Access Policy document that will become `dataAccessPolicy`.
         * @private
         */
        this.dataAccessPolicyDocument = [];
        this.collectionName = props?.collectionName ?? (0, utils_1.generatePhysicalNameV2)(this, 'VectorStore', { maxLength: 32, lower: true });
        this.standbyReplicas = props?.standbyReplicas ?? VectorCollectionStandbyReplicas.ENABLED;
        this.collectionType = props?.collectionType ?? VectorCollectionType.VECTORSEARCH;
        const encryptionPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'EncryptionPolicy', { maxLength: 32, lower: true });
        const encryptionPolicy = new oss.CfnSecurityPolicy(this, 'EncryptionPolicy', {
            name: encryptionPolicyName,
            type: 'encryption',
            policy: JSON.stringify({
                Rules: [
                    {
                        ResourceType: 'collection',
                        Resource: [`collection/${this.collectionName}`],
                    },
                ],
                AWSOwnedKey: true,
            }),
        });
        const networkPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'NetworkPolicy', { maxLength: 32, lower: true });
        const networkPolicy = new oss.CfnSecurityPolicy(this, 'NetworkPolicy', {
            name: networkPolicyName,
            type: 'network',
            policy: JSON.stringify([
                {
                    Rules: [
                        {
                            ResourceType: 'collection',
                            Resource: [`collection/${this.collectionName}`],
                        },
                        {
                            ResourceType: 'dashboard',
                            Resource: [`collection/${this.collectionName}`],
                        },
                    ],
                    AllowFromPublic: true,
                },
            ]),
        });
        this._resource = new oss.CfnCollection(this, 'VectorCollection', {
            name: this.collectionName,
            type: this.collectionType,
            standbyReplicas: this.standbyReplicas,
            description: props?.description,
            tags: props?.tags,
        });
        this.collectionArn = this._resource.attrArn;
        this.collectionId = this._resource.attrId;
        this.collectionEndpoint = this._resource.attrCollectionEndpoint;
        this.dashboardEndpoint = this._resource.attrDashboardEndpoint;
        if (props?.customAossPolicy) {
            this.aossPolicy = props.customAossPolicy;
        }
        else {
            this.aossPolicy = new iam.ManagedPolicy(this, 'AOSSApiAccessAll', {
                statements: [
                    new iam.PolicyStatement({
                        effect: iam.Effect.ALLOW,
                        actions: [
                            'aoss:APIAccessAll',
                        ],
                        resources: [this._resource.attrArn],
                    }),
                ],
            });
        }
        this._resource.node.addDependency(encryptionPolicy);
        this._resource.node.addDependency(networkPolicy);
        const isDataAccessPolicyNotEmpty = new cdk.CfnCondition(this, 'IsDataAccessPolicyNotEmpty', {
            expression: cdk.Fn.conditionNot(cdk.Fn.conditionEquals(0, cdk.Lazy.number({
                produce: () => this.dataAccessPolicyDocument.length,
            }))),
        });
        const dataAccessPolicyName = (0, utils_1.generatePhysicalNameV2)(this, 'DataAccessPolicy', { maxLength: 32, lower: true });
        this.dataAccessPolicy = new oss.CfnAccessPolicy(this, 'DataAccessPolicy', {
            name: dataAccessPolicyName,
            type: 'data',
            policy: cdk.Lazy.string({
                produce: () => JSON.stringify(this.dataAccessPolicyDocument),
            }),
        });
        this.dataAccessPolicy.cfnOptions.condition = isDataAccessPolicyNotEmpty;
        this.node.addValidation({
            validate: () => {
                const errors = [];
                if (this.collectionName) {
                    if (!/^[a-z0-9-]+$/.test(this.collectionName)) {
                        errors.push('Collection name must contain only lowercase letters, numbers, and hyphens');
                    }
                    if (this.collectionName.length < 3 || this.collectionName.length > 32) {
                        errors.push('Collection name must be between 3 and 32 characters');
                    }
                }
                return errors;
            },
        });
        cdk.Tags.of(this).add('Name', this.collectionName);
        cdk.Tags.of(this).add('Type', 'VectorCollection');
    }
    /**
       * Grants the specified role access to data in the collection.
       * @param grantee The role to grant access to.
       */
    grantDataAccess(grantee) {
        this.dataAccessPolicyDocument.push({
            Rules: [
                {
                    Resource: [`collection/${this.collectionName}`],
                    Permission: [
                        'aoss:DescribeCollectionItems',
                        'aoss:CreateCollectionItems',
                        'aoss:UpdateCollectionItems',
                    ],
                    ResourceType: 'collection',
                },
                {
                    Resource: [`index/${this.collectionName}/*`],
                    Permission: [
                        'aoss:UpdateIndex',
                        'aoss:DescribeIndex',
                        'aoss:ReadDocument',
                        'aoss:WriteDocument',
                        'aoss:CreateIndex',
                    ],
                    ResourceType: 'index',
                },
            ],
            Principal: [
                grantee.roleArn,
            ],
            Description: '',
        });
        grantee.addManagedPolicy(this.aossPolicy);
    }
}
exports.VectorCollection = VectorCollection;
_a = JSII_RTTI_SYMBOL_1;
VectorCollection[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.opensearchserverless.VectorCollection", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVjdG9yLWNvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9vcGVuc2VhcmNoc2VydmVybGVzcy92ZWN0b3ItY29sbGVjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsbUNBQW1DO0FBQ25DLHlEQUF5RDtBQUN6RCwyQ0FBMkM7QUFDM0MsNERBQTREO0FBRTVELHNEQUFvRTtBQUVwRTs7R0FFRztBQUNILElBQVksK0JBVVg7QUFWRCxXQUFZLCtCQUErQjtJQUN6Qzs7T0FFRztJQUNILHNEQUFtQixDQUFBO0lBRW5COztPQUVHO0lBQ0gsd0RBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQVZXLCtCQUErQiwrQ0FBL0IsK0JBQStCLFFBVTFDO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLG9CQWtCWDtBQWxCRCxXQUFZLG9CQUFvQjtJQUM5Qjs7O09BR0c7SUFDSCx5Q0FBaUIsQ0FBQTtJQUVqQjs7O09BR0c7SUFDSCxpREFBeUIsQ0FBQTtJQUV6Qjs7O09BR0c7SUFDSCxxREFBNkIsQ0FBQTtBQUMvQixDQUFDLEVBbEJXLG9CQUFvQixvQ0FBcEIsb0JBQW9CLFFBa0IvQjtBQXNKRDs7R0FFRztBQUNILE1BQWUsb0JBQXFCLFNBQVEsR0FBRyxDQUFDLFFBQVE7SUFTL0MsTUFBTSxDQUFDLFVBQWtCLEVBQUUsS0FBZ0M7UUFDaEUsT0FBTyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDM0IsU0FBUyxFQUFFLFVBQVU7WUFDckIsVUFBVTtZQUNWLGFBQWEsRUFBRTtnQkFDYixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7YUFDaEM7WUFDRCxHQUFHLEtBQUs7U0FDVCxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sd0JBQXdCLENBQUMsS0FBZ0M7UUFDOUQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lB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Q0FBQztTQUNGLENBQUMsQ0FBQztRQUVILEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25ELEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBQ0Q7OztTQUdLO0lBQ0wsZUFBZSxDQUFDLE9BQWtCO1FBQ2hDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUM7WUFDakMsS0FBSyxFQUFFO2dCQUNMO29CQUNFLFFBQVEsRUFBRSxDQUFDLGNBQWMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO29CQUMvQyxVQUFVLEVBQUU7d0JBQ1YsOEJBQThCO3dCQUM5Qiw0QkFBNEI7d0JBQzVCLDRCQUE0QjtxQkFDN0I7b0JBQ0QsWUFBWSxFQUFFLFlBQVk7aUJBQzNCO2dCQUNEO29CQUNFLFFBQVEsRUFBRSxDQUFDLFNBQVMsSUFBSSxDQUFDLGNBQWMsSUFBSSxDQUFDO29CQUM1QyxVQUFVLEVBQUU7d0JBQ1Ysa0JBQWtCO3dCQUNsQixvQkFBb0I7d0JBQ3BCLG1CQUFtQjt3QkFDbkIsb0JBQW9CO3dCQUNwQixrQkFBa0I7cUJBQ25CO29CQUNELFlBQVksRUFBRSxPQUFPO2lCQUN0QjthQUNGO1lBQ0QsU0FBUyxFQUFFO2dCQUNULE9BQU8sQ0FBQyxPQUFPO2FBQ2hCO1lBQ0QsV0FBVyxFQUFFLEVBQUU7U0FDaEIsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM1QyxDQUFDOztBQXRRSCw0Q0F1UUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgY2xvdWR3YXRjaCBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaCc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBvc3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLW9wZW5zZWFyY2hzZXJ2ZXJsZXNzJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGZvciBzdGFuZGJ5IHJlcGxpY2FzIGluIGEgdmVjdG9yIGNvbGxlY3Rpb24uXG4gKi9cbmV4cG9ydCBlbnVtIFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXMge1xuICAvKipcbiAgICogRW5hYmxlIHN0YW5kYnkgcmVwbGljYXMgZm9yIGhpZ2ggYXZhaWxhYmlsaXR5XG4gICAqL1xuICBFTkFCTEVEID0gJ0VOQUJMRUQnLFxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIHN0YW5kYnkgcmVwbGljYXMgdG8gcmVkdWNlIGNvc3RzXG4gICAqL1xuICBESVNBQkxFRCA9ICdESVNBQkxFRCcsXG59XG5cbi8qKlxuICogVGhlIHR5cGUgb2YgY29sbGVjdGlvbi5cbiAqL1xuZXhwb3J0IGVudW0gVmVjdG9yQ29sbGVjdGlvblR5cGUge1xuICAvKipcbiAgICogU2VhcmNoIOKAkyBGdWxsLXRleHQgc2VhcmNoIHRoYXQgcG93ZXJzIGFwcGxpY2F0aW9ucyBpbiB5b3VyIGludGVybmFsIG5ldHdvcmtzIChjb250ZW50IG1hbmFnZW1lbnQgc3lzdGVtcywgbGVnYWwgZG9jdW1lbnRzKSBhbmQgaW50ZXJuZXQtZmFjaW5nIGFwcGxpY2F0aW9ucyxcbiAgICogc3VjaCBhcyBlY29tbWVyY2Ugd2Vic2l0ZSBzZWFyY2ggYW5kIGNvbnRlbnQgc2VhcmNoLlxuICAgKi9cbiAgU0VBUkNIID0gJ1NFQVJDSCcsXG5cbiAgLyoqXG4gICAqIFRpbWUgc2VyaWVzIOKAkyBUaGUgbG9nIGFuYWx5dGljcyBzZWdtZW50IHRoYXQgZm9jdXNlcyBvbiBhbmFseXppbmcgbGFyZ2Ugdm9sdW1lcyBvZiBzZW1pLXN0cnVjdHVyZWQsXG4gICAqIG1hY2hpbmUtZ2VuZXJhdGVkIGRhdGEgaW4gcmVhbC10aW1lIGZvciBvcGVyYXRpb25hbCwgc2VjdXJpdHksIHVzZXIgYmVoYXZpb3IsIGFuZCBidXNpbmVzcyBpbnNpZ2h0cy5cbiAgICovXG4gIFRJTUVTRVJJRVMgPSAnVElNRVNFUklFUycsXG5cbiAgLyoqXG4gICAqIFZlY3RvciBzZWFyY2gg4oCTIFNlbWFudGljIHNlYXJjaCBvbiB2ZWN0b3IgZW1iZWRkaW5ncyB0aGF0IHNpbXBsaWZpZXMgdmVjdG9yIGRhdGEgbWFuYWdlbWVudCBhbmQgcG93ZXJzIG1hY2hpbmUgbGVhcm5pbmcgKE1MKSBhdWdtZW50ZWQgc2VhcmNoIGV4cGVyaWVuY2VzIGFuZCBnZW5lcmF0aXZlIEFJIGFwcGxpY2F0aW9ucyxcbiAgICogc3VjaCBhcyBjaGF0Ym90cywgcGVyc29uYWwgYXNzaXN0YW50cywgYW5kIGZyYXVkIGRldGVjdGlvbi5cbiAgICovXG4gIFZFQ1RPUlNFQVJDSCA9ICdWRUNUT1JTRUFSQ0gnXG59XG5cbi8qKlxuICogQXR0cmlidXRlcyBmb3IgaW1wb3J0aW5nIGFuIGV4aXN0aW5nIHZlY3RvciBjb2xsZWN0aW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZlY3RvckNvbGxlY3Rpb25BdHRyaWJ1dGVzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBjb2xsZWN0aW9uXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGNvbGxlY3Rpb25cbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25JZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBjb2xsZWN0aW9uXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBzdGFuZGJ5IHJlcGxpY2FzIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHJlYWRvbmx5IHN0YW5kYnlSZXBsaWNhczogVmVjdG9yQ29sbGVjdGlvblN0YW5kYnlSZXBsaWNhcztcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgY29sbGVjdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvblR5cGU6IFZlY3RvckNvbGxlY3Rpb25UeXBlO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNvbmZpZ3VyaW5nIHRoZSB2ZWN0b3IgY29sbGVjdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWZWN0b3JDb2xsZWN0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGNvbGxlY3Rpb24uIE11c3QgYmUgYmV0d2VlbiAzLTMyIGNoYXJhY3RlcnMgbG9uZyBhbmQgY29udGFpbiBvbmx5XG4gICAqIGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzLCBhbmQgaHlwaGVucy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIENESyBnZW5lcmF0ZWQgbmFtZSB3aWxsIGJlIHVzZWRcbiAgICovXG4gIHJlYWRvbmx5IGNvbGxlY3Rpb25OYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEZXNjcmlwdGlvbiBmb3IgdGhlIGNvbGxlY3Rpb25cbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0byB1c2Ugc3RhbmRieSByZXBsaWNhcyBmb3IgdGhlIGNvbGxlY3Rpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXMuRU5BQkxFRFxuICAgKi9cbiAgcmVhZG9ubHkgc3RhbmRieVJlcGxpY2FzPzogVmVjdG9yQ29sbGVjdGlvblN0YW5kYnlSZXBsaWNhcztcblxuICAvKipcbiAgICogQSB1c2VyIGRlZmluZWQgSUFNIHBvbGljeSB0aGF0IGFsbG93cyBBUEkgYWNjZXNzIHRvIHRoZSBjb2xsZWN0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tQW9zc1BvbGljeT86IGlhbS5NYW5hZ2VkUG9saWN5O1xuXG4gIC8qKlxuICAgKiBUeXBlIG9mIHZlY3RvciBjb2xsZWN0aW9uXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gVkVDVE9SU0VBUkNIXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uVHlwZT86IFZlY3RvckNvbGxlY3Rpb25UeXBlO1xuXG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgdGFncyBhc3NvY2lhdGVkIHdpdGggdGhlIGluZmVyZW5jZSBwcm9maWxlLlxuICAgKiAqL1xuICByZWFkb25seSB0YWdzPzogQXJyYXk8Y2RrLkNmblRhZz47XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHJlcHJlc2VudGluZyBhIHZlY3RvciBjb2xsZWN0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVZlY3RvckNvbGxlY3Rpb24gZXh0ZW5kcyBjZGsuSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvbk5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvbklkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGNvbGxlY3Rpb24uXG4gICAqL1xuICByZWFkb25seSBjb2xsZWN0aW9uQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIHN0YW5kYnkgcmVwbGljYXMgYXJlIGVuYWJsZWQuXG4gICAqL1xuICByZWFkb25seSBzdGFuZGJ5UmVwbGljYXM6IFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXM7XG5cbiAgLyoqXG4gICAqIEFuIElBTSBwb2xpY3kgdGhhdCBhbGxvd3MgQVBJIGFjY2VzcyB0byB0aGUgY29sbGVjdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGFvc3NQb2xpY3k6IGlhbS5NYW5hZ2VkUG9saWN5O1xuXG4gIC8qKlxuICAgKiBBbiBPcGVuU2VhcmNoIEFjY2VzcyBQb2xpY3kgdGhhdCBhbGxvd3MgYWNjZXNzIHRvIHRoZSBpbmRleC5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGFBY2Nlc3NQb2xpY3k6IG9zcy5DZm5BY2Nlc3NQb2xpY3k7XG5cbiAgLyoqXG4gICAqIFR5cGUgb2YgY29sbGVjdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgY29sbGVjdGlvblR5cGU6IFZlY3RvckNvbGxlY3Rpb25UeXBlO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGdpdmVuIG5hbWVkIG1ldHJpYyBmb3IgdGhpcyBWZWN0b3JDb2xsZWN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gbWV0cmljTmFtZSBUaGUgbmFtZSBvZiB0aGUgbWV0cmljXG4gICAqIEBwYXJhbSBwcm9wcyBQcm9wZXJ0aWVzIGZvciB0aGUgbWV0cmljXG4gICAqL1xuICBtZXRyaWMobWV0cmljTmFtZTogc3RyaW5nLCBwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljO1xuXG4gIC8qKlxuICAgKiBNZXRyaWMgZm9yIHRoZSBudW1iZXIgb2Ygc2VhcmNoIHJlcXVlc3RzLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgUHJvcGVydGllcyBmb3IgdGhlIG1ldHJpY1xuICAgKi9cbiAgbWV0cmljU2VhcmNoUmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWM7XG5cbiAgLyoqXG4gICAqIE1ldHJpYyBmb3IgdGhlIG51bWJlciBvZiBpbmRleCByZXF1ZXN0cy5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIFByb3BlcnRpZXMgZm9yIHRoZSBtZXRyaWNcbiAgICovXG4gIG1ldHJpY0luZGV4UmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWM7XG5cbiAgLyoqXG4gICAqIE1ldHJpYyBmb3IgdGhlIHNlYXJjaCBsYXRlbmN5LlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgUHJvcGVydGllcyBmb3IgdGhlIG1ldHJpY1xuICAgKi9cbiAgbWV0cmljU2VhcmNoTGF0ZW5jeShwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljO1xuXG4gIC8qKlxuICAgKiBNZXRyaWMgZm9yIHRoZSA5MHRoIHBlcmNlbnRpbGUgc2VhcmNoIGxhdGVuY3kuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyBQcm9wZXJ0aWVzIGZvciB0aGUgbWV0cmljXG4gICAqL1xuICBtZXRyaWNTZWFyY2hMYXRlbmN5UDkwKHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWM7XG59XG5cbi8qKlxuICogQSBuZXcgb3IgaW1wb3J0ZWQgdmVjdG9yIGNvbGxlY3Rpb24uXG4gKi9cbmFic3RyYWN0IGNsYXNzIFZlY3RvckNvbGxlY3Rpb25CYXNlIGV4dGVuZHMgY2RrLlJlc291cmNlIGltcGxlbWVudHMgSVZlY3RvckNvbGxlY3Rpb24ge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgY29sbGVjdGlvbk5hbWU6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGNvbGxlY3Rpb25JZDogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgY29sbGVjdGlvbkFybjogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgc3RhbmRieVJlcGxpY2FzOiBWZWN0b3JDb2xsZWN0aW9uU3RhbmRieVJlcGxpY2FzO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgYW9zc1BvbGljeTogaWFtLk1hbmFnZWRQb2xpY3k7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBkYXRhQWNjZXNzUG9saWN5OiBvc3MuQ2ZuQWNjZXNzUG9saWN5O1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgY29sbGVjdGlvblR5cGU6IFZlY3RvckNvbGxlY3Rpb25UeXBlO1xuXG4gIHB1YmxpYyBtZXRyaWMobWV0cmljTmFtZTogc3RyaW5nLCBwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgIG5hbWVzcGFjZTogJ0FXUy9BT1NTJyxcbiAgICAgIG1ldHJpY05hbWUsXG4gICAgICBkaW1lbnNpb25zTWFwOiB7XG4gICAgICAgIENvbGxlY3Rpb25JZDogdGhpcy5jb2xsZWN0aW9uSWQsXG4gICAgICB9LFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgbWV0cmljU2VhcmNoUmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYygnU2VhcmNoUmVxdWVzdENvdW50JywgcHJvcHMpO1xuICB9XG5cbiAgcHVibGljIG1ldHJpY0luZGV4UmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYygnSW5kZXhSZXF1ZXN0Q291bnQnLCBwcm9wcyk7XG4gIH1cblxuICBwdWJsaWMgbWV0cmljU2VhcmNoTGF0ZW5jeShwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoJ1NlYXJjaExhdGVuY3knLCB7IHN0YXRpc3RpYzogJ0F2ZXJhZ2UnLCAuLi5wcm9wcyB9KTtcbiAgfVxuXG4gIHB1YmxpYyBtZXRyaWNTZWFyY2hMYXRlbmN5UDkwKHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYygnU2VhcmNoTGF0ZW5jeScsIHsgc3RhdGlzdGljOiAncDkwJywgLi4ucHJvcHMgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIHZlY3RvciBzZWFyY2ggY29sbGVjdGlvbiBpbiBBbWF6b24gT3BlblNlYXJjaCBTZXJ2ZXJsZXNzLlxuICovXG5leHBvcnQgY2xhc3MgVmVjdG9yQ29sbGVjdGlvbiBleHRlbmRzIFZlY3RvckNvbGxlY3Rpb25CYXNlIHtcbiAgLyoqXG4gICAqIFJldHVybiBtZXRyaWNzIGZvciBhbGwgdmVjdG9yIGNvbGxlY3Rpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBtZXRyaWNBbGwobWV0cmljTmFtZTogc3RyaW5nLCBwcm9wcz86IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgIG5hbWVzcGFjZTogJ0FXUy9BT1NTJyxcbiAgICAgIG1ldHJpY05hbWUsXG4gICAgICBzdGF0aXN0aWM6ICdTdW0nLFxuICAgICAgLi4ucHJvcHMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTWV0cmljIGZvciB0aGUgdG90YWwgbnVtYmVyIG9mIHNlYXJjaCByZXF1ZXN0cyBhY3Jvc3MgYWxsIGNvbGxlY3Rpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBtZXRyaWNBbGxTZWFyY2hSZXF1ZXN0Q291bnQocHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljQWxsKCdTZWFyY2hSZXF1ZXN0Q291bnQnLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogTWV0cmljIGZvciB0aGUgdG90YWwgbnVtYmVyIG9mIGluZGV4IHJlcXVlc3RzIGFjcm9zcyBhbGwgY29sbGVjdGlvbnMuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIG1ldHJpY0FsbEluZGV4UmVxdWVzdENvdW50KHByb3BzPzogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zKTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0FsbCgnSW5kZXhSZXF1ZXN0Q291bnQnLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogTWV0cmljIGZvciBhdmVyYWdlIHNlYXJjaCBsYXRlbmN5IGFjcm9zcyBhbGwgY29sbGVjdGlvbnMuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIG1ldHJpY0FsbFNlYXJjaExhdGVuY3kocHJvcHM/OiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljQWxsKCdTZWFyY2hMYXRlbmN5Jywge1xuICAgICAgc3RhdGlzdGljOiAnQXZlcmFnZScsXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbXBvcnQgYW4gZXhpc3RpbmcgY29sbGVjdGlvbiB1c2luZyBpdHMgYXR0cmlidXRlcy5cbiAgICogQHBhcmFtIGNvbnN0cnVjdFNjb3BlIFRoZSBwYXJlbnQgY3JlYXRpbmcgY29uc3RydWN0LlxuICAgKiBAcGFyYW0gY29uc3RydWN0SWQgVGhlIGNvbnN0cnVjdCdzIG5hbWUuXG4gICAqIEBwYXJhbSBhdHRycyBUaGUgY29sbGVjdGlvbiBhdHRyaWJ1dGVzIHRvIHVzZS5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUNvbGxlY3Rpb25BdHRyaWJ1dGVzKFxuICAgIGNvbnN0cnVjdFNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgY29uc3RydWN0SWQ6IHN0cmluZyxcbiAgICBhdHRyczogVmVjdG9yQ29sbGVjdGlvbkF0dHJpYnV0ZXMsXG4gICk6IElWZWN0b3JDb2xsZWN0aW9uIHtcbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBWZWN0b3JDb2xsZWN0aW9uQmFzZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgY29sbGVjdGlvbkFybiA9IGF0dHJzLmNvbGxlY3Rpb25Bcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgY29sbGVjdGlvbklkID0gYXR0cnMuY29sbGVjdGlvbklkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25OYW1lID0gYXR0cnMuY29sbGVjdGlvbk5hbWU7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgc3RhbmRieVJlcGxpY2FzID0gYXR0cnMuc3RhbmRieVJlcGxpY2FzO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25UeXBlID0gYXR0cnMuY29sbGVjdGlvblR5cGU7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYW9zc1BvbGljeTogaWFtLk1hbmFnZWRQb2xpY3k7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgZGF0YUFjY2Vzc1BvbGljeTogb3NzLkNmbkFjY2Vzc1BvbGljeTtcblxuICAgICAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgICAgIHRoaXMuYW9zc1BvbGljeSA9IG5ldyBpYW0uTWFuYWdlZFBvbGljeSh0aGlzLCAnSW1wb3J0ZWRBT1NTUG9saWN5Jywge1xuICAgICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICAgICAgICBhY3Rpb25zOiBbJ2Fvc3M6QVBJQWNjZXNzQWxsJ10sXG4gICAgICAgICAgICAgIHJlc291cmNlczogW3RoaXMuY29sbGVjdGlvbkFybl0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmRhdGFBY2Nlc3NQb2xpY3kgPSBuZXcgb3NzLkNmbkFjY2Vzc1BvbGljeSh0aGlzLCAnSW1wb3J0ZWREYXRhQWNjZXNzUG9saWN5Jywge1xuICAgICAgICAgIG5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0RhdGFBY2Nlc3NQb2xpY3knLCB7IG1heExlbmd0aDogMzIsIGxvd2VyOiB0cnVlIH0pLFxuICAgICAgICAgIHR5cGU6ICdkYXRhJyxcbiAgICAgICAgICBwb2xpY3k6ICdbXScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3IEltcG9ydChjb25zdHJ1Y3RTY29wZSwgY29uc3RydWN0SWQpO1xuICB9XG5cbiAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25OYW1lOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBzdGFuZGJ5UmVwbGljYXM6IFZlY3RvckNvbGxlY3Rpb25TdGFuZGJ5UmVwbGljYXM7XG4gIHB1YmxpYyByZWFkb25seSBjb2xsZWN0aW9uSWQ6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25Bcm46IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGFvc3NQb2xpY3k6IGlhbS5NYW5hZ2VkUG9saWN5O1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YUFjY2Vzc1BvbGljeTogb3NzLkNmbkFjY2Vzc1BvbGljeTtcbiAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25UeXBlOiBWZWN0b3JDb2xsZWN0aW9uVHlwZTtcbiAgcHVibGljIHJlYWRvbmx5IGNvbGxlY3Rpb25FbmRwb2ludDogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgZGFzaGJvYXJkRW5kcG9pbnQ6IHN0cmluZztcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2YgQ2ZuQ29sbGVjdGlvbi5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX3Jlc291cmNlOiBvc3MuQ2ZuQ29sbGVjdGlvbjtcblxuICAvKipcbiAgICogQW4gT3BlblNlYXJjaCBBY2Nlc3MgUG9saWN5IGRvY3VtZW50IHRoYXQgd2lsbCBiZWNvbWUgYGRhdGFBY2Nlc3NQb2xpY3lgLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBkYXRhQWNjZXNzUG9saWN5RG9jdW1lbnQ6IGFueVtdID0gW107XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM/OiBWZWN0b3JDb2xsZWN0aW9uUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9IHByb3BzPy5jb2xsZWN0aW9uTmFtZSA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdWZWN0b3JTdG9yZScsXG4gICAgICB7IG1heExlbmd0aDogMzIsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIHRoaXMuc3RhbmRieVJlcGxpY2FzID0gcHJvcHM/LnN0YW5kYnlSZXBsaWNhcyA/PyBWZWN0b3JDb2xsZWN0aW9uU3RhbmRieVJlcGxpY2FzLkVOQUJMRUQ7XG4gICAgdGhpcy5jb2xsZWN0aW9uVHlwZSA9IHByb3BzPy5jb2xsZWN0aW9uVHlwZSA/PyBWZWN0b3JDb2xsZWN0aW9uVHlwZS5WRUNUT1JTRUFSQ0g7XG5cbiAgICBjb25zdCBlbmNyeXB0aW9uUG9saWN5TmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcyxcbiAgICAgICdFbmNyeXB0aW9uUG9saWN5JyxcbiAgICAgIHsgbWF4TGVuZ3RoOiAzMiwgbG93ZXI6IHRydWUgfSk7XG4gICAgY29uc3QgZW5jcnlwdGlvblBvbGljeSA9IG5ldyBvc3MuQ2ZuU2VjdXJpdHlQb2xpY3kodGhpcywgJ0VuY3J5cHRpb25Qb2xpY3knLCB7XG4gICAgICBuYW1lOiBlbmNyeXB0aW9uUG9saWN5TmFtZSxcbiAgICAgIHR5cGU6ICdlbmNyeXB0aW9uJyxcbiAgICAgIHBvbGljeTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBSdWxlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlc291cmNlVHlwZTogJ2NvbGxlY3Rpb24nLFxuICAgICAgICAgICAgUmVzb3VyY2U6IFtgY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbk5hbWV9YF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgQVdTT3duZWRLZXk6IHRydWUsXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIGNvbnN0IG5ldHdvcmtQb2xpY3lOYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLFxuICAgICAgJ05ldHdvcmtQb2xpY3knLFxuICAgICAgeyBtYXhMZW5ndGg6IDMyLCBsb3dlcjogdHJ1ZSB9KTtcbiAgICBjb25zdCBuZXR3b3JrUG9saWN5ID0gbmV3IG9zcy5DZm5TZWN1cml0eVBvbGljeSh0aGlzLCAnTmV0d29ya1BvbGljeScsIHtcbiAgICAgIG5hbWU6IG5ldHdvcmtQb2xpY3lOYW1lLFxuICAgICAgdHlwZTogJ25ldHdvcmsnLFxuICAgICAgcG9saWN5OiBKU09OLnN0cmluZ2lmeShbXG4gICAgICAgIHtcbiAgICAgICAgICBSdWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZXNvdXJjZVR5cGU6ICdjb2xsZWN0aW9uJyxcbiAgICAgICAgICAgICAgUmVzb3VyY2U6IFtgY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbk5hbWV9YF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZXNvdXJjZVR5cGU6ICdkYXNoYm9hcmQnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogW2Bjb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uTmFtZX1gXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBBbGxvd0Zyb21QdWJsaWM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdKSxcbiAgICB9KTtcblxuICAgIHRoaXMuX3Jlc291cmNlID0gbmV3IG9zcy5DZm5Db2xsZWN0aW9uKHRoaXMsICdWZWN0b3JDb2xsZWN0aW9uJywge1xuICAgICAgbmFtZTogdGhpcy5jb2xsZWN0aW9uTmFtZSxcbiAgICAgIHR5cGU6IHRoaXMuY29sbGVjdGlvblR5cGUsXG4gICAgICBzdGFuZGJ5UmVwbGljYXM6IHRoaXMuc3RhbmRieVJlcGxpY2FzLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzPy5kZXNjcmlwdGlvbixcbiAgICAgIHRhZ3M6IHByb3BzPy50YWdzLFxuICAgIH0pO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uQXJuID0gdGhpcy5fcmVzb3VyY2UuYXR0ckFybjtcbiAgICB0aGlzLmNvbGxlY3Rpb25JZCA9IHRoaXMuX3Jlc291cmNlLmF0dHJJZDtcbiAgICB0aGlzLmNvbGxlY3Rpb25FbmRwb2ludCA9IHRoaXMuX3Jlc291cmNlLmF0dHJDb2xsZWN0aW9uRW5kcG9pbnQ7XG4gICAgdGhpcy5kYXNoYm9hcmRFbmRwb2ludCA9IHRoaXMuX3Jlc291cmNlLmF0dHJEYXNoYm9hcmRFbmRwb2ludDtcblxuICAgIGlmIChwcm9wcz8uY3VzdG9tQW9zc1BvbGljeSkge1xuICAgICAgdGhpcy5hb3NzUG9saWN5ID0gcHJvcHMuY3VzdG9tQW9zc1BvbGljeTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hb3NzUG9saWN5ID0gbmV3IGlhbS5NYW5hZ2VkUG9saWN5KFxuICAgICAgICB0aGlzLFxuICAgICAgICAnQU9TU0FwaUFjY2Vzc0FsbCcsIHtcbiAgICAgICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgICAgICdhb3NzOkFQSUFjY2Vzc0FsbCcsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIHJlc291cmNlczogW3RoaXMuX3Jlc291cmNlLmF0dHJBcm5dLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVzb3VyY2Uubm9kZS5hZGREZXBlbmRlbmN5KGVuY3J5cHRpb25Qb2xpY3kpO1xuICAgIHRoaXMuX3Jlc291cmNlLm5vZGUuYWRkRGVwZW5kZW5jeShuZXR3b3JrUG9saWN5KTtcblxuICAgIGNvbnN0IGlzRGF0YUFjY2Vzc1BvbGljeU5vdEVtcHR5ID0gbmV3IGNkay5DZm5Db25kaXRpb24odGhpcywgJ0lzRGF0YUFjY2Vzc1BvbGljeU5vdEVtcHR5Jywge1xuICAgICAgZXhwcmVzc2lvbjogY2RrLkZuLmNvbmRpdGlvbk5vdChjZGsuRm4uY29uZGl0aW9uRXF1YWxzKDAsIGNkay5MYXp5Lm51bWJlcih7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHRoaXMuZGF0YUFjY2Vzc1BvbGljeURvY3VtZW50Lmxlbmd0aCxcbiAgICAgIH0pKSksXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYXRhQWNjZXNzUG9saWN5TmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcyxcbiAgICAgICdEYXRhQWNjZXNzUG9saWN5JyxcbiAgICAgIHsgbWF4TGVuZ3RoOiAzMiwgbG93ZXI6IHRydWUgfSk7XG5cbiAgICB0aGlzLmRhdGFBY2Nlc3NQb2xpY3kgPSBuZXcgb3NzLkNmbkFjY2Vzc1BvbGljeSh0aGlzLCAnRGF0YUFjY2Vzc1BvbGljeScsIHtcbiAgICAgIG5hbWU6IGRhdGFBY2Nlc3NQb2xpY3lOYW1lLFxuICAgICAgdHlwZTogJ2RhdGEnLFxuICAgICAgcG9saWN5OiBjZGsuTGF6eS5zdHJpbmcoe1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiBKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGFBY2Nlc3NQb2xpY3lEb2N1bWVudCksXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGF0YUFjY2Vzc1BvbGljeS5jZm5PcHRpb25zLmNvbmRpdGlvbiA9IGlzRGF0YUFjY2Vzc1BvbGljeU5vdEVtcHR5O1xuXG4gICAgdGhpcy5ub2RlLmFkZFZhbGlkYXRpb24oe1xuICAgICAgdmFsaWRhdGU6ICgpID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb25OYW1lKSB7XG4gICAgICAgICAgaWYgKCEvXlthLXowLTktXSskLy50ZXN0KHRoaXMuY29sbGVjdGlvbk5hbWUpKSB7XG4gICAgICAgICAgICBlcnJvcnMucHVzaCgnQ29sbGVjdGlvbiBuYW1lIG11c3QgY29udGFpbiBvbmx5IGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzLCBhbmQgaHlwaGVucycpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZS5sZW5ndGggPCAzIHx8IHRoaXMuY29sbGVjdGlvbk5hbWUubGVuZ3RoID4gMzIpIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKCdDb2xsZWN0aW9uIG5hbWUgbXVzdCBiZSBiZXR3ZWVuIDMgYW5kIDMyIGNoYXJhY3RlcnMnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNkay5UYWdzLm9mKHRoaXMpLmFkZCgnTmFtZScsIHRoaXMuY29sbGVjdGlvbk5hbWUpO1xuICAgIGNkay5UYWdzLm9mKHRoaXMpLmFkZCgnVHlwZScsICdWZWN0b3JDb2xsZWN0aW9uJyk7XG4gIH1cbiAgLyoqXG4gICAgICogR3JhbnRzIHRoZSBzcGVjaWZpZWQgcm9sZSBhY2Nlc3MgdG8gZGF0YSBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICAgKiBAcGFyYW0gZ3JhbnRlZSBUaGUgcm9sZSB0byBncmFudCBhY2Nlc3MgdG8uXG4gICAgICovXG4gIGdyYW50RGF0YUFjY2VzcyhncmFudGVlOiBpYW0uSVJvbGUpIHtcbiAgICB0aGlzLmRhdGFBY2Nlc3NQb2xpY3lEb2N1bWVudC5wdXNoKHtcbiAgICAgIFJ1bGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBSZXNvdXJjZTogW2Bjb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uTmFtZX1gXSxcbiAgICAgICAgICBQZXJtaXNzaW9uOiBbXG4gICAgICAgICAgICAnYW9zczpEZXNjcmliZUNvbGxlY3Rpb25JdGVtcycsXG4gICAgICAgICAgICAnYW9zczpDcmVhdGVDb2xsZWN0aW9uSXRlbXMnLFxuICAgICAgICAgICAgJ2Fvc3M6VXBkYXRlQ29sbGVjdGlvbkl0ZW1zJyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIFJlc291cmNlVHlwZTogJ2NvbGxlY3Rpb24nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgUmVzb3VyY2U6IFtgaW5kZXgvJHt0aGlzLmNvbGxlY3Rpb25OYW1lfS8qYF0sXG4gICAgICAgICAgUGVybWlzc2lvbjogW1xuICAgICAgICAgICAgJ2Fvc3M6VXBkYXRlSW5kZXgnLFxuICAgICAgICAgICAgJ2Fvc3M6RGVzY3JpYmVJbmRleCcsXG4gICAgICAgICAgICAnYW9zczpSZWFkRG9jdW1lbnQnLFxuICAgICAgICAgICAgJ2Fvc3M6V3JpdGVEb2N1bWVudCcsXG4gICAgICAgICAgICAnYW9zczpDcmVhdGVJbmRleCcsXG4gICAgICAgICAgXSxcbiAgICAgICAgICBSZXNvdXJjZVR5cGU6ICdpbmRleCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgUHJpbmNpcGFsOiBbXG4gICAgICAgIGdyYW50ZWUucm9sZUFybixcbiAgICAgIF0sXG4gICAgICBEZXNjcmlwdGlvbjogJycsXG4gICAgfSk7XG4gICAgZ3JhbnRlZS5hZGRNYW5hZ2VkUG9saWN5KHRoaXMuYW9zc1BvbGljeSk7XG4gIH1cbn1cbiJdfQ==