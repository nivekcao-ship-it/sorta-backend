"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmazonAuroraVectorStore = exports.ExistingAmazonAuroraVectorStore = exports.SupportedPostgreSQLVersions = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const iam = require("aws-cdk-lib/aws-iam");
const rds = require("aws-cdk-lib/aws-rds");
const cdk_nag_1 = require("cdk-nag");
const constructs_1 = require("constructs");
const custom_resource_provider_helper_1 = require("../../common/helpers/custom-resource-provider-helper");
const utils_1 = require("../../common/helpers/utils");
const vpc_helper_1 = require("../../common/helpers/vpc-helper");
/******************************************************************************
 *                              ENUMS
 *****************************************************************************/
/**
 * List of supported versions of PostgreSQL for Aurora cluster.
 */
exports.SupportedPostgreSQLVersions = {
    AURORA_POSTGRESQL_V12_16: rds.AuroraPostgresEngineVersion.VER_12_16,
    AURORA_POSTGRESQL_V13_12: rds.AuroraPostgresEngineVersion.VER_13_12,
    AURORA_POSTGRESQL_V14_9: rds.AuroraPostgresEngineVersion.VER_14_9,
    AURORA_POSTGRESQL_V15_4: rds.AuroraPostgresEngineVersion.VER_15_4,
    AURORA_POSTGRESQL_V15_5: rds.AuroraPostgresEngineVersion.VER_15_5,
    AURORA_POSTGRESQL_V15_6: rds.AuroraPostgresEngineVersion.VER_15_6,
    AURORA_POSTGRESQL_V15_7: rds.AuroraPostgresEngineVersion.VER_15_7,
    AURORA_POSTGRESQL_V15_8: rds.AuroraPostgresEngineVersion.VER_15_8,
    AURORA_POSTGRESQL_V16_1: rds.AuroraPostgresEngineVersion.VER_16_1,
    AURORA_POSTGRESQL_V16_2: rds.AuroraPostgresEngineVersion.VER_16_2,
    AURORA_POSTGRESQL_V16_3: rds.AuroraPostgresEngineVersion.VER_16_3,
};
/**
 * Base class for Amazon Aurora Vector Store.
 * Handles both the creation of a new Aurora Vector Store or the usage of an existing Aurora Vector Store.
 */
class BaseAmazonAuroraVectorStore extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * Setup databaseName based on if it is provided in the props or not
         * and based on whether it is an existing Aurora Vector Store or not.
         */
        this.databaseName =
            'clusterIdentifier' in props ? props.databaseName : props.databaseName ?? 'bedrock_vector_db';
        this.schemaName = props.schemaName ?? 'bedrock_integration';
        this.vectorField = props.vectorField ?? 'embedding';
        this.textField = props.textField ?? 'chunks';
        this.metadataField = props.metadataField ?? 'metadata';
        this.tableName = props.tableName ?? 'bedrock_kb';
        this.primaryKeyField = props.primaryKeyField ?? 'id';
        this.embeddingsModelVectorDimension = props.embeddingsModelVectorDimension;
    }
    createAuroraPgCRPolicy(clusterIdentifier) {
        const crPolicy = new iam.ManagedPolicy(this, 'AuroraPgPolicy', {
            managedPolicyName: (0, utils_1.generatePhysicalNameV2)(this, 'AuroraPgPolicy', {
                maxLength: 32,
                lower: true,
            }),
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'ec2:DescribeInstances',
                        'ec2:CreateNetworkInterface',
                        'ec2:AttachNetworkInterface',
                        'ec2:DescribeNetworkInterfaces',
                        'autoscaling:CompleteLifecycleAction',
                        'ec2:DeleteNetworkInterface',
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: ['rds:DescribeDBClusters'],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'rds',
                            resource: 'cluster',
                            resourceName: clusterIdentifier,
                            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
                            account: cdk.Stack.of(this).account,
                            region: cdk.Stack.of(this).region,
                        }),
                    ],
                }),
            ],
        });
        cdk_nag_1.NagSuppressions.addResourceSuppressions(crPolicy, [
            {
                id: 'AwsSolutions-IAM4',
                reason: 'The AWSLambdaBasicExecutionRole managed policy is required for ' +
                    'the Lambda function to write logs to CloudWatch.',
            },
            {
                id: 'AwsSolutions-IAM5',
                reason: 'This policy is required to allow the custom resource to create a ' +
                    'network interface for the Aurora cluster and it has to be wildcard.',
            },
        ], true);
        return crPolicy;
    }
    generateResourceArn(clusterIdentifier) {
        return cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: clusterIdentifier,
            region: cdk.Stack.of(this).region,
            account: cdk.Stack.of(this).account,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
    }
    setupDatabaseClusterResources(vpc, secret, clusterIdentifier, auroraSecurityGroup) {
        const resourceArn = this.generateResourceArn(clusterIdentifier);
        return {
            vpc,
            secret,
            resourceArn,
            auroraSecurityGroup,
            clusterIdentifier,
        };
    }
    createLambdaSecurityGroup(vpc) {
        return new ec2.SecurityGroup(this, 'LambdaSecurityGroup', {
            vpc,
            securityGroupName: 'lambda-security-group',
            description: 'Security group for Lambda access to Aurora',
        });
    }
    addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, auroraSecurityGroup) {
        auroraSecurityGroup.addIngressRule(lambdaSecurityGroup, ec2.Port.tcp(5432), 'Allow PostgreSQL access from Lambda security group');
    }
    setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy) {
        const customResource = (0, custom_resource_provider_helper_1.buildCustomResourceProvider)({
            providerName: 'AmazonAuroraPgVectorCRProvider',
            vpc: databaseClusterResources.vpc,
            securityGroup: lambdaSecurityGroup,
            codePath: path.join(__dirname, '../../../lambda/amazon-aurora-pgvector-custom-resources'),
            handler: 'custom_resources.on_event',
            runtime: cdk.aws_lambda.Runtime.PYTHON_3_12,
        });
        const crProvider = customResource.getProvider(this);
        crProvider.role.addManagedPolicy(auroraPgCRPolicy);
        databaseClusterResources.secret.grantRead(crProvider.role);
        const auroraPgVector = new cdk.CustomResource(this, 'AuroraPgVector', {
            resourceType: 'Custom::AmazonAuroraPgVector',
            serviceToken: crProvider.serviceToken,
            properties: {
                SecretName: databaseClusterResources.secret.secretName || '',
                ClusterIdentifier: databaseClusterResources.clusterIdentifier,
                DatabaseName: this.databaseName,
                TableName: this.tableName,
                VectorDimensions: this.embeddingsModelVectorDimension,
                PrimaryKeyField: this.primaryKeyField,
                SchemaName: this.schemaName,
                VectorField: this.vectorField,
                TextField: this.textField,
                MetadataField: this.metadataField,
            },
        });
        auroraPgVector.node.addDependency(auroraPgCRPolicy);
        return auroraPgVector;
    }
}
class ExistingAmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.setupDatabaseClusterResources(props.vpc, props.secret, props.clusterIdentifier, props.auroraSecurityGroup);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = this.generateResourceArn(databaseClusterResources.clusterIdentifier);
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
    }
}
exports.ExistingAmazonAuroraVectorStore = ExistingAmazonAuroraVectorStore;
_a = JSII_RTTI_SYMBOL_1;
ExistingAmazonAuroraVectorStore[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.ExistingAmazonAuroraVectorStore", version: "0.1.309" };
class AmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    /**
     * Creates an instance of AmazonAuroraVectorStore using existing Aurora Vector Store properties.
     * You need to provide your existing Aurora Vector Store properties
     * such as `databaseName`, `clusterIdentifier`, `vpc` where database is deployed,
     * `secret` containing username and password for authentication to database,
     * and `auroraSecurityGroup` with the ecurity group that was used for the database.
     *
     * @param scope - The scope in which to define the construct.
     * @param id - The ID of the construct.
     * @param props - The properties of the existing Aurora Vector Store.
     * @returns An instance of AmazonAuroraVectorStore.
     */
    static fromExistingAuroraVectorStore(scope, id, props) {
        return new ExistingAmazonAuroraVectorStore(scope, id, props);
    }
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.createDatabaseCluster(props.postgreSQLVersion ?? exports.SupportedPostgreSQLVersions.AURORA_POSTGRESQL_V15_5, props.vpc, props.clusterId);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = databaseClusterResources.resourceArn;
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        const auroraPgVector = this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
        auroraPgVector.node.addDependency(databaseClusterResources.auroraCluster);
    }
    createDatabaseCluster(postgreSQLVersion, existingVpc, clusterIdentifier) {
        const vpc = (0, vpc_helper_1.buildVpc)(this, {
            existingVpc: existingVpc,
            vpcName: `${this.node.id}-vpc`,
        });
        vpc.addFlowLog('VpcFlowLog', {
            destination: ec2.FlowLogDestination.toCloudWatchLogs(),
        });
        const auroraSecurityGroup = new ec2.SecurityGroup(this, 'AuroraSecurityGroup', {
            vpc,
            securityGroupName: 'aurora-security-group',
            description: 'Security group for access to Aurora from Lambda',
        });
        const auroraCluster = new rds.DatabaseCluster(this, 'AuroraCluster', {
            engine: rds.DatabaseClusterEngine.auroraPostgres({
                version: postgreSQLVersion,
            }),
            credentials: rds.Credentials.fromGeneratedSecret('postgres'),
            clusterIdentifier: clusterIdentifier ??
                (0, utils_1.generatePhysicalNameV2)(this, 'aurora-serverless', {
                    maxLength: 63,
                    lower: true,
                    separator: '-',
                }),
            defaultDatabaseName: this.databaseName,
            vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [auroraSecurityGroup],
            iamAuthentication: true,
            storageEncrypted: true,
            serverlessV2MinCapacity: 0.5,
            serverlessV2MaxCapacity: 4,
            writer: rds.ClusterInstance.serverlessV2('AuroraServerlessWriter'),
            readers: [
                rds.ClusterInstance.serverlessV2('AuroraServerlessReader', { scaleWithWriter: true }),
            ],
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const resourceArn = cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: auroraCluster.clusterIdentifier,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
        auroraCluster.addRotationSingleUser();
        const cfnDbCluster = auroraCluster.node.defaultChild;
        cfnDbCluster.addOverride('Properties.EnableHttpEndpoint', true);
        cdk_nag_1.NagSuppressions.addResourceSuppressions(auroraCluster, [
            {
                id: 'AwsSolutions-RDS10',
                reason: 'Deletion protection is disabled to make sure a customer can stop ' +
                    'incurring charges if they want to delete the construct.',
            },
        ], true);
        return {
            vpc,
            auroraCluster,
            resourceArn,
            secret: auroraCluster.secret,
            auroraSecurityGroup,
            clusterIdentifier: auroraCluster.clusterIdentifier,
        };
    }
}
exports.AmazonAuroraVectorStore = AmazonAuroraVectorStore;
_b = JSII_RTTI_SYMBOL_1;
AmazonAuroraVectorStore[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.AmazonAuroraVectorStore", version: "0.1.309" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyb3JhLXZlY3Rvci1zdG9yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jZGstbGliL2FtYXpvbmF1cm9yYS9hdXJvcmEtdmVjdG9yLXN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2QkFBNkI7QUFDN0IsbUNBQW1DO0FBQ25DLDJDQUEyQztBQUMzQywyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLHFDQUEwQztBQUMxQywyQ0FBdUM7QUFDdkMsMEdBQW1HO0FBQ25HLHNEQUFvRTtBQUNwRSxnRUFJeUM7QUFFekM7OytFQUUrRTtBQUMvRTs7R0FFRztBQUNVLFFBQUEsMkJBQTJCLEdBQUc7SUFDekMsd0JBQXdCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFNBQVM7SUFDbkUsd0JBQXdCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFNBQVM7SUFDbkUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7SUFDakUsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLDJCQUEyQixDQUFDLFFBQVE7Q0FDekQsQ0FBQztBQXFKWDs7O0dBR0c7QUFDSCxNQUFlLDJCQUE0QixTQUFRLHNC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RSxFQUFFLEVBQUUsb0JBQW9CO2dCQUN4QixNQUFNLEVBQ0osbUVBQW1FO29CQUNuRSx5REFBeUQ7YUFDNUQ7U0FDRixFQUNELElBQUksQ0FDTCxDQUFDO1FBRUYsT0FBTztZQUNMLEdBQUc7WUFDSCxhQUFhO1lBQ2IsV0FBVztZQUNYLE1BQU0sRUFBRSxhQUFhLENBQUMsTUFBTztZQUM3QixtQkFBbUI7WUFDbkIsaUJBQWlCLEVBQUUsYUFBYSxDQUFDLGlCQUFpQjtTQUNuRCxDQUFDO0lBQ0osQ0FBQzs7QUFySkgsMERBc0pDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBlYzIgZnJvbSAnYXdzLWNkay1saWIvYXdzLWVjMic7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyByZHMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXJkcyc7XG5pbXBvcnQgKiBhcyBzZWNyZXRzbWFuYWdlciBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc2VjcmV0c21hbmFnZXInO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IGJ1aWxkQ3VzdG9tUmVzb3VyY2VQcm92aWRlciB9IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzL2N1c3RvbS1yZXNvdXJjZS1wcm92aWRlci1oZWxwZXInO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCB7XG4gIEFkZEF3c1NlcnZpY2VFbmRwb2ludCxcbiAgYnVpbGRWcGMsXG4gIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLFxufSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy92cGMtaGVscGVyJztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTlVNU1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBMaXN0IG9mIHN1cHBvcnRlZCB2ZXJzaW9ucyBvZiBQb3N0Z3JlU1FMIGZvciBBdXJvcmEgY2x1c3Rlci5cbiAqL1xuZXhwb3J0IGNvbnN0IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9IHtcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEyXzE2OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xMl8xNixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEzXzEyOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xM18xMixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE0Xzk6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE0XzksXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV80OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV80LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfNTogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfNSxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE1XzY6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE1XzYsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV83OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV83LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfODogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfOCxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE2XzE6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE2XzEsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNl8yOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNl8yLFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTZfMzogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTZfMyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9XG4gICh0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zKVtrZXlvZiB0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zXTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT01NT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQmFzZSBwcm9wZXJ0aWVzIGZvciBhbiBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VBdXJvcmFWZWN0b3JTdG9yZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBzY2hlbWEgbmFtZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBzY2hlbWFOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIHZlY3RvciBjb2x1bW4gaW4gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG5hbWUgZm9yIHRoZSB0ZXh0IGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IHRleHRGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG5hbWUgZm9yIHRoZSBtZXRhZGF0YSBjb2x1bW4gaW4gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBtZXRhZGF0YUZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdGFibGUgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcmVhZG9ubHkgdGFibGVOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcHJpbWFyeSBrZXkgZmllbGQgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlIHRhYmxlLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJpbWFyeUtleUZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBkaW1lbnNpb24gdXNlZCBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqIFRoZSB2ZWN0b3IgZGltZW5zaW9ucyBvZiB0aGUgbW9kZWwgbXVzdCBtYXRjaCB0aGUgZGltZW5zaW9uc1xuICAgKiB1c2VkIGluIHRoZSBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC5cbiAgICovXG4gIHJlYWRvbmx5IGVtYmVkZGluZ3NNb2RlbFZlY3RvckRpbWVuc2lvbjogbnVtYmVyO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNvbmZpZ3VyaW5nIGFuIEFtYXpvbiBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMgZXh0ZW5kcyBCYXNlQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcmVhZG9ubHkgZGF0YWJhc2VOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiBQb3N0Z3JlU1FMIHRvIHVzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBsYXRlc3Qgc3VwcG9ydGVkIHZlcnNpb24gd2lsbCBiZSB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgcG9zdGdyZVNRTFZlcnNpb24/OiBTdXBwb3J0ZWRQb3N0Z3JlU1FMVmVyc2lvbnM7XG5cbiAgLyoqXG4gICAqIFVzZXIncyBWUEMgaW4gd2hpY2ggdGhleSB3YW50IHRvIGRlcGxveSBBdXJvcmEgRGF0YWJhc2UuXG4gICAqL1xuICByZWFkb25seSB2cGM/OiBlYzIuSVZwYztcblxuICAvKipcbiAgICogQ2x1c3RlciBpZGVudGlmaWVyLlxuICAgKi9cbiAgcmVhZG9ubHkgY2x1c3RlcklkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGFuIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKiBZb3UgZGF0YWJhc2UgbXVzdCBoYXZlIFRDUC9JUCBwb3J0IHRoYXQgdGhlXG4gKiBkYXRhYmFzZSB3aWxsIHVzZSBmb3IgYXBwbGljYXRpb24gY29ubmVjdGlvbnNcbiAqIHNldCB1cCBmb3IgYDU0MzJgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyBleHRlbmRzIEJhc2VBdXJvcmFWZWN0b3JTdG9yZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBkYXRhYmFzZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBjbHVzdGVyIGlkZW50aWZpZXIgb2YgeW91ciBBdXJvcmEgUkRTIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSBjbHVzdGVySWRlbnRpZmllcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIGluIHdoaWNoIHRoZSBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIGlzIGxvY2F0ZWQuXG4gICAqL1xuICByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VjcmV0IGNvbnRhaW5pbmcgdGhlIGRhdGFiYXNlIGNyZWRlbnRpYWxzLlxuICAgKiBUaGUgc2VjcmV0IG11c3QgY29udGFpbiBgaG9zdGAsIGBwb3J0YCwgYHVzZXJuYW1lYCxcbiAgICogYHBhc3N3b3JkYCBhbmQgYGRibmFtZWAgdmFsdWVzLlxuICAgKi9cbiAgcmVhZG9ubHkgc2VjcmV0OiBzZWNyZXRzbWFuYWdlci5JU2VjcmV0O1xuXG4gIC8qKlxuICAgKiBUaGUgU2VjdXJpdHkgZ3JvdXAgYXNzb2NpYXRlZCB3aXRoIHRoZSBSRFMgQXVyb3JhIGluc3RhbmNlLlxuICAgKiBUaGlzIHNlY3VyaXR5IGdyb3VwIGFsbG93cyBhY2Nlc3MgdG8gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUgZnJvbSBMYW1iZGEnc1xuICAgKiBjdXN0b20gcmVzb3VyY2UgcnVubmluZyBwZ1ZlY3RvciBTUUwgY29tbWFuZHMuXG4gICAqL1xuICByZWFkb25seSBhdXJvcmFTZWN1cml0eUdyb3VwOiBlYzIuSVNlY3VyaXR5R3JvdXA7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHJlcHJlc2VudGluZyB0aGUgcmVzb3VyY2VzIHJlcXVpcmVkIGZvciBhIGRhdGFiYXNlIGNsdXN0ZXIuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzIHtcbiAgLyoqXG4gICAqIFRoZSBBbWF6b24gQXVyb3JhIFJEUyBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgYXVyb3JhQ2x1c3Rlcj86IHJkcy5EYXRhYmFzZUNsdXN0ZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgeW91ciBleGlzdGluZyBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGNsdXN0ZXIgaWRlbnRpZmllciBvZiB0aGUgQXVyb3JhIFJEUyBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFZQQyBpbiB3aGljaCB0aGUgZGF0YWJhc2UgY2x1c3RlciBpcyBsb2NhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgdnBjOiBlYzIuSVZwYztcblxuICAvKipcbiAgICogVGhlIHNlY3JldCBjb250YWluaW5nIHRoZSBkYXRhYmFzZSBjcmVkZW50aWFscy5cbiAgICogVGhlIHNlY3JldCBtdXN0IGNvbnRhaW4gYHVzZXJuYW1lYCBhbmQgYHBhc3N3b3JkYCB2YWx1ZXMuXG4gICAqL1xuICByZWFkb25seSBzZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLklTZWNyZXQ7XG5cbiAgLyoqXG4gICAqIFRoZSBzZWN1cml0eSBncm91cCBhc3NvY2lhdGVkIHdpdGggdGhlIEF1cm9yYSBjbHVzdGVyLlxuICAgKi9cbiAgcmVhZG9ubHkgYXVyb3JhU2VjdXJpdHlHcm91cDogZWMyLklTZWN1cml0eUdyb3VwO1xufVxuXG4vKipcbiAqIEJhc2UgY2xhc3MgZm9yIEFtYXpvbiBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICogSGFuZGxlcyBib3RoIHRoZSBjcmVhdGlvbiBvZiBhIG5ldyBBdXJvcmEgVmVjdG9yIFN0b3JlIG9yIHRoZSB1c2FnZSBvZiBhbiBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICovXG5hYnN0cmFjdCBjbGFzcyBCYXNlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICAvKipcbiAgICogVGhlIHNjaGVtYSBuYW1lIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzY2hlbWFOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBuYW1lIGZvciB0aGUgdmVjdG9yIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB2ZWN0b3JGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIHRleHQgY29sdW1uIGluIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHRleHRGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIG1ldGFkYXRhIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBtZXRhZGF0YUZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YWJhc2VOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSB0YWJsZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGFibGVOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBwcmltYXJ5IGtleSBmaWVsZCBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUgdGFibGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcHJpbWFyeUtleUZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBlbWJlZGRpbmdzIG1vZGVsIGRpbWVuc2lvbiB1c2VkIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogVGhlIHZlY3RvciBkaW1lbnNpb25zIG9mIHRoZSBtb2RlbCBtdXN0IG1hdGNoIHRoZSBkaW1lbnNpb25zXG4gICAqIHVzZWQgaW4gdGhlIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LlxuICAgKi9cbiAgcmVhZG9ubHkgZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBpZDogc3RyaW5nLFxuICAgIHByb3BzOiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzIHwgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzLFxuICApIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLyoqXG4gICAgICogU2V0dXAgZGF0YWJhc2VOYW1lIGJhc2VkIG9uIGlmIGl0IGlzIHByb3ZpZGVkIGluIHRoZSBwcm9wcyBvciBub3RcbiAgICAgKiBhbmQgYmFzZWQgb24gd2hldGhlciBpdCBpcyBhbiBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIG9yIG5vdC5cbiAgICAgKi9cbiAgICB0aGlzLmRhdGFiYXNlTmFtZSA9XG4gICAgICAnY2x1c3RlcklkZW50aWZpZXInIGluIHByb3BzID8gcHJvcHMuZGF0YWJhc2VOYW1lIDogcHJvcHMuZGF0YWJhc2VOYW1lID8/ICdiZWRyb2NrX3ZlY3Rvcl9kYic7XG5cbiAgICB0aGlzLnNjaGVtYU5hbWUgPSBwcm9wcy5zY2hlbWFOYW1lID8/ICdiZWRyb2NrX2ludGVncmF0aW9uJztcbiAgICB0aGlzLnZlY3RvckZpZWxkID0gcHJvcHMudmVjdG9yRmllbGQgPz8gJ2VtYmVkZGluZyc7XG4gICAgdGhpcy50ZXh0RmllbGQgPSBwcm9wcy50ZXh0RmllbGQgPz8gJ2NodW5rcyc7XG4gICAgdGhpcy5tZXRhZGF0YUZpZWxkID0gcHJvcHMubWV0YWRhdGFGaWVsZCA/PyAnbWV0YWRhdGEnO1xuICAgIHRoaXMudGFibGVOYW1lID0gcHJvcHMudGFibGVOYW1lID8/ICdiZWRyb2NrX2tiJztcbiAgICB0aGlzLnByaW1hcnlLZXlGaWVsZCA9IHByb3BzLnByaW1hcnlLZXlGaWVsZCA/PyAnaWQnO1xuICAgIHRoaXMuZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uID0gcHJvcHMuZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUF1cm9yYVBnQ1JQb2xpY3koY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyk6IGlhbS5NYW5hZ2VkUG9saWN5IHtcbiAgICBjb25zdCBjclBvbGljeSA9IG5ldyBpYW0uTWFuYWdlZFBvbGljeSh0aGlzLCAnQXVyb3JhUGdQb2xpY3knLCB7XG4gICAgICBtYW5hZ2VkUG9saWN5TmFtZTogZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnQXVyb3JhUGdQb2xpY3knLCB7XG4gICAgICAgIG1heExlbmd0aDogMzIsXG4gICAgICAgIGxvd2VyOiB0cnVlLFxuICAgICAgfSksXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnZWMyOkRlc2NyaWJlSW5zdGFuY2VzJyxcbiAgICAgICAgICAgICdlYzI6Q3JlYXRlTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgICAnZWMyOkF0dGFjaE5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgICAgJ2VjMjpEZXNjcmliZU5ldHdvcmtJbnRlcmZhY2VzJyxcbiAgICAgICAgICAgICdhdXRvc2NhbGluZzpDb21wbGV0ZUxpZmVjeWNsZUFjdGlvbicsXG4gICAgICAgICAgICAnZWMyOkRlbGV0ZU5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3JkczpEZXNjcmliZURCQ2x1c3RlcnMnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAncmRzJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2U6ICdjbHVzdGVyJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiBjbHVzdGVySWRlbnRpZmllcixcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICAgIGFjY291bnQ6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgICAgICByZWdpb246IGNkay5TdGFjay5vZih0aGlzKS5yZWdpb24sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBjclBvbGljeSxcbiAgICAgIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTQnLFxuICAgICAgICAgIHJlYXNvbjpcbiAgICAgICAgICAgICdUaGUgQVdTTGFtYmRhQmFzaWNFeGVjdXRpb25Sb2xlIG1hbmFnZWQgcG9saWN5IGlzIHJlcXVpcmVkIGZvciAnICtcbiAgICAgICAgICAgICd0aGUgTGFtYmRhIGZ1bmN0aW9uIHRvIHdyaXRlIGxvZ3MgdG8gQ2xvdWRXYXRjaC4nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgJ1RoaXMgcG9saWN5IGlzIHJlcXVpcmVkIHRvIGFsbG93IHRoZSBjdXN0b20gcmVzb3VyY2UgdG8gY3JlYXRlIGEgJyArXG4gICAgICAgICAgICAnbmV0d29yayBpbnRlcmZhY2UgZm9yIHRoZSBBdXJvcmEgY2x1c3RlciBhbmQgaXQgaGFzIHRvIGJlIHdpbGRjYXJkLicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIGNyUG9saWN5O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdlbmVyYXRlUmVzb3VyY2VBcm4oY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgc2VydmljZTogJ3JkcycsXG4gICAgICByZXNvdXJjZTogJ2NsdXN0ZXInLFxuICAgICAgcmVzb3VyY2VOYW1lOiBjbHVzdGVySWRlbnRpZmllcixcbiAgICAgIHJlZ2lvbjogY2RrLlN0YWNrLm9mKHRoaXMpLnJlZ2lvbixcbiAgICAgIGFjY291bnQ6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0dXBEYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMoXG4gICAgdnBjOiBlYzIuSVZwYyxcbiAgICBzZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLklTZWNyZXQsXG4gICAgY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyxcbiAgICBhdXJvcmFTZWN1cml0eUdyb3VwOiBlYzIuSVNlY3VyaXR5R3JvdXAsXG4gICk6IERhdGFiYXNlQ2x1c3RlclJlc291cmNlcyB7XG4gICAgY29uc3QgcmVzb3VyY2VBcm4gPSB0aGlzLmdlbmVyYXRlUmVzb3VyY2VBcm4oY2x1c3RlcklkZW50aWZpZXIpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZwYyxcbiAgICAgIHNlY3JldCxcbiAgICAgIHJlc291cmNlQXJuLFxuICAgICAgYXVyb3JhU2VjdXJpdHlHcm91cCxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyLFxuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlTGFtYmRhU2VjdXJpdHlHcm91cCh2cGM6IGVjMi5JVnBjKTogZWMyLlNlY3VyaXR5R3JvdXAge1xuICAgIHJldHVybiBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ0xhbWJkYVNlY3VyaXR5R3JvdXAnLCB7XG4gICAgICB2cGMsXG4gICAgICBzZWN1cml0eUdyb3VwTmFtZTogJ2xhbWJkYS1zZWN1cml0eS1ncm91cCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NlY3VyaXR5IGdyb3VwIGZvciBMYW1iZGEgYWNjZXNzIHRvIEF1cm9yYScsXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYWRkSW5ncmVzc1J1bGVUb0F1cm9yYVNlY3VyaXR5R3JvdXAoXG4gICAgbGFtYmRhU2VjdXJpdHlHcm91cDogZWMyLklTZWN1cml0eUdyb3VwLFxuICAgIGF1cm9yYVNlY3VyaXR5R3JvdXA6IGVjMi5JU2VjdXJpdHlHcm91cCxcbiAgKSB7XG4gICAgYXVyb3JhU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGxhbWJkYVNlY3VyaXR5R3JvdXAsXG4gICAgICBlYzIuUG9ydC50Y3AoNTQzMiksXG4gICAgICAnQWxsb3cgUG9zdGdyZVNRTCBhY2Nlc3MgZnJvbSBMYW1iZGEgc2VjdXJpdHkgZ3JvdXAnLFxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0dXBDdXN0b21SZXNvdXJjZShcbiAgICBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXM6IERhdGFiYXNlQ2x1c3RlclJlc291cmNlcyxcbiAgICBsYW1iZGFTZWN1cml0eUdyb3VwOiBlYzIuU2VjdXJpdHlHcm91cCxcbiAgICBhdXJvcmFQZ0NSUG9saWN5OiBpYW0uTWFuYWdlZFBvbGljeSxcbiAgKTogY2RrLkN1c3RvbVJlc291cmNlIHtcbiAgICBjb25zdCBjdXN0b21SZXNvdXJjZSA9IGJ1aWxkQ3VzdG9tUmVzb3VyY2VQcm92aWRlcih7XG4gICAgICBwcm92aWRlck5hbWU6ICdBbWF6b25BdXJvcmFQZ1ZlY3RvckNSUHJvdmlkZXInLFxuICAgICAgdnBjOiBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMudnBjLFxuICAgICAgc2VjdXJpdHlHcm91cDogbGFtYmRhU2VjdXJpdHlHcm91cCxcbiAgICAgIGNvZGVQYXRoOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vbGFtYmRhL2FtYXpvbi1hdXJvcmEtcGd2ZWN0b3ItY3VzdG9tLXJlc291cmNlcycpLFxuICAgICAgaGFuZGxlcjogJ2N1c3RvbV9yZXNvdXJjZXMub25fZXZlbnQnLFxuICAgICAgcnVudGltZTogY2RrLmF3c19sYW1iZGEuUnVudGltZS5QWVRIT05fM18xMixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNyUHJvdmlkZXIgPSBjdXN0b21SZXNvdXJjZS5nZXRQcm92aWRlcih0aGlzKTtcbiAgICBjclByb3ZpZGVyLnJvbGUuYWRkTWFuYWdlZFBvbGljeShhdXJvcmFQZ0NSUG9saWN5KTtcbiAgICBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuc2VjcmV0LmdyYW50UmVhZChjclByb3ZpZGVyLnJvbGUpO1xuXG4gICAgY29uc3QgYXVyb3JhUGdWZWN0b3IgPSBuZXcgY2RrLkN1c3RvbVJlc291cmNlKHRoaXMsICdBdXJvcmFQZ1ZlY3RvcicsIHtcbiAgICAgIHJlc291cmNlVHlwZTogJ0N1c3RvbTo6QW1hem9uQXVyb3JhUGdWZWN0b3InLFxuICAgICAgc2VydmljZVRva2VuOiBjclByb3ZpZGVyLnNlcnZpY2VUb2tlbixcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgU2VjcmV0TmFtZTogZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnNlY3JldC5zZWNyZXROYW1lIHx8ICcnLFxuICAgICAgICBDbHVzdGVySWRlbnRpZmllcjogZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLmNsdXN0ZXJJZGVudGlmaWVyLFxuICAgICAgICBEYXRhYmFzZU5hbWU6IHRoaXMuZGF0YWJhc2VOYW1lLFxuICAgICAgICBUYWJsZU5hbWU6IHRoaXMudGFibGVOYW1lLFxuICAgICAgICBWZWN0b3JEaW1lbnNpb25zOiB0aGlzLmVtYmVkZGluZ3NNb2RlbFZlY3RvckRpbWVuc2lvbixcbiAgICAgICAgUHJpbWFyeUtleUZpZWxkOiB0aGlzLnByaW1hcnlLZXlGaWVsZCxcbiAgICAgICAgU2NoZW1hTmFtZTogdGhpcy5zY2hlbWFOYW1lLFxuICAgICAgICBWZWN0b3JGaWVsZDogdGhpcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgVGV4dEZpZWxkOiB0aGlzLnRleHRGaWVsZCxcbiAgICAgICAgTWV0YWRhdGFGaWVsZDogdGhpcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBhdXJvcmFQZ1ZlY3Rvci5ub2RlLmFkZERlcGVuZGVuY3koYXVyb3JhUGdDUlBvbGljeSk7XG5cbiAgICByZXR1cm4gYXVyb3JhUGdWZWN0b3I7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgZXh0ZW5kcyBCYXNlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByZXNvdXJjZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgU2VjcmV0IEFSTiBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjcmVkZW50aWFsc1NlY3JldEFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHZwYzogZWMyLklWcGM7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuXG4gICAgY29uc3QgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzID0gdGhpcy5zZXR1cERhdGFiYXNlQ2x1c3RlclJlc291cmNlcyhcbiAgICAgIHByb3BzLnZwYyxcbiAgICAgIHByb3BzLnNlY3JldCxcbiAgICAgIHByb3BzLmNsdXN0ZXJJZGVudGlmaWVyLFxuICAgICAgcHJvcHMuYXVyb3JhU2VjdXJpdHlHcm91cCxcbiAgICApO1xuXG4gICAgY29uc3QgYXVyb3JhUGdDUlBvbGljeSA9IHRoaXMuY3JlYXRlQXVyb3JhUGdDUlBvbGljeShcbiAgICAgIGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5jbHVzdGVySWRlbnRpZmllcixcbiAgICApO1xuICAgIGNvbnN0IGxhbWJkYVNlY3VyaXR5R3JvdXAgPSB0aGlzLmNyZWF0ZUxhbWJkYVNlY3VyaXR5R3JvdXAoZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYyk7XG4gICAgdGhpcy5hZGRJbmdyZXNzUnVsZVRvQXVyb3JhU2VjdXJpdHlHcm91cChcbiAgICAgIGxhbWJkYVNlY3VyaXR5R3JvdXAsXG4gICAgICBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuYXVyb3JhU2VjdXJpdHlHcm91cCxcbiAgICApO1xuXG4gICAgdGhpcy5yZXNvdXJjZUFybiA9IHRoaXMuZ2VuZXJhdGVSZXNvdXJjZUFybihkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIpO1xuICAgIHRoaXMuY3JlZGVudGlhbHNTZWNyZXRBcm4gPSBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuc2VjcmV0LnNlY3JldEFybjtcbiAgICB0aGlzLnZwYyA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGM7XG5cbiAgICBBZGRBd3NTZXJ2aWNlRW5kcG9pbnQoc2NvcGUsIHRoaXMudnBjLCBbXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5TRUNSRVRTX01BTkFHRVIsXG4gICAgICBTZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5CRURST0NLX1JVTlRJTUUsXG4gICAgXSk7XG5cbiAgICB0aGlzLnNldHVwQ3VzdG9tUmVzb3VyY2UoZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLCBsYW1iZGFTZWN1cml0eUdyb3VwLCBhdXJvcmFQZ0NSUG9saWN5KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgZXh0ZW5kcyBCYXNlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUge1xuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB1c2luZyBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIHByb3BlcnRpZXMuXG4gICAqIFlvdSBuZWVkIHRvIHByb3ZpZGUgeW91ciBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlIHByb3BlcnRpZXNcbiAgICogc3VjaCBhcyBgZGF0YWJhc2VOYW1lYCwgYGNsdXN0ZXJJZGVudGlmaWVyYCwgYHZwY2Agd2hlcmUgZGF0YWJhc2UgaXMgZGVwbG95ZWQsXG4gICAqIGBzZWNyZXRgIGNvbnRhaW5pbmcgdXNlcm5hbWUgYW5kIHBhc3N3b3JkIGZvciBhdXRoZW50aWNhdGlvbiB0byBkYXRhYmFzZSxcbiAgICogYW5kIGBhdXJvcmFTZWN1cml0eUdyb3VwYCB3aXRoIHRoZSBlY3VyaXR5IGdyb3VwIHRoYXQgd2FzIHVzZWQgZm9yIHRoZSBkYXRhYmFzZS5cbiAgICpcbiAgICogQHBhcmFtIHNjb3BlIC0gVGhlIHNjb3BlIGluIHdoaWNoIHRvIGRlZmluZSB0aGUgY29uc3RydWN0LlxuICAgKiBAcGFyYW0gaWQgLSBUaGUgSUQgb2YgdGhlIGNvbnN0cnVjdC5cbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqIEByZXR1cm5zIEFuIGluc3RhbmNlIG9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tRXhpc3RpbmdBdXJvcmFWZWN0b3JTdG9yZShcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM6IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyxcbiAgKTogRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB7XG4gICAgcmV0dXJuIG5ldyBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlKHNjb3BlLCBpZCwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcmVzb3VyY2VBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFNlY3JldCBBUk4gb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY3JlZGVudGlhbHNTZWNyZXRBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFZQQyBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICBjb25zdCBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMgPSB0aGlzLmNyZWF0ZURhdGFiYXNlQ2x1c3RlcihcbiAgICAgIHByb3BzLnBvc3RncmVTUUxWZXJzaW9uID8/IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucy5BVVJPUkFfUE9TVEdSRVNRTF9WMTVfNSxcbiAgICAgIHByb3BzLnZwYyxcbiAgICAgIHByb3BzLmNsdXN0ZXJJZCxcbiAgICApO1xuICAgIGNvbnN0IGF1cm9yYVBnQ1JQb2xpY3kgPSB0aGlzLmNyZWF0ZUF1cm9yYVBnQ1JQb2xpY3koXG4gICAgICBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIsXG4gICAgKTtcbiAgICBjb25zdCBsYW1iZGFTZWN1cml0eUdyb3VwID0gdGhpcy5jcmVhdGVMYW1iZGFTZWN1cml0eUdyb3VwKGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy52cGMpO1xuICAgIHRoaXMuYWRkSW5ncmVzc1J1bGVUb0F1cm9yYVNlY3VyaXR5R3JvdXAoXG4gICAgICBsYW1iZGFTZWN1cml0eUdyb3VwLFxuICAgICAgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLmF1cm9yYVNlY3VyaXR5R3JvdXAsXG4gICAgKTtcblxuICAgIHRoaXMucmVzb3VyY2VBcm4gPSBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMucmVzb3VyY2VBcm47XG4gICAgdGhpcy5jcmVkZW50aWFsc1NlY3JldEFybiA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5zZWNyZXQuc2VjcmV0QXJuO1xuICAgIHRoaXMudnBjID0gZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYztcblxuICAgIEFkZEF3c1NlcnZpY2VFbmRwb2ludChzY29wZSwgdGhpcy52cGMsIFtcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLlNFQ1JFVFNfTUFOQUdFUixcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLkJFRFJPQ0tfUlVOVElNRSxcbiAgICBdKTtcblxuICAgIGNvbnN0IGF1cm9yYVBnVmVjdG9yID0gdGhpcy5zZXR1cEN1c3RvbVJlc291cmNlKFxuICAgICAgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLFxuICAgICAgbGFtYmRhU2VjdXJpdHlHcm91cCxcbiAgICAgIGF1cm9yYVBnQ1JQb2xpY3ksXG4gICAgKTtcblxuICAgIGF1cm9yYVBnVmVjdG9yLm5vZGUuYWRkRGVwZW5kZW5jeShkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuYXVyb3JhQ2x1c3RlciEpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEYXRhYmFzZUNsdXN0ZXIoXG4gICAgcG9zdGdyZVNRTFZlcnNpb246IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyxcbiAgICBleGlzdGluZ1ZwYzogZWMyLklWcGMgfCB1bmRlZmluZWQsXG4gICAgY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgKTogRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzIHtcbiAgICBjb25zdCB2cGMgPSBidWlsZFZwYyh0aGlzLCB7XG4gICAgICBleGlzdGluZ1ZwYzogZXhpc3RpbmdWcGMsXG4gICAgICB2cGNOYW1lOiBgJHt0aGlzLm5vZGUuaWR9LXZwY2AsXG4gICAgfSk7XG4gICAgdnBjLmFkZEZsb3dMb2coJ1ZwY0Zsb3dMb2cnLCB7XG4gICAgICBkZXN0aW5hdGlvbjogZWMyLkZsb3dMb2dEZXN0aW5hdGlvbi50b0Nsb3VkV2F0Y2hMb2dzKCksXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdXJvcmFTZWN1cml0eUdyb3VwID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdBdXJvcmFTZWN1cml0eUdyb3VwJywge1xuICAgICAgdnBjLFxuICAgICAgc2VjdXJpdHlHcm91cE5hbWU6ICdhdXJvcmEtc2VjdXJpdHktZ3JvdXAnLFxuICAgICAgZGVzY3JpcHRpb246ICdTZWN1cml0eSBncm91cCBmb3IgYWNjZXNzIHRvIEF1cm9yYSBmcm9tIExhbWJkYScsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdXJvcmFDbHVzdGVyID0gbmV3IHJkcy5EYXRhYmFzZUNsdXN0ZXIodGhpcywgJ0F1cm9yYUNsdXN0ZXInLCB7XG4gICAgICBlbmdpbmU6IHJkcy5EYXRhYmFzZUNsdXN0ZXJFbmdpbmUuYXVyb3JhUG9zdGdyZXMoe1xuICAgICAgICB2ZXJzaW9uOiBwb3N0Z3JlU1FMVmVyc2lvbixcbiAgICAgIH0pLFxuICAgICAgY3JlZGVudGlhbHM6IHJkcy5DcmVkZW50aWFscy5mcm9tR2VuZXJhdGVkU2VjcmV0KCdwb3N0Z3JlcycpLFxuICAgICAgY2x1c3RlcklkZW50aWZpZXI6XG4gICAgICAgIGNsdXN0ZXJJZGVudGlmaWVyID8/XG4gICAgICAgIGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2F1cm9yYS1zZXJ2ZXJsZXNzJywge1xuICAgICAgICAgIG1heExlbmd0aDogNjMsXG4gICAgICAgICAgbG93ZXI6IHRydWUsXG4gICAgICAgICAgc2VwYXJhdG9yOiAnLScsXG4gICAgICAgIH0pLFxuICAgICAgZGVmYXVsdERhdGFiYXNlTmFtZTogdGhpcy5kYXRhYmFzZU5hbWUsXG4gICAgICB2cGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfSVNPTEFURUQgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbYXVyb3JhU2VjdXJpdHlHcm91cF0sXG4gICAgICBpYW1BdXRoZW50aWNhdGlvbjogdHJ1ZSxcbiAgICAgIHN0b3JhZ2VFbmNyeXB0ZWQ6IHRydWUsXG4gICAgICBzZXJ2ZXJsZXNzVjJNaW5DYXBhY2l0eTogMC41LFxuICAgICAgc2VydmVybGVzc1YyTWF4Q2FwYWNpdHk6IDQsXG4gICAgICB3cml0ZXI6IHJkcy5DbHVzdGVySW5zdGFuY2Uuc2VydmVybGVzc1YyKCdBdXJvcmFTZXJ2ZXJsZXNzV3JpdGVyJyksXG4gICAgICByZWFkZXJzOiBbXG4gICAgICAgIHJkcy5DbHVzdGVySW5zdGFuY2Uuc2VydmVybGVzc1YyKCdBdXJvcmFTZXJ2ZXJsZXNzUmVhZGVyJywgeyBzY2FsZVdpdGhXcml0ZXI6IHRydWUgfSksXG4gICAgICBdLFxuICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICB9KTtcbiAgICBjb25zdCByZXNvdXJjZUFybiA9IGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgc2VydmljZTogJ3JkcycsXG4gICAgICByZXNvdXJjZTogJ2NsdXN0ZXInLFxuICAgICAgcmVzb3VyY2VOYW1lOiBhdXJvcmFDbHVzdGVyLmNsdXN0ZXJJZGVudGlmaWVyLFxuICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgfSk7XG5cbiAgICBhdXJvcmFDbHVzdGVyLmFkZFJvdGF0aW9uU2luZ2xlVXNlcigpO1xuXG4gICAgY29uc3QgY2ZuRGJDbHVzdGVyID0gYXVyb3JhQ2x1c3Rlci5ub2RlLmRlZmF1bHRDaGlsZCBhcyByZHMuQ2ZuREJDbHVzdGVyO1xuICAgIGNmbkRiQ2x1c3Rlci5hZGRPdmVycmlkZSgnUHJvcGVydGllcy5FbmFibGVIdHRwRW5kcG9pbnQnLCB0cnVlKTtcblxuICAgIE5hZ1N1cHByZXNzaW9ucy5hZGRSZXNvdXJjZVN1cHByZXNzaW9ucyhcbiAgICAgIGF1cm9yYUNsdXN0ZXIsXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ0F3c1NvbHV0aW9ucy1SRFMxMCcsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgJ0RlbGV0aW9uIHByb3RlY3Rpb24gaXMgZGlzYWJsZWQgdG8gbWFrZSBzdXJlIGEgY3VzdG9tZXIgY2FuIHN0b3AgJyArXG4gICAgICAgICAgICAnaW5jdXJyaW5nIGNoYXJnZXMgaWYgdGhleSB3YW50IHRvIGRlbGV0ZSB0aGUgY29uc3RydWN0LicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZwYyxcbiAgICAgIGF1cm9yYUNsdXN0ZXIsXG4gICAgICByZXNvdXJjZUFybixcbiAgICAgIHNlY3JldDogYXVyb3JhQ2x1c3Rlci5zZWNyZXQhLFxuICAgICAgYXVyb3JhU2VjdXJpdHlHcm91cCxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyOiBhdXJvcmFDbHVzdGVyLmNsdXN0ZXJJZGVudGlmaWVyLFxuICAgIH07XG4gIH1cbn1cbiJdfQ==